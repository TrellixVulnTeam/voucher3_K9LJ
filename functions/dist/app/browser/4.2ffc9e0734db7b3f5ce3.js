(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{JZFu:function(t,e,n){"use strict";n.d(e,"a",function(){return r.default});var r=n("zIRd"),i=(n("t6oF"),n("6Uf2"),n("qOnz")),o=n("q/0M"),a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function s(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var u,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l=l||{},h=c||self;function f(){}function p(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function d(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),v=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function m(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function b(t,e,n){return(b=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:m).apply(null,arguments)}function _(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function w(){return Date.now()}function T(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function I(){this.j=this.j,this.i=this.i}I.prototype.j=!1,I.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,g)&&t[g]||(t[g]=++v)}(this)},I.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var E=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},O=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function S(t){return Array.prototype.concat.apply([],arguments)}function k(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function A(t){return/^[\s\xa0]*$/.test(t)}var j,N=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function C(t,e){return-1!=t.indexOf(e)}function D(t,e){return t<e?-1:t>e?1:0}t:{var x=h.navigator;if(x){var R=x.userAgent;if(R){j=R;break t}}j=""}function P(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function M(t){var e={};for(var n in t)e[n]=t[n];return e}var L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<L.length;o++)n=L[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function U(t){return U[" "](t),t}U[" "]=f;var q,V,B=C(j,"Opera"),K=C(j,"Trident")||C(j,"MSIE"),G=C(j,"Edge"),z=G||K,H=C(j,"Gecko")&&!(C(j.toLowerCase(),"webkit")&&!C(j,"Edge"))&&!(C(j,"Trident")||C(j,"MSIE"))&&!C(j,"Edge"),W=C(j.toLowerCase(),"webkit")&&!C(j,"Edge");function Q(){var t=h.document;return t?t.documentMode:void 0}t:{var X="",Y=(V=j,H?/rv:([^\);]+)(\)|;)/.exec(V):G?/Edge\/([\d\.]+)/.exec(V):K?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(V):W?/WebKit\/(\S+)/.exec(V):B?/(?:Version)[ \/]?(\S+)/.exec(V):void 0);if(Y&&(X=Y?Y[1]:""),K){var $=Q();if(null!=$&&$>parseFloat(X)){q=String($);break t}}q=X}var J={};function Z(t){return function(t,e){var n=J;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=N(String(q)).split("."),r=N(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=D(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||D(0==a[2].length,0==s[2].length)||D(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}var tt=h.document&&K&&(Q()||parseInt(q,10))||void 0,et=!K||9<=Number(tt),nt=K&&!Z("9"),rt=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{h.addEventListener("test",f,e),h.removeEventListener("test",f,e)}catch(n){}return t}();function it(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function ot(t,e){if(it.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(H){t:{try{U(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:at[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}it.prototype.b=function(){this.defaultPrevented=!0},T(ot,it);var at={2:"touch",3:"pen",4:"mouse"};ot.prototype.b=function(){ot.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,nt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var st="closure_listenable_"+(1e6*Math.random()|0),ut=0;function ct(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++ut,this.Y=this.Z=!1}function lt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function ht(t){this.src=t,this.a={},this.b=0}function ft(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=E(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(lt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function pt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}ht.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=pt(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new ct(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var dt="closure_lm_"+(1e6*Math.random()|0),gt={};function vt(t,e,n,r,i){if(r&&r.once)return mt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)vt(t,e[o],n,r,i);return null}return n=St(n),t&&t[st]?t.va(e,n,d(r)?!!r.capture:!!r,i):yt(t,e,n,!1,r,i)}function yt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=d(i)?!!i.capture:!!i;if(a&&!et)return null;var s=Et(t);if(s||(t[dt]=s=new ht(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=It,e=et?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)rt||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(wt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function mt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)mt(t,e[o],n,r,i);return null}return n=St(n),t&&t[st]?t.wa(e,n,d(r)?!!r.capture:!!r,i):yt(t,e,n,!0,r,i)}function bt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)bt(t,e[o],n,r,i);else r=d(r)?!!r.capture:!!r,n=St(n),t&&t[st]?(t=t.c,(e=String(e).toString())in t.a&&-1<(n=pt(o=t.a[e],n,r,i))&&(lt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Et(t))&&(e=t.a[e.toString()],t=-1,e&&(t=pt(e,n,r,i)),(n=-1<t?e[t]:null)&&_t(n))}function _t(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[st])ft(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(wt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Et(e))?(ft(n,t),0==n.b&&(n.src=null,e[dt]=null)):lt(t)}}}function wt(t){return t in gt?gt[t]:gt[t]="on"+t}function Tt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&_t(t),n.call(r,e)}function It(t,e){if(t.Y)return!0;if(!et){if(!e)t:{e=["window","event"];for(var n=h,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Tt(t,e=new ot(e,this))}return Tt(t,new ot(e,this))}function Et(t){return(t=t[dt])instanceof ht?t:null}var Ot="__closure_events_fn_"+(1e9*Math.random()>>>0);function St(t){return"function"==typeof t?t:(t[Ot]||(t[Ot]=function(e){return t.handleEvent(e)}),t[Ot])}function kt(){I.call(this),this.c=new ht(this),this.J=this,this.C=null}function At(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new it(e,t);else if(e instanceof it)e.target=e.target||t;else{var i=e;F(e=new it(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var a=e.a=n[o];i=jt(a,r,!0,e)&&i}if(i=jt(a=e.a=t,r,!0,e)&&i,i=jt(a,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=jt(a=e.a=n[o],r,!1,e)&&i}function jt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.Y&&a.capture==n){var s=a.listener,u=a.ca||a.src;a.Z&&ft(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&!r.defaultPrevented}T(kt,I),kt.prototype[st]=!0,(u=kt.prototype).addEventListener=function(t,e,n,r){vt(this,t,e,n,r)},u.removeEventListener=function(t,e,n,r){bt(this,t,e,n,r)},u.G=function(){if(kt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)lt(n[r]);delete e.a[t],e.b--}}this.C=null},u.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},u.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Nt=h.JSON.stringify;function Ct(){this.b=this.a=null}var Dt,xt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())(function(){return new Pt},function(t){t.reset()});function Rt(){var t=Ut,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Pt(){this.next=this.b=this.a=null}function Mt(t){h.setTimeout(function(){throw t},0)}function Lt(t,e){Dt||function(){var t=h.Promise.resolve(void 0);Dt=function(){t.then(qt)}}(),Ft||(Dt(),Ft=!0),Ut.add(t,e)}Ct.prototype.add=function(t,e){var n=xt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Pt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Pt.prototype.reset=function(){this.next=this.b=this.a=null};var Ft=!1,Ut=new Ct;function qt(){for(var t;t=Rt();){try{t.a.call(t.b)}catch(n){Mt(n)}var e=xt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Ft=!1}function Vt(t,e){kt.call(this),this.b=t||1,this.a=e||h,this.f=b(this.Za,this),this.g=w()}function Bt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Kt(t,e,n){if("function"==typeof t)n&&(t=b(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=b(t.handleEvent,t)}return 2147483647<Number(e)?-1:h.setTimeout(t,e||0)}function Gt(t){t.a=Kt(function(){t.a=null,t.c&&(t.c=!1,Gt(t))},t.h);var e=t.b;t.b=null,t.g.apply(null,e)}T(Vt,kt),(u=Vt.prototype).aa=!1,u.M=null,u.Za=function(){if(this.aa){var t=w()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),At(this,"tick"),this.aa&&(Bt(this),this.start()))}},u.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=w())},u.G=function(){Vt.X.G.call(this),Bt(this),delete this.a};var zt=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:Gt(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(h.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(I);function Ht(t){I.call(this),this.b=t,this.a={}}T(Ht,I);var Wt=[];function Qt(t,e,n,r){Array.isArray(n)||(n&&(Wt[0]=n.toString()),n=Wt);for(var i=0;i<n.length;i++){var o=vt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Xt(t){P(t.a,function(t,e){this.a.hasOwnProperty(e)&&_t(t)},t),t.a={}}function Yt(){this.a=!0}function $t(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var a=1;a<i.length;a++)i[a]=""}}}return Nt(n)}catch(s){return e}}(t,n)+(r?" "+r:"")})}Ht.prototype.G=function(){Ht.X.G.call(this),Xt(this)},Ht.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Yt.prototype.info=function(){};var Jt={},Zt=null;function te(){return Zt=Zt||new kt}function ee(t){it.call(this,Jt.Fa,t)}function ne(t){var e=te();At(e,new ee(e,t))}function re(t,e){it.call(this,Jt.STAT_EVENT,t),this.stat=e}function ie(t){var e=te();At(e,new re(e,t))}function oe(t){it.call(this,Jt.Ga,t)}function ae(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){t()},e)}Jt.Fa="serverreachability",T(ee,it),Jt.STAT_EVENT="statevent",T(re,it),Jt.Ga="timingevent",T(oe,it);var se={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},ue={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function ce(){}function le(){}ce.prototype.a=null;var he,fe={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function pe(){it.call(this,"d")}function de(){it.call(this,"c")}function ge(){}function ve(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new Ht(this),this.P=ye,this.R=new Vt(t=z?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}T(pe,it),T(de,it),T(ge,ce),he=new ge;var ye=45e3,me={},be={};function _e(t,e,n){t.H=1,t.i=Be(Me(e)),t.j=n,t.I=!0,we(t,null)}function we(t,e){t.u=w(),Ee(t),t.l=Me(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),en(n.b,"t",r),t.D=0,t.a=Yn(t.g,t.g.C?e:null),0<t.O&&(t.F=new zt(b(t.Ca,t,t.a),t.O)),Qt(t.J,t.a,"readystatechange",t.Xa),e=t.B?M(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ne(1),function(t,e,n,r,i,o){t.info(function(){if(t.a)if(o)for(var a="",s=o.split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");a=2<=h.length&&"type"==h[1]?a+(l+"=")+c+"&":a+(l+"=redacted&")}}else a=null;else a=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+a})}(t.c,t.m,t.l,t.f,t.S,t.j)}function Te(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Ie(t,n);if(i==be){4==e&&(t.h=4,ie(14),r=!1),$t(t.c,t.f,null,"[Incomplete Response]");break}if(i==me){t.h=4,ie(15),$t(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}$t(t.c,t.f,i,null),je(t,i)}4==e&&0==n.length&&(t.h=1,ie(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Bn(e),e.F=!0,ie(11))):($t(t.c,t.f,n,"[Invalid Chunked Response]"),Ae(t),ke(t))}function Ie(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?be:(n=Number(e.substring(n,r)),isNaN(n)?me:(r+=1)+n>e.length?be:(e=e.substr(r,n),t.D=r+n,e))}function Ee(t){t.T=w()+t.P,Oe(t,t.P)}function Oe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ae(b(t.Va,t),e)}function Se(t){t.o&&(h.clearTimeout(t.o),t.o=null)}function ke(t){0==t.g.v||t.A||zn(t.g,t)}function Ae(t){Se(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Bt(t.R),Xt(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function je(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||cn(n.b,t)))if(n.I=t.N,!t.C&&cn(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(Uf){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Gn(n),xn(n)}Vn(n),ie(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=ae(b(n.Sa,n),6e3));if(1>=un(n.b)&&n.ea){try{n.ea()}catch(Uf){}n.ea=void 0}}else Wn(n,11)}else if((t.C||n.a==t)&&Gn(n),!A(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var a=i[4];null!=a&&(n.pa=a,n.c.info("SVER="+n.pa));var s=i[5];if(null!=s&&"number"==typeof s&&0<s){var u=1.5*s;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var l=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=u.b;!h.a&&(C(l,"spdy")||C(l,"quic")||C(l,"h2"))&&(h.f=h.g,h.a=new Set,h.b&&(ln(h,h.b),h.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,Ve(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=w()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var p=t;if((u=n).la=Xn(u,u.C?u.ga:null,u.fa),p.C){hn(u.b,p);var d=p,g=u.D;g&&d.setTimeout(g),d.o&&(Se(d),Ee(d)),u.a=p}else qn(u);0<n.g.length&&Mn(n)}else"stop"!=i[0]&&"close"!=i[0]||Wn(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Wn(n,7):Dn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);ne(4)}catch(Uf){}}function Ne(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(p(t)||"string"==typeof t)O(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(p(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(p(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ce(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ce)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function De(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];xe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)xe(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function xe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(u=ve.prototype).setTimeout=function(t){this.P=t},u.Xa=function(t){t=t.target;var e=this.F;e&&3==An(t)?e.f():this.Ca(t)},u.Ca=function(t){try{if(t==this.a)t:{var e=An(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!z&&!this.a.$())){this.A||4!=e||7==n||ne(8==n||0>=r?3:2),Se(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,a){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+a})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var a,s=this.a;if((a=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(a)){var u=a;break e}}u=null}if(!u){this.b=!1,this.h=3,ie(12),Ae(this),ke(this);break t}$t(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,je(this,u)}this.I?(Te(this,e,o),z&&this.b&&3==e&&(Qt(this.J,this.R,"tick",this.Wa),this.R.start())):($t(this.c,this.f,o,null),je(this,o)),4==e&&Ae(this),this.b&&!this.A&&(4==e?zn(this.g,this):(this.b=!1,Ee(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,ie(12)):(this.h=0,ie(13)),Ae(this),ke(this)}}}catch(c){}},u.Wa=function(){if(this.a){var t=An(this.a),e=this.a.$();this.D<e.length&&(Se(this),Te(this,t,e),this.b&&4!=t&&Ee(this))}},u.cancel=function(){this.A=!0,Ae(this)},u.Va=function(){this.o=null;var t=w();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(ne(3),ie(17)),Ae(this),this.h=2,ke(this)):Oe(this,this.T-t)},(u=Ce.prototype).K=function(){De(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},u.L=function(){return De(this),this.a.concat()},u.get=function(t,e){return xe(this.b,t)?this.b[t]:e},u.set=function(t,e){xe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},u.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Re=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Pe(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Pe){this.a=void 0!==e?e:t.a,Le(this,t.f),this.j=t.j,Fe(this,t.c),Ue(this,t.h),this.g=t.g,e=t.b;var n=new $e;n.c=e.c,e.a&&(n.a=new Ce(e.a),n.b=e.b),qe(this,n),this.i=t.i}else t&&(n=String(t).match(Re))?(this.a=!!e,Le(this,n[1]||"",!0),this.j=Ke(n[2]||""),Fe(this,n[3]||"",!0),Ue(this,n[4]),this.g=Ke(n[5]||"",!0),qe(this,n[6]||"",!0),this.i=Ke(n[7]||"")):(this.a=!!e,this.b=new $e(null,this.a))}function Me(t){return new Pe(t)}function Le(t,e,n){t.f=n?Ke(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Fe(t,e,n){t.c=n?Ke(e,!0):e}function Ue(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function qe(t,e,n){e instanceof $e?(t.b=e,function(t,e){e&&!t.f&&(Je(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Ze(this,e),en(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=Ge(e,Xe)),t.b=new $e(e,t.a))}function Ve(t,e,n){t.b.set(e,n)}function Be(t){return Ve(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^w()).toString(36)),t}function Ke(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ge(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ze),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ze(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Pe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ge(e,He,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ge(e,He,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ge(n,"/"==n.charAt(0)?Qe:We,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ge(n,Ye)),t.join("")};var He=/[#\/\?@]/g,We=/[#\?:]/g,Qe=/[#\?]/g,Xe=/[#\?@]/g,Ye=/#/g;function $e(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Je(t){t.a||(t.a=new Ce,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Ze(t,e){Je(t),e=nn(t,e),xe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,xe((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&De(t)))}function tn(t,e){return Je(t),e=nn(t,e),xe(t.a.b,e)}function en(t,e,n){Ze(t,e),0<n.length&&(t.c=null,t.a.set(nn(t,e),k(n)),t.b+=n.length)}function nn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(u=$e.prototype).add=function(t,e){Je(this),this.c=null,t=nn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},u.forEach=function(t,e){Je(this),this.a.forEach(function(n,r){O(n,function(n){t.call(e,n,r,this)},this)},this)},u.L=function(){Je(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},u.K=function(t){Je(this);var e=[];if("string"==typeof t)tn(this,t)&&(e=S(e,this.a.get(nn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=S(e,t[n])}return e},u.set=function(t,e){return Je(this),this.c=null,tn(this,t=nn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},u.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},u.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var rn=function(){return function(t,e){this.b=t,this.a=e}}();function on(t){this.g=t||an,t=h.PerformanceNavigationTiming?0<(t=h.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(h.ia&&h.ia.ya&&h.ia.ya()&&h.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var an=10;function sn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function un(t){return t.b?1:t.a?t.a.size:0}function cn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function ln(t,e){t.a?t.a.add(e):t.b=e}function hn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function fn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=s(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return k(t.c)}function pn(){}function dn(){this.a=new pn}function gn(t,e,n){var r=n||"";try{Ne(t,function(t,n){var i=t;d(t)&&(i=Nt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Tp){throw e.push(r+"type="+encodeURIComponent("_badmap")),Tp}}function vn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}on.prototype.cancel=function(){var t,e;if(this.c=fn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=s(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},pn.prototype.stringify=function(t){return h.JSON.stringify(t,void 0)},pn.prototype.parse=function(t){return h.JSON.parse(t,void 0)};var yn=h.JSON.parse;function mn(t){kt.call(this),this.headers=new Ce,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=bn,this.D=this.F=!1}T(mn,kt);var bn="",_n=/^https?$/i,wn=["POST","PUT"];function Tn(t){return"content-type"==t.toLowerCase()}function In(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,En(t),Sn(t)}function En(t){t.u||(t.u=!0,At(t,"complete"),At(t,"error"))}function On(t){if(t.b&&void 0!==l&&(!t.s[1]||4!=An(t)||2!=t.W()))if(t.l&&4==An(t))Kt(t.za,0,t);else if(At(t,"readystatechange"),4==An(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(Re)[1]||null;if(!o&&h.self&&h.self.location){var a=h.self.location.protocol;o=a.substr(0,a.length-1)}i=!_n.test(o?o.toLowerCase():"")}e=i}if(e)At(t,"complete"),At(t,"success");else{t.h=6;try{var s=2<An(t)?t.a.statusText:""}catch(n){s=""}t.f=s+" ["+t.W()+"]",En(t)}}finally{Sn(t)}}}function Sn(t,e){if(t.a){kn(t);var n=t.a,r=t.s[0]?f:null;t.a=null,t.s=null,e||At(t,"ready");try{n.onreadystatechange=r}catch(Tp){}}}function kn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(h.clearTimeout(t.m),t.m=null)}function An(t){return t.a?t.a.readyState:0}function jn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return P(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ve(t,e,n))}function Nn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Cn(t){this.pa=0,this.g=[],this.c=new Yt,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Nn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Nn("baseRetryDelayMs",5e3,t),this.Ra=Nn("retryDelaySeedMs",1e4,t),this.Ma=Nn("forwardChannelMaxRetries",2,t),this.ma=Nn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new on(t&&t.concurrentRequestLimit),this.ka=new dn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Dn(t){if(Rn(t),3==t.v){var e=t.R++,n=Me(t.B);Ve(n,"SID",t.J),Ve(n,"RID",e),Ve(n,"TYPE","terminate"),Fn(t,n),(e=new ve(t,t.c,e,void 0)).H=2,e.i=Be(Me(n)),n=!1,h.navigator&&h.navigator.sendBeacon&&(n=h.navigator.sendBeacon(e.i.toString(),"")),!n&&h.Image&&((new Image).src=e.i,n=!0),n||(e.a=Yn(e.g,null),e.a.ba(e.i)),e.u=w(),Ee(e)}Qn(t)}function xn(t){t.a&&(Bn(t),t.a.cancel(),t.a=null)}function Rn(t){xn(t),t.j&&(h.clearTimeout(t.j),t.j=null),Gn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&h.clearTimeout(t.h),t.h=null)}function Pn(t,e){t.g.push(new rn(t.Oa++,e)),3==t.v&&Mn(t)}function Mn(t){sn(t.b)||t.h||(t.h=!0,Lt(t.Ba,t),t.u=0)}function Ln(t,e){var n;n=e?e.f:t.R++;var r=Me(t.B);Ve(r,"SID",t.J),Ve(r,"RID",n),Ve(r,"AID",t.P),Fn(t,r),t.i&&t.l&&jn(r,t.i,t.l),n=new ve(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Un(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),ln(t.b,n),_e(n,r,e)}function Fn(t,e){t.f&&Ne({},function(t,n){Ve(e,n,t)})}function Un(t,e,n){n=Math.min(t.g.length,n);var r=t.f?b(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var a=["count="+n];-1==o?0<n?a.push("ofs="+(o=i[0].b)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,l=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),s=!1;else try{gn(l,a,"req"+c+"_")}catch(kr){r&&r(l)}}if(s){r=a.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function qn(t){t.a||t.j||(t.T=1,Lt(t.Aa,t),t.o=0)}function Vn(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=ae(b(t.Aa,t),Hn(t,t.o)),t.o++,0))}function Bn(t){null!=t.s&&(h.clearTimeout(t.s),t.s=null)}function Kn(t){t.a=new ve(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Me(t.la);Ve(e,"RID","rpc"),Ve(e,"SID",t.J),Ve(e,"CI",t.H?"0":"1"),Ve(e,"AID",t.P),Fn(t,e),Ve(e,"TYPE","xmlhttp"),t.i&&t.l&&jn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Be(Me(e)),n.j=null,n.I=!0,we(n,t)}function Gn(t){null!=t.m&&(h.clearTimeout(t.m),t.m=null)}function zn(t,e){var n=null;if(t.a==e){Gn(t),Bn(t),t.a=null;var r=2}else{if(!cn(t.b,e))return;n=e.s,hn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=w()-e.u;var i=t.u;At(r=te(),new oe(r,n,e,i)),Mn(t)}else qn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(un(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=ae(b(t.Ba,t,e),Hn(t,t.u)),t.u++,0)))}(t,e)||2==r&&Vn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:Wn(t,5);break;case 4:Wn(t,10);break;case 3:Wn(t,6);break;default:Wn(t,2)}}function Hn(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function Wn(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=b(t.Ya,t);n||(n=new Pe("//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||Le(n,"https"),Be(n)),function(t,e){var n=new Yt;if(h.Image){var r=new Image;r.onload=_(vn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=_(vn,n,r,"TestLoadImage: error",!1,e),r.onabort=_(vn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=_(vn,n,r,"TestLoadImage: timeout",!1,e),h.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ie(2);t.v=0,t.f&&t.f.ra(e),Qn(t),Rn(t)}function Qn(t){t.v=0,t.I=-1,t.f&&(0==fn(t.b).length&&0==t.g.length||(t.b.c.length=0,k(t.g),t.g.length=0),t.f.qa())}function Xn(t,e,n){var r=function(t){return t instanceof Pe?Me(t):new Pe(t,void 0)}(n);if(""!=r.c)e&&Fe(r,e+"."+r.c),Ue(r,r.h);else{var i=h.location;r=function(t,e,n,r){var i=new Pe(null,void 0);return t&&Le(i,t),e&&Fe(i,e),n&&Ue(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&P(t.V,function(t,e){Ve(r,e,t)}),n=t.na,(e=t.A)&&n&&Ve(r,e,n),Ve(r,"VER",t.ha),Fn(t,r),r}function Yn(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new mn(t.Na)).F=t.C,e}function $n(){}function Jn(){if(K&&!(10<=Number(tt)))throw Error("Environmental error: no available transport.")}function Zn(t,e){kt.call(this),this.a=new Cn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!A(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!A(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new nr(this)}function tr(t){pe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function er(){de.call(this),this.status=1}function nr(t){this.a=t}(u=mn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:he),this.a.onreadystatechange=b(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void In(this,o)}t=n||"";var i=new Ce(this.headers);r&&Ne(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Tn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=h.FormData&&t instanceof h.FormData,!(0<=E(wn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{kn(this),0<this.o&&((this.D=function(t){return K&&Z(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=b(this.xa,this)):this.m=Kt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){In(this,o)}},u.xa=function(){void 0!==l&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,At(this,"timeout"),this.abort(8))},u.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,At(this,"complete"),At(this,"abort"),Sn(this))},u.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Sn(this,!0)),mn.X.G.call(this)},u.za=function(){this.j||(this.A||this.l||this.g?On(this):this.Ua())},u.Ua=function(){On(this)},u.W=function(){try{return 2<An(this)?this.a.status:-1}catch(V){return-1}},u.$=function(){try{return this.a?this.a.responseText:""}catch(V){return""}},u.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),yn(e)}},u.ua=function(){return this.h},u.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(u=Cn.prototype).ha=8,u.v=1,u.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ve(this,this.c,t,void 0),r=this.l;if(this.O&&(r?F(r=M(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Un(this,n,e),Ve(i=Me(this.B),"RID",t),Ve(i,"CVER",22),this.A&&Ve(i,"X-HTTP-Session-Id",this.A),Fn(this,i),this.i&&r&&jn(i,this.i,r),ln(this.b,n),this.Ia&&Ve(i,"TYPE","init"),this.da?(Ve(i,"$req",e),Ve(i,"SID","null"),n.U=!0,_e(n,i,null)):_e(n,i,e),this.v=2}}else 3==this.v&&(t?Ln(this,t):0==this.g.length||sn(this.b)||Ln(this))},u.Aa=function(){if(this.j=null,Kn(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=ae(b(this.Ta,this),t)}},u.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,ie(10),xn(this),Kn(this))},u.Sa=function(){null!=this.m&&(this.m=null,xn(this),Vn(this),ie(19))},u.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),ie(2)):(this.c.info("Failed to ping google.com"),ie(1))},(u=$n.prototype).ta=function(){},u.sa=function(){},u.ra=function(){},u.qa=function(){},u.Ja=function(){},Jn.prototype.a=function(t,e){return new Zn(t,e)},T(Zn,kt),Zn.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;ie(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=Xn(t,null,t.fa),Mn(t)},Zn.prototype.close=function(){Dn(this.a)},Zn.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Pn(this.a,e)}else this.l?((e={}).__data__=Nt(t),Pn(this.a,e)):Pn(this.a,t)},Zn.prototype.G=function(){this.a.f=null,delete this.f,Dn(this.a),delete this.a,Zn.X.G.call(this)},T(tr,pe),T(er,de),T(nr,$n),nr.prototype.ta=function(){At(this.a,"a")},nr.prototype.sa=function(t){At(this.a,new tr(t))},nr.prototype.ra=function(t){At(this.a,new er(t))},nr.prototype.qa=function(){At(this.a,"b")},Jn.prototype.createWebChannel=Jn.prototype.a,Zn.prototype.send=Zn.prototype.h,Zn.prototype.open=Zn.prototype.g,Zn.prototype.close=Zn.prototype.close,se.NO_ERROR=0,se.TIMEOUT=8,se.HTTP_ERROR=6,ue.COMPLETE="complete",le.EventType=fe,fe.OPEN="a",fe.CLOSE="b",fe.ERROR="c",fe.MESSAGE="d",kt.prototype.listen=kt.prototype.va,mn.prototype.listenOnce=mn.prototype.wa,mn.prototype.getLastError=mn.prototype.Qa,mn.prototype.getLastErrorCode=mn.prototype.ua,mn.prototype.getStatus=mn.prototype.W,mn.prototype.getResponseJson=mn.prototype.Pa,mn.prototype.getResponseText=mn.prototype.$,mn.prototype.send=mn.prototype.ba;var rr=se,ir=ue,or=Jt,ar=le,sr=mn,ur=n("mrSG"),cr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();cr.o=-1;var lr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},hr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(ur.__extends)(e,t),e}(Error),fr=new o.Logger("@firebase/firestore");function pr(){return fr.logLevel}function dr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(fr.logLevel<=o.LogLevel.DEBUG){var r=e.map(yr);fr.debug.apply(fr,Object(ur.__spreadArray)(["Firestore (8.6.2): "+t],r))}}function gr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(fr.logLevel<=o.LogLevel.ERROR){var r=e.map(yr);fr.error.apply(fr,Object(ur.__spreadArray)(["Firestore (8.6.2): "+t],r))}}function vr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(fr.logLevel<=o.LogLevel.WARN){var r=e.map(yr);fr.warn.apply(fr,Object(ur.__spreadArray)(["Firestore (8.6.2): "+t],r))}}function yr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Tp){return t}}function mr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.6.2) INTERNAL ASSERTION FAILED: "+t;throw gr(e),new Error(e)}function br(t,e){t||mr()}function _r(t,e){return t}function wr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Tr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=wr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Ir(t,e){return t<e?-1:t>e?1:0}function Er(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function Or(t){return t+"\0"}var Sr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new hr(lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new hr(lr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new hr(lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new hr(lr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Ir(this.nanoseconds,t.nanoseconds):Ir(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),kr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Sr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Ar(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function jr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Nr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Cr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&mr(),void 0===n?n=t.length-e:n>t.length-e&&mr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Dr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(ur.__extends)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var a=o[i];if(a.indexOf("//")>=0)throw new hr(lr.INVALID_ARGUMENT,"Invalid segment ("+a+"). Paths must not contain // in them.");r.push.apply(r,a.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Cr),xr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Rr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(ur.__extends)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return xr.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new hr(lr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new hr(lr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new hr(lr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?(a=!a,i++):"."!==s||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new hr(lr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Cr),Pr=function(){function t(t){this.fields=t,t.sort(Rr.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Er(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),Mr=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Ir(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Mr.EMPTY_BYTE_STRING=new Mr("");var Lr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fr(t){if(br(!!t),"string"==typeof t){var e=0,n=Lr.exec(t);if(br(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ur(t.seconds),nanos:Ur(t.nanos)}}function Ur(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function qr(t){return"string"==typeof t?Mr.fromBase64String(t):Mr.fromUint8Array(t)}function Vr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Br(t){var e=t.mapValue.fields.__previous_value__;return Vr(e)?Br(e):e}function Kr(t){var e=Fr(t.mapValue.fields.__local_write_time__.timestampValue);return new Sr(e.seconds,e.nanos)}function Gr(t){return null==t}function zr(t){return 0===t&&1/t==-1/0}function Hr(t){return"number"==typeof t&&Number.isInteger(t)&&!zr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Wr=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Dr.fromString(e))},t.fromName=function(e){return new t(Dr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Dr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Dr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Dr(e.slice()))},t}();function Qr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Vr(t)?4:10:mr()}function Xr(t,e){var n=Qr(t);if(n!==Qr(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Kr(t).isEqual(Kr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Fr(t.timestampValue),r=Fr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return qr(t.bytesValue).isEqual(qr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ur(t.geoPointValue.latitude)===Ur(e.geoPointValue.latitude)&&Ur(t.geoPointValue.longitude)===Ur(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ur(t.integerValue)===Ur(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Ur(t.doubleValue),r=Ur(e.doubleValue);return n===r?zr(n)===zr(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Er(t.arrayValue.values||[],e.arrayValue.values||[],Xr);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ar(n)!==Ar(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Xr(n[i],r[i])))return!1;return!0}(t,e);default:return mr()}}function Yr(t,e){return void 0!==(t.values||[]).find(function(t){return Xr(t,e)})}function $r(t,e){var n=Qr(t),r=Qr(e);if(n!==r)return Ir(n,r);switch(n){case 0:return 0;case 1:return Ir(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Ur(t.integerValue||t.doubleValue),r=Ur(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Jr(t.timestampValue,e.timestampValue);case 4:return Jr(Kr(t),Kr(e));case 5:return Ir(t.stringValue,e.stringValue);case 6:return function(t,e){var n=qr(t),r=qr(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ir(n[i],r[i]);if(0!==o)return o}return Ir(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Ir(Ur(t.latitude),Ur(e.latitude));return 0!==n?n:Ir(Ur(t.longitude),Ur(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=$r(n[i],r[i]);if(o)return o}return Ir(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var a=0;a<r.length&&a<o.length;++a){var s=Ir(r[a],o[a]);if(0!==s)return s;var u=$r(n[r[a]],i[o[a]]);if(0!==u)return u}return Ir(r.length,o.length)}(t.mapValue,e.mapValue);default:throw mr()}}function Jr(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ir(t,e);var n=Fr(t),r=Fr(e),i=Ir(n.seconds,r.seconds);return 0!==i?i:Ir(n.nanos,r.nanos)}function Zr(t){return ti(t)}function ti(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Fr(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?qr(t.bytesValue).toBase64():"referenceValue"in t?Wr.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=ti(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+ti(t.fields[o])}return e+"}"}(t.mapValue):mr();var e}function ei(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function ni(t){return!!t&&"integerValue"in t}function ri(t){return!!t&&"arrayValue"in t}function ii(t){return!!t&&"nullValue"in t}function oi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ai(t){return!!t&&"mapValue"in t}var si=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(Rr.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach(function(t,n){t?e.set(n,t):e.delete(n)})},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return Xr(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Qr(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),a=ai(o)?Object.assign({},o.mapValue.fields):{};return n.forEach(function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(a[n]=o,i=!0)}else null!==t?(a[n]=t,i=!0):a.hasOwnProperty(n)&&(delete a[n],i=!0)}),i?{mapValue:{fields:a}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(Rr.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!ai(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function ui(t){var e=[];return jr(t.fields||{},function(t,n){var r=new Rr([t]);if(ai(n)){var i=ui(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,a=i;o<a.length;o++)e.push(r.child(a[o]))}else e.push(r)}),new Pr(e)}var ci=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,kr.min(),si.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,si.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,si.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=si.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=si.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),li=function(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.h=null};function hi(t,e,n,r,i,o,a){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),new li(t,e,n,r,i,o,a)}function fi(t){var e=_r(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Zr(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),Gr(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Oi(e.startAt)),e.endAt&&(n+="|ub:",n+=Oi(e.endAt)),e.h=n}return e.h}function pi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!ki(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Xr(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ji(t.startAt,e.startAt)&&ji(t.endAt,e.endAt)}function di(t){return Wr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var gi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(ur.__extends)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new vi(t,n,r):"array-contains"===n?new _i(t,r):"in"===n?new wi(t,r):"not-in"===n?new Ti(t,r):"array-contains-any"===n?new Ii(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new yi(t,n):new mi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m($r(e,this.value)):null!==e&&Qr(this.value)===Qr(e)&&this.m($r(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return mr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),vi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Wr.fromName(r.referenceValue),i}return Object(ur.__extends)(e,t),e.prototype.matches=function(t){var e=Wr.comparator(t.key,this.key);return this.m(e)},e}(gi),yi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=bi(0,n),r}return Object(ur.__extends)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(gi),mi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=bi(0,n),r}return Object(ur.__extends)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(gi);function bi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Wr.fromName(t.referenceValue)})}var _i=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(ur.__extends)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return ri(e)&&Yr(e.arrayValue,this.value)},e}(gi),wi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(ur.__extends)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Yr(this.value.arrayValue,e)},e}(gi),Ti=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(ur.__extends)(e,t),e.prototype.matches=function(t){if(Yr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Yr(this.value.arrayValue,e)},e}(gi),Ii=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(ur.__extends)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!ri(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Yr(e.value.arrayValue,t)})},e}(gi),Ei=function(t,e){this.position=t,this.before=e};function Oi(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Zr(t)}).join(",")}var Si=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function ki(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ai(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],a=t.position[i];if(r=o.field.isKeyField()?Wr.comparator(Wr.fromName(a.referenceValue),n.key):$r(a,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ji(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Xr(t.position[n],e.position[n]))return!1;return!0}var Ni=function(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.p=null,this.T=null};function Ci(t,e,n,r,i,o,a,s){return new Ni(t,e,n,r,i,o,a,s)}function Di(t){return new Ni(t)}function xi(t){return!Gr(t.limit)&&"F"===t.limitType}function Ri(t){return!Gr(t.limit)&&"L"===t.limitType}function Pi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Mi(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Li(t){return null!==t.collectionGroup}function Fi(t){var e=_r(t);if(null===e.p){e.p=[];var n=Mi(e),r=Pi(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Si(n)),e.p.push(new Si(Rr.keyField(),"asc"));else{for(var i=!1,o=0,a=e.explicitOrderBy;o<a.length;o++){var s=a[o];e.p.push(s),s.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Si(Rr.keyField(),u))}}}return e.p}function Ui(t){var e=_r(t);if(!e.T)if("F"===e.limitType)e.T=hi(e.path,e.collectionGroup,Fi(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Fi(e);r<i.length;r++){var o=i[r];n.push(new Si(o.field,"desc"===o.dir?"asc":"desc"))}var a=e.endAt?new Ei(e.endAt.position,!e.endAt.before):null,s=e.startAt?new Ei(e.startAt.position,!e.startAt.before):null;e.T=hi(e.path,e.collectionGroup,n,e.filters,e.limit,a,s)}return e.T}function qi(t,e,n){return new Ni(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Vi(t,e){return pi(Ui(t),Ui(e))&&t.limitType===e.limitType}function Bi(t){return fi(Ui(t))+"|lt:"+t.limitType}function Ki(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Zr(e.value);var e}).join(", ")+"]"),Gr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Oi(t.startAt)),t.endAt&&(e+=", endAt: "+Oi(t.endAt)),"Target("+e+")"}(Ui(t))+"; limitType="+t.limitType+")"}function Gi(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Wr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ai(t.startAt,Fi(t),e)||t.endAt&&Ai(t.endAt,Fi(t),e))}(t,e)}function zi(t){return function(e,n){for(var r=!1,i=0,o=Fi(t);i<o.length;i++){var a=o[i],s=Hi(a,e,n);if(0!==s)return s;r=r||a.field.isKeyField()}return 0}}function Hi(t,e,n){var r=t.field.isKeyField()?Wr.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?$r(r,i):mr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return mr()}}function Wi(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zr(e)?"-0":e}}function Qi(t){return{integerValue:""+t}}function Xi(t,e){return Hr(e)?Qi(e):Wi(t,e)}var Yi=function(){this._=void 0};function $i(t,e,n){return t instanceof to?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof eo?no(t,e):t instanceof ro?io(t,e):function(t,e){var n=Zi(t,e),r=ao(n)+ao(t.A);return ni(n)&&ni(t.A)?Qi(r):Wi(t.R,r)}(t,e)}function Ji(t,e,n){return t instanceof eo?no(t,e):t instanceof ro?io(t,e):n}function Zi(t,e){return t instanceof oo?ni(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var to=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(ur.__extends)(e,t),e}(Yi),eo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(ur.__extends)(e,t),e}(Yi);function no(t,e){for(var n=so(e),r=function(t){n.some(function(e){return Xr(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ro=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(ur.__extends)(e,t),e}(Yi);function io(t,e){for(var n=so(e),r=function(t){n=n.filter(function(e){return!Xr(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var oo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(ur.__extends)(e,t),e}(Yi);function ao(t){return Ur(t.integerValue||t.doubleValue)}function so(t){return ri(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var uo=function(t,e){this.field=t,this.transform=e},co=function(t,e){this.version=t,this.transformResults=e},lo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function ho(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var fo=function(){};function po(t,e,n){t instanceof bo?function(t,e,n){var r=t.value.clone(),i=To(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof _o?function(t,e,n){if(ho(t.precondition,e)){var r=To(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(wo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function go(t,e,n){t instanceof bo?function(t,e,n){if(ho(t.precondition,e)){var r=t.value.clone(),i=Io(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(mo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof _o?function(t,e,n){if(ho(t.precondition,e)){var r=Io(t.fieldTransforms,n,e),i=e.data;i.setAll(wo(t)),i.setAll(r),e.convertToFoundDocument(mo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){ho(t.precondition,e)&&e.convertToNoDocument(kr.min())}(t,e)}function vo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],a=e.data.field(o.field),s=Zi(o.transform,a||null);null!=s&&(null==n&&(n=si.empty()),n.set(o.field,s))}return n||null}function yo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Er(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof eo&&e instanceof eo||t instanceof ro&&e instanceof ro?Er(t.elements,e.elements,Xr):t instanceof oo&&e instanceof oo?Xr(t.A,e.A):t instanceof to&&e instanceof to}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function mo(t){return t.isFoundDocument()?t.version:kr.min()}var bo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(ur.__extends)(e,t),e}(fo),_o=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var a=this;return(a=t.call(this)||this).key=e,a.data=n,a.fieldMask=r,a.precondition=i,a.fieldTransforms=o,a.type=1,a}return Object(ur.__extends)(e,t),e}(fo);function wo(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function To(t,e,n){var r=new Map;br(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],a=o.transform,s=e.data.field(o.field);r.set(o.field,Ji(a,s,n[i]))}return r}function Io(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var a=o[i],s=a.transform,u=n.data.field(a.field);r.set(a.field,$i(s,u,e))}return r}var Eo,Oo,So=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(ur.__extends)(e,t),e}(fo),ko=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(ur.__extends)(e,t),e}(fo),Ao=function(t){this.count=t};function jo(t){switch(t){case lr.OK:return mr();case lr.CANCELLED:case lr.UNKNOWN:case lr.DEADLINE_EXCEEDED:case lr.RESOURCE_EXHAUSTED:case lr.INTERNAL:case lr.UNAVAILABLE:case lr.UNAUTHENTICATED:return!1;case lr.INVALID_ARGUMENT:case lr.NOT_FOUND:case lr.ALREADY_EXISTS:case lr.PERMISSION_DENIED:case lr.FAILED_PRECONDITION:case lr.ABORTED:case lr.OUT_OF_RANGE:case lr.UNIMPLEMENTED:case lr.DATA_LOSS:return!0;default:return mr()}}function No(t){if(void 0===t)return gr("GRPC error has no .code"),lr.UNKNOWN;switch(t){case Eo.OK:return lr.OK;case Eo.CANCELLED:return lr.CANCELLED;case Eo.UNKNOWN:return lr.UNKNOWN;case Eo.DEADLINE_EXCEEDED:return lr.DEADLINE_EXCEEDED;case Eo.RESOURCE_EXHAUSTED:return lr.RESOURCE_EXHAUSTED;case Eo.INTERNAL:return lr.INTERNAL;case Eo.UNAVAILABLE:return lr.UNAVAILABLE;case Eo.UNAUTHENTICATED:return lr.UNAUTHENTICATED;case Eo.INVALID_ARGUMENT:return lr.INVALID_ARGUMENT;case Eo.NOT_FOUND:return lr.NOT_FOUND;case Eo.ALREADY_EXISTS:return lr.ALREADY_EXISTS;case Eo.PERMISSION_DENIED:return lr.PERMISSION_DENIED;case Eo.FAILED_PRECONDITION:return lr.FAILED_PRECONDITION;case Eo.ABORTED:return lr.ABORTED;case Eo.OUT_OF_RANGE:return lr.OUT_OF_RANGE;case Eo.UNIMPLEMENTED:return lr.UNIMPLEMENTED;case Eo.DATA_LOSS:return lr.DATA_LOSS;default:return mr()}}(Oo=Eo||(Eo={}))[Oo.OK=0]="OK",Oo[Oo.CANCELLED=1]="CANCELLED",Oo[Oo.UNKNOWN=2]="UNKNOWN",Oo[Oo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Oo[Oo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Oo[Oo.NOT_FOUND=5]="NOT_FOUND",Oo[Oo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Oo[Oo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Oo[Oo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Oo[Oo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Oo[Oo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Oo[Oo.ABORTED=10]="ABORTED",Oo[Oo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Oo[Oo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Oo[Oo.INTERNAL=13]="INTERNAL",Oo[Oo.UNAVAILABLE=14]="UNAVAILABLE",Oo[Oo.DATA_LOSS=15]="DATA_LOSS";var Co=function(){function t(t,e){this.comparator=t,this.root=e||xo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,xo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Do(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Do(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Do(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Do(this.root,t,this.comparator,!0)},t}(),Do=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),xo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw mr();if(this.right.isRed())throw mr();var t=this.left.check();if(t!==this.right.check())throw mr();return t+(this.isRed()?0:1)},t}();xo.EMPTY=null,xo.RED=!0,xo.BLACK=!1,xo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw mr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw mr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw mr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw mr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw mr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new xo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Ro=function(){function t(t){this.comparator=t,this.data=new Co(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Po(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Po(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Po=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Mo=new Co(Wr.comparator);function Lo(){return Mo}var Fo=new Co(Wr.comparator);function Uo(){return Fo}var qo=new Co(Wr.comparator);function Vo(){return qo}var Bo=new Ro(Wr.comparator);function Ko(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Bo,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Go=new Ro(Ir);function zo(){return Go}var Ho=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Wo.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(kr.min(),r,zo(),Lo(),Ko())},t}(),Wo=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Mr.EMPTY_BYTE_STRING,n,Ko(),Ko(),Ko())},t}(),Qo=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Xo=function(t,e){this.targetId=t,this.V=e},Yo=function(t,e,n,r){void 0===n&&(n=Mr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},$o=function(){function t(){this.S=0,this.D=ta(),this.C=Mr.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Ko(),e=Ko(),n=Ko();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:mr()}}),new Wo(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=ta()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Jo=function(){function t(t){this.W=t,this.G=new Map,this.H=Lo(),this.J=Zo(),this.Y=new Ro(Ir)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:mr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(di(i))if(0===n){var o=new Wr(i.path);this.tt(e,o,ci.newNoDocument(o,kr.min()))}else br(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.at=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&di(o.target)){var a=new Wr(o.target.path);null!==e.H.get(a)||e.ut(i,a)||e.tt(i,a,ci.newNoDocument(a,t))}r.O&&(n.set(i,r.M()),r.L())}});var r=Ko();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Ho(t,n,this.Y,this.H,r);return this.H=Lo(),this.J=Zo(),this.Y=new Ro(Ir),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.ut(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.ut(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new $o,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Ro(Ir),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||dr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new $o),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.ut=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Zo(){return new Co(Wr.comparator)}function ta(){return new Co(Wr.comparator)}var ea={asc:"ASCENDING",desc:"DESCENDING"},na={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ra=function(t,e){this.databaseId=t,this.I=e};function ia(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function oa(t,e){return t.I?e.toBase64():e.toUint8Array()}function aa(t,e){return ia(t,e.toTimestamp())}function sa(t){return br(!!t),kr.fromTimestamp(function(t){var e=Fr(t);return new Sr(e.seconds,e.nanos)}(t))}function ua(t,e){return function(t){return new Dr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function ca(t){var e=Dr.fromString(t);return br(xa(e)),e}function la(t,e){return ua(t.databaseId,e.path)}function ha(t,e){var n=ca(e);if(n.get(1)!==t.databaseId.projectId)throw new hr(lr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new hr(lr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Wr(ga(n))}function fa(t,e){return ua(t.databaseId,e)}function pa(t){var e=ca(t);return 4===e.length?Dr.emptyPath():ga(e)}function da(t){return new Dr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ga(t){return br(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function va(t,e,n){return{name:la(t,e),fields:n.toProto().mapValue.fields}}function ya(t,e,n){var r=ha(t,e.name),i=sa(e.updateTime),o=new si({mapValue:{fields:e.fields}}),a=ci.newFoundDocument(r,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function ma(t,e){var n;if(e instanceof bo)n={update:va(t,e.key,e.value)};else if(e instanceof So)n={delete:la(t,e.key)};else if(e instanceof _o)n={update:va(t,e.key,e.data),updateMask:Da(e.fieldMask)};else{if(!(e instanceof ko))return mr();n={verify:la(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof to)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof eo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ro)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof oo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw mr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:aa(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:mr()}(t,e.precondition)),n}function ba(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?lo.updateTime(sa(t.updateTime)):void 0!==t.exists?lo.exists(t.exists):lo.none()}(e.currentDocument):lo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(br("REQUEST_TIME"===e.setToServerValue),n=new to):"appendMissingElements"in e?n=new eo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new ro(e.removeAllFromArray.values||[]):"increment"in e?n=new oo(t,e.increment):mr();var r=Rr.fromServerFormat(e.fieldPath);return new uo(r,n)}(t,e)}):[];if(e.update){var i=ha(t,e.update.name),o=new si({mapValue:{fields:e.update.fields}});if(e.updateMask){var a=function(t){return new Pr((t.fieldPaths||[]).map(function(t){return Rr.fromServerFormat(t)}))}(e.updateMask);return new _o(i,o,a,n,r)}return new bo(i,o,n,r)}if(e.delete){var s=ha(t,e.delete);return new So(s,n)}if(e.verify){var u=ha(t,e.verify);return new ko(u,n)}return mr()}function _a(t,e){return{documents:[fa(t,e.path)]}}function wa(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=fa(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=fa(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(oi(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NAN"}};if(ii(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(oi(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NAN"}};if(ii(t.value))return{unaryFilter:{field:Aa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Aa(t.field),op:ka(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Aa(t.field),direction:Sa(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var a=function(t,e){return t.I||Gr(e)?e:{value:e}}(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=Ea(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ea(e.endAt)),n}function Ta(t){var e=pa(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){br(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=Ia(n.where));var s=[];n.orderBy&&(s=n.orderBy.map(function(t){return function(t){return new Si(ja(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return Gr(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Oa(n.startAt));var l=null;return n.endAt&&(l=Oa(n.endAt)),Ci(e,i,s,a,u,"F",c,l)}function Ia(t){return t?void 0!==t.unaryFilter?[Ca(t)]:void 0!==t.fieldFilter?[Na(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Ia(t)}).reduce(function(t,e){return t.concat(e)}):mr():[]}function Ea(t){return{before:t.before,values:t.position}}function Oa(t){return new Ei(t.values||[],!!t.before)}function Sa(t){return ea[t]}function ka(t){return na[t]}function Aa(t){return{fieldPath:t.canonicalString()}}function ja(t){return Rr.fromServerFormat(t.fieldPath)}function Na(t){return gi.create(ja(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return mr()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ca(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ja(t.unaryFilter.field);return gi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ja(t.unaryFilter.field);return gi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ja(t.unaryFilter.field);return gi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ja(t.unaryFilter.field);return gi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return mr()}}function Da(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function xa(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ra(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Ma(e)),e=Pa(t.get(n),e);return Ma(e)}function Pa(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Ma(t){return t+"\x01\x01"}function La(t){var e=t.length;if(br(e>=2),2===e)return br("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Dr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf("\x01",o);switch((a<0||a>n)&&mr(),t.charAt(a+1)){case"\x01":var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case"\x10":i+=t.substring(o,a),i+="\0";break;case"\x11":i+=t.substring(o,a+1);break;default:mr()}o=a+2}return new Dr(r)}var Fa=function(t,e){this.seconds=t,this.nanoseconds=e},Ua=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ua.store="owner",Ua.key="owner";var qa=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};qa.store="mutationQueues",qa.keyPath="userId";var Va=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Va.store="mutations",Va.keyPath="batchId",Va.userMutationsIndex="userMutationsIndex",Va.userMutationsKeyPath=["userId","batchId"];var Ba=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Ra(e)]},t.key=function(t,e,n){return[t,Ra(e),n]},t}();Ba.store="documentMutations",Ba.PLACEHOLDER=new Ba;var Ka=function(t,e){this.path=t,this.readTime=e},Ga=function(t,e){this.path=t,this.version=e},za=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};za.store="remoteDocuments",za.readTimeIndex="readTimeIndex",za.readTimeIndexPath="readTime",za.collectionReadTimeIndex="collectionReadTimeIndex",za.collectionReadTimeIndexPath=["parentPath","readTime"];var Ha=function(t){this.byteSize=t};Ha.store="remoteDocumentGlobal",Ha.key="remoteDocumentGlobalKey";var Wa=function(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a};Wa.store="targets",Wa.keyPath="targetId",Wa.queryTargetsIndexName="queryTargetsIndex",Wa.queryTargetsKeyPath=["canonicalId","targetId"];var Qa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Qa.store="targetDocuments",Qa.keyPath=["targetId","path"],Qa.documentTargetsIndex="documentTargetsIndex",Qa.documentTargetsKeyPath=["path","targetId"];var Xa=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Xa.key="targetGlobalKey",Xa.store="targetGlobal";var Ya=function(t,e){this.collectionId=t,this.parent=e};Ya.store="collectionParents",Ya.keyPath=["collectionId","parent"];var $a=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};$a.store="clientMetadata",$a.keyPath="clientId";var Ja=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Ja.store="bundles",Ja.keyPath="bundleId";var Za=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Za.store="namedQueries",Za.keyPath="name";var ts=Object(ur.__spreadArray)(Object(ur.__spreadArray)([],Object(ur.__spreadArray)(Object(ur.__spreadArray)([],Object(ur.__spreadArray)(Object(ur.__spreadArray)([],Object(ur.__spreadArray)(Object(ur.__spreadArray)([],[qa.store,Va.store,Ba.store,za.store,Wa.store,Ua.store,Xa.store,Qa.store]),[$a.store])),[Ha.store])),[Ya.store])),[Ja.store,Za.store]),es="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ns=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),rs=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},is=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&mr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),os=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new rs,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new us(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=ps(e.target.error);n.ft.reject(new us(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new us(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(dr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ls(e)},t}(),as=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(i.getUA)())&&gr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return dr("SimpleDb","Removing database:",t),hs(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(i.getUA)(),n=t._t(e),r=0<n&&n<10,o=t.Et(e),a=0<o&&o<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||a)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(dr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new us(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new hr(lr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new us(t,n))},i.onupgradeneeded=function(t){dr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){dr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(ur.__awaiter)(this,void 0,void 0,function(){var i,o,a,s,u;return Object(ur.__generator)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,a=function(){var e,a,u,c,l;return Object(ur.__generator)(this,function(h){switch(h.label){case 0:++o,h.label=1;case 1:return h.trys.push([1,4,,5]),[4,s.At(t)];case 2:return s.db=h.sent(),e=os.open(s.db,t,i?"readonly":"readwrite",n),a=r(e).catch(function(t){return e.abort(t),is.reject(t)}).toPromise(),u={},a.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(h.sent(),a),u)];case 4:return dr("SimpleDb","Transaction failed with error:",(c=h.sent()).message,"Retrying:",l="FirebaseError"!==c.name&&o<3),s.close(),l?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},s=this,c.label=1;case 1:return[5,a()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),ss=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return hs(this.Pt.delete())},t}(),us=function(t){function e(e,n){var r=this;return(r=t.call(this,lr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(ur.__extends)(e,t),e}(hr);function cs(t){return"IndexedDbTransactionError"===t.name}var ls=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(dr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(dr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),hs(n)},t.prototype.add=function(t){return dr("SimpleDb","ADD",this.store.name,t,t),hs(this.store.add(t))},t.prototype.get=function(t){var e=this;return hs(this.store.get(t)).next(function(n){return void 0===n&&(n=null),dr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return dr("SimpleDb","DELETE",this.store.name,t),hs(this.store.delete(t))},t.prototype.count=function(){return dr("SimpleDb","COUNT",this.store.name),hs(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){dr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new is(function(n,r){e.onerror=function(t){var e=ps(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new is(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new ss(i),a=e(i.primaryKey,i.value,o);if(a instanceof is){var s=a.catch(function(t){return o.done(),is.reject(t)});n.push(s)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return is.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function hs(t){return new is(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=ps(t.target.error);n(e)}})}var fs=!1;function ps(t){var e=as._t(Object(i.getUA)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new hr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return fs||(fs=!0,setTimeout(function(){throw r},0)),r}}return t}var ds=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(ur.__extends)(e,t),e}(ns);function gs(t,e){var n=_r(t);return as.It(n.Mt,e)}var vs=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&po(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&go(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&go(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(kr.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ko())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Er(this.mutations,t.mutations,function(t,e){return yo(t,e)})&&Er(this.baseMutations,t.baseMutations,function(t,e){return yo(t,e)})},t}(),ys=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){br(e.mutations.length===r.length);for(var i=Vo(),o=e.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new t(e,n,r,i)},t}(),ms=function(){function t(t,e,n,r,i,o,a){void 0===i&&(i=kr.min()),void 0===o&&(o=kr.min()),void 0===a&&(a=Mr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),bs=function(t){this.Lt=t};function _s(t,e){if(e.document)return ya(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Wr.fromSegments(e.noDocument.path),r=Os(e.noDocument.readTime),i=ci.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Wr.fromSegments(e.unknownDocument.path);return r=Os(e.unknownDocument.version),ci.newUnknownDocument(o,r)}return mr()}function ws(t,e,n){var r=Ts(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:la(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:ia(t,e.version.toTimestamp())}}(t.Lt,e),a=e.hasCommittedMutations;return new za(null,null,o,a,r,i)}if(e.isNoDocument()){var s=e.key.path.toArray(),u=Es(e.version);return a=e.hasCommittedMutations,new za(null,new Ka(s,u),null,a,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),l=Es(e.version);return new za(new Ga(c,l),null,null,!0,r,i)}return mr()}function Ts(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Is(t){var e=new Sr(t[0],t[1]);return kr.fromTimestamp(e)}function Es(t){var e=t.toTimestamp();return new Fa(e.seconds,e.nanoseconds)}function Os(t){var e=new Sr(t.seconds,t.nanoseconds);return kr.fromTimestamp(e)}function Ss(t,e){for(var n=(e.baseMutations||[]).map(function(e){return ba(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return ba(t.Lt,e)}),o=Sr.fromMillis(e.localWriteTimeMs);return new vs(e.batchId,o,n,i)}function ks(t){var e,n,r=Os(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Os(t.lastLimboFreeSnapshotVersion):kr.min();return void 0!==t.query.documents?(br(1===(n=t.query).documents.length),e=Ui(Di(pa(n.documents[0])))):e=function(t){return Ui(Ta(t))}(t.query),new ms(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Mr.fromBase64String(t.resumeToken))}function As(t,e){var n,r=Es(e.snapshotVersion),i=Es(e.lastLimboFreeSnapshotVersion);n=di(e.target)?_a(t.Lt,e.target):wa(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Wa(e.targetId,fi(e.target),r,o,e.sequenceNumber,i,n)}function js(t){var e=Ta({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?qi(e,e.limit,"L"):e}var Ns=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Cs(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Os(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return Cs(t).put({bundleId:(n=e).id,createTime:Es(sa(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Ds(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:js(e.bundledQuery),readTime:Os(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return Ds(t).put(function(t){return{name:t.name,readTime:Es(sa(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Cs(t){return gs(t,Ja.store)}function Ds(t){return gs(t,Za.store)}var xs=function(){function t(){this.Bt=new Rs}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),is.resolve()},t.prototype.getCollectionParents=function(t,e){return is.resolve(this.Bt.getEntries(e))},t}(),Rs=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ro(Dr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Ro(Dr.comparator)).toArray()},t}(),Ps=function(){function t(){this.qt=new Rs}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:Ra(i)};return Ms(t).put(o)}return is.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Or(e),""],!1,!0);return Ms(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(La(o.parent))}return n})},t}();function Ms(t){return gs(t,Ya.store)}var Ls={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Fs=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Us(t,e,n){var r=t.store(Va.store),i=t.store(Ba.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.Ot({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){br(1===s)}));for(var c=[],l=0,h=n.mutations;l<h.length;l++){var f=h[l],p=Ba.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return is.waitFor(o).next(function(){return c})}function qs(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw mr();e=t.noDocument}return JSON.stringify(e).length}Fs.DEFAULT_COLLECTION_PERCENTILE=10,Fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Fs.DEFAULT=new Fs(41943040,Fs.DEFAULT_COLLECTION_PERCENTILE,Fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Fs.DISABLED=new Fs(-1,0,0);var Vs=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return br(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ks(t).Ot({index:Va.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Gs(t),a=Ks(t);return a.add({}).next(function(s){br("number"==typeof s);for(var u=new vs(s,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return ma(t.Lt,e)}),i=n.mutations.map(function(e){return ma(t.Lt,e)});return new Va(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),l=[],h=new Ro(function(t,e){return Ir(t.canonicalString(),e.canonicalString())}),f=0,p=r;f<p.length;f++){var d=p[f],g=Ba.key(i.userId,d.key.path,s);h=h.add(d.key.path.popLast()),l.push(a.put(c)),l.push(o.put(g,Ba.PLACEHOLDER))}return h.forEach(function(e){l.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Qt[s]=u.keys()}),is.waitFor(l).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Ks(t).get(e).next(function(t){return t?(br(t.userId===n.userId),Ss(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?is.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Ks(t).Ot({index:Va.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(br(e.batchId>=r),o=Ss(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ks(t).Ot({index:Va.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ks(t).Nt(Va.userMutationsIndex,n).next(function(t){return t.map(function(t){return Ss(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Ba.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Gs(t).Ot({range:i},function(r,i,a){var s=r[0],u=r[2],c=La(r[1]);if(s===n.userId&&e.path.isEqual(c))return Ks(t).get(u).next(function(t){if(!t)throw mr();br(t.userId===n.userId),o.push(Ss(n.R,t))});a.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ro(Ir),i=[];return e.forEach(function(e){var o=Ba.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=Gs(t).Ot({range:a},function(t,i,o){var a=t[0],s=t[2],u=La(t[1]);a===n.userId&&e.path.isEqual(u)?r=r.add(s):o.done()});i.push(s)}),is.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Ba.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new Ro(Ir);return Gs(t).Ot({range:a},function(t,e,o){var a=t[0],u=t[2],c=La(t[1]);a===n.userId&&r.isPrefixOf(c)?c.length===i&&(s=s.add(u)):o.done()}).next(function(){return n.Wt(t,s)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Ks(t).get(e).next(function(t){if(null===t)throw mr();br(t.userId===n.userId),r.push(Ss(n.R,t))}))}),is.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Us(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),is.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return is.resolve();var r=IDBKeyRange.lowerBound(Ba.prefixForUser(e.userId)),i=[];return Gs(t).Ot({range:r},function(t,n,r){if(t[0]===e.userId){var o=La(t[1]);i.push(o)}else r.done()}).next(function(){br(0===i.length)})})},t.prototype.containsKey=function(t,e){return Bs(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return zs(t).get(this.userId).next(function(t){return t||new qa(e.userId,-1,"")})},t}();function Bs(t,e,n){var r=Ba.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return Gs(t).Ot({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(a=!0),r.done()}).next(function(){return a})}function Ks(t){return gs(t,Va.store)}function Gs(t){return gs(t,Ba.store)}function zs(t){return gs(t,qa.store)}var Hs=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Ws=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Hs(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return kr.fromTimestamp(new Sr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Qs(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return br(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Qs(t).Ot(function(a,s){var u=ks(s);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return is.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return Qs(t).Ot(function(t,n){var r=ks(n);e(r)})},t.prototype.Xt=function(t){return Xs(t).get(Xa.key).next(function(t){return br(null!==t),t})},t.prototype.Zt=function(t,e){return Xs(t).put(Xa.key,e)},t.prototype.te=function(t,e){return Qs(t).put(As(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=fi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Qs(t).Ot({range:r,index:Wa.queryTargetsIndexName},function(t,n,r){var o=ks(n);pi(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Ys(t);return e.forEach(function(e){var a=Ra(e.path);i.push(o.put(new Qa(n,a))),i.push(r.referenceDelegate.addReference(t,n,e))}),is.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Ys(t);return is.forEach(e,function(e){var o=Ra(e.path);return is.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Ys(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ys(t),i=Ko();return r.Ot({range:n,kt:!0},function(t,e,n){var r=La(t[1]),o=new Wr(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Ra(e.path),r=IDBKeyRange.bound([n],[Or(n)],!1,!0),i=0;return Ys(t).Ot({index:Qa.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return Qs(t).get(e).next(function(t){return t?ks(t):null})},t}();function Qs(t){return gs(t,Wa.store)}function Xs(t){return gs(t,Xa.store)}function Ys(t){return gs(t,Qa.store)}function $s(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){if(t.code!==lr.FAILED_PRECONDITION||t.message!==es)throw t;return dr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Js(t,e){var n=t[1],r=e[1],i=Ir(t[0],e[0]);return 0===i?Ir(n,r):i}var Zs=function(){function t(t){this.ne=t,this.buffer=new Ro(Js),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Js(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),tu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ae(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ae=function(t){var e=this,n=this.oe?3e5:6e4;dr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(ur.__awaiter)(e,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return cs(e=n.sent())?(dr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,$s(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ae(t)];case 8:return n.sent(),[2]}})})})},t}(),eu=function(){function t(t,e){this.ue=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ue.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return is.resolve(cr.o);var r=new Zs(e);return this.ue.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ue.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ue.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ue.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(dr("LruGarbageCollector","Garbage collection skipped; disabled"),is.resolve(Ls)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(dr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Ls):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ue.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,a,s,u,c,l=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>l.params.maximumSequenceNumbersToCollect?(dr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.maximumSequenceNumbersToCollect+" from "+e),r=l.params.maximumSequenceNumbersToCollect):r=e,a=Date.now(),l.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),l.removeTargets(t,n,e)}).next(function(e){return i=e,u=Date.now(),l.removeOrphanedDocuments(t,n)}).next(function(t){return c=Date.now(),pr()<=o.LogLevel.DEBUG&&dr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-a)+"ms\n\tRemoved "+i+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-h)+"ms"),is.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),nu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new eu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return ru(t,n)},t.prototype.removeReference=function(t,e,n){return ru(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return ru(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return zs(t).$t(function(r){return Bs(t,r,e).next(function(t){return t&&(n=!0),is.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(a,s){if(s<=e){var u=n._e(t,a).next(function(e){if(!e)return o++,r.getEntry(t,a).next(function(){return r.removeEntry(a),Ys(t).delete([0,Ra(a.path)])})});i.push(u)}}).next(function(){return is.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return ru(t,e)},t.prototype.we=function(t,e){var n,r=Ys(t),i=cr.o;return r.Ot({index:Qa.documentTargetsIndex},function(t,r){var o=r.path,a=r.sequenceNumber;0===t[0]?(i!==cr.o&&e(new Wr(La(n)),i),i=a,n=o):i=cr.o}).next(function(){i!==cr.o&&e(new Wr(La(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function ru(t,e){return Ys(t).put(function(t,e){return new Qa(0,Ra(t.path),e)}(e,t.currentSequenceNumber))}var iu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[1];if(this.equalsFn(o[0],t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){jr(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return Nr(this.inner)},t}(),ou=function(){function t(){this.changes=new iu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:kr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:ci.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?is.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),au=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return cu(t).put(lu(e),n)},t.prototype.removeEntry=function(t,e){var n=cu(t),r=lu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return cu(t).get(lu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return cu(t).get(lu(e)).next(function(t){return{document:n.ye(e,t),size:qs(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=Lo();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=Lo(),i=new Co(Wr.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,qs(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return is.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return cu(t).Ot({range:r},function(t,e,r){for(var a=Wr.fromSegments(t);o&&Wr.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Lo(),o=e.path.length+1,a={};if(n.isEqual(kr.min())){var s=e.path.toArray();a.range=IDBKeyRange.lowerBound(s)}else{var u=e.path.toArray(),c=Ts(n);a.range=IDBKeyRange.lowerBound([u,c],!0),a.index=za.collectionReadTimeIndex}return cu(t).Ot(a,function(t,n,a){if(t.length===o){var s=_s(r.R,n);e.path.isPrefixOf(s.key.path)?Gi(e,s)&&(i=i.insert(s.key,s)):a.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new su(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return uu(t).get(Ha.key).next(function(t){return br(!!t),t})},t.prototype.me=function(t,e){return uu(t).put(Ha.key,e)},t.prototype.ye=function(t,e){if(e){var n=_s(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(kr.min()))return n}return ci.newInvalidDocument(t)},t}(),su=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new iu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(ur.__extends)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Ro(function(t,e){return Ir(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,a){var s=e.Ae.get(o);if(a.document.isValidDocument()){var u=ws(e.Ie.R,a.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=qs(u);r+=c-s,n.push(e.Ie.addEntry(t,o,u))}else if(r-=s,e.trackRemovals){var l=ws(e.Ie.R,ci.newNoDocument(o,kr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,l))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),is.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(ou);function uu(t){return gs(t,Ha.store)}function cu(t){return gs(t,za.store)}function lu(t){return t.path.toArray()}var hu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;br(n<r&&n>=0&&r<=11);var o=new os("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ua.store)}(t),function(t){t.createObjectStore(qa.store,{keyPath:qa.keyPath}),t.createObjectStore(Va.store,{keyPath:Va.keyPath,autoIncrement:!0}).createIndex(Va.userMutationsIndex,Va.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ba.store)}(t),fu(t),function(t){t.createObjectStore(za.store)}(t));var a=is.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Qa.store),t.deleteObjectStore(Wa.store),t.deleteObjectStore(Xa.store)}(t),fu(t)),a=a.next(function(){return function(t){var e=t.store(Xa.store),n=new Xa(0,0,kr.min().toTimestamp(),0);return e.put(Xa.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(a=a.next(function(){return function(t,e){return e.store(Va.store).Nt().next(function(n){t.deleteObjectStore(Va.store),t.createObjectStore(Va.store,{keyPath:Va.keyPath,autoIncrement:!0}).createIndex(Va.userMutationsIndex,Va.userMutationsKeyPath,{unique:!0});var r=e.store(Va.store),i=n.map(function(t){return r.put(t)});return is.waitFor(i)})}(t,o)})),a=a.next(function(){!function(t){t.createObjectStore($a.store,{keyPath:$a.keyPath})}(t)})),n<5&&r>=5&&(a=a.next(function(){return i.Re(o)})),n<6&&r>=6&&(a=a.next(function(){return function(t){t.createObjectStore(Ha.store)}(t),i.be(o)})),n<7&&r>=7&&(a=a.next(function(){return i.ve(o)})),n<8&&r>=8&&(a=a.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(a=a.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(za.store);e.createIndex(za.readTimeIndex,za.readTimeIndexPath,{unique:!1}),e.createIndex(za.collectionReadTimeIndex,za.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(a=a.next(function(){return i.Ve(o)})),n<11&&r>=11&&(a=a.next(function(){!function(t){t.createObjectStore(Ja.store,{keyPath:Ja.keyPath})}(t),function(t){t.createObjectStore(Za.store,{keyPath:Za.keyPath})}(t)})),a},t.prototype.be=function(t){var e=0;return t.store(za.store).Ot(function(t,n){e+=qs(n)}).next(function(){var n=new Ha(e);return t.store(Ha.store).put(Ha.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(qa.store),r=t.store(Va.store);return n.Nt().next(function(n){return is.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Va.userMutationsIndex,i).next(function(r){return is.forEach(r,function(r){br(r.userId===n.userId);var i=Ss(e.R,r);return Us(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(Qa.store),n=t.store(za.store);return t.store(Xa.store).get(Xa.key).next(function(t){var r=[];return n.Ot(function(n,i){var o=new Dr(n),a=function(t){return[0,Ra(t)]}(o);r.push(e.get(a).next(function(n){return n?is.resolve():function(n){return e.put(new Qa(0,Ra(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return is.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Ya.store,{keyPath:Ya.keyPath});var n=e.store(Ya.store),r=new Rs,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Ra(i)})}};return e.store(za.store).Ot({kt:!0},function(t,e){var n=new Dr(t);return i(n.popLast())}).next(function(){return e.store(Ba.store).Ot({kt:!0},function(t,e){var n=La(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Wa.store);return n.Ot(function(t,r){var i=ks(r),o=As(e.R,i);return n.put(o)})},t}();function fu(t){t.createObjectStore(Qa.store,{keyPath:Qa.keyPath}).createIndex(Qa.documentTargetsIndex,Qa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Wa.store,{keyPath:Wa.keyPath}).createIndex(Wa.queryTargetsIndexName,Wa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Xa.store)}var pu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",du=function(){function t(e,n,r,i,o,a,s,u,c,l){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=a,this.document=s,this.De=c,this.Ce=l,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new hr(lr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new nu(this,i),this.Le=n+"main",this.R=new bs(u),this.Be=new as(this.Le,11,new hu(this.R)),this.qe=new Ws(this.referenceDelegate,this.R),this.Ut=new Ps,this.Ue=function(t,e){return new au(t,e)}(this.R,this.Ut),this.Qe=new Ns,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===l&&gr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new hr(lr.FAILED_PRECONDITION,pu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new cr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(ur.__awaiter)(e,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(ur.__awaiter)(e,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(ur.__awaiter)(e,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return vu(e).put(new $a(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(cs(e))return dr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return dr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return gu(t).get(Ua.key).next(function(t){return is.resolve(e.tn(t))})},t.prototype.en=function(t){return vu(t).delete(this.clientId)},t.prototype.nn=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=gs(t,$a.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return is.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)this.Ke.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?is.resolve(!0):gu(t).get(Ua.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new hr(lr.FAILED_PRECONDITION,pu);return!1}}return!(!e.networkEnabled||!e.inForeground)||vu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&dr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t=this;return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.an(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.un(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ua.store,$a.store],function(e){var n=new ds(e,cr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return vu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Vs.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return dr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",ts,function(o){return r=new ds(o,i.Ne?i.Ne.next():cr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw gr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new hr(lr.FAILED_PRECONDITION,es);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return gu(t).get(Ua.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new hr(lr.FAILED_PRECONDITION,pu)})},t.prototype.Ze=function(t){var e=new Ua(this.clientId,this.allowTabSynchronization,Date.now());return gu(t).put(Ua.key,e)},t.yt=function(){return as.yt()},t.prototype.Xe=function(t){var e=this,n=gu(t);return n.get(Ua.key).next(function(t){return e.tn(t)?(dr("IndexedDbPersistence","Releasing primary lease."),n.delete(Ua.key)):is.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(gr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.un=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.an(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return dr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return gr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.an=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){gr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function gu(t){return gs(t,Ua.store)}function vu(t){return gs(t,$a.store)}function yu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var mu=function(t,e){this.progress=t,this.wn=e},bu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Wr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Li(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Wr(e)).next(function(t){var e=Uo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Uo();return this.Ut.getCollectionParents(t,i).next(function(a){return is.forEach(a,function(a){var s=function(t,e){return new Ni(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,a.child(i));return r.An(t,s,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,l=r.get(c);null==l&&(l=ci.newInvalidDocument(c),r=r.insert(c,l)),go(u,l,o.localWriteTime),l.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){Gi(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=Ko(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof _o&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),_u=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ko(),i=Ko(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),wu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(kr.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(a){var s=i.Cn(e,a);return(xi(e)||Ri(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(pr()<=o.LogLevel.DEBUG&&dr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ki(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new Ro(zi(t));return e.forEach(function(e,r){Gi(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return pr()<=o.LogLevel.DEBUG&&dr("QueryEngine","Using full collection scan to execute query:",Ki(e)),this.Sn.getDocumentsMatchingQuery(t,e,kr.min())},t}(),Tu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Co(Ir),this.kn=new iu(function(t){return fi(t)},pi),this.On=kr.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new bu(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Iu(t,e,n,r){return new Tu(t,e,n,r)}function Eu(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:return n=_r(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(a){return o=a,r=n.persistence.getMutationQueue(e),i=new bu(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],a=Ko(),s=0,u=o;s<u.length;s++){var c=u[s];n.push(c.batchId);for(var l=0,h=c.mutations;l<h.length;l++)a=a.add(h[l].key)}for(var f=0,p=e;f<p.length;f++){var d=p[f];r.push(d.batchId);for(var g=0,v=d.mutations;g<v.length;g++)a=a.add(v[g].key)}return i.pn(t,a).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=a.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Ou(t,e){var n=_r(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),a=is.resolve();return o.forEach(function(t){a=a.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);br(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),a.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Su(t){var e=_r(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function ku(t,e){var n=_r(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var a=[];e.targetChanges.forEach(function(e,o){var s=i.get(o);if(s){a.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=s.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return br(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(s,c,e)&&a.push(n.qe.updateTargetData(t,c))}}});var s=Lo();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),a.push(Au(t,o,e.documentUpdates,r,void 0).next(function(t){s=t})),!r.isEqual(kr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});a.push(u)}return is.waitFor(a).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,s)}).next(function(){return s})}).then(function(t){return n.Fn=i,t})}function Au(t,e,n,r,i){var o=Ko();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Lo();return n.forEach(function(n,a){var s=t.get(n),u=(null==i?void 0:i.get(n))||r;a.isNoDocument()&&a.version.isEqual(kr.min())?(e.removeEntry(n,u),o=o.insert(n,a)):!s.isValidDocument()||a.version.compareTo(s.version)>0||0===a.version.compareTo(s.version)&&s.hasPendingWrites?(e.addEntry(a,u),o=o.insert(n,a)):dr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",a.version)}),o})}function ju(t,e){var n=_r(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Nu(t,e){var n=_r(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?is.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new ms(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function Cu(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:r=_r(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",s.label=1;case 1:return s.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:if(!cs(a=s.sent()))throw a;return dr("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function Du(t,e,n){var r=_r(t),i=kr.min(),o=Ko();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=_r(t),i=r.kn.get(n);return void 0!==i?is.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Ui(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:kr.min(),n?o:Ko())}).next(function(t){return{documents:t,Bn:o}})})}function xu(t,e){var n=_r(t),r=_r(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function Ru(t){var e=_r(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=_r(t),i=Lo(),o=Ts(n),a=cu(e),s=IDBKeyRange.lowerBound(o,!0);return a.Ot({index:za.readTimeIndex,range:s},function(t,e){var n=_s(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Is(o)}})}(e.$n,t,e.On)}).then(function(t){var n=t.wn;return e.On=t.readTime,n})}function Pu(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){return[2,(e=_r(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=cu(t),n=kr.min();return e.Ot({index:za.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Is(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.On=t})]})})}function Mu(t,e,n,r){return Object(ur.__awaiter)(this,void 0,void 0,function(){var i,o,a,s,u,c,l,h,f,p;return Object(ur.__generator)(this,function(d){switch(d.label){case 0:for(i=_r(t),o=Ko(),a=Lo(),s=Vo(),u=0,c=n;u<c.length;u++)h=e.qn((l=c[u]).metadata.name),l.document&&(o=o.add(h)),a=a.insert(h,e.Un(l)),s=s.insert(h,e.Qn(l.metadata.readTime));return f=i.$n.newChangeBuffer({trackRemovals:!0}),[4,Nu(i,function(t){return Ui(Di(Dr.fromString("__bundle__/docs/"+t)))}(r))];case 1:return p=d.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Au(t,f,a,kr.min(),s).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,p.targetId).next(function(){return i.qe.addMatchingKeys(t,o,p.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function Lu(t,e,n){return void 0===n&&(n=Ko()),Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return[4,Nu(t,Ui(js(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=_r(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=sa(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var a=r.withResumeToken(Mr.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(a.targetId,a),i.qe.updateTargetData(t,a).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(t,e)})})]}})})}var Fu=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return is.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:sa(n.createTime)}),is.resolve()},t.prototype.getNamedQuery=function(t,e){return is.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:js(t.bundledQuery),readTime:sa(t.readTime)}}(e)),is.resolve()},t}(),Uu=function(){function t(){this.Wn=new Ro(qu.Gn),this.zn=new Ro(qu.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new qu(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new qu(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Wr(new Dr([])),r=new qu(n,t),i=new qu(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Wr(new Dr([])),n=new qu(e,t),r=new qu(e,t+1),i=Ko();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new qu(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),qu=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Wr.comparator(t.key,e.key)||Ir(t.ns,e.ns)},t.Hn=function(t,e){return Ir(t.ns,e.ns)||Wr.comparator(t.key,e.key)},t}(),Vu=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Ro(qu.Gn)}return t.prototype.checkEmpty=function(t){return is.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new vs(i,e,n,r);this._n.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.rs=this.rs.add(new qu(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return is.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return is.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return is.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return is.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return is.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new qu(e,0),i=new qu(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),is.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ro(Ir);return e.forEach(function(t){var e=new qu(t,0),i=new qu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),is.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Wr.isDocumentKey(i)||(i=i.child(""));var o=new qu(new Wr(i),0),a=new Ro(Ir);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.ns)),!0)},o),is.resolve(this.us(a))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;br(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return is.forEach(e.mutations,function(i){var o=new qu(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new qu(e,0),r=this.rs.firstAfterOrEqual(n);return is.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return is.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Bu=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Co(Wr.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:a,readTime:n}),this.size+=a-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return is.resolve(n?n.document.clone():ci.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Lo();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():ci.newInvalidDocument(t))}),is.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Lo(),i=new Wr(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.value,u=s.document,c=s.readTime;if(!e.path.isPrefixOf(a.key.path))break;c.compareTo(n)<=0||Gi(e,u)&&(r=r.insert(u.key,u.clone()))}return is.resolve(r)},t.prototype.fs=function(t,e){return is.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new Ku(this)},t.prototype.getSize=function(t){return is.resolve(this.size)},t}(),Ku=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(ur.__extends)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),is.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(ou),Gu=function(){function t(t){this.persistence=t,this.ds=new iu(function(t){return fi(t)},pi),this.lastRemoteSnapshotVersion=kr.min(),this.highestTargetId=0,this.ws=0,this._s=new Uu,this.targetCount=0,this.ys=Hs.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),is.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return is.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return is.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),is.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),is.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Hs(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,is.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),is.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,is.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(a,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.ds.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),is.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return is.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return is.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),is.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),is.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),is.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return is.resolve(n)},t.prototype.containsKey=function(t,e){return is.resolve(this._s.containsKey(e))},t}(),zu=function(){function t(t,e){var n=this;this.gs={},this.Ne=new cr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Gu(this),this.Ut=new xs,this.Ue=function(t,e){return new Bu(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new bs(e),this.Qe=new Fu(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Vu(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;dr("MemoryPersistence","Starting transaction:",t);var i=new Hu(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return is.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Hu=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(ur.__extends)(e,t),e}(ns),Wu=function(){function t(t){this.persistence=t,this.As=new Uu,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw mr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),is.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),is.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),is.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return is.forEach(this.vs,function(r){var i=Wr.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return is.or([function(){return is.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Qu=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Xu(t,e){return"firestore_clients_"+t+"_"+e}function Yu(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function $u(t,e){return"firestore_targets_"+t+"_"+e}Qu.UNAUTHENTICATED=new Qu(null),Qu.GOOGLE_CREDENTIALS=new Qu("google-credentials-uid"),Qu.FIRST_PARTY=new Qu("first-party-uid");var Ju=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),a="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return a&&o.error&&(a="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new hr(o.error.code,o.error.message)),a?new t(e,n,o.state,i):(gr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Zu=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new hr(i.error.code,i.error.message)),o?new t(e,i.state,r):(gr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),tc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=zo(),a=0;i&&a<r.activeTargetIds.length;++a)i=Hr(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(gr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),ec=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(gr("SharedClientState","Failed to parse online state: "+e),null)},t}(),nc=function(){function t(){this.activeTargetIds=zo()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),rc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Co(Ir),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=Xu(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new nc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e,n,r,i,o,a,s,u,c,l=this;return Object(ur.__generator)(this,function(h){switch(h.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=h.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Xu(this.persistenceKey,r)))&&(o=tc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(a=this.storage.getItem(this.Us))&&(s=this.js(a))&&this.Ws(s),u=0,c=this.Os;u<c.length;u++)this.Fs(c[u]);return this.Os=[],this.window.addEventListener("pagehide",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem($u(this.persistenceKey,t));if(n){var r=Zu.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem($u(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return dr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){dr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){dr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(dr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void gr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(ur.__awaiter)(e,void 0,void 0,function(){var t,e,r,i,o,a;return Object(ur.__generator)(this,function(s){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(a=function(t){var e=cr.o;if(null!=t)try{var n=JSON.parse(t);br("number"==typeof n),e=n}catch(t){gr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==cr.o&&this.sequenceNumberHandler(a);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Ju(this.currentUser,t,e,n),i=Yu(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Yu(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=$u(this.persistenceKey,t),i=new Zu(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return tc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Ju.Vs(new Qu(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Zu.Vs(r,e)},t.prototype.js=function(t){return ec.Vs(t)},t.prototype.ii=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ai(t.batchId,t.state,t.error)]:(dr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ui(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),a=[],s=[];return o.forEach(function(t){i.has(t)||a.push(t)}),i.forEach(function(t){o.has(t)||s.push(t)}),this.syncEngine.hi(a,s).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=zo();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),ic=function(){function t(){this.li=new nc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new nc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),oc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),ac=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){dr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){dr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),sc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},uc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),cc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return Object(ur.__extends)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var a=new sr;a.listenOnce(ir.COMPLETE,function(){try{switch(a.getLastErrorCode()){case rr.NO_ERROR:var e=a.getResponseJson();dr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case rr.TIMEOUT:dr("Connection",'RPC "'+t+'" timed out'),o(new hr(lr.DEADLINE_EXCEEDED,"Request time out"));break;case rr.HTTP_ERROR:var n=a.getStatus();if(dr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",a.getResponseText()),n>0){var r=a.getResponseJson().error;if(r&&r.status&&r.message){var s=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(lr).indexOf(e)>=0?e:lr.UNKNOWN}(r.status);o(new hr(s,r.message))}else o(new hr(lr.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new hr(lr.UNAVAILABLE,"Connection failed."));break;default:mr()}}finally{dr("Connection",'RPC "'+t+'" completed.')}});var s=JSON.stringify(r);a.send(e,"POST",s,n,15)})},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Jn,o=te(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(a.initMessageHeaders,e),Object(i.isMobileCordova)()||Object(i.isReactNative)()||Object(i.isElectron)()||Object(i.isIE)()||Object(i.isUWP)()||Object(i.isBrowserExtension)()||(a.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");dr("Connection","Creating WebChannel: "+s,a);var u=r.createWebChannel(s,a),c=!1,l=!1,h=new uc({Ei:function(t){l?dr("Connection","Not sending because WebChannel is closed:",t):(c||(dr("Connection","Opening WebChannel transport."),u.open(),c=!0),dr("Connection","WebChannel sending:",t),u.send(t))},Ti:function(){return u.close()}}),f=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return f(u,ar.EventType.OPEN,function(){l||dr("Connection","WebChannel transport opened.")}),f(u,ar.EventType.CLOSE,function(){l||(l=!0,dr("Connection","WebChannel transport closed"),h.Vi())}),f(u,ar.EventType.ERROR,function(t){l||(l=!0,vr("Connection","WebChannel transport errored:",t),h.Vi(new hr(lr.UNAVAILABLE,"The operation could not be completed")))}),f(u,ar.EventType.MESSAGE,function(t){var e;if(!l){var n=t.data[0];br(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){dr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=Eo[t];if(void 0!==e)return No(e)}(i),a=r.message;void 0===o&&(o=lr.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),l=!0,h.Vi(new hr(o,a)),u.close()}else dr("Connection","WebChannel received:",n),h.Si(n)}}),f(o,or.STAT_EVENT,function(t){10===t.stat?dr("Connection","Detected buffering proxy"):11===t.stat&&dr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);dr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return dr("RestConnection","Received: ",t),t},function(e){throw vr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.6.2",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+sc[t]},t}());function lc(){return"undefined"!=typeof window?window:null}function hc(){return"undefined"!=typeof document?document:null}function fc(t){return new ra(t,!0)}var pc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&dr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),dc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new pc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ar(),this.stream.send(t)},t.prototype.rr=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ar=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return this.ar(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===lr.RESOURCE_EXHAUSTED?(gr(e.toString()),gr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===lr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ur(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ur=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new hr(lr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(ur.__awaiter)(t,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return dr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(dr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),gc=function(t){function e(e,n,r,i,o){var a=this;return(a=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,a}return Object(ur.__extends)(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:mr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(br(void 0===e||"string"==typeof e),Mr.fromBase64String(e||"")):(br(void 0===e||e instanceof Uint8Array),Mr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=(s=e.targetChange.cause)&&function(t){var e=void 0===t.code?lr.UNKNOWN:No(t.code);return new hr(e,t.message||"")}(s);n=new Yo(r,i,o,a||null)}else if("documentChange"in e){i=ha(t,(r=e.documentChange).document.name),o=sa(r.document.updateTime);var s=new si({mapValue:{fields:r.document.fields}}),u=(a=ci.newFoundDocument(i,o,s),r.targetIds||[]);n=new Qo(u,r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e)i=ha(t,(r=e.documentDelete).document),o=r.readTime?sa(r.readTime):kr.min(),s=ci.newNoDocument(i,o),n=new Qo([],a=r.removedTargetIds||[],s.key,s);else if("documentRemove"in e)i=ha(t,(r=e.documentRemove).document),n=new Qo([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return mr();var c=e.filter;i=new Ao(r=c.count||0),n=new Xo(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return kr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?kr.min():e.readTime?sa(e.readTime):kr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=da(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=di(r)?{documents:_a(t,r)}:{query:wa(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=oa(t,e.resumeToken):e.snapshotVersion.compareTo(kr.min())>0&&(n.readTime=ia(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return mr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=da(this.R),e.removeTarget=t,this.cr(e)},e}(dc),vc=function(t){function e(e,n,r,i,o){var a=this;return(a=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,a.gr=!1,a}return Object(ur.__extends)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ur=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(br(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(br(void 0!==e),t.map(function(t){return function(t,e){var n=sa(t.updateTime?t.updateTime:e);return n.isEqual(kr.min())&&(n=sa(e)),new co(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=sa(t.commitTime);return this.listener.Tr(n,e)}return br(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=da(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return ma(e.R,t)})};this.cr(n)},e}(dc),yc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(ur.__extends)(e,t),e.prototype.br=function(){if(this.Rr)throw new hr(lr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===lr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new hr(lr.UNKNOWN,t.toString())})},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Oi(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===lr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new hr(lr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),mc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(gr(e),this.Vr=!1):dr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),bc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(ur.__awaiter)(o,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:return Ac(this)?(dr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return(e=_r(t)).$r.add(4),[4,wc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,_c(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new mc(n,r)};function _c(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:if(!Ac(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function wc(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Tc(t,e){var n=_r(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),kc(n)?Sc(n):Kc(n).er()&&Ec(n,e))}function Ic(t,e){var n=_r(t),r=Kc(n);n.Or.delete(e),r.er()&&Oc(n,e),0===n.Or.size&&(r.er()?r.ir():Ac(n)&&n.Br.set("Unknown"))}function Ec(t,e){t.qr.U(e.targetId),Kc(t).mr(e)}function Oc(t,e){t.qr.U(e),Kc(t).yr(e)}function Sc(t){t.qr=new Jo({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),Kc(t).start(),t.Br.Sr()}function kc(t){return Ac(t)&&!Kc(t).tr()&&t.Or.size>0}function Ac(t){return 0===_r(t).$r.size}function jc(t){t.qr=void 0}function Nc(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){return t.Or.forEach(function(e,n){Ec(t,e)}),[2]})})}function Cc(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(n){return jc(t),kc(t)?(t.Br.Nr(e),Sc(t)):t.Br.set("Unknown"),[2]})})}function Dc(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:if(t.Br.set("Online"),!(e instanceof Yo&&2===e.state&&e.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:n=e.cause,r=0,i=e.targetIds,a.label=1;case 1:return r<i.length?t.Or.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:a.sent(),t.Or.delete(o),t.qr.removeTarget(o),a.label=3;case 3:a.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return a.sent(),[3,5];case 3:return r=a.sent(),dr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,xc(t,r)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Qo?t.qr.X(e):e instanceof Xo?t.qr.rt(e):t.qr.et(e),n.isEqual(kr.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,Su(t.localStore)];case 8:return i=a.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.at(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(Mr.EMPTY_BYTE_STRING,n.snapshotVersion)),Oc(t,e);var r=new ms(n.target,e,1,n.sequenceNumber);Ec(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return dr("RemoteStore","Failed to raise snapshot:",o=a.sent()),[4,xc(t,o)];case 12:return a.sent(),[3,13];case 13:return[2]}})})}function xc(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r=this;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:if(!cs(e))throw e;return t.$r.add(1),[4,wc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Su(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(ur.__awaiter)(r,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return dr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,_c(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function Rc(t,e){return e().catch(function(n){return xc(t,n,e)})}function Pc(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:e=_r(t),n=Gc(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,a.label=1;case 1:if(!function(t){return Ac(t)&&t.kr.length<10}(e))return[3,7];a.label=2;case 2:return a.trys.push([2,4,,6]),[4,ju(e.localStore,r)];case 3:return null===(i=a.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Gc(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=a.sent(),[4,xc(e,o)];case 5:return a.sent(),[3,6];case 6:return[3,1];case 7:return Mc(e)&&Lc(e),[2]}})})}function Mc(t){return Ac(t)&&!Gc(t).tr()&&t.kr.length>0}function Lc(t){Gc(t).start()}function Fc(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){return Gc(t).Ar(),[2]})})}function Uc(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(ur.__generator)(this,function(i){for(e=Gc(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function qc(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=ys.from(r,e,n),[4,Rc(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,Pc(t)];case 2:return o.sent(),[2]}})})}function Vc(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return e&&Gc(t).pr?[4,function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return jo(r=e.code)&&r!==lr.ABORTED?(n=t.kr.shift(),Gc(t).sr(),[4,Rc(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,Pc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Mc(t)&&Lc(t),[2]}})})}function Bc(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return n=_r(t),e?(n.$r.delete(2),[4,_c(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,wc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function Kc(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=_r(t);return r.br(),new gc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Nc.bind(null,t),Ri:Cc.bind(null,t),_r:Dc.bind(null,t)}),t.Mr.push(function(n){return Object(ur.__awaiter)(e,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),kc(t)?Sc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),jc(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Gc(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=_r(t);return r.br(),new vc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Fc.bind(null,t),Ri:Vc.bind(null,t),Ir:Uc.bind(null,t),Tr:qc.bind(null,t)}),t.Mr.push(function(n){return Object(ur.__awaiter)(e,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,Pc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(dr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Qr}var zc=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new rs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new hr(lr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Hc(t,e){if(gr("AsyncQueue",e+": "+t),cs(t))return new hr(lr.UNAVAILABLE,e+": "+t);throw t}var Wc=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Wr.comparator(e.key,n.key)}:function(t,e){return Wr.comparator(t.key,e.key)},this.keyedMap=Uo(),this.sortedSet=new Co(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Qc=function(){function t(){this.Kr=new Co(Wr.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):mr():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Xc=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Wc.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Vi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Yc=function(){this.Wr=void 0,this.listeners=[]},$c=function(){this.queries=new iu(function(t){return Bi(t)},Vi),this.onlineState="Unknown",this.Gr=new Set};function Jc(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a,s,u;return Object(ur.__generator)(this,function(c){switch(c.label){case 0:if(n=_r(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Yc),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),a=o,[4,n.onListen(r)];case 2:return a.Wr=c.sent(),[3,4];case 3:return s=c.sent(),u=Hc(s,"Initialization of query '"+Ki(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&nl(n),[2]}})})}function Zc(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a;return Object(ur.__generator)(this,function(s){return n=_r(t),i=!1,(o=n.queries.get(r=e.query))&&(a=o.listeners.indexOf(e))>=0&&(o.listeners.splice(a,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function tl(t,e){for(var n=_r(t),r=!1,i=0,o=e;i<o.length;i++){var a=o[i],s=n.queries.get(a.query);if(s){for(var u=0,c=s.listeners;u<c.length;u++)c[u].Hr(a)&&(r=!0);s.Wr=a}}r&&nl(n)}function el(t,e,n){var r=_r(t),i=r.queries.get(e);if(i)for(var o=0,a=i.listeners;o<a.length;o++)a[o].onError(n);r.queries.delete(e)}function nl(t){t.Gr.forEach(function(t){t.next()})}var rl=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Xc(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Xc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),il=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),ol=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return ha(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?ya(this.R,t.document,!1):ci.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return sa(t)},t}(),al=function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=sl(t)}return t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new ol(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var a=n.qn(o.metadata.name),s=0,u=o.metadata.queries;s<u.length;s++){var c=u[s],l=(e.get(c)||Ko()).add(a);e.set(c,l)}}return e},t.prototype.complete=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return[4,Mu(this.localStore,new ol(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Lu(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new mu(Object.assign({},this.progress),t))]}})})},t}();function sl(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var ul=function(t){this.key=t},cl=function(t){this.key=t},ll=function(){function t(t,e){this.query=t,this.ao=e,this.uo=null,this.current=!1,this.ho=Ko(),this.mutatedKeys=Ko(),this.lo=zi(t),this.fo=new Wc(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.ao},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Qc,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=xi(this.query)&&i.size===this.query.limit?i.last():null,c=Ri(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var l=i.get(t),h=Gi(n.query,e)?e:null,f=!!l&&n.mutatedKeys.has(l.key),p=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),d=!1;l&&h?l.data.isEqual(h.data)?f!==p&&(r.track({type:3,doc:h}),d=!0):n.yo(l,h)||(r.track({type:2,doc:h}),d=!0,(u&&n.lo(h,u)>0||c&&n.lo(h,c)<0)&&(s=!0)):!l&&h?(r.track({type:0,doc:h}),d=!0):l&&!h&&(r.track({type:1,doc:l}),d=!0,(u||c)&&(s=!0)),d&&(h?(a=a.add(h),o=p?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))}),xi(this.query)||Ri(this.query))for(;a.size>this.query.limit;){var l=xi(this.query)?a.last():a.first();a=a.delete(l.key),o=o.delete(l.key),r.track({type:1,doc:l})}return{fo:a,mo:r,Nn:s,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return mr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var a=e?this.Eo():[],s=0===this.ho.size&&this.current?1:0,u=s!==this.uo;return this.uo=s,0!==o.length||u?{snapshot:new Xc(this.query,t.fo,i,o,t.mutatedKeys,0===s,u,!1),To:a}:{To:a}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Qc,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.ao.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.ao=e.ao.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.ao=e.ao.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ko(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new cl(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new ul(t))}),n},t.prototype.Ao=function(t){this.ao=t.Bn,this.ho=Ko();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Xc.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.uo)},t}(),hl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},fl=function(t){this.key=t,this.bo=!1},pl=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new iu(function(t){return Bi(t)},Vi),this.Vo=new Map,this.So=new Set,this.Do=new Co(Wr.comparator),this.Co=new Map,this.No=new Uu,this.xo={},this.Fo=new Map,this.ko=Hs.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function dl(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return n=Kl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Nu(n.localStore,Ui(e))];case 2:return o=s.sent(),a=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,gl(n,e,o.targetId,"current"===a)];case 3:r=s.sent(),n.isPrimaryClient&&Tc(n.remoteStore,o),s.label=4;case 4:return[2,r]}})})}function gl(t,e,n,r){return Object(ur.__awaiter)(this,void 0,void 0,function(){var i,o,a,s,u,c;return Object(ur.__generator)(this,function(l){switch(l.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return Object(ur.__awaiter)(this,void 0,void 0,function(){var i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return(i=e.view._o(n)).Nn?[4,Du(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=s.sent(),s.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Al(t,e.targetId,a.To),a.snapshot)]}})})}(t,e,n,r)},[4,Du(t.localStore,e,!0)];case 1:return i=l.sent(),o=new ll(e,i.Bn),a=o._o(i.documents),s=Wo.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(a,t.isPrimaryClient,s),Al(t,n,u.To),c=new hl(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function vl(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return n=_r(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!Vi(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Cu(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Ic(n.remoteStore,r.targetId),Sl(n,r.targetId)}).catch($s)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Sl(n,r.targetId),[4,Cu(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function yl(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:r=Gl(t),s.label=1;case 1:return s.trys.push([1,5,,6]),[4,function(t,e){var n,r=_r(t),i=Sr.now(),o=e.reduce(function(t,e){return t.add(e.key)},Ko());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var a=[],s=0,u=e;s<u.length;s++){var c=u[s],l=vo(c,n.get(c.key));null!=l&&a.push(new _o(c.key,l,ui(l.toProto().mapValue),lo.exists(!0)))}return r._n.addMutationBatch(t,i,a,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=s.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Co(Ir)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Cl(r,i.changes)];case 3:return s.sent(),[4,Pc(r.remoteStore)];case 4:return s.sent(),[3,6];case 5:return o=s.sent(),a=Hc(o,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}})})}function ml(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:n=_r(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,ku(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(br(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?br(r.bo):t.removedDocuments.size>0&&(br(r.bo),r.bo=!1))}),[4,Cl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,$s(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function bl(t,e,n){var r=_r(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=_r(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&nl(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function _l(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a,s,u;return Object(ur.__generator)(this,function(c){switch(c.label){case 0:return(r=_r(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(a=(a=new Co(Wr.comparator)).insert(o,ci.newNoDocument(o,kr.min())),s=Ko().add(o),u=new Ho(kr.min(),new Map,new Ro(Ir),a,s),[4,ml(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Nl(r),[3,4];case 2:return[4,Cu(r.localStore,e,!1).then(function(){return Sl(r,e,n)}).catch($s)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function wl(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:n=_r(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Ou(n.localStore,e)];case 2:return i=o.sent(),Ol(n,r,null),El(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Cl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,$s(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Tl(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:r=_r(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=_r(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return br(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Ol(r,e,n),El(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Cl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,$s(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Il(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:Ac((n=_r(t)).remoteStore)||dr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,function(t){var e=_r(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=s.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=s.sent(),a=Hc(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}})})}function El(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Ol(t,e,n){var r=_r(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Sl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||kl(t,e)})}function kl(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Ic(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Nl(t))}function Al(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ul?(t.No.addReference(o.key,e),jl(t,o)):o instanceof cl?(dr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||kl(t,o.key)):mr()}}function jl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(dr("SyncEngine","New document in limbo: "+n),t.So.add(r),Nl(t))}function Nl(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Wr(Dr.fromString(e)),r=t.ko.next();t.Co.set(r,new fl(n)),t.Do=t.Do.insert(n,r),Tc(t.remoteStore,new ms(Ui(Di(n.path)),r,2,cr.o))}}function Cl(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return r=_r(t),i=[],o=[],a=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,s){a.push(r.$o(s,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(s.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=_u.Pn(s.targetId,t);o.push(e)}}))}),[4,Promise.all(a)]);case 1:return s.sent(),r.vo._r(i),[4,function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c;return Object(ur.__generator)(this,function(l){switch(l.label){case 0:n=_r(t),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return is.forEach(e,function(e){return is.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return is.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return l.sent(),[3,4];case 3:if(!cs(r=l.sent()))throw r;return dr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)s=(a=o[i]).targetId,a.fromCache||(u=n.Fn.get(s),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(s,c));return[2]}})})}(r.localStore,o)];case 2:s.sent(),s.label=3;case 3:return[2]}})})}function Dl(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return(n=_r(t)).currentUser.isEqual(e)?[3,3]:(dr("SyncEngine","User change. New user:",e.toKey()),[4,Eu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new hr(lr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Cl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function xl(t,e){var n=_r(t),r=n.Co.get(e);if(r&&r.bo)return Ko().add(r.key);var i=Ko(),o=n.Vo.get(e);if(!o)return i;for(var a=0,s=o;a<s.length;a++){var u=n.Po.get(s[a]);i=i.unionWith(u.view.wo)}return i}function Rl(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return[4,Du((n=_r(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Al(n,e.targetId,i.To),i)]}})})}function Pl(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){return[2,Ru((e=_r(t)).localStore).then(function(t){return Cl(e,t)})]})})}function Ml(t,e,n,r){return Object(ur.__awaiter)(this,void 0,void 0,function(){var i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:return[4,function(t,e){var n=_r(t),r=_r(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):is.resolve(null)})})}((i=_r(t)).localStore,e)];case 1:return null===(o=a.sent())?[3,6]:"pending"!==n?[3,3]:[4,Pc(i.remoteStore)];case 2:return a.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Ol(i,e,r||null),El(i,e),function(t,e){_r(_r(t)._n).Gt(e)}(i.localStore,e)):mr(),a.label=4;case 4:return[4,Cl(i,o)];case 5:return a.sent(),[3,7];case 6:dr("SyncEngine","Cannot apply mutation batch with id: "+e),a.label=7;case 7:return[2]}})})}function Ll(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a,s,u;return Object(ur.__generator)(this,function(c){switch(c.label){case 0:return Kl(n=_r(t)),Gl(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Fl(n,r.toArray())]);case 1:return i=c.sent(),n.Oo=!0,[4,Bc(n.remoteStore,!0)];case 2:for(c.sent(),o=0,a=i;o<a.length;o++)Tc(n.remoteStore,a[o]);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(s=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?s.push(e):u=u.then(function(){return Sl(n,e),Cu(n.localStore,e,!0)}),Ic(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,Fl(n,s)];case 5:return c.sent(),function(t){var e=_r(t);e.Co.forEach(function(t,n){Ic(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Co(Wr.comparator)}(n),n.Oo=!1,[4,Bc(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function Fl(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,h,f,p,d;return Object(ur.__generator)(this,function(g){switch(g.label){case 0:n=_r(t),r=[],i=[],o=0,a=e,g.label=1;case 1:return o<a.length?(u=void 0,(c=n.Vo.get(s=a[o]))&&0!==c.length?[4,Nu(n.localStore,Ui(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),l=0,h=c,g.label=3;case 3:return l<h.length?(f=n.Po.get(h[l]),[4,Rl(n,f)]):[3,6];case 4:(p=g.sent()).snapshot&&i.push(p.snapshot),g.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,xu(n.localStore,s)];case 8:return d=g.sent(),[4,Nu(n.localStore,d)];case 9:return u=g.sent(),[4,gl(n,Ul(d),s,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function Ul(t){return Ci(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function ql(t){var e=_r(t);return _r(_r(e.localStore).persistence).fn()}function Vl(t,e,n,r){return Object(ur.__awaiter)(this,void 0,void 0,function(){var i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return(i=_r(t)).Oo?(dr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Ru(i.localStore)];case 3:return o=s.sent(),a=Ho.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Cl(i,o,a)];case 4:return s.sent(),[3,8];case 5:return[4,Cu(i.localStore,e,!0)];case 6:return s.sent(),Sl(i,e,r),[3,8];case 7:mr(),s.label=8;case 8:return[2]}})})}function Bl(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a,s,u,c,l,h;return Object(ur.__generator)(this,function(f){switch(f.label){case 0:if(!(r=Kl(t)).Oo)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(a=o[i])?(dr("SyncEngine","Adding an already active target "+a),[3,5]):[4,xu(r.localStore,a)]:[3,6];case 2:return s=f.sent(),[4,Nu(r.localStore,s)];case 3:return u=f.sent(),[4,gl(r,Ul(s),u.targetId,!1)];case 4:f.sent(),Tc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Cu(r.localStore,t,!1).then(function(){Ic(r.remoteStore,t),Sl(r,t)}).catch($s)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},l=0,h=n,f.label=7;case 7:return l<h.length?[5,c(h[l])]:[3,10];case 8:f.sent(),f.label=9;case 9:return l++,[3,7];case 10:return[2]}})})}function Kl(t){var e=_r(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=ml.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_l.bind(null,e),e.vo._r=tl.bind(null,e.eventManager),e.vo.Mo=el.bind(null,e.eventManager),e}function Gl(t){var e=_r(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Tl.bind(null,e),e}function zl(t,e,n){var r=_r(t);(function(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a,s,u;return Object(ur.__generator)(this,function(c){switch(c.label){case 0:return c.trys.push([0,14,,15]),[4,e.getMetadata()];case 1:return r=c.sent(),[4,function(t,e){var n=_r(t),r=sa(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",function(t){return n.Qe.getBundleMetadata(t,e.id)}).then(function(t){return!!t&&t.createTime.compareTo(r)>=0})}(t.localStore,r)];case 2:return c.sent()?[4,e.close()]:[3,4];case 3:return[2,(c.sent(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r)))];case 4:return n._updateProgress(sl(r)),i=new al(r,t.localStore,e.R),[4,e.Lo()];case 5:o=c.sent(),c.label=6;case 6:return o?[4,i.oo(o)]:[3,10];case 7:return(a=c.sent())&&n._updateProgress(a),[4,e.Lo()];case 8:o=c.sent(),c.label=9;case 9:return[3,6];case 10:return[4,i.complete()];case 11:return s=c.sent(),[4,Cl(t,s.wn,void 0)];case 12:return c.sent(),[4,function(t,e){var n=_r(t);return n.persistence.runTransaction("Save bundle","readwrite",function(t){return n.Qe.saveBundleMetadata(t,e)})}(t.localStore,r)];case 13:return c.sent(),n._completeWith(s.progress),[3,15];case 14:return vr("SyncEngine","Loading bundle failed with "+(u=c.sent())),n._failWith(u),[3,15];case 15:return[2]}})})})(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var Hl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return this.R=fc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Iu(this.persistence,new wu,t.initialUser,this.R)},t.prototype.qo=function(t){return new zu(Wu.bs,this.R)},t.prototype.Bo=function(t){return new ic},t.prototype.terminate=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),Wl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(ur.__extends)(e,t),e.prototype.initialize=function(e){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Pu(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,Gl(this.Ko.syncEngine)];case 4:return n.sent(),[4,Pc(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Qo=function(t){return Iu(this.persistence,new wu,t.initialUser,this.R)},e.prototype.Uo=function(t){return new tu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=yu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Fs.withCacheSize(this.cacheSizeBytes):Fs.DEFAULT;return new du(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,lc(),hc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new ic},e}(Hl),Ql=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(ur.__extends)(e,t),e.prototype.initialize=function(e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r=this;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof rc?(this.sharedClientState.syncEngine={ai:Ml.bind(null,n),ui:Vl.bind(null,n),hi:Bl.bind(null,n),fn:ql.bind(null,n),ci:Pl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(ur.__awaiter)(r,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return[4,Ll(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=lc();if(!rc.yt(e))throw new hr(lr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=yu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new rc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Wl),Xl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n=this;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return bl(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Dl.bind(null,this.syncEngine),[4,Bc(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new $c},t.prototype.createDatastore=function(t){var e=fc(t.databaseInfo.databaseId),n=new cc(t.databaseInfo);return function(t,e,n){return new yc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,a=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return bl(a.syncEngine,t,0)},o=ac.yt()?new ac:new oc,new bc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,a){var s=new pl(t,e,n,r,i,o);return a&&(s.Oo=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return e=_r(t),dr("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,wc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}();function Yl(t,e){void 0===e&&(e=10240);var n=0;return{read:function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r;return Object(ur.__generator)(this,function(i){return n<t.byteLength?(r={value:t.slice(n,n+e),done:!1},[2,(n+=e,r)]):[2,{done:!0}]})})},cancel:function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var $l=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Jl=function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new rs,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}return t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e,n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new il(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})},t}(),Zl=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new hr(lr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a,s;return Object(ur.__generator)(this,function(u){switch(u.label){case 0:return n=_r(t),r=da(n.R)+"/documents",i={documents:e.map(function(t){return la(n.R,t)})},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=u.sent(),a=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){br(!!e.found);var n=ha(t,e.found.name),r=sa(e.found.updateTime),i=new si({mapValue:{fields:e.found.fields}});return ci.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){br(!!e.missing),br(!!e.readTime);var n=ha(t,e.missing),r=sa(e.readTime);return ci.newNoDocument(n,r)}(t,e):mr()}(n.R,t);a.set(e.key.toString(),e)}),s=[],[2,(e.forEach(function(t){var e=a.get(t.toString());br(!!e),s.push(e)}),s)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new So(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e=this;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Wr.fromPath(n);e.mutations.push(new ko(r,e.precondition(r)))}),[4,function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return n=_r(t),r=da(n.R)+"/documents",i={writes:e.map(function(t){return ma(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw mr();e=kr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new hr(lr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?lo.updateTime(e):lo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(kr.min()))throw new hr(lr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return lo.updateTime(e)}return lo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),th=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new pc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(ur.__awaiter)(t,void 0,void 0,function(){var t,e,n=this;return Object(ur.__generator)(this,function(r){return t=new Zl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Gr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!jo(e)}return!1},t}(),eh=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Qu.UNAUTHENTICATED,this.clientId=Tr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(ur.__awaiter)(r,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return dr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new hr(lr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new rs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(ur.__awaiter)(t,void 0,void 0,function(){var t,n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Hc(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function nh(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i=this;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),dr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(ur.__awaiter)(i,void 0,void 0,function(){return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Eu(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function rh(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,ih(t)];case 1:return n=i.sent(),dr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return(n=_r(t)).asyncQueue.verifyOperationInProgress(),dr("RemoteStore","RemoteStore received new credentials"),r=Ac(n),n.$r.add(3),[4,wc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,_c(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function ih(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(dr("FirestoreClient","Using default OfflineComponentProvider"),[4,nh(t,new Hl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function oh(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(dr("FirestoreClient","Using default OnlineComponentProvider"),[4,rh(t,new Xl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function ah(t){return ih(t).then(function(t){return t.persistence})}function sh(t){return ih(t).then(function(t){return t.localStore})}function uh(t){return oh(t).then(function(t){return t.remoteStore})}function ch(t){return oh(t).then(function(t){return t.syncEngine})}function lh(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,oh(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=dl.bind(null,e.syncEngine),n.onUnlisten=vl.bind(null,e.syncEngine),n)]}})})}function hh(t,e,n){var r=this;void 0===n&&(n={});var i=new rs;return t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(r,void 0,void 0,function(){var r;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new $l({next:function(o){e.enqueueAndForget(function(){return Zc(t,a)});var s=o.docs.has(n);!s&&o.fromCache?i.reject(new hr(lr.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&o.fromCache&&r&&"server"===r.source?i.reject(new hr(lr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),a=new rl(Di(n.path),o,{includeMetadataChanges:!0,so:!0});return Jc(t,a)},[4,lh(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function fh(t,e,n){var r=this;void 0===n&&(n={});var i=new rs;return t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(r,void 0,void 0,function(){var r;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new $l({next:function(n){e.enqueueAndForget(function(){return Zc(t,a)}),n.fromCache&&"server"===r.source?i.reject(new hr(lr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),a=new rl(n,o,{includeMetadataChanges:!0,so:!0});return Jc(t,a)},[4,lh(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var ph=function(t,e,n,r,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a},dh=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),gh=new Map,vh=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},yh=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Qu.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),mh=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),bh=function(){function t(t){var e=this;this.currentUser=Qu.UNAUTHENTICATED,this.oc=new rs,this.cc=0,this.changeListener=function(){return Promise.resolve()},this.ac=!1,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.hc(),e.oc.resolve(),e.ac&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){dr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.lc(),e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):e.ac&&(dr("FirebaseCredentialsProvider","Auth not yet detected"),e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)}))}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(dr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(br("string"==typeof n.accessToken),new vh(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){this.ac=!0,this.asyncQueue=t,this.changeListener=e},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.hc=function(){var t=this.auth&&this.auth.getUid();return br(null===t||"string"==typeof t),new Qu(t)},t.prototype.lc=function(){var t=this;this.ac&&(this.ac=!1,this.asyncQueue.enqueueRetryable(function(){return Object(ur.__awaiter)(t,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,this.changeListener(this.currentUser)];case 2:return t.sent(),this.ac=!0,[2]}})})}))},t}(),_h=function(){function t(t,e,n){this.fc=t,this.dc=e,this.wc=n,this.type="FirstParty",this.user=Qu.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.dc},e=this.fc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.wc&&(t["X-Goog-Iam-Authorization-Token"]=this.wc),t},enumerable:!1,configurable:!0}),t}(),wh=function(){function t(t,e,n){this.fc=t,this.dc=e,this.wc=n}return t.prototype.getToken=function(){return Promise.resolve(new _h(this.fc,this.dc,this.wc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Qu.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Th(t,e,n){if(!n)throw new hr(lr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Ih(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new hr(lr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Eh(t,e,n,r){if(!0===e&&!0===r)throw new hr(lr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Oh(t){if(!Wr.isDocumentKey(t))throw new hr(lr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Sh(t){if(Wr.isDocumentKey(t))throw new hr(lr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function kh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":mr()}function Ah(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new hr(lr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=kh(t);throw new hr(lr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function jh(t,e){if(e<=0)throw new hr(lr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Nh=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new hr(lr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new hr(lr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Eh("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Ch=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nh({}),this._settingsFrozen=!1,t instanceof dh?(this._databaseId=t,this._credentials=new yh):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new hr(lr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new dh(t.options.projectId)}(t),this._credentials=new bh(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new hr(lr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new hr(lr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nh(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new yh;switch(t.type){case"gapi":var e=t.client;return br(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new wh(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new hr(lr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=gh.get(this))&&(dr("ComponentProvider","Removing Datastore"),gh.delete(this),t.terminate()),Promise.resolve();var t},t}(),Dh=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Rh(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),xh=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Rh=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Di(r))||this)._path=r,i.type="collection",i}return Object(ur.__extends)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Dh(this.firestore,null,new Wr(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(xh);function Ph(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t=Object(i.getModularInstance)(t),Th("collection","path",e),t instanceof Ch)return Sh(n=Dr.fromString.apply(Dr,Object(ur.__spreadArray)([e],r))),new Rh(t,null,n);if(!(t instanceof Dh||t instanceof Rh))throw new hr(lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Sh(n=Dr.fromString.apply(Dr,Object(ur.__spreadArray)([t.path],r)).child(Dr.fromString(e))),new Rh(t.firestore,null,n)}function Mh(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t=Object(i.getModularInstance)(t),1===arguments.length&&(e=Tr.u()),Th("doc","path",e),t instanceof Ch)return Oh(n=Dr.fromString.apply(Dr,Object(ur.__spreadArray)([e],r))),new Dh(t,null,new Wr(n));if(!(t instanceof Dh||t instanceof Rh))throw new hr(lr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Oh(n=t._path.child(Dr.fromString.apply(Dr,Object(ur.__spreadArray)([e],r)))),new Dh(t.firestore,t instanceof Rh?t.converter:null,new Wr(n))}function Lh(t,e){return t=Object(i.getModularInstance)(t),e=Object(i.getModularInstance)(e),(t instanceof Dh||t instanceof Rh)&&(e instanceof Dh||e instanceof Rh)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Fh(t,e){return t=Object(i.getModularInstance)(t),e=Object(i.getModularInstance)(e),t instanceof xh&&e instanceof xh&&t.firestore===e.firestore&&Vi(t._query,e._query)&&t.converter===e.converter}var Uh=function(){function t(){var t=this;this._c=Promise.resolve(),this.mc=[],this.yc=!1,this.gc=[],this.Ec=null,this.Tc=!1,this.Ic=[],this.Zi=new pc(this,"async_queue_retry"),this.Ac=function(){var e=hc();e&&dr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=hc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ac)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.yc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Rc(),this.bc(t)},t.prototype.enterRestrictedMode=function(){if(!this.yc){this.yc=!0;var t=hc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ac)}},t.prototype.enqueue=function(t){return this.Rc(),this.yc?new Promise(function(t){}):this.bc(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.mc.push(t),e.vc()})},t.prototype.vc=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e=this;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:if(0===this.mc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.mc[0]()];case 2:return n.sent(),this.mc.shift(),this.Zi.reset(),[3,4];case 3:if(!cs(t=n.sent()))throw t;return dr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.mc.length>0&&this.Zi.ji(function(){return e.vc()}),n.label=5;case 5:return[2]}})})},t.prototype.bc=function(t){var e=this,n=this._c.then(function(){return e.Tc=!0,t().catch(function(t){throw e.Ec=t,e.Tc=!1,gr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.Tc=!1,t})});return this._c=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Rc(),this.Ic.indexOf(t)>-1&&(e=0);var i=zc.createAndSchedule(this,t,e,n,function(t){return r.Pc(t)});return this.gc.push(i),i},t.prototype.Rc=function(){this.Ec&&mr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Vc=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t;return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return[4,t=this._c];case 1:e.sent(),e.label=2;case 2:if(t!==this._c)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Sc=function(t){for(var e=0,n=this.gc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Dc=function(t){var e=this;return this.Vc().then(function(){e.gc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.gc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Vc()})},t.prototype.Cc=function(t){this.Ic.push(t)},t.prototype.Pc=function(t){var e=this.gc.indexOf(t);this.gc.splice(e,1)},t}();function qh(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Vh=function(){function t(){this._progressObserver={},this._taskCompletionResolver=new rs,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},t}(),Bh=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Uh,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(ur.__extends)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Gh(this),this._firestoreClient.terminate()},e}(Ch);function Kh(t){return t._firestoreClient||Gh(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Gh(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new ph(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new eh(t._credentials,t._queue,r)}function zh(t,e,n){var r=this,i=new rs;return t.asyncQueue.enqueue(function(){return Object(ur.__awaiter)(r,void 0,void 0,function(){var r;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,nh(t,n)];case 1:return o.sent(),[4,rh(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===lr.FAILED_PRECONDITION||t.code===lr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function Hh(t){if(t._initialized||t._terminated)throw new hr(lr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Wh=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new hr(lr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rr(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Qh=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Mr.fromBase64String(e))}catch(e){throw new hr(lr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Mr.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Xh=function(t){this._methodName=t},Yh=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new hr(lr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new hr(lr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Ir(this._lat,t._lat)||Ir(this._long,t._long)},t}(),$h=/^__.*__$/,Jh=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new _o(t,this.data,this.fieldMask,e,this.fieldTransforms):new bo(t,this.data,e,this.fieldTransforms)},t}(),Zh=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new _o(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function tf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw mr()}}var ef=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Nc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xc",{get:function(){return this.settings.xc},enumerable:!1,configurable:!0}),t.prototype.Fc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Fc({path:n,Oc:!1});return r.$c(t),r},t.prototype.Mc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Fc({path:n,Oc:!1});return r.Nc(),r},t.prototype.Lc=function(t){return this.Fc({path:void 0,Oc:!0})},t.prototype.Bc=function(t){return Tf(t,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Uc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Nc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Bc("Document fields must not be empty");if(tf(this.xc)&&$h.test(t))throw this.Bc('Document fields cannot begin and end with "__"')},t}(),nf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||fc(t)}return t.prototype.Qc=function(t,e,n,r){return void 0===r&&(r=!1),new ef({xc:t,methodName:e,Uc:n,path:Rr.emptyPath(),Oc:!1,qc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function rf(t){var e=t._freezeSettings(),n=fc(t._databaseId);return new nf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function of(t,e,n,r,i,o){void 0===o&&(o={});var a=t.Qc(o.merge||o.mergeFields?2:0,e,n,i);mf("Data must be an object, but it was:",a,r);var s,u,c=vf(r,a);if(o.merge)s=new Pr(a.fieldMask),u=a.fieldTransforms;else if(o.mergeFields){for(var l=[],h=0,f=o.mergeFields;h<f.length;h++){var p=bf(e,f[h],n);if(!a.contains(p))throw new hr(lr.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");If(l,p)||l.push(p)}s=new Pr(l),u=a.fieldTransforms.filter(function(t){return s.covers(t.field)})}else s=null,u=a.fieldTransforms;return new Jh(new si(c),s,u)}var af=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(ur.__extends)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.xc)throw t.Bc(1===t.xc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Xh);function sf(t,e,n){return new ef({xc:3,Uc:e.settings.Uc,methodName:t._methodName,Oc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var uf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(ur.__extends)(e,t),e.prototype._toFieldTransform=function(t){return new uo(t.path,new to)},e.prototype.isEqual=function(t){return t instanceof e},e}(Xh),cf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(ur.__extends)(e,t),e.prototype._toFieldTransform=function(t){var e=sf(this,t,!0),n=this.Kc.map(function(t){return gf(t,e)}),r=new eo(n);return new uo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Xh),lf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(ur.__extends)(e,t),e.prototype._toFieldTransform=function(t){var e=sf(this,t,!0),n=this.Kc.map(function(t){return gf(t,e)}),r=new ro(n);return new uo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Xh),hf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).jc=n,r}return Object(ur.__extends)(e,t),e.prototype._toFieldTransform=function(t){var e=new oo(t.R,Xi(t.R,this.jc));return new uo(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Xh);function ff(t,e,n,r){var o=t.Qc(1,e,n);mf("Data must be an object, but it was:",o,r);var a=[],s=si.empty();jr(r,function(t,r){var u=wf(e,t,n);r=Object(i.getModularInstance)(r);var c=o.Mc(u);if(r instanceof af)a.push(u);else{var l=gf(r,c);null!=l&&(a.push(u),s.set(u,l))}});var u=new Pr(a);return new Zh(s,u,o.fieldTransforms)}function pf(t,e,n,r,o,a){var s=t.Qc(1,e,n),u=[bf(e,r,n)],c=[o];if(a.length%2!=0)throw new hr(lr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var l=0;l<a.length;l+=2)u.push(bf(e,a[l])),c.push(a[l+1]);for(var h=[],f=si.empty(),p=u.length-1;p>=0;--p)if(!If(h,u[p])){var d=u[p],g=c[p];g=Object(i.getModularInstance)(g);var v=s.Mc(d);if(g instanceof af)h.push(d);else{var y=gf(g,v);null!=y&&(h.push(d),f.set(d,y))}}var m=new Pr(h);return new Zh(f,m,s.fieldTransforms)}function df(t,e,n,r){return void 0===r&&(r=!1),gf(n,t.Qc(r?4:3,e))}function gf(t,e){if(yf(t=Object(i.getModularInstance)(t)))return mf("Unsupported field value:",e,t),vf(t,e);if(t instanceof Xh)return function(t,e){if(!tf(e.xc))throw e.Bc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Bc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Oc&&4!==e.xc)throw e.Bc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=gf(o[i],e.Lc(r));null==a&&(a={nullValue:"NULL_VALUE"}),n.push(a),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(i.getModularInstance)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Xi(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Sr.fromDate(t);return{timestampValue:ia(e.R,n)}}if(t instanceof Sr)return n=new Sr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ia(e.R,n)};if(t instanceof Yh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Qh)return{bytesValue:oa(e.R,t._byteString)};if(t instanceof Dh){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Bc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ua(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Bc("Unsupported field value: "+kh(t))}(t,e)}function vf(t,e){var n={};return Nr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jr(t,function(t,r){var i=gf(r,e.kc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function yf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Sr||t instanceof Yh||t instanceof Qh||t instanceof Dh||t instanceof Xh)}function mf(t,e,n){if(!yf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=kh(n);throw e.Bc("an object"===r?t+" a custom object":t+" "+r)}}function bf(t,e,n){if((e=Object(i.getModularInstance)(e))instanceof Wh)return e._internalPath;if("string"==typeof e)return wf(t,e);throw Tf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var _f=new RegExp("[~\\*/\\[\\]]");function wf(t,e,n){if(e.search(_f)>=0)throw Tf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Wh.bind.apply(Wh,Object(ur.__spreadArray)([void 0],e.split(".")))))._internalPath}catch(r){throw Tf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Tf(t,e,n,r,i){var o=r&&!r.isEmpty(),a=void 0!==i,s="Function "+e+"() called with invalid data";n&&(s+=" (via `toFirestore()`)");var u="";return(o||a)&&(u+=" (found",o&&(u+=" in field "+r),a&&(u+=" in document "+i),u+=")"),new hr(lr.INVALID_ARGUMENT,(s+=". ")+t+u)}function If(t,e){return t.some(function(t){return t.isEqual(e)})}var Ef=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Dh(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Of(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Sf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Of=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(ur.__extends)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Ef);function Sf(t,e){return"string"==typeof e?wf(t,e):e instanceof Wh?e._internalPath:e._delegate._internalPath}var kf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Af=function(t){function e(e,n,r,i,o,a){var s=this;return(s=t.call(this,e,n,r,i,a)||this)._firestore=e,s._firestoreImpl=e,s.metadata=o,s}return Object(ur.__extends)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new jf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Sf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Ef),jf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(ur.__extends)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Af),Nf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new kf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new jf(n._firestore,n._userDataWriter,r.key,r,new kf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new hr(lr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new jf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new kf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new jf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new kf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Cf(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Cf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return mr()}}function Df(t,e){return t instanceof Af&&e instanceof Af?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Nf&&e instanceof Nf&&t._firestore===e._firestore&&Fh(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function xf(t){if(Ri(t)&&0===t.explicitOrderBy.length)throw new hr(lr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Rf=function(){};function Pf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Mf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Wc=e,i.Gc=n,i.zc=r,i.type="where",i}return Object(ur.__extends)(e,t),e.prototype._apply=function(t){var e=rf(t.firestore),n=function(t,e,n,r,i,o,a){var s;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new hr(lr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Kf(a,o);for(var u=[],c=0,l=a;c<l.length;c++)u.push(Bf(r,t,l[c]));s={arrayValue:{values:u}}}else s=Bf(r,t,a)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Kf(a,o),s=df(n,"where",a,"in"===o||"not-in"===o);var h=gi.create(i,o,s);return function(t,e){if(e.g()){var n=Mi(t);if(null!==n&&!n.isEqual(e.field))throw new hr(lr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Pi(t);null!==r&&Gf(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new hr(lr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,h),h}(t._query,0,e,t.firestore._databaseId,this.Wc,this.Gc,this.zc);return new xh(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Ni(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Rf),Lf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Wc=e,r.Hc=n,r.type="orderBy",r}return Object(ur.__extends)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new hr(lr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new hr(lr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Si(e,n);return function(t,e){if(null===Pi(t)){var n=Mi(t);null!==n&&Gf(0,n,e.field)}}(t,r),r}(t._query,this.Wc,this.Hc);return new xh(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Ni(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Rf),Ff=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(ur.__extends)(e,t),e.prototype._apply=function(t){return new xh(t.firestore,t.converter,qi(t._query,this.Jc,this.Yc))},e}(Rf),Uf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Xc=n,i.Zc=r,i}return Object(ur.__extends)(e,t),e.prototype._apply=function(t){var e=Vf(t,this.type,this.Xc,this.Zc);return new xh(t.firestore,t.converter,function(t,e){return new Ni(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Rf),qf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Xc=n,i.Zc=r,i}return Object(ur.__extends)(e,t),e.prototype._apply=function(t){var e=Vf(t,this.type,this.Xc,this.Zc);return new xh(t.firestore,t.converter,function(t,e){return new Ni(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Rf);function Vf(t,e,n,r){if(n[0]=Object(i.getModularInstance)(n[0]),n[0]instanceof Ef)return function(t,e,n,r,i){if(!r)throw new hr(lr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],a=0,s=Fi(t);a<s.length;a++){var u=s[a];if(u.field.isKeyField())o.push(ei(e,r.key));else{var c=r.data.field(u.field);if(Vr(c))throw new hr(lr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=u.field.canonicalString();throw new hr(lr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+l+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Ei(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var o=rf(t.firestore);return function(t,e,n,r,i,o){var a=t.explicitOrderBy;if(i.length>a.length)throw new hr(lr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var s=[],u=0;u<i.length;u++){var c=i[u];if(a[u].field.isKeyField()){if("string"!=typeof c)throw new hr(lr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Li(t)&&-1!==c.indexOf("/"))throw new hr(lr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var l=t.path.child(Dr.fromString(c));if(!Wr.isDocumentKey(l))throw new hr(lr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+l+"' is not because it contains an odd number of segments.");var h=new Wr(l);s.push(ei(e,h))}else{var f=df(n,r,c);s.push(f)}}return new Ei(s,o)}(t._query,t.firestore._databaseId,o,e,n,r)}function Bf(t,e,n){if("string"==typeof(n=Object(i.getModularInstance)(n))){if(""===n)throw new hr(lr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Li(e)&&-1!==n.indexOf("/"))throw new hr(lr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Dr.fromString(n));if(!Wr.isDocumentKey(r))throw new hr(lr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return ei(t,new Wr(r))}if(n instanceof Dh)return ei(t,n._key);throw new hr(lr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+kh(n)+".")}function Kf(t,e){if(!Array.isArray(t)||0===t.length)throw new hr(lr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new hr(lr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Gf(t,e,n){if(!n.isEqual(e))throw new hr(lr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var zf=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Qr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ur(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(qr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw mr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return jr(t.fields||{},function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new Yh(Ur(t.latitude),Ur(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Br(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Kr(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Fr(t);return new Sr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Dr.fromString(t);br(xa(n));var r=new dh(n.get(1),n.get(3)),i=new Wr(n.popFirst(5));return r.isEqual(e)||gr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Hf(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Wf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(ur.__extends)(e,t),e.prototype.convertBytes=function(t){return new Qh(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Dh(this.firestore,null,e)},e}(zf),Qf=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=rf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Xf(t,this._firestore),i=Hf(r.converter,e,n),o=of(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,lo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];this._verifyNotCommitted();var a,s=Xf(t,this._firestore);return a="string"==typeof(e=Object(i.getModularInstance)(e))||e instanceof Wh?pf(this._dataReader,"WriteBatch.update",s._key,e,n,r):ff(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,lo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Xf(t,this._firestore);return this._mutations=this._mutations.concat(new So(e._key,lo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new hr(lr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Xf(t,e){if((t=Object(i.getModularInstance)(t)).firestore!==e)throw new hr(lr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Yf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(ur.__extends)(e,t),e.prototype.convertBytes=function(t){return new Qh(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Dh(this.firestore,null,e)},e}(zf);function $f(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];t=Ah(t,Dh);var a=Ah(t.firestore,Bh),s=rf(a);return Zf(a,[("string"==typeof(e=Object(i.getModularInstance)(e))||e instanceof Wh?pf(s,"updateDoc",t._key,e,n,r):ff(s,"updateDoc",t._key,e)).toMutation(t._key,lo.exists(!0))])}function Jf(t){for(var e,n,r,o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];t=Object(i.getModularInstance)(t);var s={includeMetadataChanges:!1},u=0;"object"!=typeof o[u]||qh(o[u])||(s=o[u],u++);var c,l,h,f={includeMetadataChanges:s.includeMetadataChanges};if(qh(o[u])){var p=o[u];o[u]=null===(e=p.next)||void 0===e?void 0:e.bind(p),o[u+1]=null===(n=p.error)||void 0===n?void 0:n.bind(p),o[u+2]=null===(r=p.complete)||void 0===r?void 0:r.bind(p)}if(t instanceof Dh)l=Ah(t.firestore,Bh),h=Di(t._key.path),c={next:function(e){o[u]&&o[u](tp(l,t,e))},error:o[u+1],complete:o[u+2]};else{var d=Ah(t,xh);l=Ah(d.firestore,Bh),h=d._query;var g=new Yf(l);c={next:function(t){o[u]&&o[u](new Nf(l,g,d,t))},error:o[u+1],complete:o[u+2]},xf(t._query)}return function(t,e,n,r){var i=this,o=new $l(r),a=new rl(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(i,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return e=Jc,[4,lh(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(i,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return e=Zc,[4,lh(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}})})})}}(Kh(l),h,f,c)}function Zf(t,e){return function(t,e){var n=this,r=new rs;return t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(n,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return n=yl,[4,ch(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(Kh(t),e)}function tp(t,e,n){var r=n.docs.get(e._key),i=new Yf(t);return new Af(t,i,e._key,r,new kf(n.hasPendingWrites,n.fromCache),e.converter)}var ep=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(ur.__extends)(e,t),e.prototype.get=function(e){var n=this,r=Xf(e,this._firestore),i=new Yf(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Af(n._firestore,i,r._key,t._document,new kf(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=rf(t)}return t.prototype.get=function(t){var e=this,n=Xf(t,this._firestore),r=new Wf(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return mr();var i=t[0];if(i.isFoundDocument())return new Ef(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Ef(e._firestore,r,n._key,null,n.converter);throw mr()})},t.prototype.set=function(t,e,n){var r=Xf(t,this._firestore),i=Hf(r.converter,e,n),o=of(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var a,s=Xf(t,this._firestore);return a="string"==typeof(e=Object(i.getModularInstance)(e))||e instanceof Wh?pf(this._dataReader,"Transaction.update",s._key,e,n,r):ff(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,a),this},t.prototype.delete=function(t){var e=Xf(t,this._firestore);return this._transaction.delete(e._key),this},t}());function np(){if("undefined"==typeof Uint8Array)throw new hr(lr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function rp(){if("undefined"==typeof atob)throw new hr(lr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ip=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return rp(),new t(Qh.fromBase64String(e))},t.fromUint8Array=function(e){return np(),new t(Qh.fromUint8Array(e))},t.prototype.toBase64=function(){return rp(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return np(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),op=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Hh(t=Ah(t,Bh));var n=Kh(t),r=t._freezeSettings(),i=new Xl;return zh(n,i,new Wl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Hh(t=Ah(t,Bh));var e=Kh(t),n=t._freezeSettings(),r=new Xl;return zh(e,r,new Ql(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new hr(lr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new rs;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(ur.__awaiter)(e,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return as.yt()?[4,as.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(yu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),ap=function(){function t(t,e,n){var r=this;this._delegate=e,this.ta=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof dh||(this.ea=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var o=(t=Ah(t,Ch))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&vr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var a=Object(i.createMockUserToken)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new hr(lr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new mh(new vh(a,new Qu(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(ur.__awaiter)(e,void 0,void 0,function(){var e,n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,ah(t)];case 1:return e=r.sent(),[4,uh(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=_r(t);return e.$r.delete(0),_c(e)}(n))]}})})})}(Kh(Ah(this._delegate,Bh)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(ur.__awaiter)(e,void 0,void 0,function(){var e,n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,ah(t)];case 1:return e=r.sent(),[4,uh(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return(e=_r(t)).$r.add(0),[4,wc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Kh(Ah(this._delegate,Bh)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Eh("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.ta.enableMultiTabIndexedDbPersistence(this):this.ta.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.ta.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.ea&&(this.ea._removeServiceInstance("firestore"),this.ea._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new rs;return t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(e,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return e=Il,[4,ch(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(Kh(Ah(this._delegate,Bh)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new $l(e);return t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(n,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return e=function(t,e){_r(t).Gr.add(e),e.next()},[4,lh(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(n,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return e=function(t,e){_r(t).Gr.delete(e)},[4,lh(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(Kh(t=Ah(t,Bh)),qh(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.ea)throw new hr(lr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.ea},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new _p(this,Ph(this._delegate,t))}catch(t){throw fp(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new hp(this,Mh(this._delegate,t))}catch(t){throw fp(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new yp(this,function(t,e){if(t=Ah(t,Ch),Th("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new hr(lr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new xh(t,null,function(t){return new Ni(Dr.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw fp(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new rs;return t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(n,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,function(t){return oh(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new th(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(Kh(t),function(n){return e(new ep(t,n))})}(this._delegate,function(n){return t(new up(e,n))})},t.prototype.batch=function(){var t=this;return Kh(this._delegate),new cp(new Qf(this._delegate,function(e){return Zf(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new hr(lr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new hr(lr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),sp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(ur.__extends)(e,t),e.prototype.convertBytes=function(t){return new ip(new Qh(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return hp.na(e,this.firestore,null)},e}(zf),up=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new sp(t)}return t.prototype.get=function(t){var e=this,n=wp(t);return this._delegate.get(n).then(function(t){return new gp(e._firestore,new Af(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=wp(t);return n?(Ih("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=wp(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,Object(ur.__spreadArray)([a,e,n],i)),this},t.prototype.delete=function(t){var e=wp(t);return this._delegate.delete(e),this},t}(),cp=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=wp(t);return n?(Ih("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=wp(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,Object(ur.__spreadArray)([a,e,n],i)),this},t.prototype.delete=function(t){var e=wp(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),lp=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new jf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new vp(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.sa=function(e,n){var r=t.ia,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new sp(e),n),i.set(n,o)),o},t}();lp.ia=new WeakMap;var hp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sp(t)}return t.ra=function(e,n,r){if(e.length%2!=0)throw new hr(lr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Dh(n._delegate,r,new Wr(e)))},t.na=function(e,n,r){return new t(n,new Dh(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new _p(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new _p(this.firestore,Ph(this._delegate,t))}catch(t){throw fp(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(i.getModularInstance)(t))instanceof Dh&&Lh(this._delegate,t)},t.prototype.set=function(t,e){e=Ih("DocumentReference.set",e);try{return function(t,e,n){t=Ah(t,Dh);var r=Ah(t.firestore,Bh),i=Hf(t.converter,e,n);return Zf(r,[of(rf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,lo.none())])}(this._delegate,t,e)}catch(t){throw fp(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?$f(this._delegate,t):$f.apply(void 0,Object(ur.__spreadArray)([this._delegate,t,e],n))}catch(t){throw fp(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Zf(Ah((t=this._delegate).firestore,Bh),[new So(t._key,lo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=pp(e),i=dp(e,function(e){return new gp(t.firestore,new Af(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Jf(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ah(t,Dh);var e=Ah(t.firestore,Bh),n=Kh(e),r=new Yf(e);return function(t,e){var n=this,r=new rs;return t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(n,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=_r(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new hr(lr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Hc(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,sh(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new Af(e,r,t._key,n,new kf(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ah(t,Dh);var e=Ah(t.firestore,Bh);return hh(Kh(e),t._key,{source:"server"}).then(function(n){return tp(e,t,n)})}(this._delegate):function(t){t=Ah(t,Dh);var e=Ah(t.firestore,Bh);return hh(Kh(e),t._key).then(function(n){return tp(e,t,n)})}(this._delegate)).then(function(t){return new gp(e.firestore,new Af(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?lp.sa(this.firestore,e):null))},t}();function fp(t,e,n){return t.message=t.message.replace(e,n),t}function pp(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!qh(r))return r}return{}}function dp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=qh(t[0])?t[0]:qh(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var gp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new hp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Df(this._delegate,t._delegate)},t}(),vp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(ur.__extends)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(gp),yp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sp(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Pf(this._delegate,function(t,e,n){var r=e,i=Sf("where",t);return new Mf(i,r,n)}(e,n,r)))}catch(e){throw fp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Pf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Sf("orderBy",t);return new Lf(r,n)}(e,n)))}catch(e){throw fp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Pf(this._delegate,function(t){return jh("limit",t),new Ff("limit",t,"F")}(e)))}catch(e){throw fp(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Pf(this._delegate,function(t){return jh("limitToLast",t),new Ff("limitToLast",t,"L")}(e)))}catch(e){throw fp(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Pf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Uf("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw fp(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Pf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Uf("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw fp(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Pf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qf("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw fp(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Pf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qf("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw fp(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Fh(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ah(t,xh);var e=Ah(t.firestore,Bh),n=Kh(e),r=new Yf(e);return function(t,e){var n=this,r=new rs;return t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(n,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a,s;return Object(ur.__generator)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Du(t,e,!0)];case 1:return s=u.sent(),r=new ll(e,s.Bn),i=r._o(s.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return a=u.sent(),s=Hc(a,"Failed to execute query '"+e+" against cache"),n.reject(s),[3,3];case 3:return[2]}})})},[4,sh(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new Nf(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ah(t,xh);var e=Ah(t.firestore,Bh),n=Kh(e),r=new Yf(e);return fh(n,t._query,{source:"server"}).then(function(n){return new Nf(e,r,t,n)})}(this._delegate):function(t){t=Ah(t,xh);var e=Ah(t.firestore,Bh),n=Kh(e),r=new Yf(e);return xf(t._query),fh(n,t._query).then(function(n){return new Nf(e,r,t,n)})}(this._delegate)).then(function(t){return new bp(e.firestore,new Nf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=pp(e),i=dp(e,function(e){return new bp(t.firestore,new Nf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Jf(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?lp.sa(this.firestore,e):null))},t}(),mp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new vp(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),bp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new yp(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new vp(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new mp(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new vp(n._firestore,r))})},t.prototype.isEqual=function(t){return Df(this._delegate,t._delegate)},t}(),_p=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(ur.__extends)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new hp(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new hp(this.firestore,void 0===t?Mh(this._delegate):Mh(this._delegate,t))}catch(t){throw fp(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Ah(t.firestore,Bh),r=Mh(t),i=Hf(t.converter,e);return Zf(n,[of(rf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,lo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new hp(e.firestore,t)})},e.prototype.isEqual=function(t){return Lh(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?lp.sa(this.firestore,t):null))},e}(yp);function wp(t){return Ah(t,Dh)}var Tp,Ip,Ep=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Wh.bind.apply(Wh,Object(ur.__spreadArray)([void 0],t)))}return t.documentId=function(){return new t(Rr.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(i.getModularInstance)(t))instanceof Wh&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Op=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new uf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new af("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new lf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new hf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Sp=n("/6Yf"),kp={Firestore:ap,GeoPoint:Yh,Timestamp:Sr,Blob:ip,Transaction:up,WriteBatch:cp,DocumentReference:hp,DocumentSnapshot:gp,Query:yp,QueryDocumentSnapshot:vp,QuerySnapshot:bp,CollectionReference:_p,FieldPath:Ep,FieldValue:Op,setLogLevel:function(t){fr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Sp.Component("firestore",function(t){return function(t,e){return new ap(t,new Bh(t,e),new op)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},kp)))})(Tp=r.default),Tp.registerVersion("@firebase/firestore","2.3.1"),(Ip=ap).prototype.loadBundle=function(t){return function(t,e){var n=Kh(t=Ah(t,Bh)),r=new Vh;return function(t,e,n,r){var i=this,o=function(t,e){return function(t,e){return new Jl(t,e)}(function(t,e){if(t instanceof Uint8Array)return Yl(t,e);if(t instanceof ArrayBuffer)return Yl(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof t?(new TextEncoder).encode(t):t),e)}(n,fc(e));t.asyncQueue.enqueueAndForget(function(){return Object(ur.__awaiter)(i,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return e=zl,[4,ch(t)];case 1:return e.apply(void 0,[n.sent(),o,r]),[2]}})})})}(n,t._databaseId,e,r),r}(this._delegate,t)},Ip.prototype.namedQuery=function(t){var e,n,r=this;return(e=this._delegate,n=t,function(t,e){var n=this;return t.asyncQueue.enqueue(function(){return Object(ur.__awaiter)(n,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return n=function(t,e){var n=_r(t);return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Qe.getNamedQuery(t,e)})},[4,sh(t)];case 1:return[2,n.apply(void 0,[r.sent(),e])]}})})})}(Kh(e=Ah(e,Bh)),n).then(function(t){return t?new xh(e,null,t.query):null})).then(function(t){return t?new yp(r,t):null})};var Ap={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},jp=function(t){function e(n,r,i){var o=t.call(this,r)||this;return Object.setPrototypeOf(o,e.prototype),o.code=n,o.details=i,o}return Object(ur.__extends)(e,t),e}(Error),Np=function(){function t(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then(function(t){return n.auth=t},function(){}),this.messaging||e.get().then(function(t){return n.messaging=t},function(){})}return t.prototype.getAuthToken=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t;return Object(ur.__generator)(this,function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 3:return e.sent(),[2,void 0];case 4:return[2]}})})},t.prototype.getInstanceIdToken=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:if(!this.messaging||!("Notification"in self)||"granted"!==Notification.permission)return[2,void 0];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.messaging.getToken()];case 2:return[2,t.sent()];case 3:return t.sent(),[2,void 0];case 4:return[2]}})})},t.prototype.getContext=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}})})},t}();function Cp(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var Dp,xp,Rp,Pp=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return Cp(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?Cp(t,function(t){return e.decode(t)}):t},t}(),Mp=function(){function t(t,e,n,r,i,o){var a=this;void 0===i&&(i="us-central1"),this.app_=t,this.appCheckProvider=r,this.fetchImpl=o,this.serializer=new Pp,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return Promise.resolve(a.deleteService())}},this.contextProvider=new Np(e,n),this.cancelAllRequests=new Promise(function(t){a.deleteService=function(){return t()}});try{var s=new URL(i);this.customDomain=s.origin,this.region="us-central1"}catch(Tp){this.customDomain=null,this.region=i}}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+this.region+"/"+t:null!==this.customDomain?this.customDomain+"/"+t:"https://"+this.region+"-"+e+".cloudfunctions.net/"+t},t.prototype.useEmulator=function(t,e){this.emulatorOrigin="http://"+t+":"+e},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},t.prototype.postJSON=function(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:return n["Content-Type"]="application/json",[4,this.getAppCheckToken()];case 1:null!==(r=a.sent())&&(n["X-Firebase-AppCheck"]=r),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,this.fetchImpl(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 3:return i=a.sent(),[3,5];case 4:return a.sent(),[2,{status:0,json:null}];case 5:o=null,a.label=6;case 6:return a.trys.push([6,8,,9]),[4,i.json()];case 7:return o=a.sent(),[3,9];case 8:return a.sent(),[3,9];case 9:return[2,{status:i.status,json:o}]}})})},t.prototype.getAppCheckToken=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t;return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return(t=this.appCheckProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:return[2,e.sent().token];case 2:return[2,null]}})})},t.prototype.call=function(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a,s,u,c,l,h,f;return Object(ur.__generator)(this,function(p){switch(p.label){case 0:return r=this._url(t),e=this.serializer.encode(e),i={data:e},o={},[4,this.contextProvider.getContext()];case 1:return(a=p.sent()).authToken&&(o.Authorization="Bearer "+a.authToken),a.instanceIdToken&&(o["Firebase-Instance-ID-Token"]=a.instanceIdToken),s=function(t){var e,n=new Promise(function(n,r){e=setTimeout(function(){r(new jp("deadline-exceeded","deadline-exceeded"))},t)});return{timer:e,promise:n}}(n.timeout||7e4),u=s.timer,c=s.promise,[4,Promise.race([Lp(u,this.postJSON(r,i,o)),c,Lp(u,this.cancelAllRequests)])];case 2:if(!(l=p.sent()))throw new jp("cancelled","Firebase Functions instance was deleted.");if(h=function(t,e,n){var r=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!Ap[s])return new jp("internal","internal");r=Ap[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(Tp){}return"ok"===r?null:new jp(r,i,o)}(l.status,l.json,this.serializer))throw h;if(!l.json)throw new jp("internal","Response is not valid JSON object.");if(void 0===(f=l.json.data)&&(f=l.json.result),void 0===f)throw new jp("internal","Response is missing data field.");return[2,{data:this.serializer.decode(f)}]}})})},t}();function Lp(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,e];case 1:return n=r.sent(),clearTimeout(t),[2,n]}})})}Dp=r.default,xp=fetch.bind(self),Rp={Functions:Mp},Dp.INTERNAL.registerComponent(new Sp.Component("functions",function(t,e){var n=e.instanceIdentifier,r=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal"),a=t.getProvider("messaging");return new Mp(r,i,a,o,n,xp)},"PUBLIC").setServiceProps(Rp).setMultipleInstances(!0)),r.default.registerVersion("@firebase/functions","0.6.9");var Fp,Up=n("nbvr"),qp="w:0.4.26",Vp=((Fp={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',Fp["not-registered"]="Firebase Installation is not registered.",Fp["installation-not-found"]="Firebase Installation not found.",Fp["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',Fp["app-offline"]="Could not process request. Application offline.",Fp["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",Fp),Bp=new i.ErrorFactory("installations","Installations",Vp);function Kp(t){return t instanceof i.FirebaseError&&t.code.includes("request-failed")}function Gp(t){return"https://firebaseinstallations.googleapis.com/v1/projects/"+t.projectId+"/installations"}function zp(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}function Hp(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),[2,Bp.create("request-failed",{requestName:t,serverCode:(r=n.error).code,serverMessage:r.message,serverStatus:r.status})]}})})}function Wp(t){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey})}function Qp(t,e){var n=e.refreshToken,r=Wp(t);return r.append("Authorization",function(t){return"FIS_v2 "+t}(n)),r}function Xp(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return[4,t()];case 1:return(e=n.sent()).status>=500&&e.status<600?[2,t()]:[2,e]}})})}function Yp(t,e){var n=e.fid;return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return e=Gp(t),r=Wp(t),i={method:"POST",headers:r,body:JSON.stringify({fid:n,authVersion:"FIS_v2",appId:t.appId,sdkVersion:qp})},[4,Xp(function(){return fetch(e,i)})];case 1:return(o=s.sent()).ok?[4,o.json()]:[3,3];case 2:return[2,{fid:(a=s.sent()).fid||n,registrationStatus:2,refreshToken:a.refreshToken,authToken:zp(a.authToken)}];case 3:return[4,Hp("Create Installation",o)];case 4:throw s.sent()}})})}function $p(t){return new Promise(function(e){setTimeout(e,t)})}var Jp=/^[cdef][\w-]{21}$/;function Zp(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return(e=t,btoa(String.fromCharCode.apply(String,Object(ur.__spreadArray)([],Object(ur.__read)(e)))).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var e}(t);return Jp.test(e)?e:""}catch(n){return""}}function td(t){return t.appName+"!"+t.appId}var ed=new Map;function nd(t,e){var n=td(t);rd(n,e),function(t,e){var n=od();n&&n.postMessage({key:t,fid:e}),ad()}(n,e)}function rd(t,e){var n,r,i=ed.get(t);if(i)try{for(var o=Object(ur.__values)(i),a=o.next();!a.done;a=o.next())(0,a.value)(e)}catch(s){n={error:s}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}var id=null;function od(){return!id&&"BroadcastChannel"in self&&((id=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(t){rd(t.data.key,t.data.fid)}),id}function ad(){0===ed.size&&id&&(id.close(),id=null)}var sd,ud="firebase-installations-store",cd=null;function ld(){return cd||(cd=Object(Up.openDb)("firebase-installations-database",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore(ud)}})),cd}function hd(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return n=td(t),[4,ld()];case 1:return r=s.sent(),i=r.transaction(ud,"readwrite"),[4,(o=i.objectStore(ud)).get(n)];case 2:return a=s.sent(),[4,o.put(e,n)];case 3:return s.sent(),[4,i.complete];case 4:return s.sent(),a&&a.fid===e.fid||nd(t,e.fid),[2,e]}})})}function fd(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return e=td(t),[4,ld()];case 1:return n=i.sent(),[4,(r=n.transaction(ud,"readwrite")).objectStore(ud).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}})})}function pd(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a,s;return Object(ur.__generator)(this,function(u){switch(u.label){case 0:return n=td(t),[4,ld()];case 1:return r=u.sent(),i=r.transaction(ud,"readwrite"),[4,(o=i.objectStore(ud)).get(n)];case 2:return a=u.sent(),void 0!==(s=e(a))?[3,4]:[4,o.delete(n)];case 3:return u.sent(),[3,6];case 4:return[4,o.put(s,n)];case 5:u.sent(),u.label=6;case 6:return[4,i.complete];case 7:return u.sent(),!s||a&&a.fid===s.fid||nd(t,s.fid),[2,s]}})})}function dd(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,pd(t,function(n){var r=function(t){return yd(t||{fid:Zp(),registrationStatus:0})}(n),i=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Bp.create("app-offline"))};var n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,Yp(t,e)];case 1:return n=i.sent(),[2,hd(t,n)];case 2:return Kp(r=i.sent())&&409===r.customData.serverCode?[4,fd(t)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,hd(t,{fid:e.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}})})}(t,n)}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:gd(t)}:{installationEntry:e}}(t,r);return e=i.registrationPromise,i.installationEntry})];case 1:return""!==(n=i.sent()).fid?[3,3]:(r={},[4,e]);case 2:return[2,(r.installationEntry=i.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}})})}function gd(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return[4,vd(t)];case 1:e=o.sent(),o.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,$p(100)];case 3:return o.sent(),[4,vd(t)];case 4:return e=o.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,dd(t)];case 6:return n=o.sent(),r=n.installationEntry,(i=n.registrationPromise)?[2,i]:[2,r];case 7:return[2,e]}})})}function vd(t){return pd(t,function(t){if(!t)throw Bp.create("installation-not-found");return yd(t)})}function yd(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}function md(t,e){var n=t.appConfig,r=t.platformLoggerProvider;return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,i,o,a,s;return Object(ur.__generator)(this,function(u){switch(u.label){case 0:return t=function(t,e){var n=e.fid;return Gp(t)+"/"+n+"/authTokens:generate"}(n,e),i=Qp(n,e),(o=r.getImmediate({optional:!0}))&&i.append("x-firebase-client",o.getPlatformInfoString()),a={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:qp}})},[4,Xp(function(){return fetch(t,a)})];case 1:return(s=u.sent()).ok?[4,s.json()]:[3,3];case 2:return[2,zp(u.sent())];case 3:return[4,Hp("Generate Auth Token",s)];case 4:throw u.sent()}})})}function bd(t,e){return void 0===e&&(e=!1),Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return[4,pd(t.appConfig,function(r){if(!wd(r))throw Bp.create("not-registered");var i,o=r.authToken;if(!e&&2===(i=o).requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(i))return r;if(1===o.requestStatus)return n=function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,_d(t.appConfig)];case 1:n=i.sent(),i.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,$p(100)];case 3:return i.sent(),[4,_d(t.appConfig)];case 4:return n=i.sent(),[3,2];case 5:return 0===(r=n.authToken).requestStatus?[2,bd(t,e)]:[2,r]}})})}(t,e),r;if(!navigator.onLine)throw Bp.create("app-offline");var a=function(t){var e={requestStatus:1,requestTime:Date.now()};return Object(ur.__assign)(Object(ur.__assign)({},t),{authToken:e})}(r);return n=function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,8]),[4,md(t,e)];case 1:return n=o.sent(),i=Object(ur.__assign)(Object(ur.__assign)({},e),{authToken:n}),[4,hd(t.appConfig,i)];case 2:return o.sent(),[2,n];case 3:return!Kp(r=o.sent())||401!==r.customData.serverCode&&404!==r.customData.serverCode?[3,5]:[4,fd(t.appConfig)];case 4:return o.sent(),[3,7];case 5:return i=Object(ur.__assign)(Object(ur.__assign)({},e),{authToken:{requestStatus:0}}),[4,hd(t.appConfig,i)];case 6:o.sent(),o.label=7;case 7:throw r;case 8:return[2]}})})}(t,a),a})];case 1:return r=o.sent(),n?[4,n]:[3,3];case 2:return i=o.sent(),[3,4];case 3:i=r.authToken,o.label=4;case 4:return[2,i]}})})}function _d(t){return pd(t,function(t){if(!wd(t))throw Bp.create("not-registered");var e;return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object(ur.__assign)(Object(ur.__assign)({},t),{authToken:{requestStatus:0}}):t})}function wd(t){return void 0!==t&&2===t.registrationStatus}function Td(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return[4,dd(t)];case 1:return(e=n.sent().registrationPromise)?[4,e]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})}function Id(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:return n=function(t,e){var n=e.fid;return Gp(t)+"/"+n}(t,e),r=Qp(t,e),i={method:"DELETE",headers:r},[4,Xp(function(){return fetch(n,i)})];case 1:return(o=a.sent()).ok?[3,3]:[4,Hp("Delete Installation",o)];case 2:throw a.sent();case 3:return[2]}})})}function Ed(t){return Bp.create("missing-app-config-values",{valueName:t})}!function(t){t.INTERNAL.registerComponent(new Sp.Component("installations",function(t){var e=t.getProvider("app").getImmediate(),n={appConfig:function(t){var e,n;if(!t||!t.options)throw Ed("App Configuration");if(!t.name)throw Ed("App Name");try{for(var r=Object(ur.__values)(["projectId","apiKey","appId"]),i=r.next();!i.done;i=r.next()){var o=i.value;if(!t.options[o])throw Ed(o)}}catch(a){e={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),platformLoggerProvider:t.getProvider("platform-logger")};return{app:e,getId:function(){return function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,dd(t.appConfig)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?r.catch(console.error):bd(t).catch(console.error),[2,n.fid]}})})}(n)},getToken:function(t){return function(t,e){return void 0===e&&(e=!1),Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return[4,Td(t.appConfig)];case 1:return n.sent(),[4,bd(t,e)];case 2:return[2,n.sent().token]}})})}(n,t)},delete:function(){return function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,pd(e=t.appConfig,function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw Bp.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw Bp.create("app-offline");case 3:return[4,Id(e,n)];case 4:return r.sent(),[4,fd(e)];case 5:r.sent(),r.label=6;case 6:return[2]}})})}(n)},onIdChange:function(t){return function(t,e){var n=t.appConfig;return function(t,e){od();var n=td(t),r=ed.get(n);r||(r=new Set,ed.set(n,r)),r.add(e)}(n,e),function(){!function(t,e){var n=td(t),r=ed.get(n);r&&(r.delete(e),0===r.size&&ed.delete(n),ad())}(n,e)}}(n,t)}}},"PUBLIC")),t.registerVersion("@firebase/installations","0.4.26")}(r.default);var Od=((sd={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',sd["only-available-in-window"]="This method is available in a Window context.",sd["only-available-in-sw"]="This method is available in a service worker context.",sd["permission-default"]="The notification permission was not granted and dismissed instead.",sd["permission-blocked"]="The notification permission was not granted and blocked instead.",sd["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",sd["failed-service-worker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",sd["token-subscribe-failed"]="A problem occurred while subscribing the user to FCM: {$errorInfo}",sd["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",sd["token-unsubscribe-failed"]="A problem occurred while unsubscribing the user from FCM: {$errorInfo}",sd["token-update-failed"]="A problem occurred while updating the user from FCM: {$errorInfo}",sd["token-update-no-token"]="FCM returned no token when updating the user to push.",sd["use-sw-after-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",sd["invalid-sw-registration"]="The input to useServiceWorker() must be a ServiceWorkerRegistration.",sd["invalid-bg-handler"]="The input to setBackgroundMessageHandler() must be a function.",sd["invalid-vapid-key"]="The public VAPID key must be a string.",sd["use-vapid-key-after-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",sd),Sd=new i.ErrorFactory("messaging","Messaging",Od),kd="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Ad=function(t){return t.PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked",t}({});function jd(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,Object(ur.__spreadArray)([],Object(ur.__read)(e)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Nd(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var Cd="fcm_token_details_db",Dd="fcm_token_object_Store";function xd(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return"databases"in indexedDB?[4,indexedDB.databases()]:[3,2];case 1:if(!r.sent().map(function(t){return t.name}).includes(Cd))return[2,null];r.label=2;case 2:return e=null,[4,Object(Up.openDb)(Cd,5,function(r){return Object(ur.__awaiter)(n,void 0,void 0,function(){var n,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return r.oldVersion<2?[2]:r.objectStoreNames.contains(Dd)?[4,(n=r.transaction.objectStore(Dd)).index("fcmSenderId").get(t)]:[2];case 1:return i=s.sent(),[4,n.clear()];case 2:if(s.sent(),!i)return[2];if(2===r.oldVersion){if(!(o=i).auth||!o.p256dh||!o.endpoint)return[2];e={token:o.fcmToken,createTime:null!==(a=o.createTime)&&void 0!==a?a:Date.now(),subscriptionOptions:{auth:o.auth,p256dh:o.p256dh,endpoint:o.endpoint,swScope:o.swScope,vapidKey:"string"==typeof o.vapidKey?o.vapidKey:jd(o.vapidKey)}}}else(3===r.oldVersion||4===r.oldVersion)&&(e={token:(o=i).fcmToken,createTime:o.createTime,subscriptionOptions:{auth:jd(o.auth),p256dh:jd(o.p256dh),endpoint:o.endpoint,swScope:o.swScope,vapidKey:jd(o.vapidKey)}});return[2]}})})})];case 3:return r.sent().close(),[4,Object(Up.deleteDb)(Cd)];case 4:return r.sent(),[4,Object(Up.deleteDb)("fcm_vapid_details_db")];case 5:return r.sent(),[4,Object(Up.deleteDb)("undefined")];case 6:return r.sent(),[2,Rd(e)?e:null]}})})}function Rd(t){if(!t||!t.subscriptionOptions)return!1;var e=t.subscriptionOptions;return"number"==typeof t.createTime&&t.createTime>0&&"string"==typeof t.token&&t.token.length>0&&"string"==typeof e.auth&&e.auth.length>0&&"string"==typeof e.p256dh&&e.p256dh.length>0&&"string"==typeof e.endpoint&&e.endpoint.length>0&&"string"==typeof e.swScope&&e.swScope.length>0&&"string"==typeof e.vapidKey&&e.vapidKey.length>0}var Pd="firebase-messaging-store",Md=null;function Ld(){return Md||(Md=Object(Up.openDb)("firebase-messaging-database",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore(Pd)}})),Md}function Fd(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return e=Vd(t),[4,Ld()];case 1:return[4,i.sent().transaction(Pd).objectStore(Pd).get(e)];case 2:return(n=i.sent())?[2,n]:[3,3];case 3:return[4,xd(t.appConfig.senderId)];case 4:return(r=i.sent())?[4,Ud(t,r)]:[3,6];case 5:return i.sent(),[2,r];case 6:return[2]}})})}function Ud(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return n=Vd(t),[4,Ld()];case 1:return r=o.sent(),[4,(i=r.transaction(Pd,"readwrite")).objectStore(Pd).put(e,n)];case 2:return o.sent(),[4,i.complete];case 3:return o.sent(),[2,e]}})})}function qd(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return e=Vd(t),[4,Ld()];case 1:return n=i.sent(),[4,(r=n.transaction(Pd,"readwrite")).objectStore(Pd).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}})})}function Vd(t){return t.appConfig.appId}function Bd(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return[4,Hd(t)];case 1:n=s.sent(),r=Wd(e),i={method:"POST",headers:n,body:JSON.stringify(r)},s.label=2;case 2:return s.trys.push([2,5,,6]),[4,fetch(zd(t.appConfig),i)];case 3:return[4,s.sent().json()];case 4:return o=s.sent(),[3,6];case 5:throw a=s.sent(),Sd.create("token-subscribe-failed",{errorInfo:a});case 6:if(o.error)throw Sd.create("token-subscribe-failed",{errorInfo:o.error.message});if(!o.token)throw Sd.create("token-subscribe-no-token");return[2,o.token]}})})}function Kd(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return[4,Hd(t)];case 1:n=s.sent(),r=Wd(e.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)},s.label=2;case 2:return s.trys.push([2,5,,6]),[4,fetch(zd(t.appConfig)+"/"+e.token,i)];case 3:return[4,s.sent().json()];case 4:return o=s.sent(),[3,6];case 5:throw a=s.sent(),Sd.create("token-update-failed",{errorInfo:a});case 6:if(o.error)throw Sd.create("token-update-failed",{errorInfo:o.error.message});if(!o.token)throw Sd.create("token-update-no-token");return[2,o.token]}})})}function Gd(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:return[4,Hd(t)];case 1:n=a.sent(),r={method:"DELETE",headers:n},a.label=2;case 2:return a.trys.push([2,5,,6]),[4,fetch(zd(t.appConfig)+"/"+e,r)];case 3:return[4,a.sent().json()];case 4:if((i=a.sent()).error)throw Sd.create("token-unsubscribe-failed",{errorInfo:i.error.message});return[3,6];case 5:throw o=a.sent(),Sd.create("token-unsubscribe-failed",{errorInfo:o});case 6:return[2]}})})}function zd(t){return"https://fcmregistrations.googleapis.com/v1/projects/"+t.projectId+"/registrations"}function Hd(t){var e=t.appConfig,n=t.installations;return Object(ur.__awaiter)(this,void 0,void 0,function(){var t;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,n.getToken()];case 1:return t=r.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})]}})})}function Wd(t){var e=t.vapidKey,n={web:{endpoint:t.endpoint,auth:t.auth,p256dh:t.p256dh}};return e!==kd&&(n.web.applicationPubKey=e),n}function Qd(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:if("granted"!==Notification.permission)throw Sd.create("permission-blocked");return[4,Jd(e,n)];case 1:return r=s.sent(),[4,Fd(t)];case 2:return i=s.sent(),o={vapidKey:n,swScope:e.scope,endpoint:r.endpoint,auth:jd(r.getKey("auth")),p256dh:jd(r.getKey("p256dh"))},i?[3,3]:[2,$d(t,o)];case 3:if(l=(c=o).endpoint===(u=i.subscriptionOptions).endpoint,c.vapidKey===u.vapidKey&&l&&c.auth===u.auth&&c.p256dh===u.p256dh)return[3,8];s.label=4;case 4:return s.trys.push([4,6,,7]),[4,Gd(t,i.token)];case 5:return s.sent(),[3,7];case 6:return a=s.sent(),console.warn(a),[3,7];case 7:return[2,$d(t,o)];case 8:return Date.now()>=i.createTime+6048e5?[2,Yd({token:i.token,createTime:Date.now(),subscriptionOptions:o},t,e)]:[2,i.token];case 9:return[2]}var u,c,l})})}function Xd(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,Fd(t)];case 1:return(n=i.sent())?[4,Gd(t,n.token)]:[3,4];case 2:return i.sent(),[4,qd(t)];case 3:i.sent(),i.label=4;case 4:return[4,e.pushManager.getSubscription()];case 5:return(r=i.sent())?[2,r.unsubscribe()]:[2,!0]}})})}function Yd(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,5]),[4,Kd(e,t)];case 1:return r=a.sent(),i=Object(ur.__assign)(Object(ur.__assign)({},t),{token:r,createTime:Date.now()}),[4,Ud(e,i)];case 2:return a.sent(),[2,r];case 3:return o=a.sent(),[4,Xd(e,n)];case 4:throw a.sent(),o;case 5:return[2]}})})}function $d(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,Bd(t,e)];case 1:return n=i.sent(),r={token:n,createTime:Date.now(),subscriptionOptions:e},[4,Ud(t,r)];case 2:return i.sent(),[2,r.token]}})})}function Jd(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,t.pushManager.getSubscription()];case 1:return(n=r.sent())?[2,n]:[2,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Nd(e)})]}})})}function Zd(t){return"object"==typeof t&&!!t&&"google.c.a.c_id"in t}function tg(t){return new Promise(function(e){setTimeout(e,t)})}var eg=function(){function t(t){var e=this;this.firebaseDependencies=t,this.isOnBackgroundMessageUsed=null,this.vapidKey=null,this.bgMessageHandler=null,self.addEventListener("push",function(t){t.waitUntil(e.onPush(t))}),self.addEventListener("pushsubscriptionchange",function(t){t.waitUntil(e.onSubChange(t))}),self.addEventListener("notificationclick",function(t){t.waitUntil(e.onNotificationClick(t))})}return Object.defineProperty(t.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),t.prototype.setBackgroundMessageHandler=function(t){if(this.isOnBackgroundMessageUsed=!1,!t||"function"!=typeof t)throw Sd.create("invalid-bg-handler");this.bgMessageHandler=t},t.prototype.onBackgroundMessage=function(t){var e=this;return this.isOnBackgroundMessageUsed=!0,this.bgMessageHandler=t,function(){e.bgMessageHandler=null}},t.prototype.getToken=function(){var t,e;return Object(ur.__awaiter)(this,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return this.vapidKey?[3,2]:[4,Fd(this.firebaseDependencies)];case 1:n=r.sent(),this.vapidKey=null!==(e=null===(t=null==n?void 0:n.subscriptionOptions)||void 0===t?void 0:t.vapidKey)&&void 0!==e?e:kd,r.label=2;case 2:return[2,Qd(this.firebaseDependencies,self.registration,this.vapidKey)]}})})},t.prototype.deleteToken=function(){return Xd(this.firebaseDependencies,self.registration)},t.prototype.requestPermission=function(){throw Sd.create("only-available-in-window")},t.prototype.usePublicVapidKey=function(t){if(null!==this.vapidKey)throw Sd.create("use-vapid-key-after-get-token");if("string"!=typeof t||0===t.length)throw Sd.create("invalid-vapid-key");this.vapidKey=t},t.prototype.useServiceWorker=function(){throw Sd.create("only-available-in-window")},t.prototype.onMessage=function(){throw Sd.create("only-available-in-window")},t.prototype.onTokenRefresh=function(){throw Sd.create("only-available-in-window")},t.prototype.onPush=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r,i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return(e=function(t){var e=t.data;if(!e)return null;try{return e.json()}catch(n){return null}}(t))?[4,og()]:(console.debug("FirebaseMessaging: failed to get parsed MessagePayload from the PushEvent. Skip handling the push."),[2]);case 1:return function(t){return t.some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})}(n=o.sent())?[2,ig(n,e)]:(r=!1,e.notification?[4,ag(ng(e))]:[3,3]);case 2:o.sent(),r=!0,o.label=3;case 3:return!0===r&&!1===this.isOnBackgroundMessageUsed?[2]:(this.bgMessageHandler&&(i=function(t){var e={from:t.from,collapseKey:t.collapse_key};return function(t,e){if(e.notification){t.notification={};var n=e.notification.title;n&&(t.notification.title=n);var r=e.notification.body;r&&(t.notification.body=r);var i=e.notification.image;i&&(t.notification.image=i)}}(e,t),function(t,e){e.data&&(t.data=e.data)}(e,t),function(t,e){if(e.fcmOptions){t.fcmOptions={};var n=e.fcmOptions.link;n&&(t.fcmOptions.link=n);var r=e.fcmOptions.analytics_label;r&&(t.fcmOptions.analyticsLabel=r)}}(e,t),e}(e),"function"==typeof this.bgMessageHandler?this.bgMessageHandler(i):this.bgMessageHandler.next(i)),[4,tg(1e3)]);case 4:return o.sent(),[2]}})})},t.prototype.onSubChange=function(t){var e,n;return Object(ur.__awaiter)(this,void 0,void 0,function(){var r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return t.newSubscription?[3,2]:[4,Xd(this.firebaseDependencies,self.registration)];case 1:return i.sent(),[2];case 2:return[4,Fd(this.firebaseDependencies)];case 3:return r=i.sent(),[4,Xd(this.firebaseDependencies,self.registration)];case 4:return i.sent(),[4,Qd(this.firebaseDependencies,self.registration,null!==(n=null===(e=null==r?void 0:r.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==n?n:kd)];case 5:return i.sent(),[2]}})})},t.prototype.onNotificationClick=function(t){var e,n;return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o,a,s;return Object(ur.__generator)(this,function(u){switch(u.label){case 0:return(r=null===(n=null===(e=t.notification)||void 0===e?void 0:e.data)||void 0===n?void 0:n.FCM_MSG)?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(i=function(t){var e,n,r;return(null!==(n=null===(e=t.fcmOptions)||void 0===e?void 0:e.link)&&void 0!==n?n:null===(r=t.notification)||void 0===r?void 0:r.click_action)||(Zd(t.data)?self.location.origin:null)}(r))?(o=new URL(i,self.location.href),a=new URL(self.location.origin),o.host!==a.host?[2]:[4,rg(o)]):[2]):[2];case 1:return(s=u.sent())?[3,4]:[4,self.clients.openWindow(i)];case 2:return s=u.sent(),[4,tg(3e3)];case 3:return u.sent(),[3,6];case 4:return[4,s.focus()];case 5:s=u.sent(),u.label=6;case 6:return s?(r.messageType=Ad.NOTIFICATION_CLICKED,r.isFirebaseMessaging=!0,[2,s.postMessage(r)]):[2]}})})},t}();function ng(t){var e,n=Object(ur.__assign)({},t.notification);return n.data=((e={}).FCM_MSG=t,e),n}function rg(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r,i,o,a,s;return Object(ur.__generator)(this,function(u){switch(u.label){case 0:return[4,og()];case 1:e=u.sent();try{for(n=Object(ur.__values)(e),r=n.next();!r.done;r=n.next())if(i=r.value,o=new URL(i.url,self.location.href),t.host===o.host)return[2,i]}catch(c){a={error:c}}finally{try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(a)throw a.error}}return[2,null]}})})}function ig(t,e){var n,r;e.isFirebaseMessaging=!0,e.messageType=Ad.PUSH_RECEIVED;try{for(var i=Object(ur.__values)(t),o=i.next();!o.done;o=i.next())o.value.postMessage(e)}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}function og(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function ag(t){var e,n=t.actions,r=Notification.maxActions;return n&&r&&n.length>r&&console.warn("This browser only supports "+r+" actions. The remaining actions will not be displayed."),self.registration.showNotification(null!==(e=t.title)&&void 0!==e?e:"",t)}var sg=function(){function t(t){var e=this;this.firebaseDependencies=t,this.vapidKey=null,this.onMessageCallback=null,navigator.serviceWorker.addEventListener("message",function(t){return e.messageEventListener(t)})}return Object.defineProperty(t.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),t.prototype.messageEventListener=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return(e=t.data).isFirebaseMessaging?(this.onMessageCallback&&e.messageType===Ad.PUSH_RECEIVED&&("function"==typeof this.onMessageCallback?this.onMessageCallback(function(t){return delete t.messageType,delete t.isFirebaseMessaging,t}(Object.assign({},e))):this.onMessageCallback.next(Object.assign({},e))),Zd(n=e.data)&&"1"===n["google.c.a.e"]?[4,this.logEvent(e.messageType,n)]:[3,2]):[2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.getVapidKey=function(){return this.vapidKey},t.prototype.getSwReg=function(){return this.swRegistration},t.prototype.getToken=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return"default"!==Notification.permission?[3,2]:[4,Notification.requestPermission()];case 1:e.sent(),e.label=2;case 2:if("granted"!==Notification.permission)throw Sd.create("permission-blocked");return[4,this.updateVapidKey(null==t?void 0:t.vapidKey)];case 3:return e.sent(),[4,this.updateSwReg(null==t?void 0:t.serviceWorkerRegistration)];case 4:return e.sent(),[2,Qd(this.firebaseDependencies,this.swRegistration,this.vapidKey)]}})})},t.prototype.updateVapidKey=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){return t?this.vapidKey=t:this.vapidKey||(this.vapidKey=kd),[2]})})},t.prototype.updateSwReg=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return t||this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:e.sent(),e.label=2;case 2:if(!t&&this.swRegistration)return[2];if(!(t instanceof ServiceWorkerRegistration))throw Sd.create("invalid-sw-registration");return this.swRegistration=t,[2]}})})},t.prototype.registerDefaultSw=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=this,[4,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"})];case 1:return t.swRegistration=n.sent(),this.swRegistration.update().catch(function(){}),[3,3];case 2:throw e=n.sent(),Sd.create("failed-service-worker-registration",{browserErrorMessage:e.message});case 3:return[2]}})})},t.prototype.deleteToken=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:return this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:t.sent(),t.label=2;case 2:return[2,Xd(this.firebaseDependencies,this.swRegistration)]}})})},t.prototype.requestPermission=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t;return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw Sd.create("denied"===t?"permission-blocked":"permission-default")}})})},t.prototype.usePublicVapidKey=function(t){if(null!==this.vapidKey)throw Sd.create("use-vapid-key-after-get-token");if("string"!=typeof t||0===t.length)throw Sd.create("invalid-vapid-key");this.vapidKey=t},t.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw Sd.create("invalid-sw-registration");if(this.swRegistration)throw Sd.create("use-sw-after-get-token");this.swRegistration=t},t.prototype.onMessage=function(t){var e=this;return this.onMessageCallback=t,function(){e.onMessageCallback=null}},t.prototype.setBackgroundMessageHandler=function(){throw Sd.create("only-available-in-sw")},t.prototype.onBackgroundMessage=function(){throw Sd.create("only-available-in-sw")},t.prototype.onTokenRefresh=function(){return function(){}},t.prototype.logEvent=function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return n=function(t){switch(t){case Ad.NOTIFICATION_CLICKED:return"notification_open";case Ad.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t),[4,this.firebaseDependencies.analyticsProvider.get()];case 1:return r.sent().logEvent(n,{message_id:e["google.c.a.c_id"],message_name:e["google.c.a.c_l"],message_time:e["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),[2]}})})},t}();function ug(t){return Sd.create("missing-app-config-values",{valueName:t})}var cg={isSupported:lg};function lg(){return self&&"ServiceWorkerGlobalScope"in self?"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}r.default.INTERNAL.registerComponent(new Sp.Component("messaging",function(t){var e=t.getProvider("app").getImmediate(),n={app:e,appConfig:function(t){var e,n;if(!t||!t.options)throw ug("App Configuration Object");if(!t.name)throw ug("App Name");var r=t.options;try{for(var i=Object(ur.__values)(["projectId","apiKey","appId","messagingSenderId"]),o=i.next();!o.done;o=i.next()){var a=o.value;if(!r[a])throw ug(a)}}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return{appName:t.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}}(e),installations:t.getProvider("installations").getImmediate(),analyticsProvider:t.getProvider("analytics-internal")};if(!lg())throw Sd.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new eg(n):new sg(n)},"PUBLIC").setServiceProps(cg));var hg="firebasestorage.googleapis.com",fg=function(t){function e(n,r){var i=t.call(this,pg(n),"Firebase Storage: "+r+" ("+pg(n)+")")||this;return i.customData={serverResponse:null},i._baseMessage=i.message,Object.setPrototypeOf(i,e.prototype),i}return Object(ur.__extends)(e,t),e.prototype._codeEquals=function(t){return pg(t)===this.code},Object.defineProperty(e.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(t){this.customData.serverResponse=t,this.message=this.customData.serverResponse?this._baseMessage+"\n"+this.customData.serverResponse:this._baseMessage},enumerable:!1,configurable:!0}),e}(i.FirebaseError);function pg(t){return"storage/"+t}function dg(){return new fg("unknown","An unknown error occurred, please check the error payload for server response.")}function gg(){return new fg("canceled","User canceled the upload/download.")}function vg(){return new fg("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function yg(t){return new fg("invalid-argument",t)}function mg(){return new fg("app-deleted","The Firebase app was deleted.")}function bg(t){return new fg("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function _g(t,e){return new fg("invalid-format","String does not match format '"+t+"': "+e)}function wg(t){throw new fg("internal-error","Internal error: "+t)}var Tg={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Ig=function(){return function(t,e){this.data=t,this.contentType=e||null}}();function Eg(t,e){switch(t){case Tg.RAW:return new Ig(Og(e));case Tg.BASE64:case Tg.BASE64URL:return new Ig(Sg(t,e));case Tg.DATA_URL:return new Ig((n=new kg(e)).base64?Sg(Tg.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(Tp){throw _g(Tg.DATA_URL,"Malformed data URL.")}return Og(e)}(n.rest),new kg(e).contentType)}var n;throw dg()}function Og(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1))){var i=r,o=t.charCodeAt(++n);e.push(240|(r=65536|(1023&i)<<10|1023&o)>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function Sg(t,e){switch(t){case Tg.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw _g(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Tg.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw _g(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(Tp){throw _g(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var kg=function(){return function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw _g(Tg.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r,i=e[1]||null;null!=i&&(this.base64=(n=i).length>=(r=";base64").length&&n.substring(n.length-r.length)===r,this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=t.substring(t.indexOf(",")+1)}}(),Ag={STATE_CHANGED:"state_changed"},jg={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ng(t){switch(t){case"running":case"pausing":case"canceling":return jg.RUNNING;case"paused":return jg.PAUSED;case"success":return jg.SUCCESS;case"canceled":return jg.CANCELED;case"error":default:return jg.ERROR}}var Cg=function(t){return t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT",t}({}),Dg=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Cg.NO_ERROR,this.sendPromise_=new Promise(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=Cg.ABORT,e(t)}),t.xhr_.addEventListener("error",function(){t.errorCode_=Cg.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(){e(t)})})}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw wg("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==r)for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw wg("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw wg("cannot .getStatus() before sending");try{return this.xhr_.status}catch(Tp){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw wg("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)},t}(),xg=function(){function t(){}return t.prototype.createXhrIo=function(){return new Dg},t}(),Rg=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e,n){var r;try{r=t.makeFromUrl(e,n)}catch(Tp){return new t(e,"")}if(""===r.path)return r;throw new fg("invalid-default-bucket","Invalid default bucket '"+e+"'.")},t.makeFromUrl=function(e,n){var r=null,i="([A-Za-z0-9.\\-_]+)",o=new RegExp("^gs://"+i+"(/(.*))?$","i");function a(t){t.path_=decodeURIComponent(t.path)}for(var s=n.replace(/[.]/g,"\\."),u=[{regex:o,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+s+"/v[A-Za-z0-9_]+/b/"+i+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:a},{regex:new RegExp("^https?://"+(n===hg?"(?:storage.googleapis.com|storage.cloud.google.com)":n)+"/"+i+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:a}],c=0;c<u.length;c++){var l=u[c],h=l.regex.exec(e);if(h){var f=h[l.indices.path];f||(f=""),r=new t(h[l.indices.bucket],f),l.postModify(r);break}}if(null==r)throw function(t){return new fg("invalid-url","Invalid URL '"+t+"'.")}(e);return r},t}(),Pg=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}();function Mg(t){return"string"==typeof t||t instanceof String}function Lg(t){return Fg()&&t instanceof Blob}function Fg(){return"undefined"!=typeof Blob}function Ug(t,e,n,r){if(r<e)throw yg("Invalid value for '"+t+"'. Expected "+e+" or greater.");if(r>n)throw yg("Invalid value for '"+t+"'. Expected "+n+" or less.")}function qg(t,e){var n=e.match(/^(\w+):\/\/.+/),r=e;return null==(null==n?void 0:n[1])&&(r="https://"+e),r+"/v0"+t}function Vg(t){var e=encodeURIComponent,n="?";for(var r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n.slice(0,-1)}var Bg=function(){function t(t,e,n,r,i,o,a,s,u,c,l){var h=this;this.pendingXhr_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=l,this.promise_=new Promise(function(t,e){h.resolve_=t,h.reject_=e,h.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());void 0!==s?i(s):i()}catch(Tp){o(Tp)}else null!==a?((r=dg()).serverResponse=a.getResponseText(),o(t.errorCallback_?t.errorCallback_(a,r):r)):o(r=n.canceled?t.appDelete_?mg():gg():new fg("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new Kg(!1,null,!0)):this.backoffId_=function(e,n,r){var i=1,o=null,a=!1,s=0;function u(){return 2===s}var c=!1;function l(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];c||(c=!0,n.apply(null,t))}function h(e){o=setTimeout(function(){o=null,function(e,n){if(n)e(!1,new Kg(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===Cg.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new Kg(a,n))}else{var s=n.getErrorCode()===Cg.ABORT;e(!1,new Kg(!1,null,s))}})}function i(e){null!==t.progressCallback_&&t.progressCallback_(e.loaded,e.lengthComputable?e.total:-1)}}(f,u())},e)}function f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!c)if(t)l.call.apply(l,Object(ur.__spreadArray)([null,t],e));else{var r;u()||a?l.call.apply(l,Object(ur.__spreadArray)([null,t],e)):(i<64&&(i*=2),1===s?(s=2,r=0):r=1e3*(i+Math.random()),h(r))}}var p=!1;function d(t){p||(p=!0,c||(null!==o?(t||(s=2),clearTimeout(o),h(0)):t||(s=1)))}return h(0),setTimeout(function(){a=!0,d(!0)},r),d}(0,e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),Kg=function(){return function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n}}();function Gg(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function zg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Gg();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Fg())return new Blob(t);throw new fg("unsupported-environment","This browser doesn't seem to support creating Blobs")}var Hg=function(){function t(t,e){var n=0,r="";Lg(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(Lg(this.data_)){var r=(o=e,a=n,(i=this.data_).webkitSlice?i.webkitSlice(o,a):i.mozSlice?i.mozSlice(o,a):i.slice?i.slice(o,a):null);return null===r?null:new t(r)}var i,o,a;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(Fg()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(zg.apply(null,r))}var i=e.map(function(t){return Mg(t)?Eg(Tg.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var a=new Uint8Array(o),s=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)a[s++]=t[e]}),new t(a,!0)},t.prototype.uploadData=function(){return this.data_},t}();function Wg(t){var e,n;try{e=JSON.parse(t)}catch(Tp){return null}return"object"!=typeof(n=e)||Array.isArray(n)?null:e}function Qg(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function Xg(t,e){return e}var Yg=function(){return function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||Xg}}(),$g=null;function Jg(){if($g)return $g;var t=[];t.push(new Yg("bucket")),t.push(new Yg("generation")),t.push(new Yg("metageneration")),t.push(new Yg("name","fullPath",!0));var e=new Yg("name");e.xform=function(t,e){return function(t){return!Mg(t)||t.length<2?t:Qg(t)}(e)},t.push(e);var n=new Yg("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new Yg("timeCreated")),t.push(new Yg("updated")),t.push(new Yg("md5Hash",null,!0)),t.push(new Yg("cacheControl",null,!0)),t.push(new Yg("contentDisposition",null,!0)),t.push(new Yg("contentEncoding",null,!0)),t.push(new Yg("contentLanguage",null,!0)),t.push(new Yg("contentType",null,!0)),t.push(new Yg("metadata","customMetadata",!0)),$g=t}function Zg(t,e,n){var r=Wg(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=new Rg(t.bucket,t.fullPath);return e._makeStorageReference(n)}})}(r,t),r}(t,r,n)}function tv(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}var ev=function(){return function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();function nv(t){if(!t)throw dg()}function rv(t,e){return function(n,r){var i=Zg(t,r,e);return nv(null!==i),i}}function iv(t){return function(e,n){var r;return(r=401===e.getStatus()?e.getResponseText().includes("Firebase App Check token is invalid")?new fg("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new fg("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?new fg("quota-exceeded","Quota for bucket '"+t.bucket+"' exceeded, please view quota on https://firebase.google.com/pricing/."):403===e.getStatus()?new fg("unauthorized","User does not have permission to access '"+t.path+"'."):n).serverResponse=n.serverResponse,r}}function ov(t){var e=iv(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=new fg("object-not-found","Object '"+t.path+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function av(t,e,n){var r=qg(e.fullServerUrl(),t.host),i=t.maxOperationRetryTime,o=new ev(r,"GET",rv(t,n),i);return o.errorHandler=ov(e),o}function sv(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var uv=function(){return function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null}}();function cv(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(Tp){nv(!1)}return nv(!!n&&-1!==(e||["active"]).indexOf(n)),n}var lv=262144,hv=function(){return function(t,e,n){if("function"==typeof t||null!=e||null!=n)this.next=t,this.error=e,this.complete=n;else{var r=t;this.next=r.next,this.error=r.error,this.complete=r.complete}}}();function fv(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then(function(){return t.apply(void 0,e)})}}var pv=function(){function t(t,e,n){var r=this;void 0===n&&(n=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=e,this._metadata=n,this._mappings=Jg(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=function(t){r._request=void 0,r._chunkMultiplier=1,t._codeEquals("canceled")?(r._needToFetchStatus=!0,r.completeTransitions_()):(r._error=t,r._transition("error"))},this._metadataErrorHandler=function(t){r._request=void 0,t._codeEquals("canceled")?r.completeTransitions_():(r._error=t,r._transition("error"))},this._promise=new Promise(function(t,e){r._resolve=t,r._reject=e,r._start()}),this._promise.then(null,function(){})}return t.prototype._makeProgressCallback=function(){var t=this,e=this._transferred;return function(n){return t._updateProgress(e+n)}},t.prototype._shouldDoResumable=function(t){return t.size()>262144},t.prototype._start=function(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},t.prototype._resolveToken=function(t){var e=this;Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(function(n){var r=n[0],i=n[1];switch(e._state){case"running":t(r,i);break;case"canceling":e._transition("canceled");break;case"pausing":e._transition("paused")}})},t.prototype._createResumable=function(){var t=this;this._resolveToken(function(e,n){var r=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=sv(e,r,i),s={name:a.fullPath},u=qg(o,t.host),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},l=tv(a,n),h=new ev(u,"POST",function(t){var e;cv(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(Tp){nv(!1)}return nv(Mg(e)),e},t.maxUploadRetryTime);return h.urlParams=s,h.headers=c,h.body=l,h.errorHandler=iv(e),h}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._uploadUrl=e,t._needToFetchStatus=!1,t.completeTransitions_()},t._errorHandler)})},t.prototype._fetchStatus=function(){var t=this,e=this._uploadUrl;this._resolveToken(function(n,r){var i=function(t,e,n,r){var i=new ev(n,"POST",function(t){var e=cv(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(Tp){nv(!1)}n||nv(!1);var i=Number(n);return nv(!isNaN(i)),new uv(i,r.size(),"final"===e)},t.maxUploadRetryTime);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=iv(e),i}(t._ref.storage,t._ref._location,e,t._blob),o=t._ref.storage._makeRequest(i,n,r);t._request=o,o.getPromise().then(function(e){e=e,t._request=void 0,t._updateProgress(e.current),t._needToFetchStatus=!1,e.finalized&&(t._needToFetchMetadata=!0),t.completeTransitions_()},t._errorHandler)})},t.prototype._continueUpload=function(){var t=this,e=lv*this._chunkMultiplier,n=new uv(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken(function(i,o){var a;try{a=function(t,e,n,r,i,o,a,s){var u=new uv(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new fg("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,l=c;i>0&&(l=Math.min(l,i));var h=u.current,f={"X-Goog-Upload-Command":l===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},p=r.slice(h,h+l);if(null===p)throw vg();var d=new ev(n,"POST",function(t,n){var i,a=cv(t,["active","final"]),s=u.current+l,c=r.size();return i="final"===a?rv(e,o)(t,n):null,new uv(s,c,"final"===a,i)},e.maxUploadRetryTime);return d.headers=f,d.body=p.uploadData(),d.progressCallback=s||null,d.errorHandler=iv(t),d}(t._ref._location,t._ref.storage,r,t._blob,e,t._mappings,n,t._makeProgressCallback())}catch(Tp){return t._error=Tp,void t._transition("error")}var s=t._ref.storage._makeRequest(a,i,o);t._request=s,s.getPromise().then(function(e){t._increaseMultiplier(),t._request=void 0,t._updateProgress(e.current),e.finalized?(t._metadata=e.metadata,t._transition("success")):t.completeTransitions_()},t._errorHandler)})},t.prototype._increaseMultiplier=function(){lv*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},t.prototype._fetchMetadata=function(){var t=this;this._resolveToken(function(e,n){var r=av(t._ref.storage,t._ref._location,t._mappings),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._transition("success")},t._metadataErrorHandler)})},t.prototype._oneShotUpload=function(){var t=this;this._resolveToken(function(e,n){var r=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=sv(e,r,i),c=tv(u,n),l=Hg.getBlob("--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+c+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",r,"\r\n--"+s+"--");if(null===l)throw vg();var h={name:u.fullPath},f=qg(o,t.host),p=t.maxUploadRetryTime,d=new ev(f,"POST",rv(t,n),p);return d.urlParams=h,d.headers=a,d.body=l.uploadData(),d.errorHandler=iv(e),d}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._updateProgress(t._blob.size()),t._transition("success")},t._errorHandler)})},t.prototype._updateProgress=function(t){var e=this._transferred;this._transferred=t,this._transferred!==e&&this._notifyObservers()},t.prototype._transition=function(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,void 0!==this._request&&this._request.cancel();break;case"running":var e="paused"===this._state;this._state=t,e&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=gg(),this._state=t,this._notifyObservers();break;case"error":case"success":this._state=t,this._notifyObservers()}},t.prototype.completeTransitions_=function(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=Ng(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}},enumerable:!1,configurable:!0}),t.prototype.on=function(t,e,n,r){var i=this,o=new hv(e,n,r);return this._addObserver(o),function(){i._removeObserver(o)}},t.prototype.then=function(t,e){return this._promise.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype._addObserver=function(t){this._observers.push(t),this._notifyObserver(t)},t.prototype._removeObserver=function(t){var e=this._observers.indexOf(t);-1!==e&&this._observers.splice(e,1)},t.prototype._notifyObservers=function(){var t=this;this._finishPromise(),this._observers.slice().forEach(function(e){t._notifyObserver(e)})},t.prototype._finishPromise=function(){if(void 0!==this._resolve){var t=!0;switch(Ng(this._state)){case jg.SUCCESS:fv(this._resolve.bind(null,this.snapshot))();break;case jg.CANCELED:case jg.ERROR:fv(this._reject.bind(null,this._error))();break;default:t=!1}t&&(this._resolve=void 0,this._reject=void 0)}},t.prototype._notifyObserver=function(t){switch(Ng(this._state)){case jg.RUNNING:case jg.PAUSED:t.next&&fv(t.next.bind(t,this.snapshot))();break;case jg.SUCCESS:t.complete&&fv(t.complete.bind(t))();break;case jg.CANCELED:case jg.ERROR:t.error&&fv(t.error.bind(t,this._error))();break;default:t.error&&fv(t.error.bind(t,this._error))()}},t.prototype.resume=function(){var t="paused"===this._state||"pausing"===this._state;return t&&this._transition("running"),t},t.prototype.pause=function(){var t="running"===this._state;return t&&this._transition("pausing"),t},t.prototype.cancel=function(){var t="running"===this._state||"pausing"===this._state;return t&&this._transition("canceling"),t},t}(),dv=function(){function t(t,e){this._service=t,this._location=e instanceof Rg?e:Rg.makeFromUrl(e,t.host)}return t.prototype.toString=function(){return"gs://"+this._location.bucket+"/"+this._location.path},t.prototype._newRef=function(e,n){return new t(e,n)},Object.defineProperty(t.prototype,"root",{get:function(){var t=new Rg(this._location.bucket,"");return this._newRef(this._service,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return Qg(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===e)return null;var n=new Rg(this._location.bucket,e);return new t(this._service,n)},enumerable:!1,configurable:!0}),t.prototype._throwIfRoot=function(t){if(""===this._location.path)throw bg(t)},t}();function gv(t){var e={prefixes:[],items:[]};return vv(t,e).then(function(){return e})}function vv(t,e,n){return Object(ur.__awaiter)(this,void 0,void 0,function(){var r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:return[4,yv(t,{pageToken:n})];case 1:return r=a.sent(),(i=e.prefixes).push.apply(i,r.prefixes),(o=e.items).push.apply(o,r.items),null==r.nextPageToken?[3,3]:[4,vv(t,e,r.nextPageToken)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function yv(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return null!=e&&"number"==typeof e.maxResults&&Ug("options.maxResults",1,1e3,e.maxResults),r=function(t,e,n,r,i){var o={};o.prefix=e.isRoot?"":e.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=qg(e.bucketOnlyServerUrl(),t.host),s=t.maxOperationRetryTime,u=new ev(a,"GET",function(t,e){return function(n,r){var i=function(t,e,n){var r=Wg(n);return null===r?null:function(t,e,n){var r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(var i=0,o=n.prefixes;i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t._makeStorageReference(new Rg(e,a));r.prefixes.push(s)}if(n.items)for(var u=0,c=n.items;u<c.length;u++)s=t._makeStorageReference(new Rg(e,c[u].name)),r.items.push(s);return r}(t,e,r)}(t,e,r);return nv(null!==i),i}}(t,e.bucket),s);return u.urlParams=o,u.errorHandler=iv(e),u}(t.storage,t._location,"/",(n=e||{}).pageToken,n.maxResults),[4,t.storage.makeRequestWithTokens(r)];case 1:return[2,i.sent().getPromise()]}})})}function mv(t,e){var n=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),r=new Rg(t._location.bucket,n);return new dv(t.storage,r)}function bv(t){return/^[A-Za-z]+:\/\//.test(t)}function _v(t,e){if(t instanceof Iv){var n=t;if(null==n._bucket)throw new fg("no-default-bucket","No default bucket found. Did you set the 'storageBucket' property when initializing the app?");var r=new dv(n,n._bucket);return null!=e?_v(r,e):r}if(void 0!==e){if(e.includes(".."))throw yg('`path` param cannot contain ".."');return mv(t,e)}return t}function wv(t,e){if(e&&bv(e)){if(t instanceof Iv)return new dv(t,e);throw yg("To use ref(service, url), the first argument must be a Storage instance.")}return _v(t,e)}function Tv(t,e){var n=null==e?void 0:e.storageBucket;return null==n?null:Rg.makeFromBucketSpec(n,t)}var Iv=function(){function t(t,e,n,r,i,o){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=o,this._bucket=null,this._host=hg,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?Rg.makeFromBucketSpec(i,this._host):Tv(this._host,this.app.options)}return Object.defineProperty(t.prototype,"host",{get:function(){return this._host},set:function(t){this._host=t,this._bucket=null!=this._url?Rg.makeFromBucketSpec(this._url,t):Tv(t,this.app.options)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._maxUploadRetryTime},set:function(t){Ug("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._maxOperationRetryTime},set:function(t){Ug("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t},enumerable:!1,configurable:!0}),t.prototype._getAuthToken=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return(t=this._authProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:if(null!==(e=n.sent()))return[2,e.accessToken];n.label=2;case 2:return[2,null]}})})},t.prototype._getAppCheckToken=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t;return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return(t=this._appCheckProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:return[2,e.sent().token];case 2:return[2,null]}})})},t.prototype._delete=function(){return this._deleted=!0,this._requests.forEach(function(t){return t.cancel()}),this._requests.clear(),Promise.resolve()},t.prototype._makeStorageReference=function(t){return new dv(this,t)},t.prototype._makeRequest=function(t,e,n){var r=this;if(this._deleted)return new Pg(mg());var i=function(t,e,n,r,i,o){var a=Vg(t.urlParams),s=t.url+a,u=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(u,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(u,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(u,o),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(u,r),new Bg(s,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}(t,this._appId,e,n,this._pool,this._firebaseVersion);return this._requests.add(i),i.getPromise().then(function(){return r._requests.delete(i)},function(){return r._requests.delete(i)}),i},t.prototype.makeRequestWithTokens=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return[4,Promise.all([this._getAuthToken(),this._getAppCheckToken()])];case 1:return e=n.sent(),[2,this._makeRequest(t,e[0],e[1])]}})})},t}();function Ev(t,e){return wv(t=Object(i.getModularInstance)(t),e)}var Ov=function(){function t(t,e,n){this._delegate=t,this.task=e,this.ref=n}return Object.defineProperty(t.prototype,"bytesTransferred",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalBytes",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),t}(),Sv=function(){function t(t,e){this._delegate=t,this._ref=e,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}return Object.defineProperty(t.prototype,"snapshot",{get:function(){return new Ov(this._delegate.snapshot,this,this._ref)},enumerable:!1,configurable:!0}),t.prototype.then=function(t,e){var n=this;return this._delegate.then(function(e){if(t)return t(new Ov(e,n,n._ref))},e)},t.prototype.on=function(t,e,n,r){var i=this,o=void 0;return e&&(o="function"==typeof e?function(t){return e(new Ov(t,i,i._ref))}:{next:e.next?function(t){return e.next(new Ov(t,i,i._ref))}:void 0,complete:e.complete||void 0,error:e.error||void 0}),this._delegate.on(t,o,n||void 0,r||void 0)},t}(),kv=function(){function t(t,e){this._delegate=t,this._service=e}return Object.defineProperty(t.prototype,"prefixes",{get:function(){var t=this;return this._delegate.prefixes.map(function(e){return new Av(e,t._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){var t=this;return this._delegate.items.map(function(e){return new Av(e,t._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextPageToken",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),t}(),Av=function(){function t(t,e){this._delegate=t,this.storage=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this._delegate.toString()},t.prototype.child=function(e){return new t(function(t,e){return mv(t,e)}(this._delegate,e),this.storage)},Object.defineProperty(t.prototype,"root",{get:function(){return new t(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=this._delegate.parent;return null==e?null:new t(e,this.storage)},enumerable:!1,configurable:!0}),t.prototype.put=function(t,e){return this._throwIfRoot("put"),new Sv(function(t,e,n){return function(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new pv(t,new Hg(e),n)}(t=Object(i.getModularInstance)(t),e,n)}(this._delegate,t,e),this)},t.prototype.putString=function(t,e,n){void 0===e&&(e=Tg.RAW),this._throwIfRoot("putString");var r=Eg(e,t),i=Object(ur.__assign)({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new Sv(new pv(this._delegate,new Hg(r.data,!0),i),this)},t.prototype.listAll=function(){var t,e=this;return(t=this._delegate,gv(t=Object(i.getModularInstance)(t))).then(function(t){return new kv(t,e.storage)})},t.prototype.list=function(t){var e=this;return function(t,e){return yv(t=Object(i.getModularInstance)(t),e)}(this._delegate,t||void 0).then(function(t){return new kv(t,e.storage)})},t.prototype.getMetadata=function(){return t=this._delegate,function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("getMetadata"),e=av(t.storage,t._location,Jg()),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise()]}})})}(t=Object(i.getModularInstance)(t));var t},t.prototype.updateMetadata=function(t){return function(t,e){return function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return t._throwIfRoot("updateMetadata"),n=function(t,e,n,r){var i=qg(e.fullServerUrl(),t.host),o=tv(n,r),a=t.maxOperationRetryTime,s=new ev(i,"PATCH",rv(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=ov(e),s}(t.storage,t._location,e,Jg()),[4,t.storage.makeRequestWithTokens(n)];case 1:return[2,r.sent().getPromise()]}})})}(t=Object(i.getModularInstance)(t),e)}(this._delegate,t)},t.prototype.getDownloadURL=function(){return t=this._delegate,function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("getDownloadURL"),e=function(t,e,n){var r=qg(e.fullServerUrl(),t.host),i=t.maxOperationRetryTime,o=new ev(r,"GET",function(t,e){return function(n,r){var i=Zg(t,r,e);return nv(null!==i),function(t,e,n){var r=Wg(e);if(null===r)return null;if(!Mg(r.downloadTokens))return null;var i=r.downloadTokens;if(0===i.length)return null;var o=encodeURIComponent;return i.split(",").map(function(e){var r=t.fullPath;return qg("/b/"+o(t.bucket)+"/o/"+o(r),n)+Vg({alt:"media",token:e})})[0]}(i,r,t.host)}}(t,n),i);return o.errorHandler=ov(e),o}(t.storage,t._location,Jg()),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise().then(function(t){if(null===t)throw new fg("no-download-url","The given file does not have any download URLs.");return t})]}})})}(t=Object(i.getModularInstance)(t));var t},t.prototype.delete=function(){return this._throwIfRoot("delete"),t=this._delegate,function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("deleteObject"),e=function(t,e){var n=qg(e.fullServerUrl(),t.host),r=new ev(n,"DELETE",function(t,e){},t.maxOperationRetryTime);return r.successCodes=[200,204],r.errorHandler=ov(e),r}(t.storage,t._location),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise()]}})})}(t=Object(i.getModularInstance)(t));var t},t.prototype._throwIfRoot=function(t){if(""===this._delegate._location.path)throw bg(t)},t}(),jv=function(){function t(t,e){var n=this;this.app=t,this._delegate=e,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),t.prototype.ref=function(t){if(bv(t))throw yg("ref() expected a child path but got a URL, use refFromURL instead.");return new Av(Ev(this._delegate,t),this)},t.prototype.refFromURL=function(t){if(!bv(t))throw yg("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Rg.makeFromUrl(t,this._delegate.host)}catch(Tp){throw yg("refFromUrl() expected a valid full URL but got an invalid one.")}return new Av(Ev(this._delegate,t),this)},t.prototype.setMaxUploadRetryTime=function(t){this._delegate.maxUploadRetryTime=t},t.prototype.setMaxOperationRetryTime=function(t){this._delegate.maxOperationRetryTime=t},t.prototype.useEmulator=function(t,e){!function(t,e,n){t.host="http://"+e+":"+n}(this._delegate,t,e)},t}();function Nv(t,e){var n=e.instanceIdentifier,i=t.getProvider("app").getImmediate(),o=t.getProvider("auth-internal"),a=t.getProvider("app-check-internal");return new jv(i,new Iv(i,o,a,new xg,n,r.default.SDK_VERSION))}!function(t){var e={TaskState:jg,TaskEvent:Ag,StringFormat:Tg,Storage:Iv,Reference:Av};t.INTERNAL.registerComponent(new Sp.Component("storage",Nv,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),t.registerVersion("@firebase/storage","0.5.2")}(r.default);var Cv,Dv,xv,Rv="0.4.12",Pv=Rv,Mv="FB-PERF-TRACE-MEASURE",Lv="_wt_",Fv="_fcp",Uv="_fid",qv="@firebase/performance/config",Vv="@firebase/performance/configexpire",Bv="Performance",Kv=((Cv={})["trace started"]="Trace {$traceName} was started before.",Cv["trace stopped"]="Trace {$traceName} is not running.",Cv["nonpositive trace startTime"]="Trace {$traceName} startTime should be positive.",Cv["nonpositive trace duration"]="Trace {$traceName} duration should be positive.",Cv["no window"]="Window is not available.",Cv["no app id"]="App id is not available.",Cv["no project id"]="Project id is not available.",Cv["no api key"]="Api key is not available.",Cv["invalid cc log"]="Attempted to queue invalid cc event",Cv["FB not default"]="Performance can only start when Firebase app instance is the default one.",Cv["RC response not ok"]="RC response is not ok",Cv["invalid attribute name"]="Attribute name {$attributeName} is invalid.",Cv["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",Cv["invalid custom metric name"]="Custom metric name {$customMetricName} is invalid",Cv["invalid String merger input"]="Input for String merger is invalid, contact support team to resolve.",Cv),Gv=new i.ErrorFactory("performance",Bv,Kv),zv=new o.Logger(Bv);zv.logLevel=o.LogLevel.INFO;var Hv,Wv=function(){function t(t){if(this.window=t,!t)throw Gv.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}return t.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},t.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},t.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},t.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},t.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},t.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},t.prototype.requiredApisAvailable=function(){return fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled?!!Object(i.isIndexedDBAvailable)()||(zv.info("IndexedDB is not supported by current browswer"),!1):(zv.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)},t.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var n=0,r=t.getEntries();n<r.length;n++)e(r[n])}).observe({entryTypes:[t]})},t.getInstance=function(){return void 0===Dv&&(Dv=new t(xv)),Dv},t}();function Qv(t,e){var n=t.length-e.length;if(n<0||n>1)throw Gv.create("invalid String merger input");for(var r=[],i=0;i<t.length;i++)r.push(t.charAt(i)),e.length>i&&r.push(e.charAt(i));return r.join("")}var Xv,Yv=function(){function t(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=Qv("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=Qv("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return t.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw Gv.create("no app id");return t},t.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw Gv.create("no project id");return t},t.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw Gv.create("no api key");return t},t.prototype.getFlTransportFullUrl=function(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)},t.getInstance=function(){return void 0===Hv&&(Hv=new t),Hv},t}();function $v(){return Xv}var Jv=function(t){return t[t.UNKNOWN=0]="UNKNOWN",t[t.VISIBLE=1]="VISIBLE",t[t.HIDDEN=2]="HIDDEN",t}({}),Zv=["firebase_","google_","ga_"],ty=new RegExp("^[a-zA-Z]\\w*$");function ey(){var t=Wv.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}function ny(){switch(Wv.getInstance().document.visibilityState){case"visible":return Jv.VISIBLE;case"hidden":return Jv.HIDDEN;default:return Jv.UNKNOWN}}function ry(){var t=Wv.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function iy(t){if(!t)return t;var e=Yv.getInstance(),n=t.entries||{};return e.loggingEnabled=void 0===n.fpr_enabled||"true"===String(n.fpr_enabled),n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(e.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=oy(e.tracesSamplingRate),e.logNetworkAfterSampling=oy(e.networkRequestsSamplingRate),t}function oy(t){return Math.random()<=t}var ay,sy=1;function uy(){return sy=2,ay=ay||function(){var t=Wv.getInstance().document;return new Promise(function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()})}().then(function(){return(t=Yv.getInstance().installationsService.getId()).then(function(t){Xv=t}),t;var t}).then(function(t){return function(t){var e=function(){var t=Wv.getInstance().localStorage;if(t){var e=t.getItem(Vv);if(e&&Number(e)>Date.now()){var n=t.getItem(qv);if(n)try{return JSON.parse(n)}catch(r){return}}}}();return e?(iy(e),Promise.resolve()):function(t){return(e=Yv.getInstance().installationsService.getToken(),e.then(function(t){}),e).then(function(e){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+Yv.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+Yv.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:"FIREBASE_INSTALLATIONS_AUTH "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:Yv.getInstance().getAppId(),app_version:Pv,sdk_version:"0.0.1"})});return fetch(r).then(function(t){if(t.ok)return t.json();throw Gv.create("RC response not ok")})}).catch(function(){zv.info("Could not fetch config, will use default configs")});var e}(t).then(iy).then(function(t){return function(t){var e=Wv.getInstance().localStorage;t&&e&&(e.setItem(qv,JSON.stringify(t)),e.setItem(Vv,String(Date.now()+60*Yv.getInstance().configTimeToLive*60*1e3)))}(t)},function(){})}(t)}).then(function(){return cy()},function(){return cy()})}function cy(){sy=3}var ly,hy=1e4,fy=3,py=[],dy=!1;function gy(t){setTimeout(function(){var t,e;if(0!==fy)return py.length?(e=(t=py.splice(0,1e3)).map(function(t){return{source_extension_json_proto3:t.message,event_time_ms:String(t.eventTime)}}),void function(t,e){return function(t){var e=Yv.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(t)})}(t).then(function(t){return t.ok||zv.info("Call to Firebase backend failed."),t.json()}).then(function(t){var n=Number(t.nextRequestWaitMillis),r=hy;isNaN(n)||(r=Math.max(n,r));var i=t.logResponseDetails;Array.isArray(i)&&i.length>0&&"RETRY_REQUEST_LATER"===i[0].responseAction&&(py=Object(ur.__spreadArray)(Object(ur.__spreadArray)([],e),py),zv.info("Retry transport request later.")),fy=3,gy(r)})}({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Yv.getInstance().logSource,log_event:e},t).catch(function(){py=Object(ur.__spreadArray)(Object(ur.__spreadArray)([],t),py),fy--,zv.info("Tries left: "+fy+"."),gy(hy)})):gy(hy)},t)}function vy(t){if(!t.eventTime||!t.message)throw Gv.create("invalid cc log");py=Object(ur.__spreadArray)(Object(ur.__spreadArray)([],py),[t])}function yy(t,e){ly||(ly=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];vy({message:t.apply(void 0,e),eventTime:Date.now()})}}(_y)),ly(t,e)}function my(t){var e=Yv.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&Wv.getInstance().requiredApisAvailable()&&(t.isAuto&&ny()!==Jv.VISIBLE||(3===sy?by(t):uy().then(function(){return by(t)},function(){return by(t)})))}function by(t){if($v()){var e=Yv.getInstance();e.loggingEnabled&&e.logTraceAfterSampling&&setTimeout(function(){return yy(t,1)},0)}}function _y(t,e){return 0===e?(r={url:(n=t).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},i={application_info:wy(),network_request_metric:r},JSON.stringify(i)):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=t.counters);var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=n);var r={application_info:wy(),trace_metric:e};return JSON.stringify(r)}(t);var n,r,i}function wy(){return{google_app_id:Yv.getInstance().getAppId(),app_instance_id:$v(),web_app_info:{sdk_version:Pv,page_url:Wv.getInstance().getUrl(),service_worker_status:ey(),visibility_state:ny(),effective_connection_type:ry()},application_process_state:0}}var Ty=["_fp",Fv,Uv],Iy=function(){function t(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=Wv.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||"FB-PERF-TRACE-MEASURE-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}return t.prototype.start=function(){if(1!==this.state)throw Gv.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},t.prototype.stop=function(){if(2!==this.state)throw Gv.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),my(this)},t.prototype.record=function(t,e,n){if(t<=0)throw Gv.create("nonpositive trace startTime",{traceName:this.name});if(e<=0)throw Gv.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=Object(ur.__assign)({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}my(this)},t.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),this.putMetric(t,void 0===this.counters[t]?e:this.counters[t]+e)},t.prototype.putMetric=function(t,e){if(o=this.name,0===(i=t).length||i.length>100||!(o&&o.startsWith(Lv)&&Ty.indexOf(i)>-1)&&i.startsWith("_"))throw Gv.create("invalid custom metric name",{customMetricName:t});var n,r,i,o;this.counters[t]=(n=e,(r=Math.floor(n))<n&&zv.info("Metric value should be an Integer, setting the value as : "+r+"."),r)},t.prototype.getMetric=function(t){return this.counters[t]||0},t.prototype.putAttribute=function(t,e){var n,r=!(0===(n=t).length||n.length>40||Zv.some(function(t){return n.startsWith(t)})||!n.match(ty)),i=function(t){return 0!==t.length&&t.length<=100}(e);if(r&&i)this.customAttributes[t]=e;else{if(!r)throw Gv.create("invalid attribute name",{attributeName:t});if(!i)throw Gv.create("invalid attribute value",{attributeValue:e})}},t.prototype.getAttribute=function(t){return this.customAttributes[t]},t.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},t.prototype.getAttributes=function(){return Object(ur.__assign)({},this.customAttributes)},t.prototype.setStartTime=function(t){this.startTimeUs=t},t.prototype.setDuration=function(t){this.durationUs=t},t.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},t.createOobTrace=function(e,n,r){var i=Wv.getInstance().getUrl();if(i){var o=new t(Lv+i,!0),a=Math.floor(1e3*Wv.getInstance().getTimeOrigin());if(o.setStartTime(a),e&&e[0]&&(o.setDuration(Math.floor(1e3*e[0].duration)),o.putMetric("domInteractive",Math.floor(1e3*e[0].domInteractive)),o.putMetric("domContentLoadedEventEnd",Math.floor(1e3*e[0].domContentLoadedEventEnd)),o.putMetric("loadEventEnd",Math.floor(1e3*e[0].loadEventEnd))),n){var s=n.find(function(t){return"first-paint"===t.name});s&&s.startTime&&o.putMetric("_fp",Math.floor(1e3*s.startTime));var u=n.find(function(t){return"first-contentful-paint"===t.name});u&&u.startTime&&o.putMetric(Fv,Math.floor(1e3*u.startTime)),r&&o.putMetric(Uv,Math.floor(1e3*r))}my(o)}},t.createUserTimingTrace=function(e){my(new t(e,!1,e))},t}();function Ey(t){var e=t;if(e&&void 0!==e.responseStart){var n=Wv.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=Yv.getInstance();if(e.instrumentationEnabled){var n=t.url,r=e.logEndPointUrl.split("?")[0],i=e.flTransportEndpointUrl.split("?")[0];n!==r&&n!==i&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return yy(t,0)},0)}}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}function Oy(){$v()&&(setTimeout(function(){return function(){var t=Wv.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){Iy.createOobTrace(e,n),r=void 0},5e3);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),Iy.createOobTrace(e,n,t))})}else Iy.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=Wv.getInstance(),e=0,n=t.getEntriesByType("resource");e<n.length;e++)Ey(n[e]);t.setupObserver("resource",Ey)}()},0),setTimeout(function(){return function(){for(var t=Wv.getInstance(),e=0,n=t.getEntriesByType("measure");e<n.length;e++)Sy(n[e]);t.setupObserver("measure",Sy)}()},0))}function Sy(t){var e=t.name;e.substring(0,Mv.length)!==Mv&&Iy.createUserTimingTrace(e)}var ky=function(){function t(t){this.app=t,Wv.getInstance().requiredApisAvailable()&&Object(i.validateIndexedDBOpenable)().then(function(t){t&&(dy||(gy(5500),dy=!0),uy().then(Oy,Oy))}).catch(function(t){zv.info("Environment doesn't support IndexedDB: "+t)})}return t.prototype.trace=function(t){return new Iy(t)},Object.defineProperty(t.prototype,"instrumentationEnabled",{get:function(){return Yv.getInstance().instrumentationEnabled},set:function(t){Yv.getInstance().instrumentationEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataCollectionEnabled",{get:function(){return Yv.getInstance().dataCollectionEnabled},set:function(t){Yv.getInstance().dataCollectionEnabled=t},enumerable:!1,configurable:!0}),t}();!function(t){t.INTERNAL.registerComponent(new Sp.Component("performance",function(t){return function(t,e){if("[DEFAULT]"!==t.name)throw Gv.create("FB not default");if("undefined"==typeof window)throw Gv.create("no window");return function(t){xv=t}(window),Yv.getInstance().firebaseAppInstance=t,Yv.getInstance().installationsService=e,new ky(t)}(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())},"PUBLIC")),t.registerVersion("@firebase/performance",Rv)}(r.default);var Ay,jy="https://www.googletagmanager.com/gtag/js",Ny=function(t){return t.EVENT="event",t.SET="set",t.CONFIG="config",t}({}),Cy=function(t){return t.ADD_SHIPPING_INFO="add_shipping_info",t.ADD_PAYMENT_INFO="add_payment_info",t.ADD_TO_CART="add_to_cart",t.ADD_TO_WISHLIST="add_to_wishlist",t.BEGIN_CHECKOUT="begin_checkout",t.CHECKOUT_PROGRESS="checkout_progress",t.EXCEPTION="exception",t.GENERATE_LEAD="generate_lead",t.LOGIN="login",t.PAGE_VIEW="page_view",t.PURCHASE="purchase",t.REFUND="refund",t.REMOVE_FROM_CART="remove_from_cart",t.SCREEN_VIEW="screen_view",t.SEARCH="search",t.SELECT_CONTENT="select_content",t.SELECT_ITEM="select_item",t.SELECT_PROMOTION="select_promotion",t.SET_CHECKOUT_OPTION="set_checkout_option",t.SHARE="share",t.SIGN_UP="sign_up",t.TIMING_COMPLETE="timing_complete",t.VIEW_CART="view_cart",t.VIEW_ITEM="view_item",t.VIEW_ITEM_LIST="view_item_list",t.VIEW_PROMOTION="view_promotion",t.VIEW_SEARCH_RESULTS="view_search_results",t}({}),Dy=new o.Logger("@firebase/analytics");function xy(t,e,n,r,i,o){return Object(ur.__awaiter)(this,void 0,void 0,function(){var a,s,u,c;return Object(ur.__generator)(this,function(l){switch(l.label){case 0:a=r[i],l.label=1;case 1:return l.trys.push([1,7,,8]),a?[4,e[a]]:[3,3];case 2:return l.sent(),[3,6];case 3:return[4,Promise.all(n)];case 4:return s=l.sent(),(u=s.find(function(t){return t.measurementId===i}))?[4,e[u.appId]]:[3,6];case 5:l.sent(),l.label=6;case 6:return[3,8];case 7:return c=l.sent(),Dy.error(c),[3,8];case 8:return t(Ny.CONFIG,i,o),[2]}})})}function Ry(t,e,n,r,i){return Object(ur.__awaiter)(this,void 0,void 0,function(){var o,a,s,u,c,l,h;return Object(ur.__generator)(this,function(f){switch(f.label){case 0:return f.trys.push([0,4,,5]),o=[],i&&i.send_to?(a=i.send_to,Array.isArray(a)||(a=[a]),[4,Promise.all(n)]):[3,2];case 1:for(s=f.sent(),u=function(t){var n=s.find(function(e){return e.measurementId===t}),r=n&&e[n.appId];if(!r)return o=[],"break";o.push(r)},c=0,l=a;c<l.length&&"break"!==u(l[c]);c++);f.label=2;case 2:return 0===o.length&&(o=Object.values(e)),[4,Promise.all(o)];case 3:return f.sent(),t(Ny.EVENT,r,i||{}),[3,5];case 4:return h=f.sent(),Dy.error(h),[3,5];case 5:return[2]}})})}var Py=((Ay={})["already-exists"]="A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",Ay["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",Ay["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate: {$reason}",Ay["invalid-analytics-context"]="Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",Ay["indexeddb-unavailable"]="IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",Ay["fetch-throttle"]="The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",Ay["config-fetch-failed"]="Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",Ay["no-api-key"]='The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',Ay["no-app-id"]='The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',Ay),My=new i.ErrorFactory("analytics","Analytics",Py),Ly=new(function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e=1e3),this.throttleMetadata=t,this.intervalMillis=e}return t.prototype.getThrottleMetadata=function(t){return this.throttleMetadata[t]},t.prototype.setThrottleMetadata=function(t,e){this.throttleMetadata[t]=e},t.prototype.deleteThrottleMetadata=function(t){delete this.throttleMetadata[t]},t}());function Fy(t){var e;return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a,s;return Object(ur.__generator)(this,function(u){switch(u.label){case 0:return n=t.appId,r={method:"GET",headers:(c=t.apiKey,new Headers({Accept:"application/json","x-goog-api-key":c}))},i="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),[4,fetch(i,r)];case 1:if(200===(o=u.sent()).status||304===o.status)return[3,6];a="",u.label=2;case 2:return u.trys.push([2,4,,5]),[4,o.json()];case 3:return s=u.sent(),(null===(e=s.error)||void 0===e?void 0:e.message)&&(a=s.error.message),[3,5];case 4:return u.sent(),[3,5];case 5:throw My.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a});case 6:return[2,o.json()]}var c})})}function Uy(t,e,n,r){var o=e.throttleEndTimeMillis,a=e.backoffCount;return void 0===r&&(r=Ly),Object(ur.__awaiter)(this,void 0,void 0,function(){var e,s,u,c,l,h,f;return Object(ur.__generator)(this,function(p){switch(p.label){case 0:e=t.appId,s=t.measurementId,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,qy(n,o)];case 2:return p.sent(),[3,4];case 3:if(u=p.sent(),s)return Dy.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+s+' provided in the "measurementId" field in the local Firebase config. ['+u.message+"]"),[2,{appId:e,measurementId:s}];throw u;case 4:return p.trys.push([4,6,,7]),[4,Fy(t)];case 5:return c=p.sent(),r.deleteThrottleMetadata(e),[2,c];case 6:if(!function(t){if(!(t instanceof i.FirebaseError&&t.customData))return!1;var e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(l=p.sent())){if(r.deleteThrottleMetadata(e),s)return Dy.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+s+' provided in the "measurementId" field in the local Firebase config. ['+l.message+"]"),[2,{appId:e,measurementId:s}];throw l}return h=503===Number(l.customData.httpStatus)?Object(i.calculateBackoffMillis)(a,r.intervalMillis,30):Object(i.calculateBackoffMillis)(a,r.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:a+1},r.setThrottleMetadata(e,f),Dy.debug("Calling attemptFetch again in "+h+" millis"),[2,Uy(t,f,n,r)];case 7:return[2]}})})}function qy(t,e){return new Promise(function(n,r){var i=Math.max(e-Date.now(),0),o=setTimeout(n,i);t.addEventListener(function(){clearTimeout(o),r(My.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}var Vy,By,Ky=function(){function t(){this.listeners=[]}return t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},t}(),Gy={},zy=[],Hy={},Wy="dataLayer",Qy="gtag",Xy=!1;function Yy(t){if(Xy)throw My.create("already-initialized");t.dataLayerName&&(Wy=t.dataLayerName),t.gtagName&&(Qy=t.gtagName)}var $y="analytics";function Jy(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:if(Object(i.isBrowserExtension)())return[2,!1];if(!Object(i.areCookiesEnabled)())return[2,!1];if(!Object(i.isIndexedDBAvailable)())return[2,!1];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,Object(i.validateIndexedDBOpenable)()];case 2:return[2,t.sent()];case 3:return t.sent(),[2,!1];case 4:return[2]}})})}!function(t){t.INTERNAL.registerComponent(new Sp.Component($y,function(t){return function(t,e){!function(){var t=[];if(Object(i.isBrowserExtension)()&&t.push("This is a browser extension environment."),Object(i.areCookiesEnabled)()||t.push("Cookies are not available."),t.length>0){var e=t.map(function(t,e){return"("+(e+1)+") "+t}).join(" "),n=My.create("invalid-analytics-context",{errorInfo:e});Dy.warn(n.message)}}();var n,r,o=t.options.appId;if(!o)throw My.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw My.create("no-api-key");Dy.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+t.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Gy[o])throw My.create("already-exists",{id:o});if(!Xy){n=Wy,r=[],Array.isArray(window[n])?r=window[n]:window[n]=r;var a=function(t,e,n,r,i){var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(o=window[i]),window[i]=function(t,e,n,r){return function(i,o,a){return Object(ur.__awaiter)(this,void 0,void 0,function(){var s;return Object(ur.__generator)(this,function(u){switch(u.label){case 0:return u.trys.push([0,6,,7]),i!==Ny.EVENT?[3,2]:[4,Ry(t,e,n,o,a)];case 1:return u.sent(),[3,5];case 2:return i!==Ny.CONFIG?[3,4]:[4,xy(t,e,n,r,o,a)];case 3:return u.sent(),[3,5];case 4:t(Ny.SET,o),u.label=5;case 5:return[3,7];case 6:return s=u.sent(),Dy.error(s),[3,7];case 7:return[2]}})})}}(o,t,e,n),{gtagCore:o,wrappedGtag:window[i]}}(Gy,zy,Hy,Wy,Qy);By=a.wrappedGtag,Vy=a.gtagCore,Xy=!0}return Gy[o]=function(t,e,n,r,o,a){return Object(ur.__awaiter)(this,void 0,void 0,function(){var s,u,c,l,h,f,p;return Object(ur.__generator)(this,function(d){switch(d.label){case 0:return(s=function(t,e,n){return void 0===e&&(e=Ly),Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return Object(ur.__generator)(this,function(c){if(i=(n=t.options).apiKey,o=n.measurementId,!(r=n.appId))throw My.create("no-app-id");if(!i){if(o)return[2,{measurementId:o,appId:r}];throw My.create("no-api-key")}return a=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},s=new Ky,setTimeout(function(){return Object(ur.__awaiter)(u,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){return s.abort(),[2]})})},6e4),[2,Uy({appId:r,apiKey:i,measurementId:o},a,s,e)]})})}(t)).then(function(e){n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Dy.warn("The measurement ID in the local Firebase config ("+t.options.measurementId+") does not match the measurement ID fetched from the server ("+e.measurementId+"). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(function(t){return Dy.error(t)}),e.push(s),u=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t;return Object(ur.__generator)(this,function(e){switch(e.label){case 0:return Object(i.isIndexedDBAvailable)()?[3,1]:(Dy.warn(My.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),[2,!1]);case 1:return e.trys.push([1,3,,4]),[4,Object(i.validateIndexedDBOpenable)()];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),Dy.warn(My.create("indexeddb-unavailable",{errorInfo:t}).message),[2,!1];case 4:return[2,!0]}})})}().then(function(t){return t?r.getId():void 0}),[4,Promise.all([s,u])];case 1:return c=d.sent(),l=c[0],h=c[1],function(){for(var t=window.document.getElementsByTagName("script"),e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(r.src&&r.src.includes(jy))return r}return null}()||function(t,e){var n=document.createElement("script");n.src=jy+"?l="+t+"&id="+e,n.async=!0,document.head.appendChild(n)}(a,l.measurementId),o("js",new Date),(p={}).origin="firebase",p.update=!0,f=p,null!=h&&(f.firebase_id=h),o(Ny.CONFIG,l.measurementId,f),[2,l.measurementId]}})})}(t,zy,Hy,e,Vy,Wy),{app:t,logEvent:function(t,e,n){(function(t,e,n,r,i){return Object(ur.__awaiter)(this,void 0,void 0,function(){var o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return i&&i.global?(t(Ny.EVENT,n,r),[2]):[3,1];case 1:return[4,e];case 2:o=s.sent(),a=Object(ur.__assign)(Object(ur.__assign)({},r),{send_to:o}),t(Ny.EVENT,n,a),s.label=3;case 3:return[2]}})})})(By,Gy[o],t,e,n).catch(function(t){return Dy.error(t)})},setCurrentScreen:function(t,e){(function(t,e,n,r){return Object(ur.__awaiter)(this,void 0,void 0,function(){var i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return r&&r.global?(t(Ny.SET,{screen_name:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,e];case 2:i=o.sent(),t(Ny.CONFIG,i,{update:!0,screen_name:n}),o.label=3;case 3:return[2]}})})})(By,Gy[o],t,e).catch(function(t){return Dy.error(t)})},setUserId:function(t,e){(function(t,e,n,r){return Object(ur.__awaiter)(this,void 0,void 0,function(){var i;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:return r&&r.global?(t(Ny.SET,{user_id:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,e];case 2:i=o.sent(),t(Ny.CONFIG,i,{update:!0,user_id:n}),o.label=3;case 3:return[2]}})})})(By,Gy[o],t,e).catch(function(t){return Dy.error(t)})},setUserProperties:function(t,e){(function(t,e,n,r){return Object(ur.__awaiter)(this,void 0,void 0,function(){var i,o,a,s,u;return Object(ur.__generator)(this,function(c){switch(c.label){case 0:if(!r||!r.global)return[3,1];for(i={},o=0,a=Object.keys(n);o<a.length;o++)i["user_properties."+(s=a[o])]=n[s];return t(Ny.SET,i),[2,Promise.resolve()];case 1:return[4,e];case 2:u=c.sent(),t(Ny.CONFIG,u,{update:!0,user_properties:n}),c.label=3;case 3:return[2]}})})})(By,Gy[o],t,e).catch(function(t){return Dy.error(t)})},setAnalyticsCollectionEnabled:function(t){(function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,t];case 1:return n=r.sent(),window["ga-disable-"+n]=!e,[2]}})})})(Gy[o],t).catch(function(t){return Dy.error(t)})},INTERNAL:{delete:function(){return delete Gy[o],Promise.resolve()}}}}(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())},"PUBLIC").setServiceProps({settings:Yy,EventName:Cy,isSupported:Jy})),t.INTERNAL.registerComponent(new Sp.Component("analytics-internal",function(t){try{return{logEvent:t.getProvider($y).getImmediate().logEvent}}catch(Tp){throw My.create("interop-component-reg-failed",{reason:Tp})}},"PRIVATE")),t.registerVersion("@firebase/analytics","0.6.10")}(r.default);var Zy,tm=function(){function t(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}return t.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},t.prototype.fetch=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=a.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(t.cacheMaxAgeMillis,n)?[2,r]:(t.eTag=r&&r.eTag,[4,this.client.fetch(t)]);case 2:return i=a.sent(),o=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===i.status&&o.push(this.storage.setLastSuccessfulFetchResponse(i)),[4,Promise.all(o)];case 3:return a.sent(),[2,i]}})})},t}(),em=((Zy={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",Zy["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",Zy["registration-api-key"]="Undefined API key. Check Firebase app initialization.",Zy["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",Zy["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",Zy["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",Zy["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",Zy["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",Zy["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",Zy["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',Zy["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',Zy["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",Zy["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",Zy),nm=new i.ErrorFactory("remoteconfig","Remote Config",em),rm=function(){function t(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}return t.prototype.fetch=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,l,h,f,p,d,g,v;return Object(ur.__generator)(this,function(y){switch(y.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=y.sent(),n=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",r=n+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,i={sdk_version:this.sdkVersion,app_instance_id:e[0],app_instance_id_token:e[1],app_id:this.appId,language_code:(void 0===m&&(m=navigator),m.languages&&m.languages[0]||m.language)},o={method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":t.eTag||"*"},body:JSON.stringify(i)},a=fetch(r,o),s=new Promise(function(e,n){t.signal.addEventListener(function(){var t=new Error("The operation was aborted.");t.name="AbortError",n(t)})}),y.label=2;case 2:return y.trys.push([2,5,,6]),[4,Promise.race([a,s])];case 3:return y.sent(),[4,a];case 4:return u=y.sent(),[3,6];case 5:throw c=y.sent(),l="fetch-client-network","AbortError"===c.name&&(l="fetch-timeout"),nm.create(l,{originalErrorMessage:c.message});case 6:if(h=u.status,f=u.headers.get("ETag")||void 0,200!==u.status)return[3,11];g=void 0,y.label=7;case 7:return y.trys.push([7,9,,10]),[4,u.json()];case 8:return g=y.sent(),[3,10];case 9:throw v=y.sent(),nm.create("fetch-client-parse",{originalErrorMessage:v.message});case 10:p=g.entries,d=g.state,y.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===d?h=500:"NO_CHANGE"===d?h=304:"NO_TEMPLATE"!==d&&"EMPTY_CONFIG"!==d||(p={}),304!==h&&200!==h)throw nm.create("fetch-status",{httpStatus:h});return[2,{status:h,eTag:f,config:p}]}var m})})},t}(),im=function(){function t(){this.listeners=[]}return t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},t}(),om=["1","true","t","yes","y","on"],am=function(){function t(t,e){void 0===e&&(e=""),this._source=t,this._value=e}return t.prototype.asString=function(){return this._value},t.prototype.asBoolean=function(){return"static"!==this._source&&om.indexOf(this._value.toLowerCase())>=0},t.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},t.prototype.getSource=function(){return this._source},t}(),sm=function(){function t(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}return t.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=o.LogLevel.DEBUG;break;case"silent":this._logger.logLevel=o.LogLevel.SILENT;break;default:this._logger.logLevel=o.LogLevel.ERROR}},Object.defineProperty(t.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!1,configurable:!0}),t.prototype.activate=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e,n;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return t=r.sent(),n=t[1],(e=t[0])&&e.config&&e.eTag&&e.eTag!==n?[4,Promise.all([this._storageCache.setActiveConfig(e.config),this._storage.setActiveConfigEtag(e.eTag)])]:[2,!1];case 2:return r.sent(),[2,!0]}})})},t.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){t._isInitializationComplete=!0})),this._initializePromise},t.prototype.fetch=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(ur.__generator)(this,function(o){switch(o.label){case 0:t=new im,setTimeout(function(){return Object(ur.__awaiter)(r,void 0,void 0,function(){return Object(ur.__generator)(this,function(e){return t.abort(),[2]})})},this.settings.fetchTimeoutMillis),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:t})];case 2:return o.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return o.sent(),[3,6];case 4:return e=o.sent(),n=function(t,e){return t instanceof i.FirebaseError&&-1!==t.code.indexOf("fetch-throttle")}(e)?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(n)];case 5:throw o.sent(),e;case 6:return[2]}})})},t.prototype.fetchAndActivate=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){return Object(ur.__generator)(this,function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}})})},t.prototype.getAll=function(){var t,e,n=this;return(t=this._storageCache.getActiveConfig(),e=this.defaultConfig,void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(Object(ur.__assign)(Object(ur.__assign)({},t),e))).reduce(function(t,e){return t[e]=n.getValue(e),t},{})},t.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},t.prototype.getNumber=function(t){return this.getValue(t).asNumber()},t.prototype.getString=function(t){return this.getValue(t).asString()},t.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new am("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new am("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new am("static"))},t}();function um(t,e){var n=t.target.error||void 0;return nm.create(e,{originalErrorMessage:n&&n.message})}var cm="app_namespace_store",lm=function(){function t(t,e,n,r){void 0===r&&(r=new Promise(function(t,e){var n=indexedDB.open("firebase_remote_config",1);n.onerror=function(t){e(um(t,"storage-open"))},n.onsuccess=function(e){t(e.target.result)},n.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(cm,{keyPath:"compositeKey"})}}})),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}return t.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},t.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},t.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},t.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},t.prototype.getActiveConfig=function(){return this.get("active_config")},t.prototype.setActiveConfig=function(t){return this.set("active_config",t)},t.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},t.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},t.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},t.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},t.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},t.prototype.get=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise(function(r,i){var o=e.transaction([cm],"readonly").objectStore(cm),a=n.createCompositeKey(t);try{var s=o.get(a);s.onerror=function(t){i(um(t,"storage-get"))},s.onsuccess=function(t){var e=t.target.result;r(e?e.value:void 0)}}catch(Tp){i(nm.create("storage-get",{originalErrorMessage:Tp&&Tp.message}))}})]}})})},t.prototype.set=function(t,e){return Object(ur.__awaiter)(this,void 0,void 0,function(){var n,r=this;return Object(ur.__generator)(this,function(i){switch(i.label){case 0:return[4,this.openDbPromise];case 1:return n=i.sent(),[2,new Promise(function(i,o){var a=n.transaction([cm],"readwrite").objectStore(cm),s=r.createCompositeKey(t);try{var u=a.put({compositeKey:s,value:e});u.onerror=function(t){o(um(t,"storage-set"))},u.onsuccess=function(){i()}}catch(Tp){o(nm.create("storage-set",{originalErrorMessage:Tp&&Tp.message}))}})]}})})},t.prototype.delete=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(ur.__generator)(this,function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise(function(r,i){var o=e.transaction([cm],"readwrite").objectStore(cm),a=n.createCompositeKey(t);try{var s=o.delete(a);s.onerror=function(t){i(um(t,"storage-delete"))},s.onsuccess=function(){r()}}catch(Tp){i(nm.create("storage-delete",{originalErrorMessage:Tp&&Tp.message}))}})]}})})},t.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},t}(),hm=function(){function t(t){this.storage=t}return t.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},t.prototype.getActiveConfig=function(){return this.activeConfig},t.prototype.loadFromStorage=function(){return Object(ur.__awaiter)(this,void 0,void 0,function(){var t,e,n,r,i,o;return Object(ur.__generator)(this,function(a){switch(a.label){case 0:return t=this.storage.getLastFetchStatus(),e=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),[4,t];case 1:return(r=a.sent())&&(this.lastFetchStatus=r),[4,e];case 2:return(i=a.sent())&&(this.lastSuccessfulFetchTimestampMillis=i),[4,n];case 3:return(o=a.sent())&&(this.activeConfig=o),[2]}})})},t.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},t.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},t}();function fm(t,e){return new Promise(function(n,r){var i=Math.max(e-Date.now(),0),o=setTimeout(n,i);t.addEventListener(function(){clearTimeout(o),r(nm.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}var pm,dm=function(){function t(t,e){this.client=t,this.storage=e}return t.prototype.fetch=function(t){return Object(ur.__awaiter)(this,void 0,void 0,function(){var e;return Object(ur.__generator)(this,function(n){switch(n.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=n.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(t,e)]}})})},t.prototype.attemptFetch=function(t,e){var n=e.throttleEndTimeMillis,r=e.backoffCount;return Object(ur.__awaiter)(this,void 0,void 0,function(){var e,o,a;return Object(ur.__generator)(this,function(s){switch(s.label){case 0:return[4,fm(t.signal,n)];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,5,,7]),[4,this.client.fetch(t)];case 3:return e=s.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return s.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof i.FirebaseError&&t.customData))return!1;var e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(o=s.sent()))throw o;return a={throttleEndTimeMillis:Date.now()+Object(i.calculateBackoffMillis)(r),backoffCount:r+1},[4,this.storage.setThrottleMetadata(a)];case 6:return s.sent(),[2,this.attemptFetch(t,a)];case 7:return[2]}})})},t}(),gm="@firebase/remote-config";(pm=r.default).INTERNAL.registerComponent(new Sp.Component("remoteConfig",function(t,e){var n=e.instanceIdentifier,r=t.getProvider("app").getImmediate(),i=t.getProvider("installations").getImmediate();if("undefined"==typeof window)throw nm.create("registration-window");var a=r.options,s=a.projectId,u=a.apiKey,c=a.appId;if(!s)throw nm.create("registration-project-id");if(!u)throw nm.create("registration-api-key");if(!c)throw nm.create("registration-app-id");var l=new lm(c,r.name,n=n||"firebase"),h=new hm(l),f=new o.Logger(gm);f.logLevel=o.LogLevel.ERROR;var p=new rm(i,pm.SDK_VERSION,n,s,u,c),d=new dm(p,l),g=new tm(d,l,h,f),v=new sm(r,g,h,l,f);return v.ensureInitialized(),v},"PUBLIC").setMultipleInstances(!0)),pm.registerVersion(gm,"0.1.37"),n("X8/r"),r.default.registerVersion("firebase","8.6.2","app"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),r.default.registerVersion("firebase","8.6.2")},"X8/r":function(t,e,n){"use strict";var r=n("zIRd"),i=n("/6Yf"),o=n("mrSG"),a=n("qOnz"),s=n("q/0M");function u(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var c,l=u(r),h=((c={})["already-activated"]="You are trying to activate AppCheck for FirebaseApp {$appName}, while it is already activated. AppCheck can only be activated once.",c["use-before-activation"]="AppCheck is being used before activate() is called for FirebaseApp {$appName}. Please make sure you call activate() before instantiating other Firebase services.",c["fetch-network-error"]="Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",c["fetch-parse-error"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",c["fetch-status-error"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",c["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",c["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",c["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",c["recaptcha-error"]="ReCAPTCHA error.",c),f=new a.ErrorFactory("appCheck","AppCheck",h),p=new Map,d={activated:!1,tokenListeners:[]},g={enabled:!1};function v(t){return p.get(t)||d}function y(t,e){p.set(t,e)}function m(){return g}function b(){return self.grecaptcha}function _(t){if(!v(t).activated)throw f.create("use-before-activation",{appName:t.name})}function w(t){return o.__awaiter(this,void 0,void 0,function(){var e;return o.__generator(this,function(n){switch(n.label){case 0:return _(t),[4,v(t).reCAPTCHAState.initialized.promise];case 1:return e=n.sent(),[2,new Promise(function(n,r){var i=v(t).reCAPTCHAState;e.ready(function(){n(e.execute(i.widgetId,{action:"fire_app_check"}))})})]}})})}function T(t,e,n,r){var i=n.render(r,{sitekey:e,size:"invisible"}),a=v(t);y(t,o.__assign(o.__assign({},a),{reCAPTCHAState:o.__assign(o.__assign({},a.reCAPTCHAState),{widgetId:i})}))}var I="https://content-firebaseappcheck.googleapis.com/v1beta",E=function(){function t(t,e,n,r,i){if(this.operation=t,this.retryPolicy=e,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}return t.prototype.start=function(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(function(){})},t.prototype.stop=function(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)},t.prototype.isRunning=function(){return!!this.pending},t.prototype.process=function(t){return o.__awaiter(this,void 0,void 0,function(){var e;return o.__generator(this,function(n){switch(n.label){case 0:this.stop(),n.label=1;case 1:return n.trys.push([1,6,,7]),this.pending=new a.Deferred,[4,(r=this.getNextRun(t),new Promise(function(t){setTimeout(t,r)}))];case 2:return n.sent(),this.pending.resolve(),[4,this.pending.promise];case 3:return n.sent(),this.pending=new a.Deferred,[4,this.operation()];case 4:return n.sent(),this.pending.resolve(),[4,this.pending.promise];case 5:return n.sent(),this.process(!0).catch(function(){}),[3,7];case 6:return e=n.sent(),this.retryPolicy(e)?this.process(!1).catch(function(){}):this.stop(),[3,7];case 7:return[2]}var r})})},t.prototype.getNextRun=function(t){if(t)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e},t}();function O(t,e){var n=t.url,r=t.body;return o.__awaiter(this,void 0,void 0,function(){var t,i,a,s,u,c,l,h,p,d;return o.__generator(this,function(o){switch(o.label){case 0:t={"Content-Type":"application/json"},(i=e.getImmediate({optional:!0}))&&(t["X-Firebase-Client"]=i.getPlatformInfoString()),a={method:"POST",body:JSON.stringify(r),headers:t},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(n,a)];case 2:return s=o.sent(),[3,4];case 3:throw u=o.sent(),f.create("fetch-network-error",{originalErrorMessage:u.message});case 4:if(200!==s.status)throw f.create("fetch-status-error",{httpStatus:s.status});o.label=5;case 5:return o.trys.push([5,7,,8]),[4,s.json()];case 6:return c=o.sent(),[3,8];case 7:throw l=o.sent(),f.create("fetch-parse-error",{originalErrorMessage:l.message});case 8:if(!(h=c.ttl.match(/^([\d.]+)(s)$/))||!h[2]||isNaN(Number(h[1])))throw f.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: "+c.ttl});return p=1e3*Number(h[1]),d=Date.now(),[2,{token:c.attestationToken,expireTimeMillis:d+p,issuedAtTimeMillis:d}]}})})}function S(t,e){var n=t.options;return{url:I+"/projects/"+n.projectId+"/apps/"+n.appId+":exchangeRecaptchaToken?key="+n.apiKey,body:{recaptcha_token:e}}}function k(t,e){var n=t.options;return{url:I+"/projects/"+n.projectId+"/apps/"+n.appId+":exchangeDebugToken?key="+n.apiKey,body:{debug_token:e}}}var A="firebase-app-check-store",j="debug-token",N=null;function C(){return N||(N=new Promise(function(t,e){try{var n=indexedDB.open("firebase-app-check-database",1);n.onsuccess=function(e){t(e.target.result)},n.onerror=function(t){var n;e(f.create("storage-open",{originalErrorMessage:null===(n=t.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(A,{keyPath:"compositeKey"})}}}catch(r){e(f.create("storage-open",{originalErrorMessage:r.message}))}}))}function D(t){return R(P(t))}function x(t,e){return o.__awaiter(this,void 0,void 0,function(){var n,r,i,a;return o.__generator(this,function(o){switch(o.label){case 0:return[4,C()];case 1:return n=o.sent(),r=n.transaction(A,"readwrite"),i=r.objectStore(A),a=i.put({compositeKey:t,value:e}),[2,new Promise(function(t,e){a.onsuccess=function(e){t()},r.onerror=function(t){var n;e(f.create("storage-set",{originalErrorMessage:null===(n=t.target.error)||void 0===n?void 0:n.message}))}})]}})})}function R(t){return o.__awaiter(this,void 0,void 0,function(){var e,n,r,i;return o.__generator(this,function(o){switch(o.label){case 0:return[4,C()];case 1:return e=o.sent(),n=e.transaction(A,"readonly"),r=n.objectStore(A),i=r.get(t),[2,new Promise(function(t,e){i.onsuccess=function(e){var n=e.target.result;t(n?n.value:void 0)},n.onerror=function(t){var n;e(f.create("storage-get",{originalErrorMessage:null===(n=t.target.error)||void 0===n?void 0:n.message}))}})]}})})}function P(t){return t.options.appId+"-"+t.name}var M=new s.Logger("@firebase/app-check");function L(t){return o.__awaiter(this,void 0,void 0,function(){var e,n;return o.__generator(this,function(r){switch(r.label){case 0:if(!a.isIndexedDBAvailable())return[3,5];e=void 0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,D(t)];case 2:return e=r.sent(),[3,4];case 3:return n=r.sent(),M.warn("Failed to read token from indexeddb. Error: "+n),[3,4];case 4:return[2,e];case 5:return[2,void 0]}})})}function F(t,e){return a.isIndexedDBAvailable()?function(t,e){return x(P(t),e)}(t,e).catch(function(t){M.warn("Failed to write token to indexeddb. Error: "+t)}):Promise.resolve()}function U(){return m().enabled}function q(){return o.__awaiter(this,void 0,void 0,function(){var t;return o.__generator(this,function(e){if((t=m()).enabled&&t.token)return[2,t.token.promise];throw Error("\n            Can't get debug token in production mode.\n        ")})})}var V={error:"UNKNOWN_ERROR"};function B(t,e,n){return void 0===n&&(n=!1),o.__awaiter(this,void 0,void 0,function(){var r,i,s,u,c,l,h,p,d,g,m,b,T;return o.__generator(this,function(I){switch(I.label){case 0:return _(t),U()?(r=O,i=k,s=[t],[4,q()]):[3,3];case 1:return[4,r.apply(void 0,[i.apply(void 0,s.concat([I.sent()])),e])];case 2:return[2,{token:I.sent().token}];case 3:return u=v(t),l=void 0,(c=u.token)?[3,5]:[4,L(t)];case 4:(h=I.sent())&&G(h)&&(c=h,y(t,o.__assign(o.__assign({},u),{token:c})),K(t,{token:c.token})),I.label=5;case 5:if(!n&&c&&G(c))return[2,{token:c.token}];I.label=6;case 6:return I.trys.push([6,12,,13]),u.customProvider?[4,u.customProvider.getToken()]:[3,8];case 7:return p=I.sent(),d=a.issuedAtTime(p.token),g=null!==d&&d<Date.now()&&d>0?1e3*d:Date.now(),c=o.__assign(o.__assign({},p),{issuedAtTimeMillis:g}),[3,11];case 8:return[4,w(t).catch(function(t){throw f.create("recaptcha-error")})];case 9:return m=I.sent(),[4,O(S(t,m),e)];case 10:c=I.sent(),I.label=11;case 11:return[3,13];case 12:return b=I.sent(),M.error(b),l=b,[3,13];case 13:return c?[3,14]:(T=function(t){return{token:(e=V,a.base64.encodeString(JSON.stringify(e),!1)),error:t};var e}(l),[3,16]);case 14:return T={token:c.token},y(t,o.__assign(o.__assign({},u),{token:c})),[4,F(t,c)];case 15:I.sent(),I.label=16;case 16:return K(t,T),[2,T]}})})}function K(t,e){for(var n=0,r=v(t).tokenListeners;n<r.length;n++){var i=r[n];try{i(e)}catch(o){}}}function G(t){return t.expireTimeMillis-Date.now()>0}var z="app-check-internal";!function(t){t.INTERNAL.registerComponent(new i.Component("appCheck",function(t){return e=t.getProvider("app").getImmediate(),{activate:function(t,n){return function(t,e,n){var r=v(t);if(r.activated)throw f.create("already-activated",{appName:t.name});var i=o.__assign(o.__assign({},r),{activated:!0});"string"==typeof e?i.siteKey=e:i.customProvider=e,i.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,y(t,i),i.siteKey&&function(t,e){var n=v(t),r=new a.Deferred;y(t,o.__assign(o.__assign({},n),{reCAPTCHAState:{initialized:r}}));var i="fire_app_check_"+t.name,s=document.createElement("div");s.id=i,s.style.display="none",document.body.appendChild(s);var u,c,l=b();return l?l.ready(function(){T(t,e,l,i),r.resolve(l)}):(u=function(){var n=b();if(!n)throw new Error("no recaptcha");n.ready(function(){T(t,e,n,i),r.resolve(n)})},(c=document.createElement("script")).src="https://www.google.com/recaptcha/api.js",c.onload=u,document.head.appendChild(c)),r.promise}(t,i.siteKey).catch(function(){})}(e,t,n)},setTokenAutoRefreshEnabled:function(t){return function(t,e){var n=v(t);n.tokenRefresher&&(!0===e?n.tokenRefresher.start():n.tokenRefresher.stop()),y(t,o.__assign(o.__assign({},n),{isTokenAutoRefreshEnabled:e}))}(e,t)}};var e},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(function(t,e,n){t.getProvider(z).initialize()})),t.INTERNAL.registerComponent(new i.Component(z,function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("platform-logger"),{getToken:function(t){return B(e,n,t)},addTokenListener:function(t){return function(t,e,n){var r=v(t),i=o.__assign(o.__assign({},r),{tokenListeners:o.__spreadArray(o.__spreadArray([],r.tokenListeners),[n])});if(U()){var a=m();a.enabled&&a.token&&a.token.promise.then(function(t){return n({token:t})}).catch(function(){})}else{if(!i.tokenRefresher){var s=function(t,e){var n=this;return new E(function(){return o.__awaiter(n,void 0,void 0,function(){var n;return o.__generator(this,function(r){switch(r.label){case 0:return v(t).token?[3,2]:[4,B(t,e)];case 1:return n=r.sent(),[3,4];case 2:return[4,B(t,e,!0)];case 3:n=r.sent(),r.label=4;case 4:if(n.error)throw n.error;return[2]}})})},function(){return!0},function(){var e=v(t);if(e.token){var n=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return n=Math.min(n,e.token.expireTimeMillis-3e5),Math.max(0,n-Date.now())}return 0},3e4,96e4)}(t,e);i.tokenRefresher=s}if(i.tokenRefresher.isRunning()||!0!==r.isTokenAutoRefreshEnabled||i.tokenRefresher.start(),r.token&&G(r.token)){var u=r.token;Promise.resolve().then(function(){return n({token:u.token})}).catch(function(){})}}y(t,i)}(e,n,t)},removeTokenListener:function(t){return function(t,e){var n=v(t),r=n.tokenListeners.filter(function(t){return t!==e});0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),y(t,o.__assign(o.__assign({},n),{tokenListeners:r}))}(e,t)}};var e,n},"PUBLIC").setInstantiationMode("EXPLICIT")),t.registerVersion("@firebase/app-check","0.1.1")}(l.default),function(){var t=a.getGlobal();if("string"==typeof t.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===t.FIREBASE_APPCHECK_DEBUG_TOKEN){var e=m();e.enabled=!0;var n=new a.Deferred;e.token=n,n.resolve("string"==typeof t.FIREBASE_APPCHECK_DEBUG_TOKEN?t.FIREBASE_APPCHECK_DEBUG_TOKEN:function(){return o.__awaiter(this,void 0,void 0,function(){var t,e;return o.__generator(this,function(n){switch(n.label){case 0:t=void 0,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,R(j)];case 2:return t=n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:return t?[2,t]:((r=e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),x(j,r)).catch(function(t){return M.warn("Failed to persist debug token to indexeddb. Error: "+t)}),console.log("AppCheck debug token: "+e+". You will need to whitelist it in the Firebase console for it to work"),[2,e])}var r})})}())}}()},nbvr:function(t,e,n){!function(t){"use strict";function e(t){return Array.prototype.slice.call(t)}function n(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function r(t,e,r){var i,o=new Promise(function(o,a){n(i=t[e].apply(t,r)).then(o,a)});return o.request=i,o}function i(t,e,n){var i=r(t,e,n);return i.then(function(t){if(t)return new l(t,i.request)})}function o(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function a(t,e,n,i){i.forEach(function(i){i in n.prototype&&(t.prototype[i]=function(){return r(this[e],i,arguments)})})}function s(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function u(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return i(this[e],r,arguments)})})}function c(t){this._index=t}function l(t,e){this._cursor=t,this._request=e}function h(t){this._store=t}function f(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function p(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new f(n)}function d(t){this._db=t}o(c,"_index",["name","keyPath","multiEntry","unique"]),a(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),u(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(l,"_cursor",["direction","key","primaryKey","value"]),a(l,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(l.prototype[t]=function(){var e=this,r=arguments;return Promise.resolve().then(function(){return e._cursor[t].apply(e._cursor,r),n(e._request).then(function(t){if(t)return new l(t,e._request)})})})}),h.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},h.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},o(h,"_store",["name","keyPath","indexNames","autoIncrement"]),a(h,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),u(h,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),s(h,"_store",IDBObjectStore,["deleteIndex"]),f.prototype.objectStore=function(){return new h(this._tx.objectStore.apply(this._tx,arguments))},o(f,"_tx",["objectStoreNames","mode"]),s(f,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new h(this._db.createObjectStore.apply(this._db,arguments))},o(p,"_db",["name","version","objectStoreNames"]),s(p,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new f(this._db.transaction.apply(this._db,arguments))},o(d,"_db",["name","version","objectStoreNames"]),s(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[h,c].forEach(function(n){t in n.prototype&&(n.prototype[t.replace("open","iterate")]=function(){var n=e(arguments),r=n[n.length-1],i=this._store||this._index,o=i[t].apply(i,n.slice(0,-1));o.onsuccess=function(){r(o.result)}})})}),[c,h].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(i){n.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)})})})}),t.openDb=function(t,e,n){var i=r(indexedDB,"open",[t,e]),o=i.request;return o&&(o.onupgradeneeded=function(t){n&&n(new p(o.result,t.oldVersion,o.transaction))}),i.then(function(t){return new d(t)})},t.deleteDb=function(t){return r(indexedDB,"deleteDatabase",[t])},Object.defineProperty(t,"__esModule",{value:!0})}(e)}}]);