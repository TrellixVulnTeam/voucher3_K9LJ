(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{JZFu:function(t,e,n){"use strict";n.d(e,"a",function(){return r.default});var r=n("zIRd"),i=(n("t6oF"),n("6Uf2"),n("mrSG")),o=n("qOnz"),s=n("q/0M"),a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function u(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var c,h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l=l||{},f=h||self;function p(){}function d(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function g(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var v="closure_uid_"+(1e9*Math.random()>>>0),y=0;function m(t,e,n){return t.call.apply(t.bind,arguments)}function b(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?m:b).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function T(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function I(){this.s=this.s,this.o=this.o}var E={};I.prototype.s=!1,I.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,v)&&t[v]||(t[v]=++y)}(this);delete E[t]}},I.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var O=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},S=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function k(t){return Array.prototype.concat.apply([],arguments)}function A(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function j(t){return/^[\s\xa0]*$/.test(t)}var C,N=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function D(t,e){return-1!=t.indexOf(e)}function x(t,e){return t<e?-1:t>e?1:0}t:{var R=f.navigator;if(R){var P=R.userAgent;if(P){C=P;break t}}C=""}function M(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function L(t){var e={};for(var n in t)e[n]=t[n];return e}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function U(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<F.length;o++)n=F[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function q(t){return q[" "](t),t}q[" "]=p;var V,B,K=D(C,"Opera"),G=D(C,"Trident")||D(C,"MSIE"),z=D(C,"Edge"),H=z||G,W=D(C,"Gecko")&&!(D(C.toLowerCase(),"webkit")&&!D(C,"Edge"))&&!(D(C,"Trident")||D(C,"MSIE"))&&!D(C,"Edge"),Q=D(C.toLowerCase(),"webkit")&&!D(C,"Edge");function $(){var t=f.document;return t?t.documentMode:void 0}t:{var X="",Y=(B=C,W?/rv:([^\);]+)(\)|;)/.exec(B):z?/Edge\/([\d\.]+)/.exec(B):G?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(B):Q?/WebKit\/(\S+)/.exec(B):K?/(?:Version)[ \/]?(\S+)/.exec(B):void 0);if(Y&&(X=Y?Y[1]:""),G){var J=$();if(null!=J&&J>parseFloat(X)){V=String(J);break t}}V=X}var Z={};var tt=f.document&&G&&($()||parseInt(V,10))||void 0,et=function(){if(!f.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{f.addEventListener("test",p,e),f.removeEventListener("test",p,e)}catch(n){}return t}();function nt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function rt(t,e){if(nt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(W){t:{try{q(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:it[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&rt.Z.h.call(this)}}nt.prototype.h=function(){this.defaultPrevented=!0},T(rt,nt);var it={2:"touch",3:"pen",4:"mouse"};rt.prototype.h=function(){rt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ot="closure_listenable_"+(1e6*Math.random()|0),st=0;function at(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++st,this.ca=this.fa=!1}function ut(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function ct(t){this.src=t,this.g={},this.h=0}function ht(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=O(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(ut(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function lt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}ct.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=lt(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new at(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var ft="closure_lm_"+(1e6*Math.random()|0),pt={};function dt(t,e,n,r,i){if(r&&r.once)return vt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)dt(t,e[o],n,r,i);return null}return n=It(n),t&&t[ot]?t.N(e,n,g(r)?!!r.capture:!!r,i):gt(t,e,n,!1,r,i)}function gt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=g(i)?!!i.capture:!!i,a=wt(t);if(a||(t[ft]=a=new ct(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=_t;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)et||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(bt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function vt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)vt(t,e[o],n,r,i);return null}return n=It(n),t&&t[ot]?t.O(e,n,g(r)?!!r.capture:!!r,i):gt(t,e,n,!0,r,i)}function yt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)yt(t,e[o],n,r,i);else r=g(r)?!!r.capture:!!r,n=It(n),t&&t[ot]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=lt(o=t.g[e],n,r,i))&&(ut(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=wt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=lt(e,n,r,i)),(n=-1<t?e[t]:null)&&mt(n))}function mt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[ot])ht(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(bt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=wt(e))?(ht(n,t),0==n.h&&(n.src=null,e[ft]=null)):ut(t)}}}function bt(t){return t in pt?pt[t]:pt[t]="on"+t}function _t(t,e){if(t.ca)t=!0;else{e=new rt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&mt(t),t=n.call(r,e)}return t}function wt(t){return(t=t[ft])instanceof ct?t:null}var Tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function It(t){return"function"==typeof t?t:(t[Tt]||(t[Tt]=function(e){return t.handleEvent(e)}),t[Tt])}function Et(){I.call(this),this.i=new ct(this),this.P=this,this.I=null}function Ot(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new nt(e,t);else if(e instanceof nt)e.target=e.target||t;else{var i=e;U(e=new nt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=St(s,r,!0,e)&&i}if(i=St(s=e.g=t,r,!0,e)&&i,i=St(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=St(s=e.g=n[o],r,!1,e)&&i}function St(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&ht(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}T(Et,I),Et.prototype[ot]=!0,Et.prototype.removeEventListener=function(t,e,n,r){yt(this,t,e,n,r)},Et.prototype.M=function(){if(Et.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)ut(n[r]);delete e.g[t],e.h--}}this.I=null},Et.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Et.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var kt=f.JSON.stringify;function At(){var t=Mt,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var jt,Ct=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Nt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Nt=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new Dt},function(t){return t.reset()}),Dt=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function xt(t){f.setTimeout(function(){throw t},0)}function Rt(t,e){jt||function(){var t=f.Promise.resolve(void 0);jt=function(){t.then(Lt)}}(),Pt||(jt(),Pt=!0),Mt.add(t,e)}var Pt=!1,Mt=new Ct;function Lt(){for(var t;t=At();){try{t.h.call(t.g)}catch(n){xt(n)}var e=Nt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Pt=!1}function Ft(t,e){Et.call(this),this.h=t||1,this.g=e||f,this.j=_(this.kb,this),this.l=Date.now()}function Ut(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function qt(t,e,n){if("function"==typeof t)n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:f.setTimeout(t,e||0)}function Vt(t){t.g=qt(function(){t.g=null,t.i&&(t.i=!1,Vt(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}T(Ft,Et),(c=Ft.prototype).da=!1,c.S=null,c.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ot(this,"tick"),this.da&&(Ut(this),this.start()))}},c.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},c.M=function(){Ft.Z.M.call(this),Ut(this),delete this.g};var Bt=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:Vt(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(f.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(I);function Kt(t){I.call(this),this.h=t,this.g={}}T(Kt,I);var Gt=[];function zt(t,e,n,r){Array.isArray(n)||(n&&(Gt[0]=n.toString()),n=Gt);for(var i=0;i<n.length;i++){var o=dt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function Ht(t){M(t.g,function(t,e){this.g.hasOwnProperty(e)&&mt(t)},t),t.g={}}function Wt(){this.g=!0}function Qt(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return kt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}Kt.prototype.M=function(){Kt.Z.M.call(this),Ht(this)},Kt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Wt.prototype.Aa=function(){this.g=!1},Wt.prototype.info=function(){};var $t={},Xt=null;function Yt(){return Xt=Xt||new Et}function Jt(t){nt.call(this,$t.Ma,t)}function Zt(t){var e=Yt();Ot(e,new Jt(e,t))}function te(t,e){nt.call(this,$t.STAT_EVENT,t),this.stat=e}function ee(t){var e=Yt();Ot(e,new te(e,t))}function ne(t,e){nt.call(this,$t.Na,t),this.size=e}function re(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return f.setTimeout(function(){t()},e)}$t.Ma="serverreachability",T(Jt,nt),$t.STAT_EVENT="statevent",T(te,nt),$t.Na="timingevent",T(ne,nt);var ie={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},oe={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function se(){}function ae(){}se.prototype.h=null;var ue,ce={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function he(){nt.call(this,"d")}function le(){nt.call(this,"c")}function fe(){}function pe(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Kt(this),this.P=ge,this.W=new Ft(t=H?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new de}function de(){this.i=null,this.g="",this.h=!1}T(he,nt),T(le,nt),T(fe,se),fe.prototype.g=function(){return new XMLHttpRequest},fe.prototype.i=function(){return{}},ue=new fe;var ge=45e3,ve={},ye={};function me(t,e,n){t.K=1,t.v=Ve(Pe(e)),t.s=n,t.U=!0,be(t,null)}function be(t,e){t.F=Date.now(),Ie(t),t.A=Pe(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),tn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new de,t.g=nr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Bt(_(t.Ia,t,t.g),t.O)),zt(t.V,t.g,"readystatechange",t.gb),e=t.H?L(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Zt(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function _e(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function we(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=Te(t,n))==ye){4==e&&(t.o=4,ee(14),i=!1),Qt(t.j,t.m,null,"[Incomplete Response]");break}if(r==ve){t.o=4,ee(15),Qt(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Qt(t.j,t.m,r,null),Ae(t,r)}_e(t)&&r!=ye&&r!=ve&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ee(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qn(e),e.L=!0,ee(11))):(Qt(t.j,t.m,n,"[Invalid Chunked Response]"),ke(t),Se(t))}function Te(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?ye:(n=Number(e.substring(n,r)),isNaN(n)?ve:(r+=1)+n>e.length?ye:(e=e.substr(r,n),t.C=r+n,e))}function Ie(t){t.Y=Date.now()+t.P,Ee(t,t.P)}function Ee(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=re(_(t.eb,t),e)}function Oe(t){t.B&&(f.clearTimeout(t.B),t.B=null)}function Se(t){0==t.l.G||t.I||Yn(t.l,t)}function ke(t){Oe(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Ut(t.W),Ht(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ae(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||un(n.i,t)))if(n.I=t.N,!t.J&&un(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Xn(n),Un(n)}Wn(n),ee(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=re(_(n.ab,n),6e3));if(1>=an(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Zn(n,11)}else if((t.J||n.g==t)&&Xn(n),!j(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(D(h,"spdy")||D(h,"quic")||D(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(cn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,qe(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var p=t;if((r=n).oa=er(r,r.H?r.la:null,r.W),p.J){hn(r.i,p);var d=p,g=r.K;g&&d.setTimeout(g),d.B&&(Oe(d),Ie(d)),r.g=p}else Hn(r);0<n.l.length&&Bn(n)}else"stop"!=o[0]&&"close"!=o[0]||Zn(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Zn(n,7):Fn(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}Zt(4)}catch(o){}}function je(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||"string"==typeof t)S(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(d(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(d(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ce(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ce)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ne(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];De(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)De(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function De(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(c=pe.prototype).setTimeout=function(t){this.P=t},c.gb=function(t){t=t.target;var e=this.L;e&&3==xn(t)?e.l():this.Ia(t)},c.Ia=function(t){try{if(t==this.g)t:{var e=xn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||H||this.g&&(this.h.h||this.g.ga()||Rn(this.g)))){this.I||4!=e||7==n||Zt(8==n||0>=r?3:2),Oe(this);var i=this.g.ba();this.N=i;e:if(_e(this)){var o=Rn(this.g);t="";var s=o.length,a=4==xn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ke(this),Se(this);var u="";break e}this.h.i=new f.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,ee(12),ke(this),Se(this);break t}Qt(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ae(this,i)}this.U?(we(this,e,u),H&&this.i&&3==e&&(zt(this.V,this.W,"tick",this.fb),this.W.start())):(Qt(this.j,this.m,u,null),Ae(this,u)),4==e&&ke(this),this.i&&!this.I&&(4==e?Yn(this.l,this):(this.i=!1,Ie(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,ee(12)):(this.o=0,ee(13)),ke(this),Se(this)}}}catch(e){}},c.fb=function(){if(this.g){var t=xn(this.g),e=this.g.ga();this.C<e.length&&(Oe(this),we(this,t,e),this.i&&4!=t&&Ie(this))}},c.cancel=function(){this.I=!0,ke(this)},c.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Zt(3),ee(17)),ke(this),this.o=2,Se(this)):Ee(this,this.Y-t)},(c=Ce.prototype).R=function(){Ne(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},c.T=function(){return Ne(this),this.g.concat()},c.get=function(t,e){return De(this.h,t)?this.h[t]:e},c.set=function(t,e){De(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},c.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var xe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Re(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Re){this.g=void 0!==e?e:t.g,Me(this,t.j),this.s=t.s,Le(this,t.i),Fe(this,t.m),this.l=t.l,e=t.h;var n=new Xe;n.i=e.i,e.g&&(n.g=new Ce(e.g),n.h=e.h),Ue(this,n),this.o=t.o}else t&&(n=String(t).match(xe))?(this.g=!!e,Me(this,n[1]||"",!0),this.s=Be(n[2]||""),Le(this,n[3]||"",!0),Fe(this,n[4]),this.l=Be(n[5]||"",!0),Ue(this,n[6]||"",!0),this.o=Be(n[7]||"")):(this.g=!!e,this.h=new Xe(null,this.g))}function Pe(t){return new Re(t)}function Me(t,e,n){t.j=n?Be(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Le(t,e,n){t.i=n?Be(e,!0):e}function Fe(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ue(t,e,n){e instanceof Xe?(t.h=e,function(t,e){e&&!t.j&&(Ye(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Je(this,e),tn(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=Ke(e,Qe)),t.h=new Xe(e,t.g))}function qe(t,e,n){t.h.set(e,n)}function Ve(t){return qe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Be(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ke(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ge),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ge(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Re.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ke(e,ze,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Ke(e,ze,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ke(n,"/"==n.charAt(0)?We:He,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Ke(n,$e)),t.join("")};var ze=/[#\/\?@]/g,He=/[#\?:]/g,We=/[#\?]/g,Qe=/[#\?@]/g,$e=/#/g;function Xe(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ye(t){t.g||(t.g=new Ce,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Je(t,e){Ye(t),e=en(t,e),De(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,De((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Ne(t)))}function Ze(t,e){return Ye(t),e=en(t,e),De(t.g.h,e)}function tn(t,e,n){Je(t,e),0<n.length&&(t.i=null,t.g.set(en(t,e),A(n)),t.h+=n.length)}function en(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(c=Xe.prototype).add=function(t,e){Ye(this),this.i=null,t=en(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},c.forEach=function(t,e){Ye(this),this.g.forEach(function(n,r){S(n,function(n){t.call(e,n,r,this)},this)},this)},c.T=function(){Ye(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},c.R=function(t){Ye(this);var e=[];if("string"==typeof t)Ze(this,t)&&(e=k(e,this.g.get(en(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=k(e,t[n])}return e},c.set=function(t,e){return Ye(this),this.i=null,Ze(this,t=en(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},c.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},c.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var nn=function(){return function(t,e){this.h=t,this.g=e}}();function rn(t){this.l=t||on,t=f.PerformanceNavigationTiming?0<(t=f.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(f.g&&f.g.Ea&&f.g.Ea()&&f.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var on=10;function sn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function an(t){return t.h?1:t.g?t.g.size:0}function un(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function cn(t,e){t.g?t.g.add(e):t.h=e}function hn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ln(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=u(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return A(t.i)}function fn(){}function pn(){this.g=new fn}function dn(t,e,n){var r=n||"";try{je(t,function(t,n){var i=t;g(t)&&(i=kt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(jp){throw e.push(r+"type="+encodeURIComponent("_badmap")),jp}}function gn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function vn(t){this.l=t.$b||null,this.j=t.ib||!1}function yn(t,e){Et.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=mn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}rn.prototype.cancel=function(){var t,e;if(this.i=ln(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=u(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},fn.prototype.stringify=function(t){return f.JSON.stringify(t,void 0)},fn.prototype.parse=function(t){return f.JSON.parse(t,void 0)},T(vn,se),vn.prototype.g=function(){return new yn(this.l,this.j)},vn.prototype.i=function(t){return function(){return t}}({}),T(yn,Et);var mn=0;function bn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function _n(t){t.readyState=4,t.l=null,t.j=null,t.A=null,wn(t)}function wn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(c=yn.prototype).open=function(t,e){if(this.readyState!=mn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,wn(this)},c.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||f).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},c.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,_n(this)),this.readyState=mn},c.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,wn(this)),this.g&&(this.readyState=3,wn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==f.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;bn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},c.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?_n(this):wn(this),3==this.readyState&&bn(this)}},c.Ua=function(t){this.g&&(this.response=this.responseText=t,_n(this))},c.Ta=function(t){this.g&&(this.response=t,_n(this))},c.ha=function(){this.g&&_n(this)},c.setRequestHeader=function(t,e){this.v.append(t,e)},c.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},c.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(yn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Tn=f.JSON.parse;function In(t){Et.call(this),this.headers=new Ce,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=En,this.K=this.L=!1}T(In,Et);var En="",On=/^https?$/i,Sn=["POST","PUT"];function kn(t){return"content-type"==t.toLowerCase()}function An(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,jn(t),Nn(t)}function jn(t){t.D||(t.D=!0,Ot(t,"complete"),Ot(t,"error"))}function Cn(t){if(t.h&&void 0!==l&&(!t.C[1]||4!=xn(t)||2!=t.ba()))if(t.v&&4==xn(t))qt(t.Fa,0,t);else if(Ot(t,"readystatechange"),4==xn(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(xe)[1]||null;if(!o&&f.self&&f.self.location){var s=f.self.location.protocol;o=s.substr(0,s.length-1)}i=!On.test(o?o.toLowerCase():"")}e=i}if(e)Ot(t,"complete"),Ot(t,"success");else{t.m=6;try{var a=2<xn(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",jn(t)}}finally{Nn(t)}}}function Nn(t,e){if(t.g){Dn(t);var n=t.g,r=t.C[0]?p:null;t.g=null,t.C=null,e||Ot(t,"ready");try{n.onreadystatechange=r}catch(jp){}}}function Dn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(f.clearTimeout(t.A),t.A=null)}function xn(t){return t.g?t.g.readyState:0}function Rn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case En:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Pn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return M(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):qe(t,e,n))}function Mn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ln(t){this.za=0,this.l=[],this.h=new Wt,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Mn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Mn("baseRetryDelayMs",5e3,t),this.$a=Mn("retryDelaySeedMs",1e4,t),this.Ya=Mn("forwardChannelMaxRetries",2,t),this.ra=Mn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new rn(t&&t.concurrentRequestLimit),this.Ca=new pn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Fn(t){if(qn(t),3==t.G){var e=t.V++,n=Pe(t.F);qe(n,"SID",t.J),qe(n,"RID",e),qe(n,"TYPE","terminate"),Gn(t,n),(e=new pe(t,t.h,e,void 0)).K=2,e.v=Ve(Pe(n)),n=!1,f.navigator&&f.navigator.sendBeacon&&(n=f.navigator.sendBeacon(e.v.toString(),"")),!n&&f.Image&&((new Image).src=e.v,n=!0),n||(e.g=nr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ie(e)}tr(t)}function Un(t){t.g&&(Qn(t),t.g.cancel(),t.g=null)}function qn(t){Un(t),t.u&&(f.clearTimeout(t.u),t.u=null),Xn(t),t.i.cancel(),t.m&&("number"==typeof t.m&&f.clearTimeout(t.m),t.m=null)}function Vn(t,e){t.l.push(new nn(t.Za++,e)),3==t.G&&Bn(t)}function Bn(t){sn(t.i)||t.m||(t.m=!0,Rt(t.Ha,t),t.C=0)}function Kn(t,e){var n;n=e?e.m:t.V++;var r=Pe(t.F);qe(r,"SID",t.J),qe(r,"RID",n),qe(r,"AID",t.U),Gn(t,r),t.o&&t.s&&Pn(r,t.o,t.s),n=new pe(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),cn(t.i,n),me(n,r,e)}function Gn(t,e){t.j&&je({},function(t,n){qe(e,n,t)})}function zn(t,e,n){n=Math.min(t.l.length,n);var r=t.j?_(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{dn(h,s,"req"+c+"_")}catch(Mr){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function Hn(t){t.g||t.u||(t.Y=1,Rt(t.Ga,t),t.A=0)}function Wn(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=re(_(t.Ga,t),Jn(t,t.A)),t.A++,0))}function Qn(t){null!=t.B&&(f.clearTimeout(t.B),t.B=null)}function $n(t){t.g=new pe(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Pe(t.oa);qe(e,"RID","rpc"),qe(e,"SID",t.J),qe(e,"CI",t.N?"0":"1"),qe(e,"AID",t.U),Gn(t,e),qe(e,"TYPE","xmlhttp"),t.o&&t.s&&Pn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Ve(Pe(e)),n.s=null,n.U=!0,be(n,t)}function Xn(t){null!=t.v&&(f.clearTimeout(t.v),t.v=null)}function Yn(t,e){var n=null;if(t.g==e){Xn(t),Qn(t),t.g=null;var r=2}else{if(!un(t.i,e))return;n=e.D,hn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Ot(r=Yt(),new ne(r,n,e,i)),Bn(t)}else Hn(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(an(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=re(_(t.Ha,t,e),Jn(t,t.C)),t.C++,0)))}(t,e)||2==r&&Wn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Zn(t,5);break;case 4:Zn(t,10);break;case 3:Zn(t,6);break;default:Zn(t,2)}}function Jn(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Zn(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=_(t.jb,t);n||(n=new Re("//www.google.com/images/cleardot.gif"),f.location&&"http"==f.location.protocol||Me(n,"https"),Ve(n)),function(t,e){var n=new Wt;if(f.Image){var r=new Image;r.onload=w(gn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=w(gn,n,r,"TestLoadImage: error",!1,e),r.onabort=w(gn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=w(gn,n,r,"TestLoadImage: timeout",!1,e),f.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ee(2);t.G=0,t.j&&t.j.va(e),tr(t),qn(t)}function tr(t){t.G=0,t.I=-1,t.j&&(0==ln(t.i).length&&0==t.l.length||(t.i.i.length=0,A(t.l),t.l.length=0),t.j.ua())}function er(t,e,n){var r=function(t){return t instanceof Re?Pe(t):new Re(t,void 0)}(n);if(""!=r.i)e&&Le(r,e+"."+r.i),Fe(r,r.m);else{var i=f.location;r=function(t,e,n,r){var i=new Re(null,void 0);return t&&Me(i,t),e&&Le(i,e),n&&Fe(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&M(t.aa,function(t,e){qe(r,e,t)}),n=t.sa,(e=t.D)&&n&&qe(r,e,n),qe(r,"VER",t.ma),Gn(t,r),r}function nr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new In(n&&t.Ba&&!t.qa?new vn({ib:!0}):t.qa)).L=t.H,e}function rr(){}function ir(){if(G&&!(10<=Number(tt)))throw Error("Environmental error: no available transport.")}function or(t,e){Et.call(this),this.g=new Ln(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!j(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!j(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new ur(this)}function sr(t){he.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function ar(){le.call(this),this.status=1}function ur(t){this.g=t}(c=In.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ue.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:ue),this.g.onreadystatechange=_(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void An(this,o)}t=n||"";var i=new Ce(this.headers);r&&je(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=kn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=f.FormData&&t instanceof f.FormData,!(0<=O(Sn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Dn(this),0<this.B&&((this.K=function(t){return G&&function(){return t=Z,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=N(String(V)).split("."),n=N("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=x(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||x(0==o[2].length,0==s[2].length)||x(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_(this.pa,this)):this.A=qt(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){An(this,o)}},c.pa=function(){void 0!==l&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ot(this,"timeout"),this.abort(8))},c.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ot(this,"complete"),Ot(this,"abort"),Nn(this))},c.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Nn(this,!0)),In.Z.M.call(this)},c.Fa=function(){this.s||(this.F||this.v||this.l?Cn(this):this.cb())},c.cb=function(){Cn(this)},c.ba=function(){try{return 2<xn(this)?this.g.status:-1}catch(B){return-1}},c.ga=function(){try{return this.g?this.g.responseText:""}catch(B){return""}},c.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Tn(e)}},c.Da=function(){return this.m},c.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(c=Ln.prototype).ma=8,c.G=1,c.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},c.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new pe(this,this.h,t,void 0),n=this.s;if(this.P&&(n?U(n=L(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=zn(this,e,r),qe(i=Pe(this.F),"RID",t),qe(i,"CVER",22),this.D&&qe(i,"X-HTTP-Session-Id",this.D),Gn(this,i),this.o&&n&&Pn(i,this.o,n),cn(this.i,e),this.Ra&&qe(i,"TYPE","init"),this.ja?(qe(i,"$req",r),qe(i,"SID","null"),e.$=!0,me(e,i,null)):me(e,i,r),this.G=2}}else 3==this.G&&(t?Kn(this,t):0==this.l.length||sn(this.i)||Kn(this))},c.Ga=function(){if(this.u=null,$n(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=re(_(this.bb,this),t)}},c.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ee(10),Un(this),$n(this))},c.ab=function(){null!=this.v&&(this.v=null,Un(this),Wn(this),ee(19))},c.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ee(2)):(this.h.info("Failed to ping google.com"),ee(1))},(c=rr.prototype).xa=function(){},c.wa=function(){},c.va=function(){},c.ua=function(){},c.Oa=function(){},ir.prototype.g=function(t,e){return new or(t,e)},T(or,Et),or.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Rt(_(t.hb,t,e))),ee(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=er(t,null,t.W),Bn(t)},or.prototype.close=function(){Fn(this.g)},or.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Vn(this.g,e)}else this.v?((e={}).__data__=kt(t),Vn(this.g,e)):Vn(this.g,t)},or.prototype.M=function(){this.g.j=null,delete this.j,Fn(this.g),delete this.g,or.Z.M.call(this)},T(sr,he),T(ar,le),T(ur,rr),ur.prototype.xa=function(){Ot(this.g,"a")},ur.prototype.wa=function(t){Ot(this.g,new sr(t))},ur.prototype.va=function(t){Ot(this.g,new ar(t))},ur.prototype.ua=function(){Ot(this.g,"b")},ir.prototype.createWebChannel=ir.prototype.g,or.prototype.send=or.prototype.u,or.prototype.open=or.prototype.m,or.prototype.close=or.prototype.close,ie.NO_ERROR=0,ie.TIMEOUT=8,ie.HTTP_ERROR=6,oe.COMPLETE="complete",ae.EventType=ce,ce.OPEN="a",ce.CLOSE="b",ce.ERROR="c",ce.MESSAGE="d",Et.prototype.listen=Et.prototype.N,In.prototype.listenOnce=In.prototype.O,In.prototype.getLastError=In.prototype.La,In.prototype.getLastErrorCode=In.prototype.Da,In.prototype.getStatus=In.prototype.ba,In.prototype.getResponseJson=In.prototype.Qa,In.prototype.getResponseText=In.prototype.ga,In.prototype.send=In.prototype.ea;var cr=ie,hr=oe,lr=$t,fr=vn,pr=ae,dr=In,gr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();gr.o=-1;var vr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},yr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(i.__extends)(e,t),e}(Error),mr=new s.Logger("@firebase/firestore");function br(){return mr.logLevel}function _r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(mr.logLevel<=s.LogLevel.DEBUG){var r=e.map(Ir);mr.debug.apply(mr,Object(i.__spreadArray)(["Firestore (8.7.0): "+t],r))}}function wr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(mr.logLevel<=s.LogLevel.ERROR){var r=e.map(Ir);mr.error.apply(mr,Object(i.__spreadArray)(["Firestore (8.7.0): "+t],r))}}function Tr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(mr.logLevel<=s.LogLevel.WARN){var r=e.map(Ir);mr.warn.apply(mr,Object(i.__spreadArray)(["Firestore (8.7.0): "+t],r))}}function Ir(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(jp){return t}}function Er(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.7.0) INTERNAL ASSERTION FAILED: "+t;throw wr(e),new Error(e)}function Or(t,e){t||Er()}function Sr(t,e){return t}function kr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Ar=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=kr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function jr(t,e){return t<e?-1:t>e?1:0}function Cr(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function Nr(t){return t+"\0"}var Dr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new yr(vr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new yr(vr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new yr(vr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new yr(vr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?jr(this.nanoseconds,t.nanoseconds):jr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),xr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Dr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Rr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Pr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Mr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Lr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Er(),void 0===n?n=t.length-e:n>t.length-e&&Er(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Fr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.__extends)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new yr(vr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Lr),Ur=/^[_a-zA-Z][_a-zA-Z0-9]*$/,qr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.__extends)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Ur.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new yr(vr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new yr(vr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new yr(vr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new yr(vr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Lr),Vr=function(){function t(t){this.fields=t,t.sort(qr.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Cr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),Br=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return jr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Br.EMPTY_BYTE_STRING=new Br("");var Kr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gr(t){if(Or(!!t),"string"==typeof t){var e=0,n=Kr.exec(t);if(Or(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:zr(t.seconds),nanos:zr(t.nanos)}}function zr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Hr(t){return"string"==typeof t?Br.fromBase64String(t):Br.fromUint8Array(t)}function Wr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Qr(t){var e=t.mapValue.fields.__previous_value__;return Wr(e)?Qr(e):e}function $r(t){var e=Gr(t.mapValue.fields.__local_write_time__.timestampValue);return new Dr(e.seconds,e.nanos)}function Xr(t){return null==t}function Yr(t){return 0===t&&1/t==-1/0}function Jr(t){return"number"==typeof t&&Number.isInteger(t)&&!Yr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Zr=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Fr.fromString(e))},t.fromName=function(e){return new t(Fr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Fr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Fr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Fr(e.slice()))},t}();function ti(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Wr(t)?4:10:Er()}function ei(t,e){var n=ti(t);if(n!==ti(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return $r(t).isEqual($r(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Gr(t.timestampValue),r=Gr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Hr(t.bytesValue).isEqual(Hr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return zr(t.geoPointValue.latitude)===zr(e.geoPointValue.latitude)&&zr(t.geoPointValue.longitude)===zr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return zr(t.integerValue)===zr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=zr(t.doubleValue),r=zr(e.doubleValue);return n===r?Yr(n)===Yr(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Cr(t.arrayValue.values||[],e.arrayValue.values||[],ei);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Rr(n)!==Rr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ei(n[i],r[i])))return!1;return!0}(t,e);default:return Er()}}function ni(t,e){return void 0!==(t.values||[]).find(function(t){return ei(t,e)})}function ri(t,e){var n=ti(t),r=ti(e);if(n!==r)return jr(n,r);switch(n){case 0:return 0;case 1:return jr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=zr(t.integerValue||t.doubleValue),r=zr(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ii(t.timestampValue,e.timestampValue);case 4:return ii($r(t),$r(e));case 5:return jr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Hr(t),r=Hr(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=jr(n[i],r[i]);if(0!==o)return o}return jr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=jr(zr(t.latitude),zr(e.latitude));return 0!==n?n:jr(zr(t.longitude),zr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ri(n[i],r[i]);if(o)return o}return jr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=jr(r[s],o[s]);if(0!==a)return a;var u=ri(n[r[s]],i[o[s]]);if(0!==u)return u}return jr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Er()}}function ii(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return jr(t,e);var n=Gr(t),r=Gr(e),i=jr(n.seconds,r.seconds);return 0!==i?i:jr(n.nanos,r.nanos)}function oi(t){return si(t)}function si(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Gr(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Hr(t.bytesValue).toBase64():"referenceValue"in t?Zr.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=si(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+si(t.fields[o])}return e+"}"}(t.mapValue):Er();var e}function ai(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function ui(t){return!!t&&"integerValue"in t}function ci(t){return!!t&&"arrayValue"in t}function hi(t){return!!t&&"nullValue"in t}function li(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function fi(t){return!!t&&"mapValue"in t}function pi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},Gr(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return Pr(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=pi(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=pi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var di=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!fi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=pi(e)},t.prototype.setAll=function(t){var e=this,n=qr.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=pi(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());fi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return ei(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];fi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Pr(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(pi(this.value))},t}();function gi(t){var e=[];return Pr(t.fields,function(t,n){var r=new qr([t]);if(fi(n)){var i=gi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new Vr(e)}var vi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,xr.min(),di.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,di.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,di.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=di.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=di.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),yi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function mi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new yi(t,e,n,r,i,o,s)}function bi(t){var e=Sr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+oi(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),Xr(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Di(e.startAt)),e.endAt&&(n+="|ub:",n+=Di(e.endAt)),e.h=n}return e.h}function _i(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ri(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!ei(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Mi(t.startAt,e.startAt)&&Mi(t.endAt,e.endAt)}function wi(t){return Zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ti=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(i.__extends)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Ii(t,n,r):"array-contains"===n?new ki(t,r):"in"===n?new Ai(t,r):"not-in"===n?new ji(t,r):"array-contains-any"===n?new Ci(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Ei(t,n):new Oi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(ri(e,this.value)):null!==e&&ti(this.value)===ti(e)&&this.m(ri(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Er()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Ii=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Zr.fromName(r.referenceValue),i}return Object(i.__extends)(e,t),e.prototype.matches=function(t){var e=Zr.comparator(t.key,this.key);return this.m(e)},e}(Ti),Ei=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Si(0,n),r}return Object(i.__extends)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Ti),Oi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Si(0,n),r}return Object(i.__extends)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Ti);function Si(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Zr.fromName(t.referenceValue)})}var ki=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(i.__extends)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return ci(e)&&ni(e.arrayValue,this.value)},e}(Ti),Ai=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(i.__extends)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&ni(this.value.arrayValue,e)},e}(Ti),ji=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(i.__extends)(e,t),e.prototype.matches=function(t){if(ni(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!ni(this.value.arrayValue,e)},e}(Ti),Ci=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(i.__extends)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!ci(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return ni(e.value.arrayValue,t)})},e}(Ti),Ni=function(t,e){this.position=t,this.before=e};function Di(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return oi(t)}).join(",")}var xi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ri(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Pi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Zr.comparator(Zr.fromName(s.referenceValue),n.key):ri(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Mi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ei(t.position[n],e.position[n]))return!1;return!0}var Li=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Fi(t,e,n,r,i,o,s,a){return new Li(t,e,n,r,i,o,s,a)}function Ui(t){return new Li(t)}function qi(t){return!Xr(t.limit)&&"F"===t.limitType}function Vi(t){return!Xr(t.limit)&&"L"===t.limitType}function Bi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Ki(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Gi(t){return null!==t.collectionGroup}function zi(t){var e=Sr(t);if(null===e.p){e.p=[];var n=Ki(e),r=Bi(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new xi(n)),e.p.push(new xi(qr.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new xi(qr.keyField(),u))}}}return e.p}function Hi(t){var e=Sr(t);if(!e.T)if("F"===e.limitType)e.T=mi(e.path,e.collectionGroup,zi(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=zi(e);r<i.length;r++){var o=i[r];n.push(new xi(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new Ni(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Ni(e.startAt.position,!e.startAt.before):null;e.T=mi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function Wi(t,e,n){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Qi(t,e){return _i(Hi(t),Hi(e))&&t.limitType===e.limitType}function $i(t){return bi(Hi(t))+"|lt:"+t.limitType}function Xi(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+oi(e.value);var e}).join(", ")+"]"),Xr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Di(t.startAt)),t.endAt&&(e+=", endAt: "+Di(t.endAt)),"Target("+e+")"}(Hi(t))+"; limitType="+t.limitType+")"}function Yi(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Zr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Pi(t.startAt,zi(t),e)||t.endAt&&Pi(t.endAt,zi(t),e))}(t,e)}function Ji(t){return function(e,n){for(var r=!1,i=0,o=zi(t);i<o.length;i++){var s=o[i],a=Zi(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Zi(t,e,n){var r=t.field.isKeyField()?Zr.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?ri(r,i):Er()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Er()}}function to(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yr(e)?"-0":e}}function eo(t){return{integerValue:""+t}}function no(t,e){return Jr(e)?eo(e):to(t,e)}var ro=function(){this._=void 0};function io(t,e,n){return t instanceof ao?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof uo?co(t,e):t instanceof ho?lo(t,e):function(t,e){var n=so(t,e),r=po(n)+po(t.A);return ui(n)&&ui(t.A)?eo(r):to(t.R,r)}(t,e)}function oo(t,e,n){return t instanceof uo?co(t,e):t instanceof ho?lo(t,e):n}function so(t,e){return t instanceof fo?ui(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var ao=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.__extends)(e,t),e}(ro),uo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(i.__extends)(e,t),e}(ro);function co(t,e){for(var n=go(e),r=function(t){n.some(function(e){return ei(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ho=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(i.__extends)(e,t),e}(ro);function lo(t,e){for(var n=go(e),r=function(t){n=n.filter(function(e){return!ei(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var fo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(i.__extends)(e,t),e}(ro);function po(t){return zr(t.integerValue||t.doubleValue)}function go(t){return ci(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var vo=function(t,e){this.field=t,this.transform=e},yo=function(t,e){this.version=t,this.transformResults=e},mo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function bo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var _o=function(){};function wo(t,e,n){t instanceof So?function(t,e,n){var r=t.value.clone(),i=jo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof ko?function(t,e,n){if(bo(t.precondition,e)){var r=jo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Ao(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function To(t,e,n){t instanceof So?function(t,e,n){if(bo(t.precondition,e)){var r=t.value.clone(),i=Co(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Oo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof ko?function(t,e,n){if(bo(t.precondition,e)){var r=Co(t.fieldTransforms,n,e),i=e.data;i.setAll(Ao(t)),i.setAll(r),e.convertToFoundDocument(Oo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){bo(t.precondition,e)&&e.convertToNoDocument(xr.min())}(t,e)}function Io(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=so(o.transform,s||null);null!=a&&(null==n&&(n=di.empty()),n.set(o.field,a))}return n||null}function Eo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Cr(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof uo&&e instanceof uo||t instanceof ho&&e instanceof ho?Cr(t.elements,e.elements,ei):t instanceof fo&&e instanceof fo?ei(t.A,e.A):t instanceof ao&&e instanceof ao}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Oo(t){return t.isFoundDocument()?t.version:xr.min()}var So=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(i.__extends)(e,t),e}(_o),ko=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(i.__extends)(e,t),e}(_o);function Ao(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function jo(t,e,n){var r=new Map;Or(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,oo(s,a,n[i]))}return r}function Co(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,io(a,u,e))}return r}var No,Do,xo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(i.__extends)(e,t),e}(_o),Ro=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(i.__extends)(e,t),e}(_o),Po=function(t){this.count=t};function Mo(t){switch(t){case vr.OK:return Er();case vr.CANCELLED:case vr.UNKNOWN:case vr.DEADLINE_EXCEEDED:case vr.RESOURCE_EXHAUSTED:case vr.INTERNAL:case vr.UNAVAILABLE:case vr.UNAUTHENTICATED:return!1;case vr.INVALID_ARGUMENT:case vr.NOT_FOUND:case vr.ALREADY_EXISTS:case vr.PERMISSION_DENIED:case vr.FAILED_PRECONDITION:case vr.ABORTED:case vr.OUT_OF_RANGE:case vr.UNIMPLEMENTED:case vr.DATA_LOSS:return!0;default:return Er()}}function Lo(t){if(void 0===t)return wr("GRPC error has no .code"),vr.UNKNOWN;switch(t){case No.OK:return vr.OK;case No.CANCELLED:return vr.CANCELLED;case No.UNKNOWN:return vr.UNKNOWN;case No.DEADLINE_EXCEEDED:return vr.DEADLINE_EXCEEDED;case No.RESOURCE_EXHAUSTED:return vr.RESOURCE_EXHAUSTED;case No.INTERNAL:return vr.INTERNAL;case No.UNAVAILABLE:return vr.UNAVAILABLE;case No.UNAUTHENTICATED:return vr.UNAUTHENTICATED;case No.INVALID_ARGUMENT:return vr.INVALID_ARGUMENT;case No.NOT_FOUND:return vr.NOT_FOUND;case No.ALREADY_EXISTS:return vr.ALREADY_EXISTS;case No.PERMISSION_DENIED:return vr.PERMISSION_DENIED;case No.FAILED_PRECONDITION:return vr.FAILED_PRECONDITION;case No.ABORTED:return vr.ABORTED;case No.OUT_OF_RANGE:return vr.OUT_OF_RANGE;case No.UNIMPLEMENTED:return vr.UNIMPLEMENTED;case No.DATA_LOSS:return vr.DATA_LOSS;default:return Er()}}(Do=No||(No={}))[Do.OK=0]="OK",Do[Do.CANCELLED=1]="CANCELLED",Do[Do.UNKNOWN=2]="UNKNOWN",Do[Do.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Do[Do.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Do[Do.NOT_FOUND=5]="NOT_FOUND",Do[Do.ALREADY_EXISTS=6]="ALREADY_EXISTS",Do[Do.PERMISSION_DENIED=7]="PERMISSION_DENIED",Do[Do.UNAUTHENTICATED=16]="UNAUTHENTICATED",Do[Do.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Do[Do.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Do[Do.ABORTED=10]="ABORTED",Do[Do.OUT_OF_RANGE=11]="OUT_OF_RANGE",Do[Do.UNIMPLEMENTED=12]="UNIMPLEMENTED",Do[Do.INTERNAL=13]="INTERNAL",Do[Do.UNAVAILABLE=14]="UNAVAILABLE",Do[Do.DATA_LOSS=15]="DATA_LOSS";var Fo=function(){function t(t,e){this.comparator=t,this.root=e||qo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,qo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Uo(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Uo(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Uo(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Uo(this.root,t,this.comparator,!0)},t}(),Uo=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),qo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Er();if(this.right.isRed())throw Er();var t=this.left.check();if(t!==this.right.check())throw Er();return t+(this.isRed()?0:1)},t}();qo.EMPTY=null,qo.RED=!0,qo.BLACK=!1,qo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Er()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Er()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Er()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Er()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Er()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new qo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Vo=function(){function t(t){this.comparator=t,this.data=new Fo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Bo(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Bo(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Bo=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Ko=new Fo(Zr.comparator);function Go(){return Ko}var zo=new Fo(Zr.comparator);function Ho(){return zo}var Wo=new Fo(Zr.comparator);function Qo(){return Wo}var $o=new Vo(Zr.comparator);function Xo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=$o,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Yo=new Vo(jr);function Jo(){return Yo}var Zo=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ts.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(xr.min(),r,Jo(),Go(),Xo())},t}(),ts=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Br.EMPTY_BYTE_STRING,n,Xo(),Xo(),Xo())},t}(),es=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ns=function(t,e){this.targetId=t,this.V=e},rs=function(t,e,n,r){void 0===n&&(n=Br.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},is=function(){function t(){this.S=0,this.D=as(),this.C=Br.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Xo(),e=Xo(),n=Xo();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Er()}}),new ts(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=as()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),os=function(){function t(t){this.W=t,this.G=new Map,this.H=Go(),this.J=ss(),this.Y=new Vo(jr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Er()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(wi(i))if(0===n){var o=new Zr(i.path);this.tt(e,o,vi.newNoDocument(o,xr.min()))}else Or(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&wi(o.target)){var s=new Zr(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,vi.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=Xo();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Zo(t,n,this.Y,this.H,r);return this.H=Go(),this.J=ss(),this.Y=new Vo(jr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new is,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Vo(jr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||_r("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new is),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function ss(){return new Fo(Zr.comparator)}function as(){return new Fo(Zr.comparator)}var us={asc:"ASCENDING",desc:"DESCENDING"},cs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hs=function(t,e){this.databaseId=t,this.I=e};function ls(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function fs(t,e){return t.I?e.toBase64():e.toUint8Array()}function ps(t,e){return ls(t,e.toTimestamp())}function ds(t){return Or(!!t),xr.fromTimestamp(function(t){var e=Gr(t);return new Dr(e.seconds,e.nanos)}(t))}function gs(t,e){return function(t){return new Fr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function vs(t){var e=Fr.fromString(t);return Or(qs(e)),e}function ys(t,e){return gs(t.databaseId,e.path)}function ms(t,e){var n=vs(e);if(n.get(1)!==t.databaseId.projectId)throw new yr(vr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new yr(vr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Zr(Ts(n))}function bs(t,e){return gs(t.databaseId,e)}function _s(t){var e=vs(t);return 4===e.length?Fr.emptyPath():Ts(e)}function ws(t){return new Fr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ts(t){return Or(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Is(t,e,n){return{name:ys(t,e),fields:n.value.mapValue.fields}}function Es(t,e,n){var r=ms(t,e.name),i=ds(e.updateTime),o=new di({mapValue:{fields:e.fields}}),s=vi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Os(t,e){var n;if(e instanceof So)n={update:Is(t,e.key,e.value)};else if(e instanceof xo)n={delete:ys(t,e.key)};else if(e instanceof ko)n={update:Is(t,e.key,e.data),updateMask:Us(e.fieldMask)};else{if(!(e instanceof Ro))return Er();n={verify:ys(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof ao)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof uo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ho)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof fo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Er()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ps(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Er()}(t,e.precondition)),n}function Ss(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?mo.updateTime(ds(t.updateTime)):void 0!==t.exists?mo.exists(t.exists):mo.none()}(e.currentDocument):mo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Or("REQUEST_TIME"===e.setToServerValue),n=new ao):"appendMissingElements"in e?n=new uo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new ho(e.removeAllFromArray.values||[]):"increment"in e?n=new fo(t,e.increment):Er();var r=qr.fromServerFormat(e.fieldPath);return new vo(r,n)}(t,e)}):[];if(e.update){var i=ms(t,e.update.name),o=new di({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new Vr((t.fieldPaths||[]).map(function(t){return qr.fromServerFormat(t)}))}(e.updateMask);return new ko(i,o,s,n,r)}return new So(i,o,n,r)}if(e.delete){var a=ms(t,e.delete);return new xo(a,n)}if(e.verify){var u=ms(t,e.verify);return new Ro(u,n)}return Er()}function ks(t,e){return{documents:[bs(t,e.path)]}}function As(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=bs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=bs(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(li(t.value))return{unaryFilter:{field:Ps(t.field),op:"IS_NAN"}};if(hi(t.value))return{unaryFilter:{field:Ps(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(li(t.value))return{unaryFilter:{field:Ps(t.field),op:"IS_NOT_NAN"}};if(hi(t.value))return{unaryFilter:{field:Ps(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ps(t.field),op:Rs(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Ps(t.field),direction:xs(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Xr(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Ns(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ns(e.endAt)),n}function js(t){var e=_s(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Or(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Cs(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new xi(Ms(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return Xr(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Ds(n.startAt));var h=null;return n.endAt&&(h=Ds(n.endAt)),Fi(e,i,a,s,u,"F",c,h)}function Cs(t){return t?void 0!==t.unaryFilter?[Fs(t)]:void 0!==t.fieldFilter?[Ls(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Cs(t)}).reduce(function(t,e){return t.concat(e)}):Er():[]}function Ns(t){return{before:t.before,values:t.position}}function Ds(t){return new Ni(t.values||[],!!t.before)}function xs(t){return us[t]}function Rs(t){return cs[t]}function Ps(t){return{fieldPath:t.canonicalString()}}function Ms(t){return qr.fromServerFormat(t.fieldPath)}function Ls(t){return Ti.create(Ms(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Er()}}(t.fieldFilter.op),t.fieldFilter.value)}function Fs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ms(t.unaryFilter.field);return Ti.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ms(t.unaryFilter.field);return Ti.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ms(t.unaryFilter.field);return Ti.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ms(t.unaryFilter.field);return Ti.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Er()}}function Us(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function qs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Vs(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Ks(e)),e=Bs(t.get(n),e);return Ks(e)}function Bs(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Ks(t){return t+"\x01\x01"}function Gs(t){var e=t.length;if(Or(e>=2),2===e)return Or("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Fr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Er(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Er()}o=s+2}return new Fr(r)}var zs=function(t,e){this.seconds=t,this.nanoseconds=e},Hs=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Hs.store="owner",Hs.key="owner";var Ws=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ws.store="mutationQueues",Ws.keyPath="userId";var Qs=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Qs.store="mutations",Qs.keyPath="batchId",Qs.userMutationsIndex="userMutationsIndex",Qs.userMutationsKeyPath=["userId","batchId"];var $s=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Vs(e)]},t.key=function(t,e,n){return[t,Vs(e),n]},t}();$s.store="documentMutations",$s.PLACEHOLDER=new $s;var Xs=function(t,e){this.path=t,this.readTime=e},Ys=function(t,e){this.path=t,this.version=e},Js=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Js.store="remoteDocuments",Js.readTimeIndex="readTimeIndex",Js.readTimeIndexPath="readTime",Js.collectionReadTimeIndex="collectionReadTimeIndex",Js.collectionReadTimeIndexPath=["parentPath","readTime"];var Zs=function(t){this.byteSize=t};Zs.store="remoteDocumentGlobal",Zs.key="remoteDocumentGlobalKey";var ta=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ta.store="targets",ta.keyPath="targetId",ta.queryTargetsIndexName="queryTargetsIndex",ta.queryTargetsKeyPath=["canonicalId","targetId"];var ea=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ea.store="targetDocuments",ea.keyPath=["targetId","path"],ea.documentTargetsIndex="documentTargetsIndex",ea.documentTargetsKeyPath=["path","targetId"];var na=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};na.key="targetGlobalKey",na.store="targetGlobal";var ra=function(t,e){this.collectionId=t,this.parent=e};ra.store="collectionParents",ra.keyPath=["collectionId","parent"];var ia=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ia.store="clientMetadata",ia.keyPath="clientId";var oa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};oa.store="bundles",oa.keyPath="bundleId";var sa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};sa.store="namedQueries",sa.keyPath="name";var aa=Object(i.__spreadArray)(Object(i.__spreadArray)([],Object(i.__spreadArray)(Object(i.__spreadArray)([],Object(i.__spreadArray)(Object(i.__spreadArray)([],Object(i.__spreadArray)(Object(i.__spreadArray)([],[Ws.store,Qs.store,$s.store,Js.store,ta.store,Hs.store,na.store,ea.store]),[ia.store])),[Zs.store])),[ra.store])),[oa.store,sa.store]),ua="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ca=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),ha=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},la=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Er(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),fa=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new ha,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new ga(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=_a(e.target.error);n.ft.reject(new ga(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new ga(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(_r("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ya(e)},t}(),pa=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(o.getUA)())&&wr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return _r("SimpleDb","Removing database:",t),ma(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(o.getUA)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(_r("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new ga(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new yr(vr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new ga(t,n))},i.onupgradeneeded=function(t){_r("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){_r("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(i.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c;return Object(i.__generator)(this,function(h){switch(h.label){case 0:o="readonly"===e,s=0,a=function(){var e,a,c,h,l;return Object(i.__generator)(this,function(i){switch(i.label){case 0:++s,i.label=1;case 1:return i.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=i.sent(),e=fa.open(u.db,t,o?"readonly":"readwrite",n),a=r(e).catch(function(t){return e.abort(t),la.reject(t)}).toPromise(),c={},a.catch(function(){}),[4,e.dt];case 3:return[2,(c.value=(i.sent(),a),c)];case 4:return _r("SimpleDb","Transaction failed with error:",(h=i.sent()).message,"Retrying:",l="FirebaseError"!==h.name&&s<3),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}})},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),da=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return ma(this.Pt.delete())},t}(),ga=function(t){function e(e,n){var r=this;return(r=t.call(this,vr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(i.__extends)(e,t),e}(yr);function va(t){return"IndexedDbTransactionError"===t.name}var ya=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(_r("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(_r("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ma(n)},t.prototype.add=function(t){return _r("SimpleDb","ADD",this.store.name,t,t),ma(this.store.add(t))},t.prototype.get=function(t){var e=this;return ma(this.store.get(t)).next(function(n){return void 0===n&&(n=null),_r("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return _r("SimpleDb","DELETE",this.store.name,t),ma(this.store.delete(t))},t.prototype.count=function(){return _r("SimpleDb","COUNT",this.store.name),ma(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){_r("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new la(function(n,r){e.onerror=function(t){var e=_a(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new la(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new da(i),s=e(i.primaryKey,i.value,o);if(s instanceof la){var a=s.catch(function(t){return o.done(),la.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return la.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ma(t){return new la(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=_a(t.target.error);n(e)}})}var ba=!1;function _a(t){var e=pa._t(Object(o.getUA)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new yr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ba||(ba=!0,setTimeout(function(){throw r},0)),r}}return t}var wa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(i.__extends)(e,t),e}(ca);function Ta(t,e){var n=Sr(t);return pa.It(n.Mt,e)}var Ia=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&wo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&To(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&To(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(xr.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Xo())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Cr(this.mutations,t.mutations,function(t,e){return Eo(t,e)})&&Cr(this.baseMutations,t.baseMutations,function(t,e){return Eo(t,e)})},t}(),Ea=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Or(e.mutations.length===r.length);for(var i=Qo(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Oa=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=xr.min()),void 0===o&&(o=xr.min()),void 0===s&&(s=Br.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Sa=function(t){this.Lt=t};function ka(t,e){if(e.document)return Es(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Zr.fromSegments(e.noDocument.path),r=Da(e.noDocument.readTime),i=vi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Zr.fromSegments(e.unknownDocument.path);return r=Da(e.unknownDocument.version),vi.newUnknownDocument(o,r)}return Er()}function Aa(t,e,n){var r=ja(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:ys(t,e.key),fields:e.data.value.mapValue.fields,updateTime:ls(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Js(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Na(e.version);return s=e.hasCommittedMutations,new Js(null,new Xs(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Na(e.version);return new Js(new Ys(c,h),null,null,!0,r,i)}return Er()}function ja(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ca(t){var e=new Dr(t[0],t[1]);return xr.fromTimestamp(e)}function Na(t){var e=t.toTimestamp();return new zs(e.seconds,e.nanoseconds)}function Da(t){var e=new Dr(t.seconds,t.nanoseconds);return xr.fromTimestamp(e)}function xa(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Ss(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Ss(t.Lt,e)}),o=Dr.fromMillis(e.localWriteTimeMs);return new Ia(e.batchId,o,n,i)}function Ra(t){var e,n,r=Da(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Da(t.lastLimboFreeSnapshotVersion):xr.min();return void 0!==t.query.documents?(Or(1===(n=t.query).documents.length),e=Hi(Ui(_s(n.documents[0])))):e=function(t){return Hi(js(t))}(t.query),new Oa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Br.fromBase64String(t.resumeToken))}function Pa(t,e){var n,r=Na(e.snapshotVersion),i=Na(e.lastLimboFreeSnapshotVersion);n=wi(e.target)?ks(t.Lt,e.target):As(t.Lt,e.target);var o=e.resumeToken.toBase64();return new ta(e.targetId,bi(e.target),r,o,e.sequenceNumber,i,n)}function Ma(t){var e=js({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Wi(e,e.limit,"L"):e}var La=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Fa(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Da(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return Fa(t).put({bundleId:(n=e).id,createTime:Na(ds(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Ua(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Ma(e.bundledQuery),readTime:Da(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return Ua(t).put(function(t){return{name:t.name,readTime:Na(ds(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Fa(t){return Ta(t,oa.store)}function Ua(t){return Ta(t,sa.store)}var qa=function(){function t(){this.Bt=new Va}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),la.resolve()},t.prototype.getCollectionParents=function(t,e){return la.resolve(this.Bt.getEntries(e))},t}(),Va=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Vo(Fr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Vo(Fr.comparator)).toArray()},t}(),Ba=function(){function t(){this.qt=new Va}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:Vs(i)};return Ka(t).put(o)}return la.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Nr(e),""],!1,!0);return Ka(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Gs(o.parent))}return n})},t}();function Ka(t){return Ta(t,ra.store)}var Ga={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},za=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Ha(t,e,n){var r=t.store(Qs.store),i=t.store($s.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Or(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=$s.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return la.waitFor(o).next(function(){return c})}function Wa(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Er();e=t.noDocument}return JSON.stringify(e).length}za.DEFAULT_COLLECTION_PERCENTILE=10,za.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,za.DEFAULT=new za(41943040,za.DEFAULT_COLLECTION_PERCENTILE,za.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),za.DISABLED=new za(-1,0,0);var Qa=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return Or(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xa(t).$t({index:Qs.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Ya(t),s=Xa(t);return s.add({}).next(function(a){Or("number"==typeof a);for(var u=new Ia(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Os(t.Lt,e)}),i=n.mutations.map(function(e){return Os(t.Lt,e)});return new Qs(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Vo(function(t,e){return jr(t.canonicalString(),e.canonicalString())}),f=0,p=r;f<p.length;f++){var d=p[f],g=$s.key(i.userId,d.key.path,a);l=l.add(d.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,$s.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),la.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Xa(t).get(e).next(function(t){return t?(Or(t.userId===n.userId),xa(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?la.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Xa(t).$t({index:Qs.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Or(e.batchId>=r),o=xa(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Xa(t).$t({index:Qs.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xa(t).Nt(Qs.userMutationsIndex,n).next(function(t){return t.map(function(t){return xa(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=$s.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Ya(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=Gs(r[1]);if(a===n.userId&&e.path.isEqual(c))return Xa(t).get(u).next(function(t){if(!t)throw Er();Or(t.userId===n.userId),o.push(xa(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Vo(jr),i=[];return e.forEach(function(e){var o=$s.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Ya(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=Gs(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),la.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=$s.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Vo(jr);return Ya(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=Gs(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Xa(t).get(e).next(function(t){if(null===t)throw Er();Or(t.userId===n.userId),r.push(xa(n.R,t))}))}),la.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Ha(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),la.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return la.resolve();var r=IDBKeyRange.lowerBound($s.prefixForUser(e.userId)),i=[];return Ya(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=Gs(t[1]);i.push(o)}else r.done()}).next(function(){Or(0===i.length)})})},t.prototype.containsKey=function(t,e){return $a(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Ja(t).get(this.userId).next(function(t){return t||new Ws(e.userId,-1,"")})},t}();function $a(t,e,n){var r=$s.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Ya(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function Xa(t){return Ta(t,Qs.store)}function Ya(t){return Ta(t,$s.store)}function Ja(t){return Ta(t,Ws.store)}var Za=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),tu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Za(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return xr.fromTimestamp(new Dr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return eu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Or(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return eu(t).$t(function(s,a){var u=Ra(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return la.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return eu(t).$t(function(t,n){var r=Ra(n);e(r)})},t.prototype.Xt=function(t){return nu(t).get(na.key).next(function(t){return Or(null!==t),t})},t.prototype.Zt=function(t,e){return nu(t).put(na.key,e)},t.prototype.te=function(t,e){return eu(t).put(Pa(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=bi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return eu(t).$t({range:r,index:ta.queryTargetsIndexName},function(t,n,r){var o=Ra(n);_i(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ru(t);return e.forEach(function(e){var s=Vs(e.path);i.push(o.put(new ea(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),la.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ru(t);return la.forEach(e,function(e){var o=Vs(e.path);return la.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ru(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ru(t),i=Xo();return r.$t({range:n,kt:!0},function(t,e,n){var r=Gs(t[1]),o=new Zr(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Vs(e.path),r=IDBKeyRange.bound([n],[Nr(n)],!1,!0),i=0;return ru(t).$t({index:ea.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return eu(t).get(e).next(function(t){return t?Ra(t):null})},t}();function eu(t){return Ta(t,ta.store)}function nu(t){return Ta(t,na.store)}function ru(t){return Ta(t,ea.store)}function iu(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){if(t.code!==vr.FAILED_PRECONDITION||t.message!==ua)throw t;return _r("LocalStore","Unexpectedly lost primary lease"),[2]})})}function ou(t,e){var n=t[1],r=e[1],i=jr(t[0],e[0]);return 0===i?jr(n,r):i}var su=function(){function t(t){this.ne=t,this.buffer=new Vo(ou),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ou(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),au=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;_r("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(i.__awaiter)(e,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return va(e=n.sent())?(_r("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,iu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),uu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return la.resolve(gr.o);var r=new su(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(_r("LruGarbageCollector","Garbage collection skipped; disabled"),la.resolve(Ga)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(_r("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Ga):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>h.params.maximumSequenceNumbersToCollect?(_r("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),h.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),h.removeTargets(t,n,e)}).next(function(e){return i=e,u=Date.now(),h.removeOrphanedDocuments(t,n)}).next(function(t){return c=Date.now(),br()<=s.LogLevel.DEBUG&&_r("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-l)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),la.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),cu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new uu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return hu(t,n)},t.prototype.removeReference=function(t,e,n){return hu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return hu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Ja(t).Ot(function(r){return $a(t,r,e).next(function(t){return t&&(n=!0),la.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),ru(t).delete([0,Vs(s.path)])})});i.push(u)}}).next(function(){return la.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return hu(t,e)},t.prototype.we=function(t,e){var n,r=ru(t),i=gr.o;return r.$t({index:ea.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==gr.o&&e(new Zr(Gs(n)),i),i=s,n=o):i=gr.o}).next(function(){i!==gr.o&&e(new Zr(Gs(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function hu(t,e){return ru(t).put(function(t,e){return new ea(0,Vs(t.path),e)}(e,t.currentSequenceNumber))}var lu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Pr(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return Mr(this.inner)},t}(),fu=function(){function t(){this.changes=new lu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:xr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:vi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?la.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),pu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return vu(t).put(yu(e),n)},t.prototype.removeEntry=function(t,e){var n=vu(t),r=yu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return vu(t).get(yu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return vu(t).get(yu(e)).next(function(t){return{document:n.ye(e,t),size:Wa(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=Go();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=Go(),i=new Fo(Zr.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Wa(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return la.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return vu(t).$t({range:r},function(t,e,r){for(var s=Zr.fromSegments(t);o&&Zr.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Go(),o=e.path.length+1,s={};if(n.isEqual(xr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=ja(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Js.collectionReadTimeIndex}return vu(t).$t(s,function(t,n,s){if(t.length===o){var a=ka(r.R,n);e.path.isPrefixOf(a.key.path)?Yi(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new du(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return gu(t).get(Zs.key).next(function(t){return Or(!!t),t})},t.prototype.me=function(t,e){return gu(t).put(Zs.key,e)},t.prototype.ye=function(t,e){if(e){var n=ka(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(xr.min()))return n}return vi.newInvalidDocument(t)},t}(),du=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new lu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(i.__extends)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Vo(function(t,e){return jr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Aa(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Wa(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Aa(e.Ie.R,vi.newNoDocument(o,xr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),la.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(fu);function gu(t){return Ta(t,Zs.store)}function vu(t){return Ta(t,Js.store)}function yu(t){return t.path.toArray()}var mu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Or(n<r&&n>=0&&r<=11);var o=new fa("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Hs.store)}(t),function(t){t.createObjectStore(Ws.store,{keyPath:Ws.keyPath}),t.createObjectStore(Qs.store,{keyPath:Qs.keyPath,autoIncrement:!0}).createIndex(Qs.userMutationsIndex,Qs.userMutationsKeyPath,{unique:!0}),t.createObjectStore($s.store)}(t),bu(t),function(t){t.createObjectStore(Js.store)}(t));var s=la.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ea.store),t.deleteObjectStore(ta.store),t.deleteObjectStore(na.store)}(t),bu(t)),s=s.next(function(){return function(t){var e=t.store(na.store),n=new na(0,0,xr.min().toTimestamp(),0);return e.put(na.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(Qs.store).Nt().next(function(n){t.deleteObjectStore(Qs.store),t.createObjectStore(Qs.store,{keyPath:Qs.keyPath,autoIncrement:!0}).createIndex(Qs.userMutationsIndex,Qs.userMutationsKeyPath,{unique:!0});var r=e.store(Qs.store),i=n.map(function(t){return r.put(t)});return la.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(ia.store,{keyPath:ia.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Zs.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Js.store);e.createIndex(Js.readTimeIndex,Js.readTimeIndexPath,{unique:!1}),e.createIndex(Js.collectionReadTimeIndex,Js.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(oa.store,{keyPath:oa.keyPath})}(t),function(t){t.createObjectStore(sa.store,{keyPath:sa.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(Js.store).$t(function(t,n){e+=Wa(n)}).next(function(){var n=new Zs(e);return t.store(Zs.store).put(Zs.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(Ws.store),r=t.store(Qs.store);return n.Nt().next(function(n){return la.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Qs.userMutationsIndex,i).next(function(r){return la.forEach(r,function(r){Or(r.userId===n.userId);var i=xa(e.R,r);return Ha(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(ea.store),n=t.store(Js.store);return t.store(na.store).get(na.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new Fr(n),s=function(t){return[0,Vs(t)]}(o);r.push(e.get(s).next(function(n){return n?la.resolve():function(n){return e.put(new ea(0,Vs(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return la.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(ra.store,{keyPath:ra.keyPath});var n=e.store(ra.store),r=new Va,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Vs(i)})}};return e.store(Js.store).$t({kt:!0},function(t,e){var n=new Fr(t);return i(n.popLast())}).next(function(){return e.store($s.store).$t({kt:!0},function(t,e){var n=Gs(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(ta.store);return n.$t(function(t,r){var i=Ra(r),o=Pa(e.R,i);return n.put(o)})},t}();function bu(t){t.createObjectStore(ea.store,{keyPath:ea.keyPath}).createIndex(ea.documentTargetsIndex,ea.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ta.store,{keyPath:ta.keyPath}).createIndex(ta.queryTargetsIndexName,ta.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(na.store)}var _u="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",wu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new yr(vr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new cu(this,i),this.Le=n+"main",this.R=new Sa(u),this.Be=new pa(this.Le,11,new mu(this.R)),this.qe=new tu(this.referenceDelegate,this.R),this.Ut=new Ba,this.Ue=function(t,e){return new pu(t,e)}(this.R,this.Ut),this.Ke=new La,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&wr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new yr(vr.FAILED_PRECONDITION,_u);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new gr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(i.__awaiter)(e,void 0,void 0,function(){return Object(i.__generator)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(i.__awaiter)(e,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(i.__awaiter)(e,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Iu(e).put(new ia(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(va(e))return _r("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return _r("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Tu(t).get(Hs.key).next(function(t){return la.resolve(e.tn(t))})},t.prototype.en=function(t){return Iu(t).delete(this.clientId)},t.prototype.nn=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Ta(t,ia.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return la.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?la.resolve(!0):Tu(t).get(Hs.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new yr(vr.FAILED_PRECONDITION,_u);return!1}}return!(!e.networkEnabled||!e.inForeground)||Iu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&_r("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t=this;return Object(i.__generator)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Hs.store,ia.store],function(e){var n=new wa(e,gr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Iu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Qa.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return _r("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",aa,function(o){return r=new wa(o,i.Ne?i.Ne.next():gr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw wr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new yr(vr.FAILED_PRECONDITION,ua);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Tu(t).get(Hs.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new yr(vr.FAILED_PRECONDITION,_u)})},t.prototype.Ze=function(t){var e=new Hs(this.clientId,this.allowTabSynchronization,Date.now());return Tu(t).put(Hs.key,e)},t.yt=function(){return pa.yt()},t.prototype.Xe=function(t){var e=this,n=Tu(t);return n.get(Hs.key).next(function(t){return e.tn(t)?(_r("IndexedDbPersistence","Releasing primary lease."),n.delete(Hs.key)):la.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(wr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return _r("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return wr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){wr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Tu(t){return Ta(t,Hs.store)}function Iu(t){return Ta(t,ia.store)}function Eu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Ou=function(t,e){this.progress=t,this.wn=e},Su=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Gi(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Zr(e)).next(function(t){var e=Ho();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Ho();return this.Ut.getCollectionParents(t,i).next(function(s){return la.forEach(s,function(s){var a=function(t,e){return new Li(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=vi.newInvalidDocument(c),r=r.insert(c,h)),To(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){Yi(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=Xo(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ko&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),ku=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Xo(),i=Xo(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Au=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(xr.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var a=i.Cn(e,o);return(qi(e)||Vi(e))&&i.Nn(e.limitType,a,r,n)?i.Dn(t,e):(br()<=s.LogLevel.DEBUG&&_r("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Xi(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return a.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new Vo(Ji(t));return e.forEach(function(e,r){Yi(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return br()<=s.LogLevel.DEBUG&&_r("QueryEngine","Using full collection scan to execute query:",Xi(e)),this.Sn.getDocumentsMatchingQuery(t,e,xr.min())},t}(),ju=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Fo(jr),this.kn=new lu(function(t){return bi(t)},_i),this.$n=xr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Su(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Cu(t,e,n,r){return new ju(t,e,n,r)}function Nu(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=Sr(t),r=n._n,o=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var i;return n._n.getAllMutationBatches(t).next(function(s){return i=s,r=n.persistence.getMutationQueue(e),o=new Su(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=Xo(),a=0,u=i;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,p=e;f<p.length;f++){var d=p[f];r.push(d.batchId);for(var g=0,v=d.mutations;g<v.length;g++)s=s.add(v[g].key)}return o.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return s=i.sent(),[2,(n._n=r,n.Mn=o,n.xn.Vn(n.Mn),s)]}})})}function Du(t,e){var n=Sr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=la.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Or(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function xu(t){var e=Sr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Ru(t,e){var n=Sr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Or(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=Go();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Pu(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(xr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return la.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function Pu(t,e,n,r,i){var o=Xo();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Go();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(xr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):_r("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function Mu(t,e){var n=Sr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Lu(t,e){var n=Sr(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?la.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new Oa(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function Fu(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:r=Sr(t),o=r.Fn.get(e),s=n?"readwrite":"readwrite-primary",i.label=1;case 1:return i.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",s,function(t){return r.persistence.referenceDelegate.removeTarget(t,o)})];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!va(a=i.sent()))throw a;return _r("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(o.target),[2]}})})}function Uu(t,e,n){var r=Sr(t),i=xr.min(),o=Xo();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=Sr(t),i=r.kn.get(n);return void 0!==i?la.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Hi(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:xr.min(),n?o:Xo())}).next(function(t){return{documents:t,Bn:o}})})}function qu(t,e){var n=Sr(t),r=Sr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function Vu(t){var e=Sr(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=Sr(t),i=Go(),o=ja(n),s=vu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Js.readTimeIndex,range:a},function(t,e){var n=ka(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Ca(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function Bu(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){return[2,(e=Sr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=vu(t),n=xr.min();return e.$t({index:Js.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Ca(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function Ku(t,e,n,r){return Object(i.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c,h,l,f,p,d;return Object(i.__generator)(this,function(i){switch(i.label){case 0:for(o=Sr(t),s=Xo(),a=Go(),u=Qo(),c=0,h=n;c<h.length;c++)f=e.qn((l=h[c]).metadata.name),l.document&&(s=s.add(f)),a=a.insert(f,e.Un(l)),u=u.insert(f,e.Kn(l.metadata.readTime));return p=o.On.newChangeBuffer({trackRemovals:!0}),[4,Lu(o,function(t){return Hi(Ui(Fr.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=i.sent(),[2,o.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Pu(t,p,a,xr.min(),u).next(function(e){return p.apply(t),e}).next(function(e){return o.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return o.qe.addMatchingKeys(t,s,d.targetId)}).next(function(){return o.Mn.En(t,e)}).next(function(){return e})})})]}})})}function Gu(t,e,n){return void 0===n&&(n=Xo()),Object(i.__awaiter)(this,void 0,void 0,function(){var r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Lu(t,Hi(Ma(e.bundledQuery)))];case 1:return r=i.sent(),[2,(o=Sr(t)).persistence.runTransaction("Save named query","readwrite",function(t){var i=ds(e.readTime);if(r.snapshotVersion.compareTo(i)>=0)return o.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(Br.EMPTY_BYTE_STRING,i);return o.Fn=o.Fn.insert(s.targetId,s),o.qe.updateTargetData(t,s).next(function(){return o.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return o.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return o.Ke.saveNamedQuery(t,e)})})]}})})}var zu=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return la.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:ds(n.createTime)}),la.resolve()},t.prototype.getNamedQuery=function(t,e){return la.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Ma(t.bundledQuery),readTime:ds(t.readTime)}}(e)),la.resolve()},t}(),Hu=function(){function t(){this.Wn=new Vo(Wu.Gn),this.zn=new Vo(Wu.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Wu(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new Wu(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Zr(new Fr([])),r=new Wu(n,t),i=new Wu(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Zr(new Fr([])),n=new Wu(e,t),r=new Wu(e,t+1),i=Xo();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Wu(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Wu=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Zr.comparator(t.key,e.key)||jr(t.ns,e.ns)},t.Hn=function(t,e){return jr(t.ns,e.ns)||Zr.comparator(t.key,e.key)},t}(),Qu=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Vo(Wu.Gn)}return t.prototype.checkEmpty=function(t){return la.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Ia(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Wu(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return la.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return la.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return la.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return la.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return la.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Wu(e,0),i=new Wu(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),la.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Vo(jr);return e.forEach(function(t){var e=new Wu(t,0),i=new Wu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),la.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Zr.isDocumentKey(i)||(i=i.child(""));var o=new Wu(new Zr(i),0),s=new Vo(jr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),la.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Or(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return la.forEach(e.mutations,function(i){var o=new Wu(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Wu(e,0),r=this.rs.firstAfterOrEqual(n);return la.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return la.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),$u=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Fo(Zr.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return la.resolve(n?n.document.clone():vi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Go();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():vi.newInvalidDocument(t))}),la.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Go(),i=new Zr(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||Yi(e,u)&&(r=r.insert(u.key,u.clone()))}return la.resolve(r)},t.prototype.fs=function(t,e){return la.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new Xu(this)},t.prototype.getSize=function(t){return la.resolve(this.size)},t}(),Xu=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(i.__extends)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),la.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(fu),Yu=function(){function t(t){this.persistence=t,this.ds=new lu(function(t){return bi(t)},_i),this.lastRemoteSnapshotVersion=xr.min(),this.highestTargetId=0,this.ws=0,this._s=new Hu,this.targetCount=0,this.ys=Za.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),la.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return la.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return la.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),la.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),la.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Za(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,la.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),la.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,la.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),la.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return la.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return la.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),la.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),la.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),la.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return la.resolve(n)},t.prototype.containsKey=function(t,e){return la.resolve(this._s.containsKey(e))},t}(),Ju=function(){function t(t,e){var n=this;this.gs={},this.Ne=new gr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Yu(this),this.Ut=new qa,this.Ue=function(t,e){return new $u(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Sa(e),this.Ke=new zu(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Qu(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;_r("MemoryPersistence","Starting transaction:",t);var i=new Zu(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return la.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Zu=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(i.__extends)(e,t),e}(ca),tc=function(){function t(t){this.persistence=t,this.As=new Hu,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Er()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),la.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),la.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),la.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return la.forEach(this.vs,function(r){var i=Zr.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return la.or([function(){return la.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),ec=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function nc(t,e){return"firestore_clients_"+t+"_"+e}function rc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function ic(t,e){return"firestore_targets_"+t+"_"+e}ec.UNAUTHENTICATED=new ec(null),ec.GOOGLE_CREDENTIALS=new ec("google-credentials-uid"),ec.FIRST_PARTY=new ec("first-party-uid");var oc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new yr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(wr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),sc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new yr(i.error.code,i.error.message)),o?new t(e,i.state,r):(wr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),ac=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Jo(),s=0;i&&s<r.activeTargetIds.length;++s)i=Jr(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(wr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),uc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(wr("SharedClientState","Failed to parse online state: "+e),null)},t}(),cc=function(){function t(){this.activeTargetIds=Jo()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),hc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Fo(jr),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=nc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new cc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r,o,s,a,u,c,h,l=this;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(o=this.getItem(nc(this.persistenceKey,r)))&&(s=ac.Vs(r,o))&&(this.ks=this.ks.insert(s.clientId,s));for(this.Qs(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.$s;c<h.length;c++)this.Fs(h[c]);return this.$s=[],this.window.addEventListener("pagehide",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(ic(this.persistenceKey,t));if(n){var r=sc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(ic(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return _r("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){_r("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){_r("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(_r("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void wr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(i.__awaiter)(e,void 0,void 0,function(){var t,e,r,o,s,a;return Object(i.__generator)(this,function(i){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(o=this.ri(n.key,n.newValue)))return[2,this.oi(o)]}else if(n.key===this.Us){if(null!==n.newValue&&(s=this.js(n.newValue)))return[2,this.Ws(s)]}else if(n.key===this.Ms)(a=function(t){var e=gr.o;if(null!=t)try{var n=JSON.parse(t);Or("number"==typeof n),e=n}catch(t){wr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==gr.o&&this.sequenceNumberHandler(a);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new oc(this.currentUser,t,e,n),i=rc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=rc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=ic(this.persistenceKey,t),i=new sc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return ac.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return oc.Vs(new ec(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return sc.Vs(r,e)},t.prototype.js=function(t){return uc.Vs(t)},t.prototype.ii=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(_r("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Jo();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),lc=function(){function t(){this.li=new cc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new cc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),fc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),pc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){_r("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){_r("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),dc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},gc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),vc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(i.__extends)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new dr;s.listenOnce(hr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case cr.NO_ERROR:var e=s.getResponseJson();_r("Connection","XHR received:",JSON.stringify(e)),i(e);break;case cr.TIMEOUT:_r("Connection",'RPC "'+t+'" timed out'),o(new yr(vr.DEADLINE_EXCEEDED,"Request time out"));break;case cr.HTTP_ERROR:var n=s.getStatus();if(_r("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(vr).indexOf(e)>=0?e:vr.UNKNOWN}(r.status);o(new yr(a,r.message))}else o(new yr(vr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new yr(vr.UNAVAILABLE,"Connection failed."));break;default:Er()}}finally{_r("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new ir,i=Yt(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new fr({})),this.Fi(s.initMessageHeaders,e),Object(o.isMobileCordova)()||Object(o.isReactNative)()||Object(o.isElectron)()||Object(o.isIE)()||Object(o.isUWP)()||Object(o.isBrowserExtension)()||(s.httpHeadersOverwriteParam="$httpHeaders");var a=n.join("");_r("Connection","Creating WebChannel: "+a,s);var u=r.createWebChannel(a,s),c=!1,h=!1,l=new gc({Ei:function(t){h?_r("Connection","Not sending because WebChannel is closed:",t):(c||(_r("Connection","Opening WebChannel transport."),u.open(),c=!0),_r("Connection","WebChannel sending:",t),u.send(t))},Ti:function(){return u.close()}}),f=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return f(u,pr.EventType.OPEN,function(){h||_r("Connection","WebChannel transport opened.")}),f(u,pr.EventType.CLOSE,function(){h||(h=!0,_r("Connection","WebChannel transport closed"),l.Vi())}),f(u,pr.EventType.ERROR,function(t){h||(h=!0,Tr("Connection","WebChannel transport errored:",t),l.Vi(new yr(vr.UNAVAILABLE,"The operation could not be completed")))}),f(u,pr.EventType.MESSAGE,function(t){var e;if(!h){var n=t.data[0];Or(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){_r("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=No[t];if(void 0!==e)return Lo(e)}(i),s=r.message;void 0===o&&(o=vr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),h=!0,l.Vi(new yr(o,s)),u.close()}else _r("Connection","WebChannel received:",n),l.Si(n)}}),f(i,lr.STAT_EVENT,function(t){10===t.stat?_r("Connection","Detected buffering proxy"):11===t.stat&&_r("Connection","Detected no buffering proxy")}),setTimeout(function(){l.Pi()},0),l},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);_r("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return _r("RestConnection","Received: ",t),t},function(e){throw Tr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.7.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+dc[t]},t}());function yc(){return"undefined"!=typeof window?window:null}function mc(){return"undefined"!=typeof document?document:null}function bc(t){return new hs(t,!0)}var _c=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&_r("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),wc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new _c(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===vr.RESOURCE_EXHAUSTED?(wr(e.toString()),wr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===vr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new yr(vr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(i.__awaiter)(t,void 0,void 0,function(){return Object(i.__generator)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return _r("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(_r("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Tc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(i.__extends)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Er()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Or(void 0===e||"string"==typeof e),Br.fromBase64String(e||"")):(Or(void 0===e||e instanceof Uint8Array),Br.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?vr.UNKNOWN:Lo(t.code);return new yr(e,t.message||"")}(a);n=new rs(r,i,o,s||null)}else if("documentChange"in e){i=ms(t,(r=e.documentChange).document.name),o=ds(r.document.updateTime);var a=new di({mapValue:{fields:r.document.fields}}),u=(s=vi.newFoundDocument(i,o,a),r.targetIds||[]);n=new es(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=ms(t,(r=e.documentDelete).document),o=r.readTime?ds(r.readTime):xr.min(),a=vi.newNoDocument(i,o),n=new es([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=ms(t,(r=e.documentRemove).document),n=new es([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Er();var c=e.filter;i=new Po(r=c.count||0),n=new ns(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return xr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?xr.min():e.readTime?ds(e.readTime):xr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=ws(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=wi(r)?{documents:ks(t,r)}:{query:As(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=fs(t,e.resumeToken):e.snapshotVersion.compareTo(xr.min())>0&&(n.readTime=ls(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Er()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=ws(this.R),e.removeTarget=t,this.cr(e)},e}(wc),Ic=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(i.__extends)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Or(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Or(void 0!==e),t.map(function(t){return function(t,e){var n=ds(t.updateTime?t.updateTime:e);return n.isEqual(xr.min())&&(n=ds(e)),new yo(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=ds(t.commitTime);return this.listener.Tr(n,e)}return Or(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=ws(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Os(e.R,t)})};this.cr(n)},e}(wc),Ec=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(i.__extends)(e,t),e.prototype.br=function(){if(this.Rr)throw new yr(vr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===vr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new yr(vr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===vr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new yr(vr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),Oc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(wr(e),this.Vr=!1):_r("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Sc=function(t,e,n,r,o){var s=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=o,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(i.__awaiter)(s,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return Pc(this)?(_r("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return(e=Sr(t)).Or.add(4),[4,Ac(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,kc(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Oc(n,r)};function kc(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:if(!Pc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Ac(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function jc(t,e){var n=Sr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Rc(n)?xc(n):Xc(n).er()&&Nc(n,e))}function Cc(t,e){var n=Sr(t),r=Xc(n);n.$r.delete(e),r.er()&&Dc(n,e),0===n.$r.size&&(r.er()?r.ir():Pc(n)&&n.Br.set("Unknown"))}function Nc(t,e){t.qr.U(e.targetId),Xc(t).mr(e)}function Dc(t,e){t.qr.U(e),Xc(t).yr(e)}function xc(t){t.qr=new os({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Xc(t).start(),t.Br.Sr()}function Rc(t){return Pc(t)&&!Xc(t).tr()&&t.$r.size>0}function Pc(t){return 0===Sr(t).Or.size}function Mc(t){t.qr=void 0}function Lc(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){return t.$r.forEach(function(e,n){Nc(t,e)}),[2]})})}function Fc(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(n){return Mc(t),Rc(t)?(t.Br.Nr(e),xc(t)):t.Br.set("Unknown"),[2]})})}function Uc(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s;return Object(i.__generator)(this,function(a){switch(a.label){case 0:if(t.Br.set("Online"),!(e instanceof rs&&2===e.state&&e.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:n=e.cause,r=0,o=e.targetIds,i.label=1;case 1:return r<o.length?t.$r.has(s=o[r])?[4,t.remoteSyncer.rejectListen(s,n)]:[3,3]:[3,5];case 2:i.sent(),t.$r.delete(s),t.qr.removeTarget(s),i.label=3;case 3:i.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return a.sent(),[3,5];case 3:return r=a.sent(),_r("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,qc(t,r)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof es?t.qr.X(e):e instanceof ns?t.qr.rt(e):t.qr.et(e),n.isEqual(xr.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,xu(t.localStore)];case 8:return o=a.sent(),n.compareTo(o)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(Br.EMPTY_BYTE_STRING,n.snapshotVersion)),Dc(t,e);var r=new Oa(n.target,e,1,n.sequenceNumber);Nc(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return _r("RemoteStore","Failed to raise snapshot:",s=a.sent()),[4,qc(t,s)];case 12:return a.sent(),[3,13];case 13:return[2]}})})}function qc(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r=this;return Object(i.__generator)(this,function(o){switch(o.label){case 0:if(!va(e))throw e;return t.Or.add(1),[4,Ac(t)];case 1:return o.sent(),t.Br.set("Offline"),n||(n=function(){return xu(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(i.__awaiter)(r,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return _r("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,kc(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function Vc(t,e){return e().catch(function(n){return qc(t,n,e)})}function Bc(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:e=Sr(t),n=Yc(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,i.label=1;case 1:if(!function(t){return Pc(t)&&t.kr.length<10}(e))return[3,7];i.label=2;case 2:return i.trys.push([2,4,,6]),[4,Mu(e.localStore,r)];case 3:return null===(o=i.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=o.batchId,function(t,e){t.kr.push(e);var n=Yc(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,o),[3,6]);case 4:return s=i.sent(),[4,qc(e,s)];case 5:return i.sent(),[3,6];case 6:return[3,1];case 7:return Kc(e)&&Gc(e),[2]}})})}function Kc(t){return Pc(t)&&!Yc(t).tr()&&t.kr.length>0}function Gc(t){Yc(t).start()}function zc(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){return Yc(t).Ar(),[2]})})}function Hc(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(i.__generator)(this,function(i){for(e=Yc(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function Wc(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return r=t.kr.shift(),o=Ea.from(r,e,n),[4,Vc(t,function(){return t.remoteSyncer.applySuccessfulWrite(o)})];case 1:return i.sent(),[4,Bc(t)];case 2:return i.sent(),[2]}})})}function Qc(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(n){switch(n.label){case 0:return e&&Yc(t).pr?[4,function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return Mo(r=e.code)&&r!==vr.ABORTED?(n=t.kr.shift(),Yc(t).sr(),[4,Vc(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,Bc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Kc(t)&&Gc(t),[2]}})})}function $c(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return n=Sr(t),e?(n.Or.delete(2),[4,kc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Ac(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function Xc(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Sr(t);return r.br(),new Tc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Lc.bind(null,t),Ri:Fc.bind(null,t),_r:Uc.bind(null,t)}),t.Mr.push(function(n){return Object(i.__awaiter)(e,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Rc(t)?xc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Mc(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Yc(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Sr(t);return r.br(),new Ic(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:zc.bind(null,t),Ri:Qc.bind(null,t),Ir:Hc.bind(null,t),Tr:Wc.bind(null,t)}),t.Mr.push(function(n){return Object(i.__awaiter)(e,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Bc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(_r("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var Jc=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ha,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new yr(vr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Zc(t,e){if(wr("AsyncQueue",e+": "+t),va(t))return new yr(vr.UNAVAILABLE,e+": "+t);throw t}var th=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Zr.comparator(e.key,n.key)}:function(t,e){return Zr.comparator(t.key,e.key)},this.keyedMap=Ho(),this.sortedSet=new Fo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),eh=function(){function t(){this.Qr=new Fo(Zr.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Er():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),nh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,th.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Qi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),rh=function(){this.Wr=void 0,this.listeners=[]},ih=function(){this.queries=new lu(function(t){return $i(t)},Qi),this.onlineState="Unknown",this.Gr=new Set};function oh(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a,u,c;return Object(i.__generator)(this,function(i){switch(i.label){case 0:if(n=Sr(t),o=!1,(s=n.queries.get(r=e.query))||(o=!0,s=new rh),!o)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),a=s,[4,n.onListen(r)];case 2:return a.Wr=i.sent(),[3,4];case 3:return u=i.sent(),c=Zc(u,"Initialization of query '"+Xi(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,s),s.listeners.push(e),e.zr(n.onlineState),s.Wr&&e.Hr(s.Wr)&&ch(n),[2]}})})}function sh(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a;return Object(i.__generator)(this,function(i){return n=Sr(t),o=!1,(s=n.queries.get(r=e.query))&&(a=s.listeners.indexOf(e))>=0&&(s.listeners.splice(a,1),o=0===s.listeners.length),o?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function ah(t,e){for(var n=Sr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&ch(n)}function uh(t,e,n){var r=Sr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function ch(t){t.Gr.forEach(function(t){t.next()})}var hh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new nh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=nh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),lh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),fh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return ms(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Es(this.R,t.document,!1):vi.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return ds(t)},t}(),ph=function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=dh(t)}return t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new fh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Xo()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Ku(this.localStore,new fh(this.R),this.documents,this.ro.id)];case 1:t=i.sent(),e=this.co(this.documents),n=0,r=this.queries,i.label=2;case 2:return n<r.length?[4,Gu(this.localStore,o=r[n],e.get(o.name))]:[3,5];case 3:i.sent(),i.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Ou(Object.assign({},this.progress),t))]}})})},t}();function dh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var gh=function(t){this.key=t},vh=function(t){this.key=t},yh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Xo(),this.mutatedKeys=Xo(),this.lo=Ji(t),this.fo=new th(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new eh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=qi(this.query)&&i.size===this.query.limit?i.last():null,c=Vi(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=Yi(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),p=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data.isEqual(l.data)?f!==p&&(r.track({type:3,doc:l}),d=!0):n.yo(h,l)||(r.track({type:2,doc:l}),d=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),d=!0):h&&!l&&(r.track({type:1,doc:h}),d=!0,(u||c)&&(a=!0)),d&&(l?(s=s.add(l),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),qi(this.query)||Vi(this.query))for(;s.size>this.query.limit;){var h=qi(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Er()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new nh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new eh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Xo(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new vh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new gh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Xo();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return nh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),mh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},bh=function(t){this.key=t,this.bo=!1},_h=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new lu(function(t){return $i(t)},Qi),this.Vo=new Map,this.So=new Set,this.Do=new Fo(Zr.comparator),this.Co=new Map,this.No=new Hu,this.xo={},this.Fo=new Map,this.ko=Za.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function wh(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=Xh(t),(o=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.view.Ro(),[3,4]):[3,1];case 1:return[4,Lu(n.localStore,Hi(e))];case 2:return s=i.sent(),a=n.sharedClientState.addLocalQueryTarget(s.targetId),[4,Th(n,e,s.targetId,"current"===a)];case 3:r=i.sent(),n.isPrimaryClient&&jc(n.remoteStore,s),i.label=4;case 4:return[2,r]}})})}function Th(t,e,n,r){return Object(i.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c,h;return Object(i.__generator)(this,function(l){switch(l.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(i.__awaiter)(this,void 0,void 0,function(){var o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return(o=e.view._o(n)).Nn?[4,Uu(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,o)})]:[3,2];case 1:o=i.sent(),i.label=2;case 2:return s=r&&r.targetChanges.get(e.targetId),a=e.view.applyChanges(o,t.isPrimaryClient,s),[2,(Ph(t,e.targetId,a.To),a.snapshot)]}})})}(t,e,n,r)},[4,Uu(t.localStore,e,!0)];case 1:return o=l.sent(),s=new yh(e,o.Bn),a=s._o(o.documents),u=ts.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=s.applyChanges(a,t.isPrimaryClient,u),Ph(t,n,c.To),h=new mh(e,n,s),[2,(t.Po.set(e,h),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),c.snapshot)]}})})}function Ih(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=Sr(t),r=n.Po.get(e),(o=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,o.filter(function(t){return!Qi(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Fu(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Cc(n.remoteStore,r.targetId),xh(n,r.targetId)}).catch(iu)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return xh(n,r.targetId),[4,Fu(n.localStore,r.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}})})}function Eh(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:r=Yh(t),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,function(t,e){var n,r=Sr(t),i=Dr.now(),o=e.reduce(function(t,e){return t.add(e.key)},Xo());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Io(c,n.get(c.key));null!=h&&s.push(new ko(c.key,h,gi(h.value.mapValue),mo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return o=i.sent(),r.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Fo(jr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,o.batchId,n),[4,Fh(r,o.changes)];case 3:return i.sent(),[4,Bc(r.remoteStore)];case 4:return i.sent(),[3,6];case 5:return s=i.sent(),a=Zc(s,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}})})}function Oh(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:n=Sr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Ru(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Or(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Or(r.bo):t.removedDocuments.size>0&&(Or(r.bo),r.bo=!1))}),[4,Fh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,iu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Sh(t,e,n){var r=Sr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=Sr(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&ch(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function kh(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a,u,c;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return(r=Sr(t)).sharedClientState.updateQueryState(e,"rejected",n),o=r.Co.get(e),(s=o&&o.key)?(a=(a=new Fo(Zr.comparator)).insert(s,vi.newNoDocument(s,xr.min())),u=Xo().add(s),c=new Zo(xr.min(),new Map,new Vo(jr),a,u),[4,Oh(r,c)]):[3,2];case 1:return i.sent(),r.Do=r.Do.remove(s),r.Co.delete(e),Lh(r),[3,4];case 2:return[4,Fu(r.localStore,e,!1).then(function(){return xh(r,e,n)}).catch(iu)];case 3:i.sent(),i.label=4;case 4:return[2]}})})}function Ah(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:n=Sr(t),r=e.batch.batchId,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Du(n.localStore,e)];case 2:return o=i.sent(),Dh(n,r,null),Nh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Fh(n,o)];case 3:return i.sent(),[3,6];case 4:return[4,iu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function jh(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:r=Sr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,function(t,e){var n=Sr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Or(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return o=i.sent(),Dh(r,e,n),Nh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Fh(r,o)];case 3:return i.sent(),[3,6];case 4:return[4,iu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Ch(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:Pc((n=Sr(t)).remoteStore)||_r("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,function(t){var e=Sr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=i.sent())?[2,void e.resolve()]:((o=n.Fo.get(r)||[]).push(e),n.Fo.set(r,o),[3,4]);case 3:return s=i.sent(),a=Zc(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}})})}function Nh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Dh(t,e,n){var r=Sr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function xh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||Rh(t,e)})}function Rh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Cc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Lh(t))}function Ph(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof gh?(t.No.addReference(o.key,e),Mh(t,o)):o instanceof vh?(_r("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Rh(t,o.key)):Er()}}function Mh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(_r("SyncEngine","New document in limbo: "+n),t.So.add(r),Lh(t))}function Lh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Zr(Fr.fromString(e)),r=t.ko.next();t.Co.set(r,new bh(n)),t.Do=t.Do.insert(n,r),jc(t.remoteStore,new Oa(Hi(Ui(n.path)),r,2,gr.o))}}function Fh(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a;return Object(i.__generator)(this,function(u){switch(u.label){case 0:return r=Sr(t),o=[],s=[],a=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,i){a.push(r.Oo(i,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(i.targetId,t.fromCache?"not-current":"current"),o.push(t);var e=ku.Pn(i.targetId,t);s.push(e)}}))}),[4,Promise.all(a)]);case 1:return u.sent(),r.vo._r(o),[4,function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a,u,c,h;return Object(i.__generator)(this,function(i){switch(i.label){case 0:n=Sr(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return la.forEach(e,function(e){return la.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return la.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return i.sent(),[3,4];case 3:if(!va(r=i.sent()))throw r;return _r("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(o=0,s=e;o<s.length;o++)u=(a=s[o]).targetId,a.fromCache||(c=n.Fn.get(u),h=c.withLastLimboFreeSnapshotVersion(c.snapshotVersion),n.Fn=n.Fn.insert(u,h));return[2]}})})}(r.localStore,s)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}function Uh(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return(n=Sr(t)).currentUser.isEqual(e)?[3,3]:(_r("SyncEngine","User change. New user:",e.toKey()),[4,Nu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new yr(vr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Fh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function qh(t,e){var n=Sr(t),r=n.Co.get(e);if(r&&r.bo)return Xo().add(r.key);var i=Xo(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function Vh(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Uu((n=Sr(t)).localStore,e.query,!0)];case 1:return r=i.sent(),o=e.view.Ao(r),[2,(n.isPrimaryClient&&Ph(n,e.targetId,o.To),o)]}})})}function Bh(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){return[2,Vu((e=Sr(t)).localStore).then(function(t){return Fh(e,t)})]})})}function Kh(t,e,n,r){return Object(i.__awaiter)(this,void 0,void 0,function(){var o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,function(t,e){var n=Sr(t),r=Sr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):la.resolve(null)})})}((o=Sr(t)).localStore,e)];case 1:return null===(s=i.sent())?[3,6]:"pending"!==n?[3,3]:[4,Bc(o.remoteStore)];case 2:return i.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Dh(o,e,r||null),Nh(o,e),function(t,e){Sr(Sr(t)._n).Gt(e)}(o.localStore,e)):Er(),i.label=4;case 4:return[4,Fh(o,s)];case 5:return i.sent(),[3,7];case 6:_r("SyncEngine","Cannot apply mutation batch with id: "+e),i.label=7;case 7:return[2]}})})}function Gh(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a,u,c;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return Xh(n=Sr(t)),Yh(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,zh(n,r.toArray())]);case 1:return o=i.sent(),n.$o=!0,[4,$c(n.remoteStore,!0)];case 2:for(i.sent(),s=0,a=o;s<a.length;s++)jc(n.remoteStore,a[s]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(u=[],c=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?u.push(e):c=c.then(function(){return xh(n,e),Fu(n.localStore,e,!0)}),Cc(n.remoteStore,e)}),[4,c]);case 4:return i.sent(),[4,zh(n,u)];case 5:return i.sent(),function(t){var e=Sr(t);e.Co.forEach(function(t,n){Cc(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Fo(Zr.comparator)}(n),n.$o=!1,[4,$c(n.remoteStore,!1)];case 6:i.sent(),i.label=7;case 7:return[2]}})})}function zh(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a,u,c,h,l,f,p,d,g;return Object(i.__generator)(this,function(i){switch(i.label){case 0:n=Sr(t),r=[],o=[],s=0,a=e,i.label=1;case 1:return s<a.length?(c=void 0,(h=n.Vo.get(u=a[s]))&&0!==h.length?[4,Lu(n.localStore,Hi(h[0]))]:[3,7]):[3,13];case 2:c=i.sent(),l=0,f=h,i.label=3;case 3:return l<f.length?(p=n.Po.get(f[l]),[4,Vh(n,p)]):[3,6];case 4:(d=i.sent()).snapshot&&o.push(d.snapshot),i.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,qu(n.localStore,u)];case 8:return g=i.sent(),[4,Lu(n.localStore,g)];case 9:return c=i.sent(),[4,Th(n,Hh(g),u,!1)];case 10:i.sent(),i.label=11;case 11:r.push(c),i.label=12;case 12:return s++,[3,1];case 13:return[2,(n.vo._r(o),r)]}})})}function Hh(t){return Fi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Wh(t){var e=Sr(t);return Sr(Sr(e.localStore).persistence).fn()}function Qh(t,e,n,r){return Object(i.__awaiter)(this,void 0,void 0,function(){var o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return(o=Sr(t)).$o?(_r("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Vu(o.localStore)];case 3:return s=i.sent(),a=Zo.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Fh(o,s,a)];case 4:return i.sent(),[3,8];case 5:return[4,Fu(o.localStore,e,!0)];case 6:return i.sent(),xh(o,e,r),[3,8];case 7:Er(),i.label=8;case 8:return[2]}})})}function $h(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a,u,c,h,l,f;return Object(i.__generator)(this,function(p){switch(p.label){case 0:if(!(r=Xh(t)).$o)return[3,10];o=0,s=e,p.label=1;case 1:return o<s.length?r.Vo.has(a=s[o])?(_r("SyncEngine","Adding an already active target "+a),[3,5]):[4,qu(r.localStore,a)]:[3,6];case 2:return u=p.sent(),[4,Lu(r.localStore,u)];case 3:return c=p.sent(),[4,Th(r,Hh(u),c.targetId,!1)];case 4:p.sent(),jc(r.remoteStore,c),p.label=5;case 5:return o++,[3,1];case 6:h=function(t){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Fu(r.localStore,t,!1).then(function(){Cc(r.remoteStore,t),xh(r,t)}).catch(iu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},l=0,f=n,p.label=7;case 7:return l<f.length?[5,h(f[l])]:[3,10];case 8:p.sent(),p.label=9;case 9:return l++,[3,7];case 10:return[2]}})})}function Xh(t){var e=Sr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Oh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=qh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kh.bind(null,e),e.vo._r=ah.bind(null,e.eventManager),e.vo.Mo=uh.bind(null,e.eventManager),e}function Yh(t){var e=Sr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ah.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jh.bind(null,e),e}function Jh(t,e,n){var r=Sr(t);(function(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a,u,c;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,14,,15]),[4,e.getMetadata()];case 1:return r=i.sent(),[4,function(t,e){var n=Sr(t),r=ds(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",function(t){return n.Ke.getBundleMetadata(t,e.id)}).then(function(t){return!!t&&t.createTime.compareTo(r)>=0})}(t.localStore,r)];case 2:return i.sent()?[4,e.close()]:[3,4];case 3:return[2,(i.sent(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r)))];case 4:return n._updateProgress(dh(r)),o=new ph(r,t.localStore,e.R),[4,e.Lo()];case 5:s=i.sent(),i.label=6;case 6:return s?[4,o.oo(s)]:[3,10];case 7:return(a=i.sent())&&n._updateProgress(a),[4,e.Lo()];case 8:s=i.sent(),i.label=9;case 9:return[3,6];case 10:return[4,o.complete()];case 11:return u=i.sent(),[4,Fh(t,u.wn,void 0)];case 12:return i.sent(),[4,function(t,e){var n=Sr(t);return n.persistence.runTransaction("Save bundle","readwrite",function(t){return n.Ke.saveBundleMetadata(t,e)})}(t.localStore,r)];case 13:return i.sent(),n._completeWith(u.progress),[3,15];case 14:return Tr("SyncEngine","Loading bundle failed with "+(c=i.sent())),n._failWith(c),[3,15];case 15:return[2]}})})})(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var Zh=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return this.R=bc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return Cu(this.persistence,new Au,t.initialUser,this.R)},t.prototype.qo=function(t){return new Ju(tc.bs,this.R)},t.prototype.Bo=function(t){return new lc},t.prototype.terminate=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),tl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(i.__extends)(e,t),e.prototype.initialize=function(e){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Bu(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,e)];case 3:return n.sent(),[4,Yh(this.Qo.syncEngine)];case 4:return n.sent(),[4,Bc(this.Qo.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Ko=function(t){return Cu(this.persistence,new Au,t.initialUser,this.R)},e.prototype.Uo=function(t){return new au(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Eu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?za.withCacheSize(this.cacheSizeBytes):za.DEFAULT;return new wu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,yc(),mc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new lc},e}(Zh),el=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(i.__extends)(e,t),e.prototype.initialize=function(e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r=this;return Object(i.__generator)(this,function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return o.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof hc?(this.sharedClientState.syncEngine={ui:Kh.bind(null,n),ai:Qh.bind(null,n),hi:$h.bind(null,n),fn:Wh.bind(null,n),ci:Bh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He(function(t){return Object(i.__awaiter)(r,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return[4,Gh(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},e.prototype.Bo=function(t){var e=yc();if(!hc.yt(e))throw new yr(vr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Eu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new hc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(tl),nl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n=this;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Sh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Uh.bind(null,this.syncEngine),[4,$c(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new ih},t.prototype.createDatastore=function(t){var e=bc(t.databaseInfo.databaseId),n=new vc(t.databaseInfo);return function(t,e,n){return new Ec(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Sh(s.syncEngine,t,0)},o=pc.yt()?new pc:new fc,new Sc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new _h(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return e=Sr(t),_r("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Ac(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}();function rl(t,e){void 0===e&&(e=10240);var n=0;return{read:function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var r;return Object(i.__generator)(this,function(i){return n<t.byteLength?(r={value:t.slice(n,n+e),done:!1},[2,(n+=e,r)]):[2,{done:!0}]})})},cancel:function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var il=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),ol=function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new ha,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}return t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new lh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})},t}(),sl=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(i.__generator)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new yr(vr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a,u;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=Sr(t),r=ws(n.R)+"/documents",o={documents:e.map(function(t){return ys(n.R,t)})},[4,n.$i("BatchGetDocuments",r,o)];case 1:return s=i.sent(),a=new Map,s.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Or(!!e.found);var n=ms(t,e.found.name),r=ds(e.found.updateTime),i=new di({mapValue:{fields:e.found.fields}});return vi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Or(!!e.missing),Or(!!e.readTime);var n=ms(t,e.missing),r=ds(e.readTime);return vi.newNoDocument(n,r)}(t,e):Er()}(n.R,t);a.set(e.key.toString(),e)}),u=[],[2,(e.forEach(function(t){var e=a.get(t.toString());Or(!!e),u.push(e)}),u)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new xo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e=this;return Object(i.__generator)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Zr.fromPath(n);e.mutations.push(new Ro(r,e.precondition(r)))}),[4,function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=Sr(t),r=ws(n.R)+"/documents",o={writes:e.map(function(t){return Os(n.R,t)})},[4,n.Ni("Commit",r,o)];case 1:return i.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Er();e=xr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new yr(vr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?mo.updateTime(e):mo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(xr.min()))throw new yr(vr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return mo.updateTime(e)}return mo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),al=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new _c(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(i.__awaiter)(t,void 0,void 0,function(){var t,e,n=this;return Object(i.__generator)(this,function(r){return t=new sl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Xr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Mo(e)}return!1},t}(),ul=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=ec.UNAUTHENTICATED,this.clientId=Ar.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(i.__awaiter)(r,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return _r("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new yr(vr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new ha;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(i.__awaiter)(t,void 0,void 0,function(){var t,n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Zc(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function cl(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o=this;return Object(i.__generator)(this,function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),_r("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=s.sent(),[4,e.initialize(n)];case 2:return s.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(i.__awaiter)(o,void 0,void 0,function(){return Object(i.__generator)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Nu(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function hl(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,ll(t)];case 1:return n=o.sent(),_r("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=o.sent(),[4,e.initialize(n,r)];case 3:return o.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return(n=Sr(t)).asyncQueue.verifyOperationInProgress(),_r("RemoteStore","RemoteStore received new credentials"),r=Pc(n),n.Or.add(3),[4,Ac(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,kc(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function ll(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(_r("FirestoreClient","Using default OfflineComponentProvider"),[4,cl(t,new Zh)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function fl(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(_r("FirestoreClient","Using default OnlineComponentProvider"),[4,hl(t,new nl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function pl(t){return ll(t).then(function(t){return t.persistence})}function dl(t){return ll(t).then(function(t){return t.localStore})}function gl(t){return fl(t).then(function(t){return t.remoteStore})}function vl(t){return fl(t).then(function(t){return t.syncEngine})}function yl(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,fl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=wh.bind(null,e.syncEngine),n.onUnlisten=Ih.bind(null,e.syncEngine),n)]}})})}function ml(t,e,n){var r=this;void 0===n&&(n={});var o=new ha;return t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(r,void 0,void 0,function(){var r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new il({next:function(o){e.enqueueAndForget(function(){return sh(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new yr(vr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new yr(vr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new hh(Ui(n.path),o,{includeMetadataChanges:!0,so:!0});return oh(t,s)},[4,yl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,o])]}})})}),o.promise}function bl(t,e,n){var r=this;void 0===n&&(n={});var o=new ha;return t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(r,void 0,void 0,function(){var r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new il({next:function(n){e.enqueueAndForget(function(){return sh(t,s)}),n.fromCache&&"server"===r.source?i.reject(new yr(vr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new hh(n,o,{includeMetadataChanges:!0,so:!0});return oh(t,s)},[4,yl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,o])]}})})}),o.promise}var _l=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},wl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Tl=new Map,Il=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},El=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(ec.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Ol=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Sl=function(){function t(t){var e=this;this.currentUser=ec.UNAUTHENTICATED,this.oc=new ha,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){_r("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(_r("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(_r("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Or("string"==typeof n.accessToken),new Il(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(i.__awaiter)(n,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Or(null===t||"string"==typeof t),new ec(t)},t}(),kl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=ec.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Al=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new kl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(ec.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function jl(t,e,n){if(!n)throw new yr(vr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Cl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new yr(vr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Nl(t,e,n,r){if(!0===e&&!0===r)throw new yr(vr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Dl(t){if(!Zr.isDocumentKey(t))throw new yr(vr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function xl(t){if(Zr.isDocumentKey(t))throw new yr(vr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Rl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Er()}function Pl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new yr(vr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Rl(t);throw new yr(vr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Ml(t,e){if(e<=0)throw new yr(vr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Ll=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new yr(vr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new yr(vr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Nl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Fl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ll({}),this._settingsFrozen=!1,t instanceof wl?(this._databaseId=t,this._credentials=new El):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new yr(vr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wl(t.options.projectId)}(t),this._credentials=new Sl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new yr(vr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new yr(vr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ll(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new El;switch(t.type){case"gapi":var e=t.client;return Or(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Al(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new yr(vr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Tl.get(this))&&(_r("ComponentProvider","Removing Datastore"),Tl.delete(this),t.terminate()),Promise.resolve();var t},t}(),Ul=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Vl(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),ql=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Vl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Ui(r))||this)._path=r,i.type="collection",i}return Object(i.__extends)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Ul(this.firestore,null,new Zr(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(ql);function Bl(t,e){for(var n,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];if(t=Object(o.getModularInstance)(t),jl("collection","path",e),t instanceof Fl)return xl(n=Fr.fromString.apply(Fr,Object(i.__spreadArray)([e],r))),new Vl(t,null,n);if(!(t instanceof Ul||t instanceof Vl))throw new yr(vr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return xl(n=Fr.fromString.apply(Fr,Object(i.__spreadArray)([t.path],r)).child(Fr.fromString(e))),new Vl(t.firestore,null,n)}function Kl(t,e){for(var n,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];if(t=Object(o.getModularInstance)(t),1===arguments.length&&(e=Ar.u()),jl("doc","path",e),t instanceof Fl)return Dl(n=Fr.fromString.apply(Fr,Object(i.__spreadArray)([e],r))),new Ul(t,null,new Zr(n));if(!(t instanceof Ul||t instanceof Vl))throw new yr(vr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Dl(n=t._path.child(Fr.fromString.apply(Fr,Object(i.__spreadArray)([e],r)))),new Ul(t.firestore,t instanceof Vl?t.converter:null,new Zr(n))}function Gl(t,e){return t=Object(o.getModularInstance)(t),e=Object(o.getModularInstance)(e),(t instanceof Ul||t instanceof Vl)&&(e instanceof Ul||e instanceof Vl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function zl(t,e){return t=Object(o.getModularInstance)(t),e=Object(o.getModularInstance)(e),t instanceof ql&&e instanceof ql&&t.firestore===e.firestore&&Qi(t._query,e._query)&&t.converter===e.converter}var Hl=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new _c(this,"async_queue_retry"),this.Tc=function(){var e=mc();e&&_r("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=mc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},t.prototype.enterRestrictedMode=function(){if(!this._c){this._c=!0;var t=mc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc)}},t.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise(function(t){}):this.Ac(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.Rc()})},t.prototype.Rc=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e=this;return Object(i.__generator)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!va(t=n.sent()))throw t;return _r("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.Rc()}),n.label=5;case 5:return[2]}})})},t.prototype.Ac=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,wr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ic(),this.Ec.indexOf(t)>-1&&(e=0);var i=Jc.createAndSchedule(this,t,e,n,function(t){return r.bc(t)});return this.mc.push(i),i},t.prototype.Ic=function(){this.yc&&Er()},t.prototype.verifyOperationInProgress=function(){},t.prototype.vc=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t;return Object(i.__generator)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Vc=function(t){var e=this;return this.vc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.vc()})},t.prototype.Sc=function(t){this.Ec.push(t)},t.prototype.bc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function Wl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Ql=function(){function t(){this._progressObserver={},this._taskCompletionResolver=new ha,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},t}(),$l=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Hl,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(i.__extends)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Yl(this),this._firestoreClient.terminate()},e}(Fl);function Xl(t){return t._firestoreClient||Yl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Yl(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new _l(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ul(t._credentials,t._queue,r)}function Jl(t,e,n){var r=this,o=new ha;return t.asyncQueue.enqueue(function(){return Object(i.__awaiter)(r,void 0,void 0,function(){var r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,cl(t,n)];case 1:return i.sent(),[4,hl(t,e)];case 2:return i.sent(),o.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===vr.FAILED_PRECONDITION||t.code===vr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=i.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),o.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function Zl(t){if(t._initialized||t._terminated)throw new yr(vr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var tf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new yr(vr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qr(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),ef=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Br.fromBase64String(e))}catch(e){throw new yr(vr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Br.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),nf=function(t){this._methodName=t},rf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new yr(vr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new yr(vr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return jr(this._lat,t._lat)||jr(this._long,t._long)},t}(),of=/^__.*__$/,sf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ko(t,this.data,this.fieldMask,e,this.fieldTransforms):new So(t,this.data,e,this.fieldTransforms)},t}(),af=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new ko(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function uf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Er()}}var cf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),t.prototype.Nc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.xc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.kc(t),r},t.prototype.$c=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.Dc(),r},t.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},t.prototype.Mc=function(t){return jf(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},t.prototype.kc=function(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(uf(this.Cc)&&of.test(t))throw this.Mc('Document fields cannot begin and end with "__"')},t}(),hf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||bc(t)}return t.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new cf({Cc:t,methodName:e,Bc:n,path:qr.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function lf(t){var e=t._freezeSettings(),n=bc(t._databaseId);return new hf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function ff(t,e,n,r,i,o){void 0===o&&(o={});var s=t.qc(o.merge||o.mergeFields?2:0,e,n,i);Of("Data must be an object, but it was:",s,r);var a,u,c=If(r,s);if(o.merge)a=new Vr(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var p=Sf(e,f[l],n);if(!s.contains(p))throw new yr(vr.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");Cf(h,p)||h.push(p)}a=new Vr(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new sf(new di(c),a,u)}var pf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.__extends)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw t.Mc(1===t.Cc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(nf);function df(t,e,n){return new cf({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var gf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.__extends)(e,t),e.prototype._toFieldTransform=function(t){return new vo(t.path,new ao)},e.prototype.isEqual=function(t){return t instanceof e},e}(nf),vf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(i.__extends)(e,t),e.prototype._toFieldTransform=function(t){var e=df(this,t,!0),n=this.Uc.map(function(t){return Tf(t,e)}),r=new uo(n);return new vo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(nf),yf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(i.__extends)(e,t),e.prototype._toFieldTransform=function(t){var e=df(this,t,!0),n=this.Uc.map(function(t){return Tf(t,e)}),r=new ho(n);return new vo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(nf),mf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(i.__extends)(e,t),e.prototype._toFieldTransform=function(t){var e=new fo(t.R,no(t.R,this.Kc));return new vo(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(nf);function bf(t,e,n,r){var i=t.qc(1,e,n);Of("Data must be an object, but it was:",i,r);var s=[],a=di.empty();Pr(r,function(t,r){var u=Af(e,t,n);r=Object(o.getModularInstance)(r);var c=i.$c(u);if(r instanceof pf)s.push(u);else{var h=Tf(r,c);null!=h&&(s.push(u),a.set(u,h))}});var u=new Vr(s);return new af(a,u,i.fieldTransforms)}function _f(t,e,n,r,i,s){var a=t.qc(1,e,n),u=[Sf(e,r,n)],c=[i];if(s.length%2!=0)throw new yr(vr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<s.length;h+=2)u.push(Sf(e,s[h])),c.push(s[h+1]);for(var l=[],f=di.empty(),p=u.length-1;p>=0;--p)if(!Cf(l,u[p])){var d=u[p],g=c[p];g=Object(o.getModularInstance)(g);var v=a.$c(d);if(g instanceof pf)l.push(d);else{var y=Tf(g,v);null!=y&&(l.push(d),f.set(d,y))}}var m=new Vr(l);return new af(f,m,a.fieldTransforms)}function wf(t,e,n,r){return void 0===r&&(r=!1),Tf(n,t.qc(r?4:3,e))}function Tf(t,e){if(Ef(t=Object(o.getModularInstance)(t)))return Of("Unsupported field value:",e,t),If(t,e);if(t instanceof nf)return function(t,e){if(!uf(e.Cc))throw e.Mc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Mc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Cc)throw e.Mc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Tf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(o.getModularInstance)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return no(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Dr.fromDate(t);return{timestampValue:ls(e.R,n)}}if(t instanceof Dr)return n=new Dr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ls(e.R,n)};if(t instanceof rf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ef)return{bytesValue:fs(e.R,t._byteString)};if(t instanceof Ul){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Mc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:gs(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc("Unsupported field value: "+Rl(t))}(t,e)}function If(t,e){var n={};return Mr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pr(t,function(t,r){var i=Tf(r,e.xc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Ef(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Dr||t instanceof rf||t instanceof ef||t instanceof Ul||t instanceof nf)}function Of(t,e,n){if(!Ef(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Rl(n);throw e.Mc("an object"===r?t+" a custom object":t+" "+r)}}function Sf(t,e,n){if((e=Object(o.getModularInstance)(e))instanceof tf)return e._internalPath;if("string"==typeof e)return Af(t,e);throw jf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var kf=new RegExp("[~\\*/\\[\\]]");function Af(t,e,n){if(e.search(kf)>=0)throw jf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(tf.bind.apply(tf,Object(i.__spreadArray)([void 0],e.split(".")))))._internalPath}catch(jp){throw jf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function jf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new yr(vr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Cf(t,e){return t.some(function(t){return t.isEqual(e)})}var Nf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Ul(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Df(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(xf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Df=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.__extends)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Nf);function xf(t,e){return"string"==typeof e?Af(t,e):e instanceof tf?e._internalPath:e._delegate._internalPath}var Rf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Pf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(i.__extends)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Mf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(xf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Nf),Mf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.__extends)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Pf),Lf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Rf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Mf(n._firestore,n._userDataWriter,r.key,r,new Rf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new yr(vr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Mf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Rf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Mf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Rf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Ff(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Ff(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Er()}}function Uf(t,e){return t instanceof Pf&&e instanceof Pf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Lf&&e instanceof Lf&&t._firestore===e._firestore&&zl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function qf(t){if(Vi(t)&&0===t.explicitOrderBy.length)throw new yr(vr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Vf=function(){};function Bf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Kf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.jc=n,i.Wc=r,i.type="where",i}return Object(i.__extends)(e,t),e.prototype._apply=function(t){var e=lf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new yr(vr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Xf(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push($f(r,t,h[c]));a={arrayValue:{values:u}}}else a=$f(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Xf(s,o),a=wf(n,"where",s,"in"===o||"not-in"===o);var l=Ti.create(i,o,a);return function(t,e){if(e.g()){var n=Ki(t);if(null!==n&&!n.isEqual(e.field))throw new yr(vr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Bi(t);null!==r&&Yf(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new yr(vr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Qc,this.jc,this.Wc);return new ql(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Vf),Gf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Gc=n,r.type="orderBy",r}return Object(i.__extends)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new yr(vr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new yr(vr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new xi(e,n);return function(t,e){if(null===Bi(t)){var n=Ki(t);null!==n&&Yf(0,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Gc);return new ql(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Li(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Vf),zf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return Object(i.__extends)(e,t),e.prototype._apply=function(t){return new ql(t.firestore,t.converter,Wi(t._query,this.zc,this.Hc))},e}(Vf),Hf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(i.__extends)(e,t),e.prototype._apply=function(t){var e=Qf(t,this.type,this.Jc,this.Yc);return new ql(t.firestore,t.converter,function(t,e){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Vf),Wf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(i.__extends)(e,t),e.prototype._apply=function(t){var e=Qf(t,this.type,this.Jc,this.Yc);return new ql(t.firestore,t.converter,function(t,e){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Vf);function Qf(t,e,n,r){if(n[0]=Object(o.getModularInstance)(n[0]),n[0]instanceof Nf)return function(t,e,n,r,i){if(!r)throw new yr(vr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=zi(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(ai(e,r.key));else{var c=r.data.field(u.field);if(Wr(c))throw new yr(vr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new yr(vr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Ni(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=lf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new yr(vr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new yr(vr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Gi(t)&&-1!==c.indexOf("/"))throw new yr(vr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Fr.fromString(c));if(!Zr.isDocumentKey(h))throw new yr(vr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Zr(h);a.push(ai(e,l))}else{var f=wf(n,r,c);a.push(f)}}return new Ni(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function $f(t,e,n){if("string"==typeof(n=Object(o.getModularInstance)(n))){if(""===n)throw new yr(vr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Gi(e)&&-1!==n.indexOf("/"))throw new yr(vr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Fr.fromString(n));if(!Zr.isDocumentKey(r))throw new yr(vr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return ai(t,new Zr(r))}if(n instanceof Ul)return ai(t,n._key);throw new yr(vr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Rl(n)+".")}function Xf(t,e){if(!Array.isArray(t)||0===t.length)throw new yr(vr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new yr(vr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Yf(t,e,n){if(!n.isEqual(e))throw new yr(vr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Jf=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),ti(t)){case 0:return null;case 1:return t.booleanValue;case 2:return zr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Hr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Er()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Pr(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new rf(zr(t.latitude),zr(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Qr(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp($r(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Gr(t);return new Dr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Fr.fromString(t);Or(qs(n));var r=new wl(n.get(1),n.get(3)),i=new Zr(n.popFirst(5));return r.isEqual(e)||wr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Zf(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var tp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(i.__extends)(e,t),e.prototype.convertBytes=function(t){return new ef(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ul(this.firestore,null,e)},e}(Jf),ep=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=lf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=np(t,this._firestore),i=Zf(r.converter,e,n),o=ff(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,mo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var s,a=np(t,this._firestore);return s="string"==typeof(e=Object(o.getModularInstance)(e))||e instanceof tf?_f(this._dataReader,"WriteBatch.update",a._key,e,n,r):bf(this._dataReader,"WriteBatch.update",a._key,e),this._mutations.push(s.toMutation(a._key,mo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=np(t,this._firestore);return this._mutations=this._mutations.concat(new xo(e._key,mo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new yr(vr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function np(t,e){if((t=Object(o.getModularInstance)(t)).firestore!==e)throw new yr(vr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var rp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(i.__extends)(e,t),e.prototype.convertBytes=function(t){return new ef(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ul(this.firestore,null,e)},e}(Jf);function ip(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Pl(t,Ul);var s=Pl(t.firestore,$l),a=lf(s);return sp(s,[("string"==typeof(e=Object(o.getModularInstance)(e))||e instanceof tf?_f(a,"updateDoc",t._key,e,n,r):bf(a,"updateDoc",t._key,e)).toMutation(t._key,mo.exists(!0))])}function op(t){for(var e,n,r,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];t=Object(o.getModularInstance)(t);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||Wl(s[c])||(u=s[c],c++);var h,l,f,p={includeMetadataChanges:u.includeMetadataChanges};if(Wl(s[c])){var d=s[c];s[c]=null===(e=d.next)||void 0===e?void 0:e.bind(d),s[c+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),s[c+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof Ul)l=Pl(t.firestore,$l),f=Ui(t._key.path),h={next:function(e){s[c]&&s[c](ap(l,t,e))},error:s[c+1],complete:s[c+2]};else{var g=Pl(t,ql);l=Pl(g.firestore,$l),f=g._query;var v=new rp(l);h={next:function(t){s[c]&&s[c](new Lf(l,v,g,t))},error:s[c+1],complete:s[c+2]},qf(t._query)}return function(t,e,n,r){var o=this,s=new il(r),a=new hh(e,s,n);return t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(o,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return e=oh,[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}})})}),function(){s.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(o,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return e=sh,[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}})})})}}(Xl(l),f,p,h)}function sp(t,e){return function(t,e){var n=this,r=new ha;return t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(n,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=Eh,[4,vl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(Xl(t),e)}function ap(t,e,n){var r=n.docs.get(e._key),i=new rp(t);return new Pf(t,i,e._key,r,new Rf(n.hasPendingWrites,n.fromCache),e.converter)}var up=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(i.__extends)(e,t),e.prototype.get=function(e){var n=this,r=np(e,this._firestore),i=new rp(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Pf(n._firestore,i,r._key,t._document,new Rf(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=lf(t)}return t.prototype.get=function(t){var e=this,n=np(t,this._firestore),r=new tp(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Er();var i=t[0];if(i.isFoundDocument())return new Nf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Nf(e._firestore,r,n._key,null,n.converter);throw Er()})},t.prototype.set=function(t,e,n){var r=np(t,this._firestore),i=Zf(r.converter,e,n),o=ff(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var s,a=np(t,this._firestore);return s="string"==typeof(e=Object(o.getModularInstance)(e))||e instanceof tf?_f(this._dataReader,"Transaction.update",a._key,e,n,r):bf(this._dataReader,"Transaction.update",a._key,e),this._transaction.update(a._key,s),this},t.prototype.delete=function(t){var e=np(t,this._firestore);return this._transaction.delete(e._key),this},t}());function cp(){if("undefined"==typeof Uint8Array)throw new yr(vr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function hp(){if("undefined"==typeof atob)throw new yr(vr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var lp=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return hp(),new t(ef.fromBase64String(e))},t.fromUint8Array=function(e){return cp(),new t(ef.fromUint8Array(e))},t.prototype.toBase64=function(){return hp(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return cp(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),fp=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Zl(t=Pl(t,$l));var n=Xl(t),r=t._freezeSettings(),i=new nl;return Jl(n,i,new tl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Zl(t=Pl(t,$l));var e=Xl(t),n=t._freezeSettings(),r=new nl;return Jl(e,r,new el(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new yr(vr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new ha;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(i.__awaiter)(e,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return pa.yt()?[4,pa.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Eu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),pp=function(){function t(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof wl||(this.Zc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Tr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Pl(t,Fl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Tr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s=Object(o.createMockUserToken)(r.mockUserToken),a=r.mockUserToken.sub||r.mockUserToken.user_id;if(!a)throw new yr(vr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Ol(new Il(s,new ec(a)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(i.__awaiter)(e,void 0,void 0,function(){var e,n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,pl(t)];case 1:return e=r.sent(),[4,gl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Sr(t);return e.Or.delete(0),kc(e)}(n))]}})})})}(Xl(Pl(this._delegate,$l)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(i.__awaiter)(e,void 0,void 0,function(){var e,n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,pl(t)];case 1:return e=r.sent(),[4,gl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return(e=Sr(t)).Or.add(0),[4,Ac(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Xl(Pl(this._delegate,$l)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Nl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new ha;return t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(e,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return e=Ch,[4,vl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(Xl(Pl(this._delegate,$l)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new il(e);return t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(n,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return e=function(t,e){Sr(t).Gr.add(e),e.next()},[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(n,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return e=function(t,e){Sr(t).Gr.delete(e)},[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(Xl(t=Pl(t,$l)),Wl(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Zc)throw new yr(vr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new kp(this,Bl(this._delegate,t))}catch(t){throw bp(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new mp(this,Kl(this._delegate,t))}catch(t){throw bp(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Ep(this,function(t,e){if(t=Pl(t,Fl),jl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new yr(vr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ql(t,null,function(t){return new Li(Fr.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw bp(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new ha;return t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(n,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,function(t){return fl(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new al(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(Xl(t),function(n){return e(new up(t,n))})}(this._delegate,function(n){return t(new gp(e,n))})},t.prototype.batch=function(){var t=this;return Xl(this._delegate),new vp(new ep(this._delegate,function(e){return sp(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new yr(vr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new yr(vr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),dp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(i.__extends)(e,t),e.prototype.convertBytes=function(t){return new lp(new ef(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return mp.tu(e,this.firestore,null)},e}(Jf),gp=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new dp(t)}return t.prototype.get=function(t){var e=this,n=Ap(t);return this._delegate.get(n).then(function(t){return new Tp(e._firestore,new Pf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=Ap(t);return n?(Cl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Ap(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,Object(i.__spreadArray)([a,e,n],o)),this},t.prototype.delete=function(t){var e=Ap(t);return this._delegate.delete(e),this},t}(),vp=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Ap(t);return n?(Cl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Ap(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,Object(i.__spreadArray)([a,e,n],o)),this},t.prototype.delete=function(t){var e=Ap(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),yp=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Mf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Ip(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.eu=function(e,n){var r=t.nu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new dp(e),n),i.set(n,o)),o},t}();yp.nu=new WeakMap;var mp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new dp(t)}return t.su=function(e,n,r){if(e.length%2!=0)throw new yr(vr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Ul(n._delegate,r,new Zr(e)))},t.tu=function(e,n,r){return new t(n,new Ul(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new kp(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new kp(this.firestore,Bl(this._delegate,t))}catch(t){throw bp(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(o.getModularInstance)(t))instanceof Ul&&Gl(this._delegate,t)},t.prototype.set=function(t,e){e=Cl("DocumentReference.set",e);try{return function(t,e,n){t=Pl(t,Ul);var r=Pl(t.firestore,$l),i=Zf(t.converter,e,n);return sp(r,[ff(lf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,mo.none())])}(this._delegate,t,e)}catch(t){throw bp(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?ip(this._delegate,t):ip.apply(void 0,Object(i.__spreadArray)([this._delegate,t,e],n))}catch(t){throw bp(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return sp(Pl((t=this._delegate).firestore,$l),[new xo(t._key,mo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=_p(e),i=wp(e,function(e){return new Tp(t.firestore,new Pf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return op(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Pl(t,Ul);var e=Pl(t.firestore,$l),n=Xl(e),r=new rp(e);return function(t,e){var n=this,r=new ha;return t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(n,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(o){switch(o.label){case 0:return n=function(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(t,e){var n=Sr(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(o=i.sent()).isFoundDocument()?n.resolve(o):o.isNoDocument()?n.resolve(null):n.reject(new yr(vr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=i.sent(),o=Zc(r,"Failed to get document '"+e+" from cache"),n.reject(o),[3,3];case 3:return[2]}})})},[4,dl(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new Pf(e,r,t._key,n,new Rf(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Pl(t,Ul);var e=Pl(t.firestore,$l);return ml(Xl(e),t._key,{source:"server"}).then(function(n){return ap(e,t,n)})}(this._delegate):function(t){t=Pl(t,Ul);var e=Pl(t.firestore,$l);return ml(Xl(e),t._key).then(function(n){return ap(e,t,n)})}(this._delegate)).then(function(t){return new Tp(e.firestore,new Pf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?yp.eu(this.firestore,e):null))},t}();function bp(t,e,n){return t.message=t.message.replace(e,n),t}function _p(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Wl(r))return r}return{}}function wp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Wl(t[0])?t[0]:Wl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Tp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new mp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Uf(this._delegate,t._delegate)},t}(),Ip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.__extends)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Tp),Ep=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new dp(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Bf(this._delegate,function(t,e,n){var r=e,i=xf("where",t);return new Kf(i,r,n)}(e,n,r)))}catch(e){throw bp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Bf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=xf("orderBy",t);return new Gf(r,n)}(e,n)))}catch(e){throw bp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Bf(this._delegate,function(t){return Ml("limit",t),new zf("limit",t,"F")}(e)))}catch(e){throw bp(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Bf(this._delegate,function(t){return Ml("limitToLast",t),new zf("limitToLast",t,"L")}(e)))}catch(e){throw bp(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Bf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hf("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw bp(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Bf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hf("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw bp(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Bf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wf("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw bp(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Bf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wf("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw bp(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return zl(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Pl(t,ql);var e=Pl(t.firestore,$l),n=Xl(e),r=new rp(e);return function(t,e){var n=this,r=new ha;return t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(n,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(o){switch(o.label){case 0:return n=function(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a,u;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Uu(t,e,!0)];case 1:return u=i.sent(),r=new yh(e,u.Bn),o=r._o(u.documents),s=r.applyChanges(o,!1),n.resolve(s.snapshot),[3,3];case 2:return a=i.sent(),u=Zc(a,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}})})},[4,dl(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new Lf(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Pl(t,ql);var e=Pl(t.firestore,$l),n=Xl(e),r=new rp(e);return bl(n,t._query,{source:"server"}).then(function(n){return new Lf(e,r,t,n)})}(this._delegate):function(t){t=Pl(t,ql);var e=Pl(t.firestore,$l),n=Xl(e),r=new rp(e);return qf(t._query),bl(n,t._query).then(function(n){return new Lf(e,r,t,n)})}(this._delegate)).then(function(t){return new Sp(e.firestore,new Lf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=_p(e),i=wp(e,function(e){return new Sp(t.firestore,new Lf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return op(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?yp.eu(this.firestore,e):null))},t}(),Op=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Ip(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Sp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Ep(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Ip(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Op(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Ip(n._firestore,r))})},t.prototype.isEqual=function(t){return Uf(this._delegate,t._delegate)},t}(),kp=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(i.__extends)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new mp(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new mp(this.firestore,void 0===t?Kl(this._delegate):Kl(this._delegate,t))}catch(t){throw bp(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Pl(t.firestore,$l),r=Kl(t),i=Zf(t.converter,e);return sp(n,[ff(lf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,mo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new mp(e.firestore,t)})},e.prototype.isEqual=function(t){return Gl(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?yp.eu(this.firestore,t):null))},e}(Ep);function Ap(t){return Pl(t,Ul)}var jp,Cp,Np=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(tf.bind.apply(tf,Object(i.__spreadArray)([void 0],t)))}return t.documentId=function(){return new t(qr.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(o.getModularInstance)(t))instanceof tf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Dp=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new gf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new pf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new yf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new mf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),xp=n("/6Yf"),Rp={Firestore:pp,GeoPoint:rf,Timestamp:Dr,Blob:lp,Transaction:gp,WriteBatch:vp,DocumentReference:mp,DocumentSnapshot:Tp,Query:Ep,QueryDocumentSnapshot:Ip,QuerySnapshot:Sp,CollectionReference:kp,FieldPath:Np,FieldValue:Dp,setLogLevel:function(t){mr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new xp.Component("firestore",function(t){return function(t,e){return new pp(t,new $l(t,e),new fp)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Rp)))})(jp=r.default),jp.registerVersion("@firebase/firestore","2.3.8"),(Cp=pp).prototype.loadBundle=function(t){return function(t,e){var n=Xl(t=Pl(t,$l)),r=new Ql;return function(t,e,n,r){var o=this,s=function(t,e){return function(t,e){return new ol(t,e)}(function(t,e){if(t instanceof Uint8Array)return rl(t,e);if(t instanceof ArrayBuffer)return rl(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof t?(new TextEncoder).encode(t):t),e)}(n,bc(e));t.asyncQueue.enqueueAndForget(function(){return Object(i.__awaiter)(o,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return e=Jh,[4,vl(t)];case 1:return e.apply(void 0,[n.sent(),s,r]),[2]}})})})}(n,t._databaseId,e,r),r}(this._delegate,t)},Cp.prototype.namedQuery=function(t){var e,n,r=this;return(e=this._delegate,n=t,function(t,e){var n=this;return t.asyncQueue.enqueue(function(){return Object(i.__awaiter)(n,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return n=function(t,e){var n=Sr(t);return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Ke.getNamedQuery(t,e)})},[4,dl(t)];case 1:return[2,n.apply(void 0,[r.sent(),e])]}})})})}(Xl(e=Pl(e,$l)),n).then(function(t){return t?new ql(e,null,t.query):null})).then(function(t){return t?new Ep(r,t):null})};var Pp={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Mp=function(t){function e(n,r,i){var o=t.call(this,r)||this;return Object.setPrototypeOf(o,e.prototype),o.code=n,o.details=i,o}return Object(i.__extends)(e,t),e}(Error),Lp=function(){function t(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then(function(t){return n.auth=t},function(){}),this.messaging||e.get().then(function(t){return n.messaging=t},function(){})}return t.prototype.getAuthToken=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t;return Object(i.__generator)(this,function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 3:return e.sent(),[2,void 0];case 4:return[2]}})})},t.prototype.getInstanceIdToken=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:if(!this.messaging||!("Notification"in self)||"granted"!==Notification.permission)return[2,void 0];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.messaging.getToken()];case 2:return[2,t.sent()];case 3:return t.sent(),[2,void 0];case 4:return[2]}})})},t.prototype.getContext=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}})})},t}();function Fp(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var Up,qp,Vp,Bp=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return Fp(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?Fp(t,function(t){return e.decode(t)}):t},t}(),Kp=function(){function t(t,e,n,r,i,o){var s=this;void 0===i&&(i="us-central1"),this.app_=t,this.appCheckProvider=r,this.fetchImpl=o,this.serializer=new Bp,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return Promise.resolve(s.deleteService())}},this.contextProvider=new Lp(e,n),this.cancelAllRequests=new Promise(function(t){s.deleteService=function(){return t()}});try{var a=new URL(i);this.customDomain=a.origin,this.region="us-central1"}catch(jp){this.customDomain=null,this.region=i}}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+this.region+"/"+t:null!==this.customDomain?this.customDomain+"/"+t:"https://"+this.region+"-"+e+".cloudfunctions.net/"+t},t.prototype.useEmulator=function(t,e){this.emulatorOrigin="http://"+t+":"+e},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},t.prototype.postJSON=function(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n["Content-Type"]="application/json",[4,this.getAppCheckToken()];case 1:null!==(r=i.sent())&&(n["X-Firebase-AppCheck"]=r),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.fetchImpl(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 3:return o=i.sent(),[3,5];case 4:return i.sent(),[2,{status:0,json:null}];case 5:s=null,i.label=6;case 6:return i.trys.push([6,8,,9]),[4,o.json()];case 7:return s=i.sent(),[3,9];case 8:return i.sent(),[3,9];case 9:return[2,{status:o.status,json:s}]}})})},t.prototype.getAppCheckToken=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t;return Object(i.__generator)(this,function(e){switch(e.label){case 0:return(t=this.appCheckProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:return[2,e.sent().token];case 2:return[2,null]}})})},t.prototype.call=function(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a,u,c,h,l,f,p;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return r=this._url(t),e=this.serializer.encode(e),o={data:e},s={},[4,this.contextProvider.getContext()];case 1:return(a=i.sent()).authToken&&(s.Authorization="Bearer "+a.authToken),a.instanceIdToken&&(s["Firebase-Instance-ID-Token"]=a.instanceIdToken),u=function(t){var e,n=new Promise(function(n,r){e=setTimeout(function(){r(new Mp("deadline-exceeded","deadline-exceeded"))},t)});return{timer:e,promise:n}}(n.timeout||7e4),c=u.timer,h=u.promise,[4,Promise.race([Gp(c,this.postJSON(r,o,s)),h,Gp(c,this.cancelAllRequests)])];case 2:if(!(l=i.sent()))throw new Mp("cancelled","Firebase Functions instance was deleted.");if(f=function(t,e,n){var r=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var s=e&&e.error;if(s){var a=s.status;if("string"==typeof a){if(!Pp[a])return new Mp("internal","internal");r=Pp[a],i=a}var u=s.message;"string"==typeof u&&(i=u),void 0!==(o=s.details)&&(o=n.decode(o))}}catch(jp){}return"ok"===r?null:new Mp(r,i,o)}(l.status,l.json,this.serializer))throw f;if(!l.json)throw new Mp("internal","Response is not valid JSON object.");if(void 0===(p=l.json.data)&&(p=l.json.result),void 0===p)throw new Mp("internal","Response is missing data field.");return[2,{data:this.serializer.decode(p)}]}})})},t}();function Gp(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,e];case 1:return n=r.sent(),clearTimeout(t),[2,n]}})})}Up=r.default,qp=fetch.bind(self),Vp={Functions:Kp},Up.INTERNAL.registerComponent(new xp.Component("functions",function(t,e){var n=e.instanceIdentifier,r=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal"),s=t.getProvider("messaging");return new Kp(r,i,s,o,n,qp)},"PUBLIC").setServiceProps(Vp).setMultipleInstances(!0)),r.default.registerVersion("@firebase/functions","0.6.13");var zp,Hp=n("nbvr"),Wp="w:0.4.30",Qp=((zp={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',zp["not-registered"]="Firebase Installation is not registered.",zp["installation-not-found"]="Firebase Installation not found.",zp["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',zp["app-offline"]="Could not process request. Application offline.",zp["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",zp),$p=new o.ErrorFactory("installations","Installations",Qp);function Xp(t){return t instanceof o.FirebaseError&&t.code.includes("request-failed")}function Yp(t){return"https://firebaseinstallations.googleapis.com/v1/projects/"+t.projectId+"/installations"}function Jp(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}function Zp(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),[2,$p.create("request-failed",{requestName:t,serverCode:(r=n.error).code,serverMessage:r.message,serverStatus:r.status})]}})})}function td(t){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey})}function ed(t,e){var n=e.refreshToken,r=td(t);return r.append("Authorization",function(t){return"FIS_v2 "+t}(n)),r}function nd(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return[4,t()];case 1:return(e=n.sent()).status>=500&&e.status<600?[2,t()]:[2,e]}})})}function rd(t,e){var n=e.fid;return Object(i.__awaiter)(this,void 0,void 0,function(){var e,r,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return e=Yp(t),r=td(t),o={method:"POST",headers:r,body:JSON.stringify({fid:n,authVersion:"FIS_v2",appId:t.appId,sdkVersion:Wp})},[4,nd(function(){return fetch(e,o)})];case 1:return(s=i.sent()).ok?[4,s.json()]:[3,3];case 2:return[2,{fid:(a=i.sent()).fid||n,registrationStatus:2,refreshToken:a.refreshToken,authToken:Jp(a.authToken)}];case 3:return[4,Zp("Create Installation",s)];case 4:throw i.sent()}})})}function id(t){return new Promise(function(e){setTimeout(e,t)})}var od=/^[cdef][\w-]{21}$/;function sd(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return(e=t,btoa(String.fromCharCode.apply(String,Object(i.__spreadArray)([],Object(i.__read)(e)))).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var e}(t);return od.test(e)?e:""}catch(n){return""}}function ad(t){return t.appName+"!"+t.appId}var ud=new Map;function cd(t,e){var n=ad(t);hd(n,e),function(t,e){var n=fd();n&&n.postMessage({key:t,fid:e}),pd()}(n,e)}function hd(t,e){var n,r,o=ud.get(t);if(o)try{for(var s=Object(i.__values)(o),a=s.next();!a.done;a=s.next())(0,a.value)(e)}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}var ld=null;function fd(){return!ld&&"BroadcastChannel"in self&&((ld=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(t){hd(t.data.key,t.data.fid)}),ld}function pd(){0===ud.size&&ld&&(ld.close(),ld=null)}var dd,gd="firebase-installations-store",vd=null;function yd(){return vd||(vd=Object(Hp.openDb)("firebase-installations-database",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore(gd)}})),vd}function md(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=ad(t),[4,yd()];case 1:return r=i.sent(),o=r.transaction(gd,"readwrite"),[4,(s=o.objectStore(gd)).get(n)];case 2:return a=i.sent(),[4,s.put(e,n)];case 3:return i.sent(),[4,o.complete];case 4:return i.sent(),a&&a.fid===e.fid||cd(t,e.fid),[2,e]}})})}function bd(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return e=ad(t),[4,yd()];case 1:return n=i.sent(),[4,(r=n.transaction(gd,"readwrite")).objectStore(gd).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}})})}function _d(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a,u;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=ad(t),[4,yd()];case 1:return r=i.sent(),o=r.transaction(gd,"readwrite"),[4,(s=o.objectStore(gd)).get(n)];case 2:return a=i.sent(),void 0!==(u=e(a))?[3,4]:[4,s.delete(n)];case 3:return i.sent(),[3,6];case 4:return[4,s.put(u,n)];case 5:i.sent(),i.label=6;case 6:return[4,o.complete];case 7:return i.sent(),!u||a&&a.fid===u.fid||cd(t,u.fid),[2,u]}})})}function wd(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(i.__generator)(this,function(o){switch(o.label){case 0:return[4,_d(t,function(n){var r=function(t){return Ed(t||{fid:sd(),registrationStatus:0})}(n),o=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject($p.create("app-offline"))};var n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,rd(t,e)];case 1:return n=i.sent(),[2,md(t,n)];case 2:return Xp(r=i.sent())&&409===r.customData.serverCode?[4,bd(t)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,md(t,{fid:e.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}})})}(t,n)}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:Td(t)}:{installationEntry:e}}(t,r);return e=o.registrationPromise,o.installationEntry})];case 1:return""!==(n=o.sent()).fid?[3,3]:(r={},[4,e]);case 2:return[2,(r.installationEntry=o.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}})})}function Td(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Id(t)];case 1:e=i.sent(),i.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,id(100)];case 3:return i.sent(),[4,Id(t)];case 4:return e=i.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,wd(t)];case 6:return n=i.sent(),r=n.installationEntry,(o=n.registrationPromise)?[2,o]:[2,r];case 7:return[2,e]}})})}function Id(t){return _d(t,function(t){if(!t)throw $p.create("installation-not-found");return Ed(t)})}function Ed(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}function Od(t,e){var n=t.appConfig,r=t.platformLoggerProvider;return Object(i.__awaiter)(this,void 0,void 0,function(){var t,o,s,a,u;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return t=function(t,e){var n=e.fid;return Yp(t)+"/"+n+"/authTokens:generate"}(n,e),o=ed(n,e),(s=r.getImmediate({optional:!0}))&&o.append("x-firebase-client",s.getPlatformInfoString()),a={method:"POST",headers:o,body:JSON.stringify({installation:{sdkVersion:Wp}})},[4,nd(function(){return fetch(t,a)})];case 1:return(u=i.sent()).ok?[4,u.json()]:[3,3];case 2:return[2,Jp(i.sent())];case 3:return[4,Zp("Generate Auth Token",u)];case 4:throw i.sent()}})})}function Sd(t,e){return void 0===e&&(e=!1),Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return Object(i.__generator)(this,function(s){switch(s.label){case 0:return[4,_d(t.appConfig,function(r){if(!Ad(r))throw $p.create("not-registered");var o,s=r.authToken;if(!e&&2===(o=s).requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(o))return r;if(1===s.requestStatus)return n=function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,kd(t.appConfig)];case 1:n=i.sent(),i.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,id(100)];case 3:return i.sent(),[4,kd(t.appConfig)];case 4:return n=i.sent(),[3,2];case 5:return 0===(r=n.authToken).requestStatus?[2,Sd(t,e)]:[2,r]}})})}(t,e),r;if(!navigator.onLine)throw $p.create("app-offline");var a=function(t){var e={requestStatus:1,requestTime:Date.now()};return Object(i.__assign)(Object(i.__assign)({},t),{authToken:e})}(r);return n=function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return Object(i.__generator)(this,function(s){switch(s.label){case 0:return s.trys.push([0,3,,8]),[4,Od(t,e)];case 1:return n=s.sent(),o=Object(i.__assign)(Object(i.__assign)({},e),{authToken:n}),[4,md(t.appConfig,o)];case 2:return s.sent(),[2,n];case 3:return!Xp(r=s.sent())||401!==r.customData.serverCode&&404!==r.customData.serverCode?[3,5]:[4,bd(t.appConfig)];case 4:return s.sent(),[3,7];case 5:return o=Object(i.__assign)(Object(i.__assign)({},e),{authToken:{requestStatus:0}}),[4,md(t.appConfig,o)];case 6:s.sent(),s.label=7;case 7:throw r;case 8:return[2]}})})}(t,a),a})];case 1:return r=s.sent(),n?[4,n]:[3,3];case 2:return o=s.sent(),[3,4];case 3:o=r.authToken,s.label=4;case 4:return[2,o]}})})}function kd(t){return _d(t,function(t){if(!Ad(t))throw $p.create("not-registered");var e;return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object(i.__assign)(Object(i.__assign)({},t),{authToken:{requestStatus:0}}):t})}function Ad(t){return void 0!==t&&2===t.registrationStatus}function jd(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return[4,wd(t)];case 1:return(e=n.sent().registrationPromise)?[4,e]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})}function Cd(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=function(t,e){var n=e.fid;return Yp(t)+"/"+n}(t,e),r=ed(t,e),o={method:"DELETE",headers:r},[4,nd(function(){return fetch(n,o)})];case 1:return(s=i.sent()).ok?[3,3]:[4,Zp("Delete Installation",s)];case 2:throw i.sent();case 3:return[2]}})})}function Nd(t){return $p.create("missing-app-config-values",{valueName:t})}!function(t){t.INTERNAL.registerComponent(new xp.Component("installations",function(t){var e=t.getProvider("app").getImmediate(),n={appConfig:function(t){var e,n;if(!t||!t.options)throw Nd("App Configuration");if(!t.name)throw Nd("App Name");try{for(var r=Object(i.__values)(["projectId","apiKey","appId"]),o=r.next();!o.done;o=r.next()){var s=o.value;if(!t.options[s])throw Nd(s)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),platformLoggerProvider:t.getProvider("platform-logger")};return{app:e,getId:function(){return function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,wd(t.appConfig)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?r.catch(console.error):Sd(t).catch(console.error),[2,n.fid]}})})}(n)},getToken:function(t){return function(t,e){return void 0===e&&(e=!1),Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(n){switch(n.label){case 0:return[4,jd(t.appConfig)];case 1:return n.sent(),[4,Sd(t,e)];case 2:return[2,n.sent().token]}})})}(n,t)},delete:function(){return function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,_d(e=t.appConfig,function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw $p.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw $p.create("app-offline");case 3:return[4,Cd(e,n)];case 4:return r.sent(),[4,bd(e)];case 5:r.sent(),r.label=6;case 6:return[2]}})})}(n)},onIdChange:function(t){return function(t,e){var n=t.appConfig;return function(t,e){fd();var n=ad(t),r=ud.get(n);r||(r=new Set,ud.set(n,r)),r.add(e)}(n,e),function(){!function(t,e){var n=ad(t),r=ud.get(n);r&&(r.delete(e),0===r.size&&ud.delete(n),pd())}(n,e)}}(n,t)}}},"PUBLIC")),t.registerVersion("@firebase/installations","0.4.30")}(r.default);var Dd=((dd={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',dd["only-available-in-window"]="This method is available in a Window context.",dd["only-available-in-sw"]="This method is available in a service worker context.",dd["permission-default"]="The notification permission was not granted and dismissed instead.",dd["permission-blocked"]="The notification permission was not granted and blocked instead.",dd["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",dd["failed-service-worker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",dd["token-subscribe-failed"]="A problem occurred while subscribing the user to FCM: {$errorInfo}",dd["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",dd["token-unsubscribe-failed"]="A problem occurred while unsubscribing the user from FCM: {$errorInfo}",dd["token-update-failed"]="A problem occurred while updating the user from FCM: {$errorInfo}",dd["token-update-no-token"]="FCM returned no token when updating the user to push.",dd["use-sw-after-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",dd["invalid-sw-registration"]="The input to useServiceWorker() must be a ServiceWorkerRegistration.",dd["invalid-bg-handler"]="The input to setBackgroundMessageHandler() must be a function.",dd["invalid-vapid-key"]="The public VAPID key must be a string.",dd["use-vapid-key-after-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",dd),xd=new o.ErrorFactory("messaging","Messaging",Dd),Rd="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Pd=function(t){return t.PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked",t}({});function Md(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,Object(i.__spreadArray)([],Object(i.__read)(e)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Ld(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var Fd="fcm_token_details_db",Ud="fcm_token_object_Store";function qd(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return"databases"in indexedDB?[4,indexedDB.databases()]:[3,2];case 1:if(!r.sent().map(function(t){return t.name}).includes(Fd))return[2,null];r.label=2;case 2:return e=null,[4,Object(Hp.openDb)(Fd,5,function(r){return Object(i.__awaiter)(n,void 0,void 0,function(){var n,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return r.oldVersion<2?[2]:r.objectStoreNames.contains(Ud)?[4,(n=r.transaction.objectStore(Ud)).index("fcmSenderId").get(t)]:[2];case 1:return o=i.sent(),[4,n.clear()];case 2:if(i.sent(),!o)return[2];if(2===r.oldVersion){if(!(s=o).auth||!s.p256dh||!s.endpoint)return[2];e={token:s.fcmToken,createTime:null!==(a=s.createTime)&&void 0!==a?a:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:Md(s.vapidKey)}}}else(3===r.oldVersion||4===r.oldVersion)&&(e={token:(s=o).fcmToken,createTime:s.createTime,subscriptionOptions:{auth:Md(s.auth),p256dh:Md(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:Md(s.vapidKey)}});return[2]}})})})];case 3:return r.sent().close(),[4,Object(Hp.deleteDb)(Fd)];case 4:return r.sent(),[4,Object(Hp.deleteDb)("fcm_vapid_details_db")];case 5:return r.sent(),[4,Object(Hp.deleteDb)("undefined")];case 6:return r.sent(),[2,Vd(e)?e:null]}})})}function Vd(t){if(!t||!t.subscriptionOptions)return!1;var e=t.subscriptionOptions;return"number"==typeof t.createTime&&t.createTime>0&&"string"==typeof t.token&&t.token.length>0&&"string"==typeof e.auth&&e.auth.length>0&&"string"==typeof e.p256dh&&e.p256dh.length>0&&"string"==typeof e.endpoint&&e.endpoint.length>0&&"string"==typeof e.swScope&&e.swScope.length>0&&"string"==typeof e.vapidKey&&e.vapidKey.length>0}var Bd="firebase-messaging-store",Kd=null;function Gd(){return Kd||(Kd=Object(Hp.openDb)("firebase-messaging-database",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore(Bd)}})),Kd}function zd(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return e=Qd(t),[4,Gd()];case 1:return[4,i.sent().transaction(Bd).objectStore(Bd).get(e)];case 2:return(n=i.sent())?[2,n]:[3,3];case 3:return[4,qd(t.appConfig.senderId)];case 4:return(r=i.sent())?[4,Hd(t,r)]:[3,6];case 5:return i.sent(),[2,r];case 6:return[2]}})})}function Hd(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=Qd(t),[4,Gd()];case 1:return r=i.sent(),[4,(o=r.transaction(Bd,"readwrite")).objectStore(Bd).put(e,n)];case 2:return i.sent(),[4,o.complete];case 3:return i.sent(),[2,e]}})})}function Wd(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return e=Qd(t),[4,Gd()];case 1:return n=i.sent(),[4,(r=n.transaction(Bd,"readwrite")).objectStore(Bd).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}})})}function Qd(t){return t.appConfig.appId}function $d(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Zd(t)];case 1:n=i.sent(),r=tg(e),o={method:"POST",headers:n,body:JSON.stringify(r)},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(Jd(t.appConfig),o)];case 3:return[4,i.sent().json()];case 4:return s=i.sent(),[3,6];case 5:throw a=i.sent(),xd.create("token-subscribe-failed",{errorInfo:a});case 6:if(s.error)throw xd.create("token-subscribe-failed",{errorInfo:s.error.message});if(!s.token)throw xd.create("token-subscribe-no-token");return[2,s.token]}})})}function Xd(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Zd(t)];case 1:n=i.sent(),r=tg(e.subscriptionOptions),o={method:"PATCH",headers:n,body:JSON.stringify(r)},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(Jd(t.appConfig)+"/"+e.token,o)];case 3:return[4,i.sent().json()];case 4:return s=i.sent(),[3,6];case 5:throw a=i.sent(),xd.create("token-update-failed",{errorInfo:a});case 6:if(s.error)throw xd.create("token-update-failed",{errorInfo:s.error.message});if(!s.token)throw xd.create("token-update-no-token");return[2,s.token]}})})}function Yd(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Zd(t)];case 1:n=i.sent(),r={method:"DELETE",headers:n},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(Jd(t.appConfig)+"/"+e,r)];case 3:return[4,i.sent().json()];case 4:if((o=i.sent()).error)throw xd.create("token-unsubscribe-failed",{errorInfo:o.error.message});return[3,6];case 5:throw s=i.sent(),xd.create("token-unsubscribe-failed",{errorInfo:s});case 6:return[2]}})})}function Jd(t){return"https://fcmregistrations.googleapis.com/v1/projects/"+t.projectId+"/registrations"}function Zd(t){var e=t.appConfig,n=t.installations;return Object(i.__awaiter)(this,void 0,void 0,function(){var t;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,n.getToken()];case 1:return t=r.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})]}})})}function tg(t){var e=t.vapidKey,n={web:{endpoint:t.endpoint,auth:t.auth,p256dh:t.p256dh}};return e!==Rd&&(n.web.applicationPubKey=e),n}function eg(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:if("granted"!==Notification.permission)throw xd.create("permission-blocked");return[4,og(e,n)];case 1:return r=i.sent(),[4,zd(t)];case 2:return o=i.sent(),s={vapidKey:n,swScope:e.scope,endpoint:r.endpoint,auth:Md(r.getKey("auth")),p256dh:Md(r.getKey("p256dh"))},o?[3,3]:[2,ig(t,s)];case 3:if(h=(c=s).endpoint===(u=o.subscriptionOptions).endpoint,c.vapidKey===u.vapidKey&&h&&c.auth===u.auth&&c.p256dh===u.p256dh)return[3,8];i.label=4;case 4:return i.trys.push([4,6,,7]),[4,Yd(t,o.token)];case 5:return i.sent(),[3,7];case 6:return a=i.sent(),console.warn(a),[3,7];case 7:return[2,ig(t,s)];case 8:return Date.now()>=o.createTime+6048e5?[2,rg({token:o.token,createTime:Date.now(),subscriptionOptions:s},t,e)]:[2,o.token];case 9:return[2]}var u,c,h})})}function ng(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,zd(t)];case 1:return(n=i.sent())?[4,Yd(t,n.token)]:[3,4];case 2:return i.sent(),[4,Wd(t)];case 3:i.sent(),i.label=4;case 4:return[4,e.pushManager.getSubscription()];case 5:return(r=i.sent())?[2,r.unsubscribe()]:[2,!0]}})})}function rg(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s;return Object(i.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,5]),[4,Xd(e,t)];case 1:return r=a.sent(),o=Object(i.__assign)(Object(i.__assign)({},t),{token:r,createTime:Date.now()}),[4,Hd(e,o)];case 2:return a.sent(),[2,r];case 3:return s=a.sent(),[4,ng(e,n)];case 4:throw a.sent(),s;case 5:return[2]}})})}function ig(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,$d(t,e)];case 1:return n=i.sent(),r={token:n,createTime:Date.now(),subscriptionOptions:e},[4,Hd(t,r)];case 2:return i.sent(),[2,r.token]}})})}function og(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,t.pushManager.getSubscription()];case 1:return(n=r.sent())?[2,n]:[2,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ld(e)})]}})})}function sg(t){return"object"==typeof t&&!!t&&"google.c.a.c_id"in t}function ag(t){return new Promise(function(e){setTimeout(e,t)})}var ug=function(){function t(t){var e=this;this.firebaseDependencies=t,this.isOnBackgroundMessageUsed=null,this.vapidKey=null,this.bgMessageHandler=null,self.addEventListener("push",function(t){t.waitUntil(e.onPush(t))}),self.addEventListener("pushsubscriptionchange",function(t){t.waitUntil(e.onSubChange(t))}),self.addEventListener("notificationclick",function(t){t.waitUntil(e.onNotificationClick(t))})}return Object.defineProperty(t.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),t.prototype.setBackgroundMessageHandler=function(t){if(this.isOnBackgroundMessageUsed=!1,!t||"function"!=typeof t)throw xd.create("invalid-bg-handler");this.bgMessageHandler=t},t.prototype.onBackgroundMessage=function(t){var e=this;return this.isOnBackgroundMessageUsed=!0,this.bgMessageHandler=t,function(){e.bgMessageHandler=null}},t.prototype.getToken=function(){var t,e;return Object(i.__awaiter)(this,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return this.vapidKey?[3,2]:[4,zd(this.firebaseDependencies)];case 1:n=r.sent(),this.vapidKey=null!==(e=null===(t=null==n?void 0:n.subscriptionOptions)||void 0===t?void 0:t.vapidKey)&&void 0!==e?e:Rd,r.label=2;case 2:return[2,eg(this.firebaseDependencies,self.registration,this.vapidKey)]}})})},t.prototype.deleteToken=function(){return ng(this.firebaseDependencies,self.registration)},t.prototype.requestPermission=function(){throw xd.create("only-available-in-window")},t.prototype.usePublicVapidKey=function(t){if(null!==this.vapidKey)throw xd.create("use-vapid-key-after-get-token");if("string"!=typeof t||0===t.length)throw xd.create("invalid-vapid-key");this.vapidKey=t},t.prototype.useServiceWorker=function(){throw xd.create("only-available-in-window")},t.prototype.onMessage=function(){throw xd.create("only-available-in-window")},t.prototype.onTokenRefresh=function(){throw xd.create("only-available-in-window")},t.prototype.onPush=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r,o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return(e=function(t){var e=t.data;if(!e)return null;try{return e.json()}catch(n){return null}}(t))?[4,fg()]:(console.debug("FirebaseMessaging: failed to get parsed MessagePayload from the PushEvent. Skip handling the push."),[2]);case 1:return function(t){return t.some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})}(n=i.sent())?[2,lg(n,e)]:(r=!1,e.notification?[4,pg(cg(e))]:[3,3]);case 2:i.sent(),r=!0,i.label=3;case 3:return!0===r&&!1===this.isOnBackgroundMessageUsed?[2]:(this.bgMessageHandler&&(o=function(t){var e={from:t.from,collapseKey:t.collapse_key};return function(t,e){if(e.notification){t.notification={};var n=e.notification.title;n&&(t.notification.title=n);var r=e.notification.body;r&&(t.notification.body=r);var i=e.notification.image;i&&(t.notification.image=i)}}(e,t),function(t,e){e.data&&(t.data=e.data)}(e,t),function(t,e){if(e.fcmOptions){t.fcmOptions={};var n=e.fcmOptions.link;n&&(t.fcmOptions.link=n);var r=e.fcmOptions.analytics_label;r&&(t.fcmOptions.analyticsLabel=r)}}(e,t),e}(e),"function"==typeof this.bgMessageHandler?this.bgMessageHandler(o):this.bgMessageHandler.next(o)),[4,ag(1e3)]);case 4:return i.sent(),[2]}})})},t.prototype.onSubChange=function(t){var e,n;return Object(i.__awaiter)(this,void 0,void 0,function(){var r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return t.newSubscription?[3,2]:[4,ng(this.firebaseDependencies,self.registration)];case 1:return i.sent(),[2];case 2:return[4,zd(this.firebaseDependencies)];case 3:return r=i.sent(),[4,ng(this.firebaseDependencies,self.registration)];case 4:return i.sent(),[4,eg(this.firebaseDependencies,self.registration,null!==(n=null===(e=null==r?void 0:r.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==n?n:Rd)];case 5:return i.sent(),[2]}})})},t.prototype.onNotificationClick=function(t){var e,n;return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s,a,u;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return(r=null===(n=null===(e=t.notification)||void 0===e?void 0:e.data)||void 0===n?void 0:n.FCM_MSG)?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(o=function(t){var e,n,r;return(null!==(n=null===(e=t.fcmOptions)||void 0===e?void 0:e.link)&&void 0!==n?n:null===(r=t.notification)||void 0===r?void 0:r.click_action)||(sg(t.data)?self.location.origin:null)}(r))?(s=new URL(o,self.location.href),a=new URL(self.location.origin),s.host!==a.host?[2]:[4,hg(s)]):[2]):[2];case 1:return(u=i.sent())?[3,4]:[4,self.clients.openWindow(o)];case 2:return u=i.sent(),[4,ag(3e3)];case 3:return i.sent(),[3,6];case 4:return[4,u.focus()];case 5:u=i.sent(),i.label=6;case 6:return u?(r.messageType=Pd.NOTIFICATION_CLICKED,r.isFirebaseMessaging=!0,[2,u.postMessage(r)]):[2]}})})},t}();function cg(t){var e,n=Object(i.__assign)({},t.notification);return n.data=((e={}).FCM_MSG=t,e),n}function hg(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r,o,s,a,u;return Object(i.__generator)(this,function(c){switch(c.label){case 0:return[4,fg()];case 1:e=c.sent();try{for(n=Object(i.__values)(e),r=n.next();!r.done;r=n.next())if(o=r.value,s=new URL(o.url,self.location.href),t.host===s.host)return[2,o]}catch(h){a={error:h}}finally{try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(a)throw a.error}}return[2,null]}})})}function lg(t,e){var n,r;e.isFirebaseMessaging=!0,e.messageType=Pd.PUSH_RECEIVED;try{for(var o=Object(i.__values)(t),s=o.next();!s.done;s=o.next())s.value.postMessage(e)}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}function fg(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function pg(t){var e,n=t.actions,r=Notification.maxActions;return n&&r&&n.length>r&&console.warn("This browser only supports "+r+" actions. The remaining actions will not be displayed."),self.registration.showNotification(null!==(e=t.title)&&void 0!==e?e:"",t)}var dg=function(){function t(t){var e=this;this.firebaseDependencies=t,this.vapidKey=null,this.onMessageCallback=null,navigator.serviceWorker.addEventListener("message",function(t){return e.messageEventListener(t)})}return Object.defineProperty(t.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),t.prototype.messageEventListener=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return(e=t.data).isFirebaseMessaging?(this.onMessageCallback&&e.messageType===Pd.PUSH_RECEIVED&&("function"==typeof this.onMessageCallback?this.onMessageCallback(function(t){return delete t.messageType,delete t.isFirebaseMessaging,t}(Object.assign({},e))):this.onMessageCallback.next(Object.assign({},e))),sg(n=e.data)&&"1"===n["google.c.a.e"]?[4,this.logEvent(e.messageType,n)]:[3,2]):[2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.getVapidKey=function(){return this.vapidKey},t.prototype.getSwReg=function(){return this.swRegistration},t.prototype.getToken=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return"default"!==Notification.permission?[3,2]:[4,Notification.requestPermission()];case 1:e.sent(),e.label=2;case 2:if("granted"!==Notification.permission)throw xd.create("permission-blocked");return[4,this.updateVapidKey(null==t?void 0:t.vapidKey)];case 3:return e.sent(),[4,this.updateSwReg(null==t?void 0:t.serviceWorkerRegistration)];case 4:return e.sent(),[2,eg(this.firebaseDependencies,this.swRegistration,this.vapidKey)]}})})},t.prototype.updateVapidKey=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){return t?this.vapidKey=t:this.vapidKey||(this.vapidKey=Rd),[2]})})},t.prototype.updateSwReg=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return t||this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:e.sent(),e.label=2;case 2:if(!t&&this.swRegistration)return[2];if(!(t instanceof ServiceWorkerRegistration))throw xd.create("invalid-sw-registration");return this.swRegistration=t,[2]}})})},t.prototype.registerDefaultSw=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=this,[4,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"})];case 1:return t.swRegistration=n.sent(),this.swRegistration.update().catch(function(){}),[3,3];case 2:throw e=n.sent(),xd.create("failed-service-worker-registration",{browserErrorMessage:e.message});case 3:return[2]}})})},t.prototype.deleteToken=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:t.sent(),t.label=2;case 2:return[2,ng(this.firebaseDependencies,this.swRegistration)]}})})},t.prototype.requestPermission=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t;return Object(i.__generator)(this,function(e){switch(e.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw xd.create("denied"===t?"permission-blocked":"permission-default")}})})},t.prototype.usePublicVapidKey=function(t){if(null!==this.vapidKey)throw xd.create("use-vapid-key-after-get-token");if("string"!=typeof t||0===t.length)throw xd.create("invalid-vapid-key");this.vapidKey=t},t.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw xd.create("invalid-sw-registration");if(this.swRegistration)throw xd.create("use-sw-after-get-token");this.swRegistration=t},t.prototype.onMessage=function(t){var e=this;return this.onMessageCallback=t,function(){e.onMessageCallback=null}},t.prototype.setBackgroundMessageHandler=function(){throw xd.create("only-available-in-sw")},t.prototype.onBackgroundMessage=function(){throw xd.create("only-available-in-sw")},t.prototype.onTokenRefresh=function(){return function(){}},t.prototype.logEvent=function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return n=function(t){switch(t){case Pd.NOTIFICATION_CLICKED:return"notification_open";case Pd.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t),[4,this.firebaseDependencies.analyticsProvider.get()];case 1:return r.sent().logEvent(n,{message_id:e["google.c.a.c_id"],message_name:e["google.c.a.c_l"],message_time:e["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),[2]}})})},t}();function gg(t){return xd.create("missing-app-config-values",{valueName:t})}var vg={isSupported:yg};function yg(){return self&&"ServiceWorkerGlobalScope"in self?"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}r.default.INTERNAL.registerComponent(new xp.Component("messaging",function(t){var e=t.getProvider("app").getImmediate(),n={app:e,appConfig:function(t){var e,n;if(!t||!t.options)throw gg("App Configuration Object");if(!t.name)throw gg("App Name");var r=t.options;try{for(var o=Object(i.__values)(["projectId","apiKey","appId","messagingSenderId"]),s=o.next();!s.done;s=o.next()){var a=s.value;if(!r[a])throw gg(a)}}catch(u){e={error:u}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return{appName:t.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}}(e),installations:t.getProvider("installations").getImmediate(),analyticsProvider:t.getProvider("analytics-internal")};if(!yg())throw xd.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new ug(n):new dg(n)},"PUBLIC").setServiceProps(vg));var mg="firebasestorage.googleapis.com",bg=function(t){function e(n,r){var i=t.call(this,_g(n),"Firebase Storage: "+r+" ("+_g(n)+")")||this;return i.customData={serverResponse:null},i._baseMessage=i.message,Object.setPrototypeOf(i,e.prototype),i}return Object(i.__extends)(e,t),e.prototype._codeEquals=function(t){return _g(t)===this.code},Object.defineProperty(e.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(t){this.customData.serverResponse=t,this.message=this.customData.serverResponse?this._baseMessage+"\n"+this.customData.serverResponse:this._baseMessage},enumerable:!1,configurable:!0}),e}(o.FirebaseError);function _g(t){return"storage/"+t}function wg(){return new bg("unknown","An unknown error occurred, please check the error payload for server response.")}function Tg(){return new bg("canceled","User canceled the upload/download.")}function Ig(){return new bg("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function Eg(t){return new bg("invalid-argument",t)}function Og(){return new bg("app-deleted","The Firebase app was deleted.")}function Sg(t){return new bg("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function kg(t,e){return new bg("invalid-format","String does not match format '"+t+"': "+e)}function Ag(t){throw new bg("internal-error","Internal error: "+t)}var jg={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Cg=function(){return function(t,e){this.data=t,this.contentType=e||null}}();function Ng(t,e){switch(t){case jg.RAW:return new Cg(Dg(e));case jg.BASE64:case jg.BASE64URL:return new Cg(xg(t,e));case jg.DATA_URL:return new Cg((n=new Rg(e)).base64?xg(jg.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(jp){throw kg(jg.DATA_URL,"Malformed data URL.")}return Dg(e)}(n.rest),new Rg(e).contentType)}var n;throw wg()}function Dg(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1))){var i=r,o=t.charCodeAt(++n);e.push(240|(r=65536|(1023&i)<<10|1023&o)>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function xg(t,e){switch(t){case jg.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw kg(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case jg.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw kg(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var s;try{s=atob(e)}catch(jp){throw kg(t,"Invalid character found")}for(var a=new Uint8Array(s.length),u=0;u<s.length;u++)a[u]=s.charCodeAt(u);return a}var Rg=function(){return function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw kg(jg.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r,i=e[1]||null;null!=i&&(this.base64=(n=i).length>=(r=";base64").length&&n.substring(n.length-r.length)===r,this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=t.substring(t.indexOf(",")+1)}}(),Pg={STATE_CHANGED:"state_changed"},Mg={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Lg(t){switch(t){case"running":case"pausing":case"canceling":return Mg.RUNNING;case"paused":return Mg.PAUSED;case"success":return Mg.SUCCESS;case"canceled":return Mg.CANCELED;case"error":default:return Mg.ERROR}}var Fg=function(t){return t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT",t}({}),Ug=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Fg.NO_ERROR,this.sendPromise_=new Promise(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=Fg.ABORT,e()}),t.xhr_.addEventListener("error",function(){t.errorCode_=Fg.NETWORK_ERROR,e()}),t.xhr_.addEventListener("load",function(){e()})})}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw Ag("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==r)for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw Ag("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw Ag("cannot .getStatus() before sending");try{return this.xhr_.status}catch(jp){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw Ag("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)},t}(),qg=function(){function t(){}return t.prototype.createConnection=function(){return new Ug},t}(),Vg=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e,n){var r;try{r=t.makeFromUrl(e,n)}catch(jp){return new t(e,"")}if(""===r.path)return r;throw new bg("invalid-default-bucket","Invalid default bucket '"+e+"'.")},t.makeFromUrl=function(e,n){var r=null,i="([A-Za-z0-9.\\-_]+)",o=new RegExp("^gs://"+i+"(/(.*))?$","i");function s(t){t.path_=decodeURIComponent(t.path)}for(var a=n.replace(/[.]/g,"\\."),u=[{regex:o,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+a+"/v[A-Za-z0-9_]+/b/"+i+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp("^https?://"+(n===mg?"(?:storage.googleapis.com|storage.cloud.google.com)":n)+"/"+i+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:s}],c=0;c<u.length;c++){var h=u[c],l=h.regex.exec(e);if(l){var f=l[h.indices.path];f||(f=""),r=new t(l[h.indices.bucket],f),h.postModify(r);break}}if(null==r)throw function(t){return new bg("invalid-url","Invalid URL '"+t+"'.")}(e);return r},t}(),Bg=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}();function Kg(t){return"string"==typeof t||t instanceof String}function Gg(t){return zg()&&t instanceof Blob}function zg(){return"undefined"!=typeof Blob}function Hg(t,e,n,r){if(r<e)throw Eg("Invalid value for '"+t+"'. Expected "+e+" or greater.");if(r>n)throw Eg("Invalid value for '"+t+"'. Expected "+n+" or less.")}function Wg(t,e){var n=e.match(/^(\w+):\/\/.+/),r=e;return null==(null==n?void 0:n[1])&&(r="https://"+e),r+"/v0"+t}function Qg(t){var e=encodeURIComponent,n="?";for(var r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n.slice(0,-1)}var $g=function(){function t(t,e,n,r,i,o,s,a,u,c,h){var l=this;this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=s,this.errorCallback_=a,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,s=n.connection;if(n.wasSuccessCode)try{var a=t.callback_(s,s.getResponseText());void 0!==a?i(a):i()}catch(jp){o(jp)}else null!==s?((r=wg()).serverResponse=s.getResponseText(),o(t.errorCallback_?t.errorCallback_(s,r):r)):o(r=n.canceled?t.appDelete_?Og():Tg():new bg("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new Xg(!1,null,!0)):this.backoffId_=function(e,n,r){var o=1,s=null,a=!1,u=0;function c(){return 2===u}var h=!1;function l(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];h||(h=!0,n.apply(null,t))}function f(e){s=setTimeout(function(){s=null,function(e,n){if(n)e(!1,new Xg(!1,null,!0));else{var r=t.pool_.createConnection();t.pendingConnection_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(){null!==t.progressCallback_&&r.removeUploadProgressListener(i),t.pendingConnection_=null;var n=r.getErrorCode()===Fg.NO_ERROR,o=r.getStatus();if(n&&!t.isRetryStatusCode_(o)){var s=-1!==t.successCodes_.indexOf(o);e(!0,new Xg(s,r))}else{var a=r.getErrorCode()===Fg.ABORT;e(!1,new Xg(!1,null,a))}})}function i(e){null!==t.progressCallback_&&t.progressCallback_(e.loaded,e.lengthComputable?e.total:-1)}}(p,c())},e)}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!h)if(t)l.call.apply(l,Object(i.__spreadArray)([null,t],e));else{var r;c()||a?l.call.apply(l,Object(i.__spreadArray)([null,t],e)):(o<64&&(o*=2),1===u?(u=2,r=0):r=1e3*(o+Math.random()),f(r))}}var d=!1;function g(t){d||(d=!0,h||(null!==s?(t||(u=2),clearTimeout(s),f(0)):t||(u=1)))}return f(0),setTimeout(function(){a=!0,g(!0)},r),g}(0,e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),Xg=function(){return function(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}();function Yg(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Jg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Yg();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(zg())return new Blob(t);throw new bg("unsupported-environment","This browser doesn't seem to support creating Blobs")}var Zg=function(){function t(t,e){var n=0,r="";Gg(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(Gg(this.data_)){var r=(o=e,s=n,(i=this.data_).webkitSlice?i.webkitSlice(o,s):i.mozSlice?i.mozSlice(o,s):i.slice?i.slice(o,s):null);return null===r?null:new t(r)}var i,o,s;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(zg()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(Jg.apply(null,r))}var i=e.map(function(t){return Kg(t)?Ng(jg.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var s=new Uint8Array(o),a=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)s[a++]=t[e]}),new t(s,!0)},t.prototype.uploadData=function(){return this.data_},t}();function tv(t){var e,n;try{e=JSON.parse(t)}catch(jp){return null}return"object"!=typeof(n=e)||Array.isArray(n)?null:e}function ev(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function nv(t,e){return e}var rv=function(){return function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||nv}}(),iv=null;function ov(){if(iv)return iv;var t=[];t.push(new rv("bucket")),t.push(new rv("generation")),t.push(new rv("metageneration")),t.push(new rv("name","fullPath",!0));var e=new rv("name");e.xform=function(t,e){return function(t){return!Kg(t)||t.length<2?t:ev(t)}(e)},t.push(e);var n=new rv("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new rv("timeCreated")),t.push(new rv("updated")),t.push(new rv("md5Hash",null,!0)),t.push(new rv("cacheControl",null,!0)),t.push(new rv("contentDisposition",null,!0)),t.push(new rv("contentEncoding",null,!0)),t.push(new rv("contentLanguage",null,!0)),t.push(new rv("contentType",null,!0)),t.push(new rv("metadata","customMetadata",!0)),iv=t}function sv(t,e,n){var r=tv(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var s=n[o];r[s.local]=s.xform(r,e[s.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=new Vg(t.bucket,t.fullPath);return e._makeStorageReference(n)}})}(r,t),r}(t,r,n)}function av(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}var uv=function(){return function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();function cv(t){if(!t)throw wg()}function hv(t,e){return function(n,r){var i=sv(t,r,e);return cv(null!==i),i}}function lv(t){return function(e,n){var r;return(r=401===e.getStatus()?e.getResponseText().includes("Firebase App Check token is invalid")?new bg("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new bg("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?new bg("quota-exceeded","Quota for bucket '"+t.bucket+"' exceeded, please view quota on https://firebase.google.com/pricing/."):403===e.getStatus()?new bg("unauthorized","User does not have permission to access '"+t.path+"'."):n).serverResponse=n.serverResponse,r}}function fv(t){var e=lv(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=new bg("object-not-found","Object '"+t.path+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function pv(t,e,n){var r=Wg(e.fullServerUrl(),t.host),i=t.maxOperationRetryTime,o=new uv(r,"GET",hv(t,n),i);return o.errorHandler=fv(e),o}function dv(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var gv=function(){return function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null}}();function vv(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(jp){cv(!1)}return cv(!!n&&-1!==(e||["active"]).indexOf(n)),n}var yv=262144,mv=function(){return function(t,e,n){if("function"==typeof t||null!=e||null!=n)this.next=t,this.error=e,this.complete=n;else{var r=t;this.next=r.next,this.error=r.error,this.complete=r.complete}}}();function bv(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then(function(){return t.apply(void 0,e)})}}var _v=function(){function t(t,e,n){var r=this;void 0===n&&(n=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=e,this._metadata=n,this._mappings=ov(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=function(t){r._request=void 0,r._chunkMultiplier=1,t._codeEquals("canceled")?(r._needToFetchStatus=!0,r.completeTransitions_()):(r._error=t,r._transition("error"))},this._metadataErrorHandler=function(t){r._request=void 0,t._codeEquals("canceled")?r.completeTransitions_():(r._error=t,r._transition("error"))},this._promise=new Promise(function(t,e){r._resolve=t,r._reject=e,r._start()}),this._promise.then(null,function(){})}return t.prototype._makeProgressCallback=function(){var t=this,e=this._transferred;return function(n){return t._updateProgress(e+n)}},t.prototype._shouldDoResumable=function(t){return t.size()>262144},t.prototype._start=function(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},t.prototype._resolveToken=function(t){var e=this;Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(function(n){var r=n[0],i=n[1];switch(e._state){case"running":t(r,i);break;case"canceling":e._transition("canceled");break;case"pausing":e._transition("paused")}})},t.prototype._createResumable=function(){var t=this;this._resolveToken(function(e,n){var r=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s=dv(e,r,i),a={name:s.fullPath},u=Wg(o,t.host),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+r.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},h=av(s,n),l=new uv(u,"POST",function(t){var e;vv(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(jp){cv(!1)}return cv(Kg(e)),e},t.maxUploadRetryTime);return l.urlParams=a,l.headers=c,l.body=h,l.errorHandler=lv(e),l}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._uploadUrl=e,t._needToFetchStatus=!1,t.completeTransitions_()},t._errorHandler)})},t.prototype._fetchStatus=function(){var t=this,e=this._uploadUrl;this._resolveToken(function(n,r){var i=function(t,e,n,r){var i=new uv(n,"POST",function(t){var e=vv(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(jp){cv(!1)}n||cv(!1);var i=Number(n);return cv(!isNaN(i)),new gv(i,r.size(),"final"===e)},t.maxUploadRetryTime);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=lv(e),i}(t._ref.storage,t._ref._location,e,t._blob),o=t._ref.storage._makeRequest(i,n,r);t._request=o,o.getPromise().then(function(e){e=e,t._request=void 0,t._updateProgress(e.current),t._needToFetchStatus=!1,e.finalized&&(t._needToFetchMetadata=!0),t.completeTransitions_()},t._errorHandler)})},t.prototype._continueUpload=function(){var t=this,e=yv*this._chunkMultiplier,n=new gv(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken(function(i,o){var s;try{s=function(t,e,n,r,i,o,s,a){var u=new gv(0,0);if(s?(u.current=s.current,u.total=s.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new bg("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;i>0&&(h=Math.min(h,i));var l=u.current,f={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":""+u.current},p=r.slice(l,l+h);if(null===p)throw Ig();var d=new uv(n,"POST",function(t,n){var i,s=vv(t,["active","final"]),a=u.current+h,c=r.size();return i="final"===s?hv(e,o)(t,n):null,new gv(a,c,"final"===s,i)},e.maxUploadRetryTime);return d.headers=f,d.body=p.uploadData(),d.progressCallback=a||null,d.errorHandler=lv(t),d}(t._ref._location,t._ref.storage,r,t._blob,e,t._mappings,n,t._makeProgressCallback())}catch(jp){return t._error=jp,void t._transition("error")}var a=t._ref.storage._makeRequest(s,i,o);t._request=a,a.getPromise().then(function(e){t._increaseMultiplier(),t._request=void 0,t._updateProgress(e.current),e.finalized?(t._metadata=e.metadata,t._transition("success")):t.completeTransitions_()},t._errorHandler)})},t.prototype._increaseMultiplier=function(){yv*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},t.prototype._fetchMetadata=function(){var t=this;this._resolveToken(function(e,n){var r=pv(t._ref.storage,t._ref._location,t._mappings),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._transition("success")},t._metadataErrorHandler)})},t.prototype._oneShotUpload=function(){var t=this;this._resolveToken(function(e,n){var r=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();s["Content-Type"]="multipart/related; boundary="+a;var u=dv(e,r,i),c=av(u,n),h=Zg.getBlob("--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+c+"\r\n--"+a+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",r,"\r\n--"+a+"--");if(null===h)throw Ig();var l={name:u.fullPath},f=Wg(o,t.host),p=t.maxUploadRetryTime,d=new uv(f,"POST",hv(t,n),p);return d.urlParams=l,d.headers=s,d.body=h.uploadData(),d.errorHandler=lv(e),d}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._updateProgress(t._blob.size()),t._transition("success")},t._errorHandler)})},t.prototype._updateProgress=function(t){var e=this._transferred;this._transferred=t,this._transferred!==e&&this._notifyObservers()},t.prototype._transition=function(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,void 0!==this._request&&this._request.cancel();break;case"running":var e="paused"===this._state;this._state=t,e&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=Tg(),this._state=t,this._notifyObservers();break;case"error":case"success":this._state=t,this._notifyObservers()}},t.prototype.completeTransitions_=function(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=Lg(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}},enumerable:!1,configurable:!0}),t.prototype.on=function(t,e,n,r){var i=this,o=new mv(e,n,r);return this._addObserver(o),function(){i._removeObserver(o)}},t.prototype.then=function(t,e){return this._promise.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype._addObserver=function(t){this._observers.push(t),this._notifyObserver(t)},t.prototype._removeObserver=function(t){var e=this._observers.indexOf(t);-1!==e&&this._observers.splice(e,1)},t.prototype._notifyObservers=function(){var t=this;this._finishPromise(),this._observers.slice().forEach(function(e){t._notifyObserver(e)})},t.prototype._finishPromise=function(){if(void 0!==this._resolve){var t=!0;switch(Lg(this._state)){case Mg.SUCCESS:bv(this._resolve.bind(null,this.snapshot))();break;case Mg.CANCELED:case Mg.ERROR:bv(this._reject.bind(null,this._error))();break;default:t=!1}t&&(this._resolve=void 0,this._reject=void 0)}},t.prototype._notifyObserver=function(t){switch(Lg(this._state)){case Mg.RUNNING:case Mg.PAUSED:t.next&&bv(t.next.bind(t,this.snapshot))();break;case Mg.SUCCESS:t.complete&&bv(t.complete.bind(t))();break;case Mg.CANCELED:case Mg.ERROR:t.error&&bv(t.error.bind(t,this._error))();break;default:t.error&&bv(t.error.bind(t,this._error))()}},t.prototype.resume=function(){var t="paused"===this._state||"pausing"===this._state;return t&&this._transition("running"),t},t.prototype.pause=function(){var t="running"===this._state;return t&&this._transition("pausing"),t},t.prototype.cancel=function(){var t="running"===this._state||"pausing"===this._state;return t&&this._transition("canceling"),t},t}(),wv=function(){function t(t,e){this._service=t,this._location=e instanceof Vg?e:Vg.makeFromUrl(e,t.host)}return t.prototype.toString=function(){return"gs://"+this._location.bucket+"/"+this._location.path},t.prototype._newRef=function(e,n){return new t(e,n)},Object.defineProperty(t.prototype,"root",{get:function(){var t=new Vg(this._location.bucket,"");return this._newRef(this._service,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return ev(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===e)return null;var n=new Vg(this._location.bucket,e);return new t(this._service,n)},enumerable:!1,configurable:!0}),t.prototype._throwIfRoot=function(t){if(""===this._location.path)throw Sg(t)},t}();function Tv(t){var e={prefixes:[],items:[]};return Iv(t,e).then(function(){return e})}function Iv(t,e,n){return Object(i.__awaiter)(this,void 0,void 0,function(){var r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Ev(t,{pageToken:n})];case 1:return r=i.sent(),(o=e.prefixes).push.apply(o,r.prefixes),(s=e.items).push.apply(s,r.items),null==r.nextPageToken?[3,3]:[4,Iv(t,e,r.nextPageToken)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function Ev(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return null!=e&&"number"==typeof e.maxResults&&Hg("options.maxResults",1,1e3,e.maxResults),r=function(t,e,n,r,i){var o={};o.prefix=e.isRoot?"":e.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var s=Wg(e.bucketOnlyServerUrl(),t.host),a=t.maxOperationRetryTime,u=new uv(s,"GET",function(t,e){return function(n,r){var i=function(t,e,n){var r=tv(n);return null===r?null:function(t,e,n){var r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(var i=0,o=n.prefixes;i<o.length;i++){var s=o[i].replace(/\/$/,""),a=t._makeStorageReference(new Vg(e,s));r.prefixes.push(a)}if(n.items)for(var u=0,c=n.items;u<c.length;u++)a=t._makeStorageReference(new Vg(e,c[u].name)),r.items.push(a);return r}(t,e,r)}(t,e,r);return cv(null!==i),i}}(t,e.bucket),a);return u.urlParams=o,u.errorHandler=lv(e),u}(t.storage,t._location,"/",(n=e||{}).pageToken,n.maxResults),[4,t.storage.makeRequestWithTokens(r)];case 1:return[2,i.sent().getPromise()]}})})}function Ov(t,e){var n=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),r=new Vg(t._location.bucket,n);return new wv(t.storage,r)}function Sv(t){return/^[A-Za-z]+:\/\//.test(t)}function kv(t,e){if(t instanceof Cv){var n=t;if(null==n._bucket)throw new bg("no-default-bucket","No default bucket found. Did you set the 'storageBucket' property when initializing the app?");var r=new wv(n,n._bucket);return null!=e?kv(r,e):r}if(void 0!==e){if(e.includes(".."))throw Eg('`path` param cannot contain ".."');return Ov(t,e)}return t}function Av(t,e){if(e&&Sv(e)){if(t instanceof Cv)return new wv(t,e);throw Eg("To use ref(service, url), the first argument must be a Storage instance.")}return kv(t,e)}function jv(t,e){var n=null==e?void 0:e.storageBucket;return null==n?null:Vg.makeFromBucketSpec(n,t)}var Cv=function(){function t(t,e,n,r,i,o){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=o,this._bucket=null,this._host=mg,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?Vg.makeFromBucketSpec(i,this._host):jv(this._host,this.app.options)}return Object.defineProperty(t.prototype,"host",{get:function(){return this._host},set:function(t){this._host=t,this._bucket=null!=this._url?Vg.makeFromBucketSpec(this._url,t):jv(t,this.app.options)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._maxUploadRetryTime},set:function(t){Hg("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._maxOperationRetryTime},set:function(t){Hg("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t},enumerable:!1,configurable:!0}),t.prototype._getAuthToken=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return(t=this._authProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:if(null!==(e=n.sent()))return[2,e.accessToken];n.label=2;case 2:return[2,null]}})})},t.prototype._getAppCheckToken=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t;return Object(i.__generator)(this,function(e){switch(e.label){case 0:return(t=this._appCheckProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:return[2,e.sent().token];case 2:return[2,null]}})})},t.prototype._delete=function(){return this._deleted=!0,this._requests.forEach(function(t){return t.cancel()}),this._requests.clear(),Promise.resolve()},t.prototype._makeStorageReference=function(t){return new wv(this,t)},t.prototype._makeRequest=function(t,e,n){var r=this;if(this._deleted)return new Bg(Og());var i=function(t,e,n,r,i,o){var s=Qg(t.urlParams),a=t.url+s,u=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(u,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(u,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(u,o),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(u,r),new $g(a,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}(t,this._appId,e,n,this._pool,this._firebaseVersion);return this._requests.add(i),i.getPromise().then(function(){return r._requests.delete(i)},function(){return r._requests.delete(i)}),i},t.prototype.makeRequestWithTokens=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return[4,Promise.all([this._getAuthToken(),this._getAppCheckToken()])];case 1:return e=n.sent(),[2,this._makeRequest(t,e[0],e[1])]}})})},t}();function Nv(t,e){return Av(t=Object(o.getModularInstance)(t),e)}var Dv=function(){function t(t,e,n){this._delegate=t,this.task=e,this.ref=n}return Object.defineProperty(t.prototype,"bytesTransferred",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalBytes",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),t}(),xv=function(){function t(t,e){this._delegate=t,this._ref=e,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}return Object.defineProperty(t.prototype,"snapshot",{get:function(){return new Dv(this._delegate.snapshot,this,this._ref)},enumerable:!1,configurable:!0}),t.prototype.then=function(t,e){var n=this;return this._delegate.then(function(e){if(t)return t(new Dv(e,n,n._ref))},e)},t.prototype.on=function(t,e,n,r){var i=this,o=void 0;return e&&(o="function"==typeof e?function(t){return e(new Dv(t,i,i._ref))}:{next:e.next?function(t){return e.next(new Dv(t,i,i._ref))}:void 0,complete:e.complete||void 0,error:e.error||void 0}),this._delegate.on(t,o,n||void 0,r||void 0)},t}(),Rv=function(){function t(t,e){this._delegate=t,this._service=e}return Object.defineProperty(t.prototype,"prefixes",{get:function(){var t=this;return this._delegate.prefixes.map(function(e){return new Pv(e,t._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){var t=this;return this._delegate.items.map(function(e){return new Pv(e,t._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextPageToken",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),t}(),Pv=function(){function t(t,e){this._delegate=t,this.storage=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this._delegate.toString()},t.prototype.child=function(e){return new t(function(t,e){return Ov(t,e)}(this._delegate,e),this.storage)},Object.defineProperty(t.prototype,"root",{get:function(){return new t(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=this._delegate.parent;return null==e?null:new t(e,this.storage)},enumerable:!1,configurable:!0}),t.prototype.put=function(t,e){return this._throwIfRoot("put"),new xv(function(t,e,n){return function(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new _v(t,new Zg(e),n)}(t=Object(o.getModularInstance)(t),e,n)}(this._delegate,t,e),this)},t.prototype.putString=function(t,e,n){void 0===e&&(e=jg.RAW),this._throwIfRoot("putString");var r=Ng(e,t),o=Object(i.__assign)({},n);return null==o.contentType&&null!=r.contentType&&(o.contentType=r.contentType),new xv(new _v(this._delegate,new Zg(r.data,!0),o),this)},t.prototype.listAll=function(){var t,e=this;return(t=this._delegate,Tv(t=Object(o.getModularInstance)(t))).then(function(t){return new Rv(t,e.storage)})},t.prototype.list=function(t){var e=this;return function(t,e){return Ev(t=Object(o.getModularInstance)(t),e)}(this._delegate,t||void 0).then(function(t){return new Rv(t,e.storage)})},t.prototype.getMetadata=function(){return t=this._delegate,function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("getMetadata"),e=pv(t.storage,t._location,ov()),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise()]}})})}(t=Object(o.getModularInstance)(t));var t},t.prototype.updateMetadata=function(t){return function(t,e){return function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return t._throwIfRoot("updateMetadata"),n=function(t,e,n,r){var i=Wg(e.fullServerUrl(),t.host),o=av(n,r),s=t.maxOperationRetryTime,a=new uv(i,"PATCH",hv(t,r),s);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=o,a.errorHandler=fv(e),a}(t.storage,t._location,e,ov()),[4,t.storage.makeRequestWithTokens(n)];case 1:return[2,r.sent().getPromise()]}})})}(t=Object(o.getModularInstance)(t),e)}(this._delegate,t)},t.prototype.getDownloadURL=function(){return t=this._delegate,function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("getDownloadURL"),e=function(t,e,n){var r=Wg(e.fullServerUrl(),t.host),i=t.maxOperationRetryTime,o=new uv(r,"GET",function(t,e){return function(n,r){var i=sv(t,r,e);return cv(null!==i),function(t,e,n){var r=tv(e);if(null===r)return null;if(!Kg(r.downloadTokens))return null;var i=r.downloadTokens;if(0===i.length)return null;var o=encodeURIComponent;return i.split(",").map(function(e){var r=t.fullPath;return Wg("/b/"+o(t.bucket)+"/o/"+o(r),n)+Qg({alt:"media",token:e})})[0]}(i,r,t.host)}}(t,n),i);return o.errorHandler=fv(e),o}(t.storage,t._location,ov()),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise().then(function(t){if(null===t)throw new bg("no-download-url","The given file does not have any download URLs.");return t})]}})})}(t=Object(o.getModularInstance)(t));var t},t.prototype.delete=function(){return this._throwIfRoot("delete"),t=this._delegate,function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("deleteObject"),e=function(t,e){var n=Wg(e.fullServerUrl(),t.host),r=new uv(n,"DELETE",function(t,e){},t.maxOperationRetryTime);return r.successCodes=[200,204],r.errorHandler=fv(e),r}(t.storage,t._location),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise()]}})})}(t=Object(o.getModularInstance)(t));var t},t.prototype._throwIfRoot=function(t){if(""===this._delegate._location.path)throw Sg(t)},t}(),Mv=function(){function t(t,e){var n=this;this.app=t,this._delegate=e,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),t.prototype.ref=function(t){if(Sv(t))throw Eg("ref() expected a child path but got a URL, use refFromURL instead.");return new Pv(Nv(this._delegate,t),this)},t.prototype.refFromURL=function(t){if(!Sv(t))throw Eg("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Vg.makeFromUrl(t,this._delegate.host)}catch(jp){throw Eg("refFromUrl() expected a valid full URL but got an invalid one.")}return new Pv(Nv(this._delegate,t),this)},t.prototype.setMaxUploadRetryTime=function(t){this._delegate.maxUploadRetryTime=t},t.prototype.setMaxOperationRetryTime=function(t){this._delegate.maxOperationRetryTime=t},t.prototype.useEmulator=function(t,e){!function(t,e,n){t.host="http://"+e+":"+n}(this._delegate,t,e)},t}();function Lv(t,e){var n=e.instanceIdentifier,i=t.getProvider("app").getImmediate(),o=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new Mv(i,new Cv(i,o,s,new qg,n,r.default.SDK_VERSION))}!function(t){var e={TaskState:Mg,TaskEvent:Pg,StringFormat:jg,Storage:Cv,Reference:Pv};t.INTERNAL.registerComponent(new xp.Component("storage",Lv,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),t.registerVersion("@firebase/storage","0.5.6")}(r.default);var Fv,Uv,qv,Vv="0.4.16",Bv=Vv,Kv="FB-PERF-TRACE-MEASURE",Gv="_wt_",zv="_fcp",Hv="_fid",Wv="@firebase/performance/config",Qv="@firebase/performance/configexpire",$v="Performance",Xv=((Fv={})["trace started"]="Trace {$traceName} was started before.",Fv["trace stopped"]="Trace {$traceName} is not running.",Fv["nonpositive trace startTime"]="Trace {$traceName} startTime should be positive.",Fv["nonpositive trace duration"]="Trace {$traceName} duration should be positive.",Fv["no window"]="Window is not available.",Fv["no app id"]="App id is not available.",Fv["no project id"]="Project id is not available.",Fv["no api key"]="Api key is not available.",Fv["invalid cc log"]="Attempted to queue invalid cc event",Fv["FB not default"]="Performance can only start when Firebase app instance is the default one.",Fv["RC response not ok"]="RC response is not ok",Fv["invalid attribute name"]="Attribute name {$attributeName} is invalid.",Fv["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",Fv["invalid custom metric name"]="Custom metric name {$customMetricName} is invalid",Fv["invalid String merger input"]="Input for String merger is invalid, contact support team to resolve.",Fv),Yv=new o.ErrorFactory("performance",$v,Xv),Jv=new s.Logger($v);Jv.logLevel=s.LogLevel.INFO;var Zv,ty=function(){function t(t){if(this.window=t,!t)throw Yv.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}return t.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},t.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},t.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},t.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},t.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},t.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},t.prototype.requiredApisAvailable=function(){return fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled?!!Object(o.isIndexedDBAvailable)()||(Jv.info("IndexedDB is not supported by current browswer"),!1):(Jv.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)},t.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var n=0,r=t.getEntries();n<r.length;n++)e(r[n])}).observe({entryTypes:[t]})},t.getInstance=function(){return void 0===Uv&&(Uv=new t(qv)),Uv},t}();function ey(t,e){var n=t.length-e.length;if(n<0||n>1)throw Yv.create("invalid String merger input");for(var r=[],i=0;i<t.length;i++)r.push(t.charAt(i)),e.length>i&&r.push(e.charAt(i));return r.join("")}var ny,ry=function(){function t(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=ey("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=ey("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return t.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw Yv.create("no app id");return t},t.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw Yv.create("no project id");return t},t.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw Yv.create("no api key");return t},t.prototype.getFlTransportFullUrl=function(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)},t.getInstance=function(){return void 0===Zv&&(Zv=new t),Zv},t}();function iy(){return ny}var oy=function(t){return t[t.UNKNOWN=0]="UNKNOWN",t[t.VISIBLE=1]="VISIBLE",t[t.HIDDEN=2]="HIDDEN",t}({}),sy=["firebase_","google_","ga_"],ay=new RegExp("^[a-zA-Z]\\w*$");function uy(){var t=ty.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}function cy(){switch(ty.getInstance().document.visibilityState){case"visible":return oy.VISIBLE;case"hidden":return oy.HIDDEN;default:return oy.UNKNOWN}}function hy(){var t=ty.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function ly(t){if(!t)return t;var e=ry.getInstance(),n=t.entries||{};return e.loggingEnabled=void 0===n.fpr_enabled||"true"===String(n.fpr_enabled),n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(e.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=fy(e.tracesSamplingRate),e.logNetworkAfterSampling=fy(e.networkRequestsSamplingRate),t}function fy(t){return Math.random()<=t}var py,dy=1;function gy(){return dy=2,py=py||function(){var t=ty.getInstance().document;return new Promise(function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()})}().then(function(){return(t=ry.getInstance().installationsService.getId()).then(function(t){ny=t}),t;var t}).then(function(t){return function(t){var e=function(){var t=ty.getInstance().localStorage;if(t){var e=t.getItem(Qv);if(e&&Number(e)>Date.now()){var n=t.getItem(Wv);if(n)try{return JSON.parse(n)}catch(r){return}}}}();return e?(ly(e),Promise.resolve()):function(t){return(e=ry.getInstance().installationsService.getToken(),e.then(function(t){}),e).then(function(e){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+ry.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+ry.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:"FIREBASE_INSTALLATIONS_AUTH "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:ry.getInstance().getAppId(),app_version:Bv,sdk_version:"0.0.1"})});return fetch(r).then(function(t){if(t.ok)return t.json();throw Yv.create("RC response not ok")})}).catch(function(){Jv.info("Could not fetch config, will use default configs")});var e}(t).then(ly).then(function(t){return function(t){var e=ty.getInstance().localStorage;t&&e&&(e.setItem(Wv,JSON.stringify(t)),e.setItem(Qv,String(Date.now()+60*ry.getInstance().configTimeToLive*60*1e3)))}(t)},function(){})}(t)}).then(function(){return vy()},function(){return vy()})}function vy(){dy=3}var yy,my=1e4,by=3,_y=[],wy=!1;function Ty(t){setTimeout(function(){var t,e;if(0!==by)return _y.length?(e=(t=_y.splice(0,1e3)).map(function(t){return{source_extension_json_proto3:t.message,event_time_ms:String(t.eventTime)}}),void function(t,e){return function(t){var e=ry.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(t)})}(t).then(function(t){return t.ok||Jv.info("Call to Firebase backend failed."),t.json()}).then(function(t){var n=Number(t.nextRequestWaitMillis),r=my;isNaN(n)||(r=Math.max(n,r));var o=t.logResponseDetails;Array.isArray(o)&&o.length>0&&"RETRY_REQUEST_LATER"===o[0].responseAction&&(_y=Object(i.__spreadArray)(Object(i.__spreadArray)([],e),_y),Jv.info("Retry transport request later.")),by=3,Ty(r)})}({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:ry.getInstance().logSource,log_event:e},t).catch(function(){_y=Object(i.__spreadArray)(Object(i.__spreadArray)([],t),_y),by--,Jv.info("Tries left: "+by+"."),Ty(my)})):Ty(my)},t)}function Iy(t){if(!t.eventTime||!t.message)throw Yv.create("invalid cc log");_y=Object(i.__spreadArray)(Object(i.__spreadArray)([],_y),[t])}function Ey(t,e){yy||(yy=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Iy({message:t.apply(void 0,e),eventTime:Date.now()})}}(ky)),yy(t,e)}function Oy(t){var e=ry.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&ty.getInstance().requiredApisAvailable()&&(t.isAuto&&cy()!==oy.VISIBLE||(3===dy?Sy(t):gy().then(function(){return Sy(t)},function(){return Sy(t)})))}function Sy(t){if(iy()){var e=ry.getInstance();e.loggingEnabled&&e.logTraceAfterSampling&&setTimeout(function(){return Ey(t,1)},0)}}function ky(t,e){return 0===e?(r={url:(n=t).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},i={application_info:Ay(),network_request_metric:r},JSON.stringify(i)):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=t.counters);var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=n);var r={application_info:Ay(),trace_metric:e};return JSON.stringify(r)}(t);var n,r,i}function Ay(){return{google_app_id:ry.getInstance().getAppId(),app_instance_id:iy(),web_app_info:{sdk_version:Bv,page_url:ty.getInstance().getUrl(),service_worker_status:uy(),visibility_state:cy(),effective_connection_type:hy()},application_process_state:0}}var jy=["_fp",zv,Hv],Cy=function(){function t(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=ty.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||"FB-PERF-TRACE-MEASURE-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}return t.prototype.start=function(){if(1!==this.state)throw Yv.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},t.prototype.stop=function(){if(2!==this.state)throw Yv.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Oy(this)},t.prototype.record=function(t,e,n){if(t<=0)throw Yv.create("nonpositive trace startTime",{traceName:this.name});if(e<=0)throw Yv.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=Object(i.__assign)({},n.attributes)),n&&n.metrics)for(var r=0,o=Object.keys(n.metrics);r<o.length;r++){var s=o[r];isNaN(Number(n.metrics[s]))||(this.counters[s]=Number(Math.floor(n.metrics[s])))}Oy(this)},t.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),this.putMetric(t,void 0===this.counters[t]?e:this.counters[t]+e)},t.prototype.putMetric=function(t,e){if(o=this.name,0===(i=t).length||i.length>100||!(o&&o.startsWith(Gv)&&jy.indexOf(i)>-1)&&i.startsWith("_"))throw Yv.create("invalid custom metric name",{customMetricName:t});var n,r,i,o;this.counters[t]=(n=e,(r=Math.floor(n))<n&&Jv.info("Metric value should be an Integer, setting the value as : "+r+"."),r)},t.prototype.getMetric=function(t){return this.counters[t]||0},t.prototype.putAttribute=function(t,e){var n,r=!(0===(n=t).length||n.length>40||sy.some(function(t){return n.startsWith(t)})||!n.match(ay)),i=function(t){return 0!==t.length&&t.length<=100}(e);if(r&&i)this.customAttributes[t]=e;else{if(!r)throw Yv.create("invalid attribute name",{attributeName:t});if(!i)throw Yv.create("invalid attribute value",{attributeValue:e})}},t.prototype.getAttribute=function(t){return this.customAttributes[t]},t.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},t.prototype.getAttributes=function(){return Object(i.__assign)({},this.customAttributes)},t.prototype.setStartTime=function(t){this.startTimeUs=t},t.prototype.setDuration=function(t){this.durationUs=t},t.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},t.createOobTrace=function(e,n,r){var i=ty.getInstance().getUrl();if(i){var o=new t(Gv+i,!0),s=Math.floor(1e3*ty.getInstance().getTimeOrigin());if(o.setStartTime(s),e&&e[0]&&(o.setDuration(Math.floor(1e3*e[0].duration)),o.putMetric("domInteractive",Math.floor(1e3*e[0].domInteractive)),o.putMetric("domContentLoadedEventEnd",Math.floor(1e3*e[0].domContentLoadedEventEnd)),o.putMetric("loadEventEnd",Math.floor(1e3*e[0].loadEventEnd))),n){var a=n.find(function(t){return"first-paint"===t.name});a&&a.startTime&&o.putMetric("_fp",Math.floor(1e3*a.startTime));var u=n.find(function(t){return"first-contentful-paint"===t.name});u&&u.startTime&&o.putMetric(zv,Math.floor(1e3*u.startTime)),r&&o.putMetric(Hv,Math.floor(1e3*r))}Oy(o)}},t.createUserTimingTrace=function(e){Oy(new t(e,!1,e))},t}();function Ny(t){var e=t;if(e&&void 0!==e.responseStart){var n=ty.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=ry.getInstance();if(e.instrumentationEnabled){var n=t.url,r=e.logEndPointUrl.split("?")[0],i=e.flTransportEndpointUrl.split("?")[0];n!==r&&n!==i&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return Ey(t,0)},0)}}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}function Dy(){iy()&&(setTimeout(function(){return function(){var t=ty.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){Cy.createOobTrace(e,n),r=void 0},5e3);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),Cy.createOobTrace(e,n,t))})}else Cy.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=ty.getInstance(),e=0,n=t.getEntriesByType("resource");e<n.length;e++)Ny(n[e]);t.setupObserver("resource",Ny)}()},0),setTimeout(function(){return function(){for(var t=ty.getInstance(),e=0,n=t.getEntriesByType("measure");e<n.length;e++)xy(n[e]);t.setupObserver("measure",xy)}()},0))}function xy(t){var e=t.name;e.substring(0,Kv.length)!==Kv&&Cy.createUserTimingTrace(e)}var Ry=function(){function t(t){this.app=t,ty.getInstance().requiredApisAvailable()&&Object(o.validateIndexedDBOpenable)().then(function(t){t&&(wy||(Ty(5500),wy=!0),gy().then(Dy,Dy))}).catch(function(t){Jv.info("Environment doesn't support IndexedDB: "+t)})}return t.prototype.trace=function(t){return new Cy(t)},Object.defineProperty(t.prototype,"instrumentationEnabled",{get:function(){return ry.getInstance().instrumentationEnabled},set:function(t){ry.getInstance().instrumentationEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataCollectionEnabled",{get:function(){return ry.getInstance().dataCollectionEnabled},set:function(t){ry.getInstance().dataCollectionEnabled=t},enumerable:!1,configurable:!0}),t}();!function(t){t.INTERNAL.registerComponent(new xp.Component("performance",function(t){return function(t,e){if("[DEFAULT]"!==t.name)throw Yv.create("FB not default");if("undefined"==typeof window)throw Yv.create("no window");return function(t){qv=t}(window),ry.getInstance().firebaseAppInstance=t,ry.getInstance().installationsService=e,new Ry(t)}(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())},"PUBLIC")),t.registerVersion("@firebase/performance",Vv)}(r.default);var Py,My="https://www.googletagmanager.com/gtag/js",Ly=function(t){return t.EVENT="event",t.SET="set",t.CONFIG="config",t}({}),Fy=function(t){return t.ADD_SHIPPING_INFO="add_shipping_info",t.ADD_PAYMENT_INFO="add_payment_info",t.ADD_TO_CART="add_to_cart",t.ADD_TO_WISHLIST="add_to_wishlist",t.BEGIN_CHECKOUT="begin_checkout",t.CHECKOUT_PROGRESS="checkout_progress",t.EXCEPTION="exception",t.GENERATE_LEAD="generate_lead",t.LOGIN="login",t.PAGE_VIEW="page_view",t.PURCHASE="purchase",t.REFUND="refund",t.REMOVE_FROM_CART="remove_from_cart",t.SCREEN_VIEW="screen_view",t.SEARCH="search",t.SELECT_CONTENT="select_content",t.SELECT_ITEM="select_item",t.SELECT_PROMOTION="select_promotion",t.SET_CHECKOUT_OPTION="set_checkout_option",t.SHARE="share",t.SIGN_UP="sign_up",t.TIMING_COMPLETE="timing_complete",t.VIEW_CART="view_cart",t.VIEW_ITEM="view_item",t.VIEW_ITEM_LIST="view_item_list",t.VIEW_PROMOTION="view_promotion",t.VIEW_SEARCH_RESULTS="view_search_results",t}({}),Uy=new s.Logger("@firebase/analytics");function qy(t,e,n,r,o,s){return Object(i.__awaiter)(this,void 0,void 0,function(){var a,u,c,h;return Object(i.__generator)(this,function(i){switch(i.label){case 0:a=r[o],i.label=1;case 1:return i.trys.push([1,7,,8]),a?[4,e[a]]:[3,3];case 2:return i.sent(),[3,6];case 3:return[4,Promise.all(n)];case 4:return u=i.sent(),(c=u.find(function(t){return t.measurementId===o}))?[4,e[c.appId]]:[3,6];case 5:i.sent(),i.label=6;case 6:return[3,8];case 7:return h=i.sent(),Uy.error(h),[3,8];case 8:return t(Ly.CONFIG,o,s),[2]}})})}function Vy(t,e,n,r,o){return Object(i.__awaiter)(this,void 0,void 0,function(){var s,a,u,c,h,l,f;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),s=[],o&&o.send_to?(a=o.send_to,Array.isArray(a)||(a=[a]),[4,Promise.all(n)]):[3,2];case 1:for(u=i.sent(),c=function(t){var n=u.find(function(e){return e.measurementId===t}),r=n&&e[n.appId];if(!r)return s=[],"break";s.push(r)},h=0,l=a;h<l.length&&"break"!==c(l[h]);h++);i.label=2;case 2:return 0===s.length&&(s=Object.values(e)),[4,Promise.all(s)];case 3:return i.sent(),t(Ly.EVENT,r,o||{}),[3,5];case 4:return f=i.sent(),Uy.error(f),[3,5];case 5:return[2]}})})}var By=((Py={})["already-exists"]="A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",Py["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",Py["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate: {$reason}",Py["invalid-analytics-context"]="Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",Py["indexeddb-unavailable"]="IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",Py["fetch-throttle"]="The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",Py["config-fetch-failed"]="Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",Py["no-api-key"]='The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',Py["no-app-id"]='The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',Py),Ky=new o.ErrorFactory("analytics","Analytics",By),Gy=new(function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e=1e3),this.throttleMetadata=t,this.intervalMillis=e}return t.prototype.getThrottleMetadata=function(t){return this.throttleMetadata[t]},t.prototype.setThrottleMetadata=function(t,e){this.throttleMetadata[t]=e},t.prototype.deleteThrottleMetadata=function(t){delete this.throttleMetadata[t]},t}());function zy(t){var e;return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a,u;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return n=t.appId,r={method:"GET",headers:(c=t.apiKey,new Headers({Accept:"application/json","x-goog-api-key":c}))},o="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),[4,fetch(o,r)];case 1:if(200===(s=i.sent()).status||304===s.status)return[3,6];a="",i.label=2;case 2:return i.trys.push([2,4,,5]),[4,s.json()];case 3:return u=i.sent(),(null===(e=u.error)||void 0===e?void 0:e.message)&&(a=u.error.message),[3,5];case 4:return i.sent(),[3,5];case 5:throw Ky.create("config-fetch-failed",{httpStatus:s.status,responseMessage:a});case 6:return[2,s.json()]}var c})})}function Hy(t,e,n,r){var s=e.throttleEndTimeMillis,a=e.backoffCount;return void 0===r&&(r=Gy),Object(i.__awaiter)(this,void 0,void 0,function(){var e,u,c,h,l,f,p;return Object(i.__generator)(this,function(i){switch(i.label){case 0:e=t.appId,u=t.measurementId,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Wy(n,s)];case 2:return i.sent(),[3,4];case 3:if(c=i.sent(),u)return Uy.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+u+' provided in the "measurementId" field in the local Firebase config. ['+c.message+"]"),[2,{appId:e,measurementId:u}];throw c;case 4:return i.trys.push([4,6,,7]),[4,zy(t)];case 5:return h=i.sent(),r.deleteThrottleMetadata(e),[2,h];case 6:if(!function(t){if(!(t instanceof o.FirebaseError&&t.customData))return!1;var e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(l=i.sent())){if(r.deleteThrottleMetadata(e),u)return Uy.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+u+' provided in the "measurementId" field in the local Firebase config. ['+l.message+"]"),[2,{appId:e,measurementId:u}];throw l}return f=503===Number(l.customData.httpStatus)?Object(o.calculateBackoffMillis)(a,r.intervalMillis,30):Object(o.calculateBackoffMillis)(a,r.intervalMillis),p={throttleEndTimeMillis:Date.now()+f,backoffCount:a+1},r.setThrottleMetadata(e,p),Uy.debug("Calling attemptFetch again in "+f+" millis"),[2,Hy(t,p,n,r)];case 7:return[2]}})})}function Wy(t,e){return new Promise(function(n,r){var i=Math.max(e-Date.now(),0),o=setTimeout(n,i);t.addEventListener(function(){clearTimeout(o),r(Ky.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}var Qy,$y,Xy=function(){function t(){this.listeners=[]}return t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},t}(),Yy={},Jy=[],Zy={},tm="dataLayer",em="gtag",nm=!1;function rm(t){if(nm)throw Ky.create("already-initialized");t.dataLayerName&&(tm=t.dataLayerName),t.gtagName&&(em=t.gtagName)}var im="analytics";function om(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:if(Object(o.isBrowserExtension)())return[2,!1];if(!Object(o.areCookiesEnabled)())return[2,!1];if(!Object(o.isIndexedDBAvailable)())return[2,!1];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,Object(o.validateIndexedDBOpenable)()];case 2:return[2,t.sent()];case 3:return t.sent(),[2,!1];case 4:return[2]}})})}!function(t){t.INTERNAL.registerComponent(new xp.Component(im,function(t){return function(t,e){!function(){var t=[];if(Object(o.isBrowserExtension)()&&t.push("This is a browser extension environment."),Object(o.areCookiesEnabled)()||t.push("Cookies are not available."),t.length>0){var e=t.map(function(t,e){return"("+(e+1)+") "+t}).join(" "),n=Ky.create("invalid-analytics-context",{errorInfo:e});Uy.warn(n.message)}}();var n,r,s=t.options.appId;if(!s)throw Ky.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Ky.create("no-api-key");Uy.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+t.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Yy[s])throw Ky.create("already-exists",{id:s});if(!nm){n=tm,r=[],Array.isArray(window[n])?r=window[n]:window[n]=r;var a=function(t,e,n,r,o){var s=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];window[r].push(arguments)};return window[o]&&"function"==typeof window[o]&&(s=window[o]),window[o]=function(t,e,n,r){return function(o,s,a){return Object(i.__awaiter)(this,void 0,void 0,function(){var u;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),o!==Ly.EVENT?[3,2]:[4,Vy(t,e,n,s,a)];case 1:return i.sent(),[3,5];case 2:return o!==Ly.CONFIG?[3,4]:[4,qy(t,e,n,r,s,a)];case 3:return i.sent(),[3,5];case 4:t(Ly.SET,s),i.label=5;case 5:return[3,7];case 6:return u=i.sent(),Uy.error(u),[3,7];case 7:return[2]}})})}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[o]}}(Yy,Jy,Zy,tm,em);$y=a.wrappedGtag,Qy=a.gtagCore,nm=!0}return Yy[s]=function(t,e,n,r,s,a){return Object(i.__awaiter)(this,void 0,void 0,function(){var u,c,h,l,f,p,d;return Object(i.__generator)(this,function(g){switch(g.label){case 0:return(u=function(t,e,n){return void 0===e&&(e=Gy),Object(i.__awaiter)(this,void 0,void 0,function(){var n,r,o,s,a,u,c=this;return Object(i.__generator)(this,function(h){if(o=(n=t.options).apiKey,s=n.measurementId,!(r=n.appId))throw Ky.create("no-app-id");if(!o){if(s)return[2,{measurementId:s,appId:r}];throw Ky.create("no-api-key")}return a=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},u=new Xy,setTimeout(function(){return Object(i.__awaiter)(c,void 0,void 0,function(){return Object(i.__generator)(this,function(t){return u.abort(),[2]})})},6e4),[2,Hy({appId:r,apiKey:o,measurementId:s},a,u,e)]})})}(t)).then(function(e){n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Uy.warn("The measurement ID in the local Firebase config ("+t.options.measurementId+") does not match the measurement ID fetched from the server ("+e.measurementId+"). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(function(t){return Uy.error(t)}),e.push(u),c=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t;return Object(i.__generator)(this,function(e){switch(e.label){case 0:return Object(o.isIndexedDBAvailable)()?[3,1]:(Uy.warn(Ky.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),[2,!1]);case 1:return e.trys.push([1,3,,4]),[4,Object(o.validateIndexedDBOpenable)()];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),Uy.warn(Ky.create("indexeddb-unavailable",{errorInfo:t}).message),[2,!1];case 4:return[2,!0]}})})}().then(function(t){return t?r.getId():void 0}),[4,Promise.all([u,c])];case 1:return h=g.sent(),l=h[0],f=h[1],function(){for(var t=window.document.getElementsByTagName("script"),e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(r.src&&r.src.includes(My))return r}return null}()||function(t,e){var n=document.createElement("script");n.src=My+"?l="+t+"&id="+e,n.async=!0,document.head.appendChild(n)}(a,l.measurementId),s("js",new Date),(d={}).origin="firebase",d.update=!0,p=d,null!=f&&(p.firebase_id=f),s(Ly.CONFIG,l.measurementId,p),[2,l.measurementId]}})})}(t,Jy,Zy,e,Qy,tm),{app:t,logEvent:function(t,e,n){(function(t,e,n,r,o){return Object(i.__awaiter)(this,void 0,void 0,function(){var s,a;return Object(i.__generator)(this,function(u){switch(u.label){case 0:return o&&o.global?(t(Ly.EVENT,n,r),[2]):[3,1];case 1:return[4,e];case 2:s=u.sent(),a=Object(i.__assign)(Object(i.__assign)({},r),{send_to:s}),t(Ly.EVENT,n,a),u.label=3;case 3:return[2]}})})})($y,Yy[s],t,e,n).catch(function(t){return Uy.error(t)})},setCurrentScreen:function(t,e){(function(t,e,n,r){return Object(i.__awaiter)(this,void 0,void 0,function(){var o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return r&&r.global?(t(Ly.SET,{screen_name:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,e];case 2:o=i.sent(),t(Ly.CONFIG,o,{update:!0,screen_name:n}),i.label=3;case 3:return[2]}})})})($y,Yy[s],t,e).catch(function(t){return Uy.error(t)})},setUserId:function(t,e){(function(t,e,n,r){return Object(i.__awaiter)(this,void 0,void 0,function(){var o;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return r&&r.global?(t(Ly.SET,{user_id:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,e];case 2:o=i.sent(),t(Ly.CONFIG,o,{update:!0,user_id:n}),i.label=3;case 3:return[2]}})})})($y,Yy[s],t,e).catch(function(t){return Uy.error(t)})},setUserProperties:function(t,e){(function(t,e,n,r){return Object(i.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c;return Object(i.__generator)(this,function(i){switch(i.label){case 0:if(!r||!r.global)return[3,1];for(o={},s=0,a=Object.keys(n);s<a.length;s++)o["user_properties."+(u=a[s])]=n[u];return t(Ly.SET,o),[2,Promise.resolve()];case 1:return[4,e];case 2:c=i.sent(),t(Ly.CONFIG,c,{update:!0,user_properties:n}),i.label=3;case 3:return[2]}})})})($y,Yy[s],t,e).catch(function(t){return Uy.error(t)})},setAnalyticsCollectionEnabled:function(t){(function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,t];case 1:return n=r.sent(),window["ga-disable-"+n]=!e,[2]}})})})(Yy[s],t).catch(function(t){return Uy.error(t)})},INTERNAL:{delete:function(){return delete Yy[s],Promise.resolve()}}}}(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())},"PUBLIC").setServiceProps({settings:rm,EventName:Fy,isSupported:om})),t.INTERNAL.registerComponent(new xp.Component("analytics-internal",function(t){try{return{logEvent:t.getProvider(im).getImmediate().logEvent}}catch(jp){throw Ky.create("interop-component-reg-failed",{reason:jp})}},"PRIVATE")),t.registerVersion("@firebase/analytics","0.6.14")}(r.default);var sm,am=function(){function t(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}return t.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},t.prototype.fetch=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=i.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(t.cacheMaxAgeMillis,n)?[2,r]:(t.eTag=r&&r.eTag,[4,this.client.fetch(t)]);case 2:return o=i.sent(),s=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===o.status&&s.push(this.storage.setLastSuccessfulFetchResponse(o)),[4,Promise.all(s)];case 3:return i.sent(),[2,o]}})})},t}(),um=((sm={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",sm["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",sm["registration-api-key"]="Undefined API key. Check Firebase app initialization.",sm["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",sm["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",sm["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",sm["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",sm["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",sm["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",sm["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',sm["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',sm["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",sm["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",sm),cm=new o.ErrorFactory("remoteconfig","Remote Config",um),hm=function(){function t(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}return t.prototype.fetch=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n,r,o,s,a,u,c,h,l,f,p,d,g,v,y;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=i.sent(),n=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",r=n+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,o={sdk_version:this.sdkVersion,app_instance_id:e[0],app_instance_id_token:e[1],app_id:this.appId,language_code:(void 0===m&&(m=navigator),m.languages&&m.languages[0]||m.language)},s={method:"POST",headers:{"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":t.eTag||"*"},body:JSON.stringify(o)},a=fetch(r,s),u=new Promise(function(e,n){t.signal.addEventListener(function(){var t=new Error("The operation was aborted.");t.name="AbortError",n(t)})}),i.label=2;case 2:return i.trys.push([2,5,,6]),[4,Promise.race([a,u])];case 3:return i.sent(),[4,a];case 4:return c=i.sent(),[3,6];case 5:throw h=i.sent(),l="fetch-client-network","AbortError"===h.name&&(l="fetch-timeout"),cm.create(l,{originalErrorMessage:h.message});case 6:if(f=c.status,p=c.headers.get("ETag")||void 0,200!==c.status)return[3,11];v=void 0,i.label=7;case 7:return i.trys.push([7,9,,10]),[4,c.json()];case 8:return v=i.sent(),[3,10];case 9:throw y=i.sent(),cm.create("fetch-client-parse",{originalErrorMessage:y.message});case 10:d=v.entries,g=v.state,i.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===g?f=500:"NO_CHANGE"===g?f=304:"NO_TEMPLATE"!==g&&"EMPTY_CONFIG"!==g||(d={}),304!==f&&200!==f)throw cm.create("fetch-status",{httpStatus:f});return[2,{status:f,eTag:p,config:d}]}var m})})},t}(),lm=function(){function t(){this.listeners=[]}return t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},t}(),fm=["1","true","t","yes","y","on"],pm=function(){function t(t,e){void 0===e&&(e=""),this._source=t,this._value=e}return t.prototype.asString=function(){return this._value},t.prototype.asBoolean=function(){return"static"!==this._source&&fm.indexOf(this._value.toLowerCase())>=0},t.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},t.prototype.getSource=function(){return this._source},t}(),dm=function(){function t(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}return t.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=s.LogLevel.DEBUG;break;case"silent":this._logger.logLevel=s.LogLevel.SILENT;break;default:this._logger.logLevel=s.LogLevel.ERROR}},Object.defineProperty(t.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!1,configurable:!0}),t.prototype.activate=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e,n;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return t=r.sent(),n=t[1],(e=t[0])&&e.config&&e.eTag&&e.eTag!==n?[4,Promise.all([this._storageCache.setActiveConfig(e.config),this._storage.setActiveConfigEtag(e.eTag)])]:[2,!1];case 2:return r.sent(),[2,!0]}})})},t.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){t._isInitializationComplete=!0})),this._initializePromise},t.prototype.fetch=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(i.__generator)(this,function(s){switch(s.label){case 0:t=new lm,setTimeout(function(){return Object(i.__awaiter)(r,void 0,void 0,function(){return Object(i.__generator)(this,function(e){return t.abort(),[2]})})},this.settings.fetchTimeoutMillis),s.label=1;case 1:return s.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:t})];case 2:return s.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return s.sent(),[3,6];case 4:return e=s.sent(),n=function(t,e){return t instanceof o.FirebaseError&&-1!==t.code.indexOf("fetch-throttle")}(e)?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(n)];case 5:throw s.sent(),e;case 6:return[2]}})})},t.prototype.fetchAndActivate=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}})})},t.prototype.getAll=function(){var t,e,n=this;return(t=this._storageCache.getActiveConfig(),e=this.defaultConfig,void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(Object(i.__assign)(Object(i.__assign)({},t),e))).reduce(function(t,e){return t[e]=n.getValue(e),t},{})},t.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},t.prototype.getNumber=function(t){return this.getValue(t).asNumber()},t.prototype.getString=function(t){return this.getValue(t).asString()},t.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new pm("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new pm("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new pm("static"))},t}();function gm(t,e){var n=t.target.error||void 0;return cm.create(e,{originalErrorMessage:n&&n.message})}var vm="app_namespace_store",ym=function(){function t(t,e,n,r){void 0===r&&(r=new Promise(function(t,e){var n=indexedDB.open("firebase_remote_config",1);n.onerror=function(t){e(gm(t,"storage-open"))},n.onsuccess=function(e){t(e.target.result)},n.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(vm,{keyPath:"compositeKey"})}}})),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}return t.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},t.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},t.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},t.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},t.prototype.getActiveConfig=function(){return this.get("active_config")},t.prototype.setActiveConfig=function(t){return this.set("active_config",t)},t.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},t.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},t.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},t.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},t.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},t.prototype.get=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise(function(r,i){var o=e.transaction([vm],"readonly").objectStore(vm),s=n.createCompositeKey(t);try{var a=o.get(s);a.onerror=function(t){i(gm(t,"storage-get"))},a.onsuccess=function(t){var e=t.target.result;r(e?e.value:void 0)}}catch(jp){i(cm.create("storage-get",{originalErrorMessage:jp&&jp.message}))}})]}})})},t.prototype.set=function(t,e){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,r=this;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,this.openDbPromise];case 1:return n=i.sent(),[2,new Promise(function(i,o){var s=n.transaction([vm],"readwrite").objectStore(vm),a=r.createCompositeKey(t);try{var u=s.put({compositeKey:a,value:e});u.onerror=function(t){o(gm(t,"storage-set"))},u.onsuccess=function(){i()}}catch(jp){o(cm.create("storage-set",{originalErrorMessage:jp&&jp.message}))}})]}})})},t.prototype.delete=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,n=this;return Object(i.__generator)(this,function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise(function(r,i){var o=e.transaction([vm],"readwrite").objectStore(vm),s=n.createCompositeKey(t);try{var a=o.delete(s);a.onerror=function(t){i(gm(t,"storage-delete"))},a.onsuccess=function(){r()}}catch(jp){i(cm.create("storage-delete",{originalErrorMessage:jp&&jp.message}))}})]}})})},t.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},t}(),mm=function(){function t(t){this.storage=t}return t.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},t.prototype.getActiveConfig=function(){return this.activeConfig},t.prototype.loadFromStorage=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return t=this.storage.getLastFetchStatus(),e=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),[4,t];case 1:return(r=i.sent())&&(this.lastFetchStatus=r),[4,e];case 2:return(o=i.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,n];case 3:return(s=i.sent())&&(this.activeConfig=s),[2]}})})},t.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},t.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},t}();function bm(t,e){return new Promise(function(n,r){var i=Math.max(e-Date.now(),0),o=setTimeout(n,i);t.addEventListener(function(){clearTimeout(o),r(cm.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}var _m,wm=function(){function t(t,e){this.client=t,this.storage=e}return t.prototype.fetch=function(t){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=n.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(t,e)]}})})},t.prototype.attemptFetch=function(t,e){var n=e.throttleEndTimeMillis,r=e.backoffCount;return Object(i.__awaiter)(this,void 0,void 0,function(){var e,s,a;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,bm(t.signal,n)];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,5,,7]),[4,this.client.fetch(t)];case 3:return e=i.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return i.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof o.FirebaseError&&t.customData))return!1;var e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(s=i.sent()))throw s;return a={throttleEndTimeMillis:Date.now()+Object(o.calculateBackoffMillis)(r),backoffCount:r+1},[4,this.storage.setThrottleMetadata(a)];case 6:return i.sent(),[2,this.attemptFetch(t,a)];case 7:return[2]}})})},t}(),Tm="@firebase/remote-config";(_m=r.default).INTERNAL.registerComponent(new xp.Component("remoteConfig",function(t,e){var n=e.instanceIdentifier,r=t.getProvider("app").getImmediate(),i=t.getProvider("installations").getImmediate();if("undefined"==typeof window)throw cm.create("registration-window");var o=r.options,a=o.projectId,u=o.apiKey,c=o.appId;if(!a)throw cm.create("registration-project-id");if(!u)throw cm.create("registration-api-key");if(!c)throw cm.create("registration-app-id");var h=new ym(c,r.name,n=n||"firebase"),l=new mm(h),f=new s.Logger(Tm);f.logLevel=s.LogLevel.ERROR;var p=new hm(i,_m.SDK_VERSION,n,a,u,c),d=new wm(p,h),g=new am(d,h,l,f),v=new dm(r,g,l,h,f);return v.ensureInitialized(),v},"PUBLIC").setMultipleInstances(!0)),_m.registerVersion(Tm,"0.1.41"),n("X8/r");var Im="8.7.1";r.default.registerVersion("firebase",Im,"app"),r.default.SDK_VERSION=Im,console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),r.default.registerVersion("firebase","8.7.1")},"X8/r":function(t,e,n){"use strict";var r=n("zIRd"),i=n("/6Yf"),o=n("mrSG"),s=n("qOnz"),a=n("q/0M");function u(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var c,h=u(r),l=((c={})["already-activated"]="You are trying to activate AppCheck for FirebaseApp {$appName}, while it is already activated. AppCheck can only be activated once.",c["use-before-activation"]="AppCheck is being used before activate() is called for FirebaseApp {$appName}. Please make sure you call activate() before instantiating other Firebase services.",c["fetch-network-error"]="Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",c["fetch-parse-error"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",c["fetch-status-error"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",c["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",c["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",c["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",c["recaptcha-error"]="ReCAPTCHA error.",c),f=new s.ErrorFactory("appCheck","AppCheck",l),p=new Map,d={activated:!1,tokenObservers:[]},g={enabled:!1};function v(t){return p.get(t)||d}function y(t,e){p.set(t,e)}function m(){return g}function b(){return self.grecaptcha}function _(t){if(!v(t).activated)throw f.create("use-before-activation",{appName:t.name})}function w(t){return o.__awaiter(this,void 0,void 0,function(){var e;return o.__generator(this,function(n){switch(n.label){case 0:return _(t),[4,v(t).reCAPTCHAState.initialized.promise];case 1:return e=n.sent(),[2,new Promise(function(n,r){var i=v(t).reCAPTCHAState;e.ready(function(){n(e.execute(i.widgetId,{action:"fire_app_check"}))})})]}})})}function T(t,e,n,r){var i=n.render(r,{sitekey:e,size:"invisible"}),s=v(t);y(t,o.__assign(o.__assign({},s),{reCAPTCHAState:o.__assign(o.__assign({},s.reCAPTCHAState),{widgetId:i})}))}var I="https://content-firebaseappcheck.googleapis.com/v1beta",E=function(){function t(t,e,n,r,i){if(this.operation=t,this.retryPolicy=e,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}return t.prototype.start=function(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(function(){})},t.prototype.stop=function(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)},t.prototype.isRunning=function(){return!!this.pending},t.prototype.process=function(t){return o.__awaiter(this,void 0,void 0,function(){var e;return o.__generator(this,function(n){switch(n.label){case 0:this.stop(),n.label=1;case 1:return n.trys.push([1,6,,7]),this.pending=new s.Deferred,[4,(r=this.getNextRun(t),new Promise(function(t){setTimeout(t,r)}))];case 2:return n.sent(),this.pending.resolve(),[4,this.pending.promise];case 3:return n.sent(),this.pending=new s.Deferred,[4,this.operation()];case 4:return n.sent(),this.pending.resolve(),[4,this.pending.promise];case 5:return n.sent(),this.process(!0).catch(function(){}),[3,7];case 6:return e=n.sent(),this.retryPolicy(e)?this.process(!1).catch(function(){}):this.stop(),[3,7];case 7:return[2]}var r})})},t.prototype.getNextRun=function(t){if(t)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e},t}();function O(t,e){var n=t.url,r=t.body;return o.__awaiter(this,void 0,void 0,function(){var t,i,s,a,u,c,h,l,p,d;return o.__generator(this,function(o){switch(o.label){case 0:t={"Content-Type":"application/json"},(i=e.getImmediate({optional:!0}))&&(t["X-Firebase-Client"]=i.getPlatformInfoString()),s={method:"POST",body:JSON.stringify(r),headers:t},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(n,s)];case 2:return a=o.sent(),[3,4];case 3:throw u=o.sent(),f.create("fetch-network-error",{originalErrorMessage:u.message});case 4:if(200!==a.status)throw f.create("fetch-status-error",{httpStatus:a.status});o.label=5;case 5:return o.trys.push([5,7,,8]),[4,a.json()];case 6:return c=o.sent(),[3,8];case 7:throw h=o.sent(),f.create("fetch-parse-error",{originalErrorMessage:h.message});case 8:if(!(l=c.ttl.match(/^([\d.]+)(s)$/))||!l[2]||isNaN(Number(l[1])))throw f.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: "+c.ttl});return p=1e3*Number(l[1]),d=Date.now(),[2,{token:c.attestationToken,expireTimeMillis:d+p,issuedAtTimeMillis:d}]}})})}function S(t,e){var n=t.options;return{url:I+"/projects/"+n.projectId+"/apps/"+n.appId+":exchangeRecaptchaToken?key="+n.apiKey,body:{recaptcha_token:e}}}function k(t,e){var n=t.options;return{url:I+"/projects/"+n.projectId+"/apps/"+n.appId+":exchangeDebugToken?key="+n.apiKey,body:{debug_token:e}}}var A="firebase-app-check-store",j="debug-token",C=null;function N(){return C||(C=new Promise(function(t,e){try{var n=indexedDB.open("firebase-app-check-database",1);n.onsuccess=function(e){t(e.target.result)},n.onerror=function(t){var n;e(f.create("storage-open",{originalErrorMessage:null===(n=t.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(A,{keyPath:"compositeKey"})}}}catch(r){e(f.create("storage-open",{originalErrorMessage:r.message}))}}))}function D(t){return R(P(t))}function x(t,e){return o.__awaiter(this,void 0,void 0,function(){var n,r,i,s;return o.__generator(this,function(o){switch(o.label){case 0:return[4,N()];case 1:return n=o.sent(),r=n.transaction(A,"readwrite"),i=r.objectStore(A),s=i.put({compositeKey:t,value:e}),[2,new Promise(function(t,e){s.onsuccess=function(e){t()},r.onerror=function(t){var n;e(f.create("storage-set",{originalErrorMessage:null===(n=t.target.error)||void 0===n?void 0:n.message}))}})]}})})}function R(t){return o.__awaiter(this,void 0,void 0,function(){var e,n,r,i;return o.__generator(this,function(o){switch(o.label){case 0:return[4,N()];case 1:return e=o.sent(),n=e.transaction(A,"readonly"),r=n.objectStore(A),i=r.get(t),[2,new Promise(function(t,e){i.onsuccess=function(e){var n=e.target.result;t(n?n.value:void 0)},n.onerror=function(t){var n;e(f.create("storage-get",{originalErrorMessage:null===(n=t.target.error)||void 0===n?void 0:n.message}))}})]}})})}function P(t){return t.options.appId+"-"+t.name}var M=new a.Logger("@firebase/app-check");function L(t){return o.__awaiter(this,void 0,void 0,function(){var e,n;return o.__generator(this,function(r){switch(r.label){case 0:if(!s.isIndexedDBAvailable())return[3,5];e=void 0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,D(t)];case 2:return e=r.sent(),[3,4];case 3:return n=r.sent(),M.warn("Failed to read token from indexeddb. Error: "+n),[3,4];case 4:return[2,e];case 5:return[2,void 0]}})})}function F(t,e){return s.isIndexedDBAvailable()?function(t,e){return x(P(t),e)}(t,e).catch(function(t){M.warn("Failed to write token to indexeddb. Error: "+t)}):Promise.resolve()}function U(){return o.__awaiter(this,void 0,void 0,function(){var t;return o.__generator(this,function(e){if((t=m()).enabled&&t.token)return[2,t.token.promise];throw Error("\n            Can't get debug token in production mode.\n        ")})})}var q={error:"UNKNOWN_ERROR"};function V(t,e,n){return void 0===n&&(n=!1),o.__awaiter(this,void 0,void 0,function(){var r,i,a,u,c,h,l,p,d,g,b,T,I,E;return o.__generator(this,function(A){switch(A.label){case 0:return _(t),r=v(t),a=void 0,(i=r.token)?[3,2]:[4,L(t)];case 1:(u=A.sent())&&z(u)&&(i=u,y(t,o.__assign(o.__assign({},r),{token:i})),G(t,{token:i.token})),A.label=2;case 2:return!n&&i&&z(i)?[2,{token:i.token}]:m().enabled?(h=O,l=k,p=[t],[4,U()]):[3,6];case 3:return[4,h.apply(void 0,[l.apply(void 0,p.concat([A.sent()])),e])];case 4:return c=A.sent(),[4,F(t,c)];case 5:return A.sent(),y(t,o.__assign(o.__assign({},r),{token:c})),[2,{token:c.token}];case 6:return A.trys.push([6,12,,13]),r.customProvider?[4,r.customProvider.getToken()]:[3,8];case 7:return d=A.sent(),g=s.issuedAtTime(d.token),b=null!==g&&g<Date.now()&&g>0?1e3*g:Date.now(),i=o.__assign(o.__assign({},d),{issuedAtTimeMillis:b}),[3,11];case 8:return[4,w(t).catch(function(t){throw f.create("recaptcha-error")})];case 9:return T=A.sent(),[4,O(S(t,T),e)];case 10:i=A.sent(),A.label=11;case 11:return[3,13];case 12:return I=A.sent(),M.error(I),a=I,[3,13];case 13:return i?[3,14]:(E=function(t){return{token:(e=q,s.base64.encodeString(JSON.stringify(e),!1)),error:t};var e}(a),[3,16]);case 14:return E={token:i.token},y(t,o.__assign(o.__assign({},r),{token:i})),[4,F(t,i)];case 15:A.sent(),A.label=16;case 16:return G(t,E),[2,E]}})})}function B(t,e,n,r,i){var s=v(t),a={next:r,error:i,type:n},u=o.__assign(o.__assign({},s),{tokenObservers:o.__spreadArray(o.__spreadArray([],s.tokenObservers),[a])});if(!u.tokenRefresher){var c=function(t,e){var n=this;return new E(function(){return o.__awaiter(n,void 0,void 0,function(){var n;return o.__generator(this,function(r){switch(r.label){case 0:return v(t).token?[3,2]:[4,V(t,e)];case 1:return n=r.sent(),[3,4];case 2:return[4,V(t,e,!0)];case 3:n=r.sent(),r.label=4;case 4:if(n.error)throw n.error;return[2]}})})},function(){return!0},function(){var e=v(t);if(e.token){var n=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;return n=Math.min(n,e.token.expireTimeMillis-3e5),Math.max(0,n-Date.now())}return 0},3e4,96e4)}(t,e);u.tokenRefresher=c}if(u.tokenRefresher.isRunning()||!0!==s.isTokenAutoRefreshEnabled||u.tokenRefresher.start(),s.token&&z(s.token)){var h=s.token;Promise.resolve().then(function(){return r({token:h.token})}).catch(function(){})}y(t,u)}function K(t,e){var n=v(t),r=n.tokenObservers.filter(function(t){return t.next!==e});0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),y(t,o.__assign(o.__assign({},n),{tokenObservers:r}))}function G(t,e){for(var n=0,r=v(t).tokenObservers;n<r.length;n++){var i=r[n];try{"EXTERNAL"===i.type&&null!=e.error?i.error(e.error):i.next(e)}catch(o){}}}function z(t){return t.expireTimeMillis-Date.now()>0}var H="app-check-internal";!function(t){t.INTERNAL.registerComponent(new i.Component("appCheck",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("platform-logger"),{app:e,activate:function(t,n){return function(t,e,n){var r=v(t);if(r.activated)throw f.create("already-activated",{appName:t.name});var i=o.__assign(o.__assign({},r),{activated:!0});"string"==typeof e?i.siteKey=e:i.customProvider=e,i.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,y(t,i),i.siteKey&&function(t,e){var n=v(t),r=new s.Deferred;y(t,o.__assign(o.__assign({},n),{reCAPTCHAState:{initialized:r}}));var i="fire_app_check_"+t.name,a=document.createElement("div");a.id=i,a.style.display="none",document.body.appendChild(a);var u,c,h=b();return h?h.ready(function(){T(t,e,h,i),r.resolve(h)}):(u=function(){var n=b();if(!n)throw new Error("no recaptcha");n.ready(function(){T(t,e,n,i),r.resolve(n)})},(c=document.createElement("script")).src="https://www.google.com/recaptcha/api.js",c.onload=u,document.head.appendChild(c)),r.promise}(t,i.siteKey).catch(function(){})}(e,t,n)},setTokenAutoRefreshEnabled:function(t){return function(t,e){var n=v(t);n.tokenRefresher&&(!0===e?n.tokenRefresher.start():n.tokenRefresher.stop()),y(t,o.__assign(o.__assign({},n),{isTokenAutoRefreshEnabled:e}))}(e,t)},getToken:function(t){return function(t,e,n){return o.__awaiter(this,void 0,void 0,function(){var r;return o.__generator(this,function(i){switch(i.label){case 0:return[4,V(t,e,n)];case 1:if((r=i.sent()).error)throw r.error;return[2,{token:r.token}]}})})}(e,n,t)},onTokenChanged:function(t,r,i){return function(t,e,n,r,i){var o,s=function(){};return o=null!=n.next?n.next.bind(n):n,null!=n.error?s=n.error.bind(n):r&&(s=r),B(t,e,"EXTERNAL",o,s),function(){return K(t,o)}}(e,n,t,r)},INTERNAL:{delete:function(){for(var t=0,n=v(e).tokenObservers;t<n.length;t++)K(e,n[t].next);return Promise.resolve()}}};var e,n},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(function(t,e,n){t.getProvider(H).initialize()})),t.INTERNAL.registerComponent(new i.Component(H,function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("platform-logger"),{getToken:function(t){return V(e,n,t)},addTokenListener:function(t){return B(e,n,"INTERNAL",t)},removeTokenListener:function(t){return K(e,t)}};var e,n},"PUBLIC").setInstantiationMode("EXPLICIT")),t.registerVersion("@firebase/app-check","0.2.0")}(h.default),function(){var t=s.getGlobal();if("string"==typeof t.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===t.FIREBASE_APPCHECK_DEBUG_TOKEN){var e=m();e.enabled=!0;var n=new s.Deferred;e.token=n,n.resolve("string"==typeof t.FIREBASE_APPCHECK_DEBUG_TOKEN?t.FIREBASE_APPCHECK_DEBUG_TOKEN:function(){return o.__awaiter(this,void 0,void 0,function(){var t,e;return o.__generator(this,function(n){switch(n.label){case 0:t=void 0,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,R(j)];case 2:return t=n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:return t?[2,t]:((r=e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),x(j,r)).catch(function(t){return M.warn("Failed to persist debug token to indexeddb. Error: "+t)}),console.log("AppCheck debug token: "+e+". You will need to whitelist it in the Firebase console for it to work"),[2,e])}var r})})}())}}()},nbvr:function(t,e,n){!function(t){"use strict";function e(t){return Array.prototype.slice.call(t)}function n(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function r(t,e,r){var i,o=new Promise(function(o,s){n(i=t[e].apply(t,r)).then(o,s)});return o.request=i,o}function i(t,e,n){var i=r(t,e,n);return i.then(function(t){if(t)return new h(t,i.request)})}function o(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function s(t,e,n,i){i.forEach(function(i){i in n.prototype&&(t.prototype[i]=function(){return r(this[e],i,arguments)})})}function a(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function u(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return i(this[e],r,arguments)})})}function c(t){this._index=t}function h(t,e){this._cursor=t,this._request=e}function l(t){this._store=t}function f(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function p(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new f(n)}function d(t){this._db=t}o(c,"_index",["name","keyPath","multiEntry","unique"]),s(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),u(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(h,"_cursor",["direction","key","primaryKey","value"]),s(h,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(h.prototype[t]=function(){var e=this,r=arguments;return Promise.resolve().then(function(){return e._cursor[t].apply(e._cursor,r),n(e._request).then(function(t){if(t)return new h(t,e._request)})})})}),l.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},o(l,"_store",["name","keyPath","indexNames","autoIncrement"]),s(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),u(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),a(l,"_store",IDBObjectStore,["deleteIndex"]),f.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},o(f,"_tx",["objectStoreNames","mode"]),a(f,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},o(p,"_db",["name","version","objectStoreNames"]),a(p,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new f(this._db.transaction.apply(this._db,arguments))},o(d,"_db",["name","version","objectStoreNames"]),a(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[l,c].forEach(function(n){t in n.prototype&&(n.prototype[t.replace("open","iterate")]=function(){var n=e(arguments),r=n[n.length-1],i=this._store||this._index,o=i[t].apply(i,n.slice(0,-1));o.onsuccess=function(){r(o.result)}})})}),[c,l].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(i){n.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)})})})}),t.openDb=function(t,e,n){var i=r(indexedDB,"open",[t,e]),o=i.request;return o&&(o.onupgradeneeded=function(t){n&&n(new p(o.result,t.oldVersion,o.transaction))}),i.then(function(t){return new d(t)})},t.deleteDb=function(t){return r(indexedDB,"deleteDatabase",[t])},Object.defineProperty(t,"__esModule",{value:!0})}(e)}}]);